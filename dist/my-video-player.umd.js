(function(Pe,Zt){typeof exports=="object"&&typeof module<"u"?module.exports=Zt(require("vue")):typeof define=="function"&&define.amd?define(["vue"],Zt):(Pe=typeof globalThis<"u"?globalThis:Pe||self,Pe.MyVideoPlayer=Zt(Pe.Vue))})(this,(function(Pe){"use strict";var Zt=document.createElement("style");Zt.textContent=`body{margin:0;padding:0}.fullscreen-video{position:fixed!important;left:0;top:0;width:100vw;height:100vh;z-index:9999}.fullscreen-video video,.fullscreen-video canvas{width:100%;height:calc(100% - 37px)}.fullscreen-video .jessibuca-loading-bg{height:calc(100% - 37px)}.fullscreen-video .jessibuca-controls{z-index:20}.fullscreen-video .screen-shot-btn{position:absolute;right:10px;top:10px;z-index:3;width:30px;height:30px;cursor:pointer}.fullscreen-video .video-js.vjs-playing .vjs-tech{pointer-events:none}.fullscreen-video .video-tip{position:absolute;left:10px;top:10px;font-size:15px;color:#fff;z-index:2}.fullscreen-video .wrapper{background:#000;overflow:hidden;width:100%;height:100%}.fullscreen-video .video-error-status,.fullscreen-video .video-none-status{font-size:1.2em;color:#ccc}.video-item[data-v-acd97828]{width:100%;height:100%;background:#000;position:relative}.video-item[data-v-acd97828] video,.video-item[data-v-acd97828] canvas{width:100%;height:calc(100% - 37px)}.video-item[data-v-acd97828] .jessibuca-loading-bg{height:calc(100% - 37px)}.video-item[data-v-acd97828] .jessibuca-controls{z-index:20}.video-item[data-v-acd97828] .screen-shot-btn{position:absolute;right:10px;top:10px;z-index:3;width:30px;height:30px;cursor:pointer}.video-item .video-js.vjs-playing .vjs-tech[data-v-acd97828]{pointer-events:none}.video-item .video-tip[data-v-acd97828]{position:absolute;left:10px;top:10px;font-size:15px;color:#fff;z-index:2}.video-item .wrapper[data-v-acd97828]{background:#000;overflow:hidden;width:100%;height:100%}.video-item .video-error-status[data-v-acd97828],.video-item .video-none-status[data-v-acd97828]{font-size:1.2em;color:#ccc}canvas[data-v-74e4a689]{width:100%;height:100%;background:#000;position:relative}.videoPlayer[data-v-e3943240]{width:100vw;height:80vh;margin:auto}
/*$vite$:1*/`,document.head.appendChild(Zt);const xr=(Ae,Xe)=>{const He=Ae.__vccOpts||Ae;for(const[ve,Ie]of Xe)He[ve]=Ie;return He},Cr="http://127.0.0.1:8080",Lr="aOacmzbW3VEqKeJB3nOsRyEPX6WppTvV",kn=xr({__name:"jessibucaPlayer",props:{data:{type:Object,default:{url:"https://cswc.jxs163.com:5012/pss/11010101001320004589_691fb74960b245083a43b956.flv"}},streamType:{type:String,default:"0"},parentEmits:{type:[Object,Function],default:()=>()=>{}},videoIndex:Number,isRoundPlay:Boolean,showAudioBtn:Boolean},setup(Ae,{expose:Xe,emit:He}){const ve=Ae,Ie=Pe.ref(null),It=Pe.ref(null),pe=Pe.ref(null),Ze=Pe.ref(!1),Gt=Pe.ref(!1),wt=Pe.ref(!1),Pt=He,St=Pe.ref(0),Ht=async()=>{try{await Pe.nextTick();let Me="";(ve.isRoundPlay||ve.streamType=="1")&&(Me=ve.data?.img),pe.value=new JessibucaPro({hasAudio:ve.showAudioBtn,container:Ie.value,decoder:"../../assets/js/jessibucaPlayer/decoder-pro.js",decoderAudio:"../../assets/js/jessibucaPlayer/decoder-pro-audio.js",videoBuffer:2,videoBufferDelay:2,isResize:ve?.data?.isResize||!1,isFlv:ve.data.url.indexOf("rtsp://")!==-1,text:"",loadingText:"",loadingIcon:!1,debug:!1,debugLevel:"debug",useMSE:!0,useSIMD:!1,useWCS:!1,background:Me||"",loadingBackground:Me||"",showBandwidth:!1,showPerformance:!1,showPlaybackOperate:ve.streamType=="1",operateBtns:{fullscreen:!0,screenshot:!0,play:!1,audio:!0,ptz:!1,quality:!1,performance:!0,zoom:!1},heartTimeout:5,loadingTimeoutReplayTimes:5,pauseAndNextPlayUseLastFrameShow:!0,replayUseLastFrameShow:!0,heartTimeoutReplayUseLastFrameShow:!0,zoomMaxScale:5,flvDemuxBufferSizeTooLargeReplay:!0,audioEngine:"worklet",qualityConfig:["普清","高清","超清","4K","8K"],forceNoOffscreen:!0,isNotMute:!1,supportHls265:!0}),console.log(pe.value," videoInstance.value"),pe.value.on("play",function(){console.log("开始播放 play"),wt.value=!0,ve.data.isError=!1,ve.parentEmits("play")}),pe.value.on("load",function(){console.log("加载完成"),Ze.value=!0}),pe.value.on("error",Se=>{console.log("播放错误 error",Se),Gt.value=!0,ve.parentEmits("disconnect"),Pt("setStreams",{...ve.data,img:ve.data?.img,status:"error",videoIndex:ve.videoIndex}),ve.parentEmits("statusChange",{status:"error",videoIndex:ve.videoIndex,img:ve.data?.img,data:ve.data}),Se==="fetchError"&&!ve.data?.isError&&ve.streamType=="0"&&Pt("refreshItem",{device:{...ve.data,isError:!0},videoIndex:ve.videoIndex})}),pe.value.on("websocketClose",function(){console.log("websocketClose"),St.value<=3&&(St.value+=1,Et(ve.data.url,st.stream,{enable_audio:ve.showAudioBtn?1:0}))})}catch(Me){console.log(Me,"err")}},Et=async Me=>{pe.value.play(Me)};let st={};const Tt=()=>{pe.value&&pe.value.destroy()},vt=Pe.ref(null),kt=Me=>{let Se="";if(!wt.value){alert("视频暂无画面，请稍后截图");return}if(Me&&pe.value.screenshot(),vt.value.querySelector("video")){const Q=document.createElement("canvas"),N=vt.value.querySelector("video");Q.width=N.clientWidth,Q.height=N.clientHeight;var Y=Q.getContext("2d");Y.drawImage(N,0,0,Q.width,Q.height),Se=Q.toDataURL("image/png",1)}else vt.value.querySelector("canvas")&&(Se=vt.value.querySelector("canvas").toDataURL("image/png",1));return Se},Bt=()=>(console.log(pe.value,"jessibuca实例start"),!pe.value||!pe.value.isPlaying()?(alert("视频未开始播放，请稍后录制"),!1):(pe.value.startRecord(),!0)),xt=Me=>{console.log(pe.value,"jessibuca实例close"),pe.value&&pe.value.isRecording()&&(Me?pe.value.stopRecordAndSave():(pe.value.player.emit("recordEnd"),pe.value.player.recorder._reset(),pe.value.player.emit("recording",!1)))},Vt=()=>pe.value.isRecording();Pe.onBeforeUnmount(()=>{Tt()});const Wt=(Me,Se,Y)=>{const Q=new URLSearchParams;for(const[N,ae]of Object.entries(Y))Q.append(N,ae);return new Promise((N,ae)=>{console.log(Q.toString()),fetch(`${Cr}/index/api/addStreamProxy?secret=${Lr}&vhost={{defaultVhost}}&app=live&stream=${Se}&url=${encodeURIComponent(Me)}&enable_hls=&enable_hls_fmp4=&enable_mp4=&enable_rtsp=1&enable_rtmp=1&enable_ts=1&enable_fmp4=1${Q.toString()?"&"+Q.toString():""}`).then(oe=>{oe.json().then(async H=>{if(H.code===-1)reFetch(Me,Se).then(()=>{const de=`ws://127.0.0.1:8080/live/${Se}.live.flv`;N(de)});else{const de=`ws://127.0.0.1:8080/live/${Se}.live.flv`;N(de)}})}).catch(oe=>{ae(),!window.pluginAlert&&(window.pluginAlert=ElMessageBox.confirm("请确认已成功安装播放器控件。若已安装播放控件，请检查“window>服务>mediaServer”是否启动或刷新页面后重试！","提示",{confirmButtonText:"立即下载",cancelButtonText:"取消",type:"info"}).then(()=>{window.pluginAlert=null}).catch(()=>{window.pluginAlert=null}))})})};return Pe.onMounted(async()=>{ve.data?.url&&(await Ht(),ve.data.url.indexOf("rtsp://")!==-1?Wt(ve.data.url,new Date().valueOf()+Math.random()*100,{}).then(Me=>{Et(Me)}):Et(ve.data?.url))}),Xe({screenShot:kt,startRecording:Bt,getRecording:Vt,stopRecording:xt,destroy:Tt,pause:()=>{pe.value.pause()},pauseToPlay:()=>{pe.value.play()},cancelMute:()=>{pe.value.cancelMute();const Me={...st}.stream;st={...ve.data,stream:new Date().valueOf()+ve.data.deviceId},Wt(st.url,st.stream,{enable_audio:1}).then(Se=>{fetch(`${Cr}/index/api/delStreamProxy?secret=${Lr}&key=__defaultVhost__/live/${Me}`),pe.value.play(Se)})},mute:()=>{pe.value.mute();const Me={...st}.stream;st={...ve.data,stream:new Date().valueOf()+ve.data.deviceId},Wt(st.url,st.stream,{enable_audio:0}).then(Se=>{fetch(`${Cr}/index/api/delStreamProxy?secret=${Lr}&key=__defaultVhost__/live/${Me}`),pe.value.play(Se)})}}),(Me,Se)=>(Pe.openBlock(),Pe.createElementBlock("div",{class:"video-item",ref_key:"videoBox",ref:It},[Pe.createElementVNode("div",{ref_key:"videoWrapperRef",ref:vt,"element-loading-background":"rgba(122, 122, 122, 0)",class:"wrapper player-wrapper"},[Pe.createElementVNode("div",{ref_key:"videoRef",ref:Ie,style:{width:"100%",height:"100%"}},null,512)],512)],512))}},[["__scopeId","data-v-acd97828"]]),xn=xr({__name:"h265",props:{data:{type:Object}},setup(Ae){const Xe=Ae,He=Pe.ref(null);let ve;return Pe.onMounted(()=>{ve=new libde265.RawPlayer(He.value),ve.playback(Xe.data.url)}),Pe.onUnmounted(()=>{ve&&ve.stop()}),(Ie,It)=>(Pe.openBlock(),Pe.createElementBlock("canvas",{ref_key:"videoRef",ref:He},null,512))}},[["__scopeId","data-v-74e4a689"]]),Cn=xr({__name:"videoPlayer",props:{data:{type:Object,default:{url:"https://ehome-dl.ctseelink.cn/oos/fileDownload?appKey=deviceCloud&timeStamp=1764120418541&version=v1.0&format=json&cid=2199&paras=7D82F1D4B015631E51CD14CCBCCFC8189CF49DA632A466CC7420FFE69EDFBA8B3C1D0EA4DC3A35395CAF2EDD5098E1C48503A7705E666A6A000B5293C43DFEF36FE9D9D4DA73A4014AFDA4C82404E91F845FEE021B77ABBBFCD617CEE41D7EB2E54A125757BCDCA22AED4BA14B6BCE32A788BBAB2E3FCC0E96508F54CF534F084C04FFCF887EAF329F5EB90B&appSignature=t5bbDxwx9Cr0JWBx2lbYtNNF0xs="}}},setup(Ae){const Xe=Ae,He=Xe.data.url.indexOf(".flv")!==-1||Xe.data.url.indexOf("rtsp://")!==-1?kn:xn;return(ve,Ie)=>(Pe.openBlock(),Pe.createBlock(Pe.resolveDynamicComponent(Pe.unref(He)),{data:Xe.data,class:"videoPlayer"},null,8,["data"]))}},[["__scopeId","data-v-e3943240"]]);return(function(Ae){typeof define=="function"&&define.amd?define(Ae):Ae()})(function(){class Ae{on(e,i,s){var u=this.e||(this.e={});return(u[e]||(u[e]=[])).push({fn:i,ctx:s}),this}once(e,i,s){const u=this;function c(){u.off(e,c);for(var l=arguments.length,o=new Array(l),f=0;f<l;f++)o[f]=arguments[f];i.apply(s,o)}return c._=i,this.on(e,c,s)}emit(e){for(var i=((this.e||(this.e={}))[e]||[]).slice(),s=arguments.length,u=new Array(1<s?s-1:0),c=1;c<s;c++)u[c-1]=arguments[c];for(let l=0;l<i.length;l+=1)i[l].fn.apply(i[l].ctx,u);return this}off(e,i){const s=this.e||(this.e={});if(e){var u=s[e],c=[];if(u&&i)for(let l=0,o=u.length;l<o;l+=1)u[l].fn!==i&&u[l].fn._!==i&&c.push(u[l]);return c.length?s[e]=c:delete s[e],this}Object.keys(s).forEach(l=>{delete s[l]}),delete this.e}}const Xe="fetch",He="websocket",ve="worker",Ie="player",It="playerAudio",pe="playbackTF",Ze="mp4",Gt="webm",wt="flv",Pt="webTransport",St="nakedFlow",Ht="fmp4",Et="mpeg4",st={flv:"FLV",m7s:"m7s",hls:"HLS",fmp4:"FMP4",mpeg4:"MPEG4",webrtc:"Webrtc",webTransport:"WebTransport",nakedFlow:"裸流"},Tt="canvas",vt="video",kt="debug",Bt="warn",xt="click",Vt="mouseDownAndUp",Wt={url:"",playbackConfig:{},fullscreenWatermarkConfig:{},playType:Ie,playbackForwardMaxRateDecodeIFrame:4,playOptions:{},isLive:!0,isMulti:!1,isCrypto:!1},ci={playType:Ie,container:"",videoBuffer:1e3,videoBufferDelay:1e3,networkDelay:1e4,isResize:!0,isFullResize:!1,isFlv:!1,isHls:!1,isFmp4:!1,isWebrtc:!1,isWebrtcForZLM:!1,isNakedFlow:!1,isMpeg4:!1,debug:!1,debugLevel:Bt,debugUuid:"",isMulti:!1,hotKey:!1,loadingTimeout:10,heartTimeout:10,timeout:10,pageVisibilityHiddenTimeout:300,loadingTimeoutReplay:!0,heartTimeoutReplay:!0,loadingTimeoutReplayTimes:3,heartTimeoutReplayTimes:3,heartTimeoutReplayUseLastFrameShow:!1,replayUseLastFrameShow:!1,supportDblclickFullscreen:!1,showBandwidth:!1,showPerformance:!1,mseCorrectTimeDuration:20,keepScreenOn:!0,isNotMute:!1,hasAudio:!0,hasVideo:!0,operateBtns:{fullscreen:!1,screenshot:!1,play:!1,audio:!1,record:!1,ptz:!1,quality:!1,zoom:!1,close:!1,scale:!1,performance:!1,aiFace:!1,aiObject:!1,fullscreenFn:null,fullscreenExitFn:null,screenshotFn:null,playFn:null,pauseFn:null,recordFn:null,recordStopFn:null},extendOperateBtns:[],contextmenuBtns:[],watermarkConfig:{},controlAutoHide:!1,hasControl:!1,loadingIcon:!0,loadingText:"",background:"",backgroundLoadingShow:!1,loadingBackground:"",decoder:"decoder-pro.js",decoderAudio:"decoder-pro-audio.js",decoderWASM:"",isDecoderUseCDN:!1,url:"",rotate:0,mirrorRotate:"none",playbackConfig:{playList:[],fps:"",showControl:!0,showRateBtn:!1,rateConfig:[],isCacheBeforeDecodeForFpsRender:!1,uiUsePlaybackPause:!1,isPlaybackPauseClearCache:!0,isUseFpsRender:!1,isUseLocalCalculateTime:!1,localOneFrameTimestamp:40,supportWheel:!1},qualityConfig:[],defaultStreamQuality:"",scaleConfig:["拉伸","缩放","正常"],forceNoOffscreen:!0,hiddenAutoPause:!1,protocol:2,demuxType:wt,useWasm:!1,useWCS:!1,useSIMD:!0,wcsUseVideoRender:!0,wasmUseVideoRender:!0,mseUseCanvasRender:!1,hlsUseCanvasRender:!1,useMSE:!1,useOffscreen:!1,useWebGPU:!1,mseDecodeErrorReplay:!0,wcsDecodeErrorReplay:!0,wasmDecodeErrorReplay:!0,autoWasm:!0,webglAlignmentErrorReplay:!0,webglContextLostErrorReplay:!0,openWebglAlignment:!1,syncAudioAndVideo:!1,playbackDelayTime:1e3,playbackFps:25,playbackForwardMaxRateDecodeIFrame:4,playbackCurrentTimeMove:!0,useVideoRender:!0,useCanvasRender:!1,networkDelayTimeoutReplay:!1,recordType:Ze,checkFirstIFrame:!0,nakedFlowFps:25,audioEngine:null,isShowRecordingUI:!0,isShowZoomingUI:!0,useFaceDetector:!1,useObjectDetector:!1,ptzClickType:xt,ptzStopEmitDelay:.3,ptzZoomShow:!1,ptzApertureShow:!1,ptzFocusShow:!1,ptzMoreArrowShow:!1,weiXinInAndroidAudioBufferSize:4800,isCrypto:!1,cryptoKey:"",cryptoIV:"",cryptoKeyUrl:"",autoResize:!1,useWebFullScreen:!1,ptsMaxDiff:3600,aiFaceDetectWidth:192,aiObjectDetectWidth:192,videoRenderSupportScale:!0,mediaSourceTsIsMaxDiffReplay:!0,controlHtml:"",isH265:!1,supportLockScreenPlayAudio:!0,supportHls265:!0,isFmp4Private:!1},ei="init",pi="initVideo",fi="initAudio",Me="audioCode",Se="videoCode",Y="videoCodec",Q="closeEnd",N={fullscreen:"fullscreen$2",webFullscreen:"webFullscreen",decoderWorkerInit:"decoderWorkerInit",play:"play",playing:"playing",pause:"pause",mute:"mute",load:"load",loading:"loading",zooming:"zooming",videoInfo:"videoInfo",timeUpdate:"timeUpdate",audioInfo:"audioInfo",log:"log",error:"error",kBps:"kBps",timeout:"timeout",delayTimeout:"delayTimeout",delayTimeoutRetryEnd:"delayTimeoutRetryEnd",loadingTimeout:"loadingTimeout",loadingTimeoutRetryEnd:"loadingTimeoutRetryEnd",stats:"stats",performance:"performance",faceDetectActive:"faceDetectActive",objectDetectActive:"objectDetectActive",record:"record",recording:"recording",recordingTimestamp:"recordingTimestamp",recordStart:"recordStart",recordEnd:"recordEnd",recordCreateError:"recordCreateError",recordBlob:"recordBlob",buffer:"buffer",videoFrame:"videoFrame",start:"start",metadata:"metadata",resize:"resize",volumechange:"volumechange",destroy:"destroy",beforeDestroy:"beforeDestroy",streamEnd:"streamEnd",streamRate:"streamRate",streamAbps:"streamAbps",streamVbps:"streamVbps",streamDts:"streamDts",streamSuccess:"streamSuccess",streamMessage:"streamMessage",streamError:"streamError",streamStats:"streamStats",mseSourceOpen:"mseSourceOpen",mseSourceClose:"mseSourceClose",mseSourceended:"mseSourceended",mseSourceBufferError:"mseSourceBufferError",mseAddSourceBufferError:"mseAddSourceBufferError",mseSourceBufferBusy:"mseSourceBufferBusy",mseSourceBufferFull:"mseSourceBufferFull",videoWaiting:"videoWaiting",videoTimeUpdate:"videoTimeUpdate",videoSyncAudio:"videoSyncAudio",playToRenderTimes:"playToRenderTimes",playbackTime:"playbackTime",playbackTimestamp:"playbackTimestamp",playbackPrecision:"playbackPrecision",playbackJustTime:"playbackJustTime",playbackStats:"playbackStats",playbackSeek:"playbackSeek",playbackPause:"playbackPause",playbackPauseOrResume:"playbackPauseOrResume",playbackRateChange:"playbackRateChange",playbackPreRateChange:"playbackPreRateChange",ptz:"ptz",streamQualityChange:"streamQualityChange",visibilityChange:"visibilityChange",netBuf:"netBuf",close:"close",networkDelayTimeout:"networkDelayTimeout",togglePerformancePanel:"togglePerformancePanel",viewResizeChange:"viewResizeChange",flvDemuxBufferSizeTooLarge:"flvDemuxBufferSizeTooLarge",talkGetUserMediaSuccess:"talkGetUserMediaSuccess",talkGetUserMediaFail:"talkGetUserMediaFail",talkGetUserMediaTimeout:"talkGetUserMediaTimeout",talkStreamStart:"talkStreamStart",talkStreamOpen:"talkStreamOpen",talkStreamClose:"talkStreamClose",talkStreamError:"talkStreamError",talkStreamInactive:"talkStreamInactive",webrtcDisconnect:"webrtcDisconnect",webrtcFailed:"webrtcFailed",webrtcClosed:"webrtcClosed",crashLog:"crashLog",focus:"focus",blur:"blur",visibilityHiddenTimeout:"visibilityHiddenTimeout",websocketOpen:"websocketOpen",websocketClose:"websocketClose",websocketError:"websocketError",websocketMessage:"websocketMessage",aiObjectDetectorInfo:"aiObjectDetectorInfo",aiFaceDetector:"aiFaceDetector",playFailedAndPaused:"playFailedAndPaused",audioResumeState:"audioResumeState"},ae={load:N.load,timeUpdate:N.timeUpdate,videoInfo:N.videoInfo,audioInfo:N.audioInfo,error:N.error,kBps:N.kBps,start:N.start,timeout:N.timeout,loadingTimeout:N.loadingTimeout,loadingTimeoutRetryEnd:N.loadingTimeoutRetryEnd,delayTimeout:N.delayTimeout,delayTimeoutRetryEnd:N.delayTimeoutRetryEnd,fullscreen:"fullscreen",webFullscreen:N.webFullscreen,play:N.play,pause:N.pause,mute:N.mute,stats:N.stats,performance:N.performance,recordingTimestamp:N.recordingTimestamp,recordStart:N.recordStart,recordEnd:N.recordEnd,recordBlob:N.recordBlob,playToRenderTimes:N.playToRenderTimes,playbackSeek:N.playbackSeek,playbackStats:N.playbackStats,playbackTimestamp:N.playbackTimestamp,playbackPauseOrResume:N.playbackPauseOrResume,playbackPreRateChange:N.playbackPreRateChange,playbackRateChange:N.playbackRateChange,ptz:N.ptz,streamQualityChange:N.streamQualityChange,zooming:N.zooming,crashLog:N.crashLog,focus:N.focus,blur:N.blur,visibilityHiddenTimeout:N.visibilityHiddenTimeout,visibilityChange:N.visibilityChange,websocketOpen:N.websocketOpen,websocketClose:N.websocketClose,networkDelayTimeout:N.networkDelayTimeout,aiObjectDetectorInfo:N.aiObjectDetectorInfo,playFailedAndPaused:N.playFailedAndPaused,audioResumeState:N.audioResumeState},oe={talkStreamClose:N.talkStreamClose,talkStreamError:N.talkStreamError,talkStreamInactive:N.talkStreamInactive,talkGetUserMediaTimeout:N.talkGetUserMediaTimeout},H={playError:"playIsNotPauseOrUrlIsNull",fetchError:"fetchError",websocketError:"websocketError",webcodecsH265NotSupport:"webcodecsH265NotSupport",webcodecsDecodeError:"webcodecsDecodeError",webcodecsUnsupportedConfigurationError:"webcodecsUnsupportedConfigurationError",mediaSourceH265NotSupport:"mediaSourceH265NotSupport",mediaSourceDecoderConfigurationError:"mediaSourceDecoderConfigurationError",mediaSourceFull:N.mseSourceBufferFull,mseSourceBufferError:N.mseSourceBufferError,mseAddSourceBufferError:N.mseAddSourceBufferError,mediaSourceAppendBufferError:"mediaSourceAppendBufferError",mediaSourceBufferListLarge:"mediaSourceBufferListLarge",mediaSourceAppendBufferEndTimeout:"mediaSourceAppendBufferEndTimeout",mediaSourceTsIsMaxDiff:"mediaSourceTsIsMaxDiff",mediaSourceUseCanvasRenderPlayFailed:"mediaSourceUseCanvasRenderPlayFailed",wasmDecodeError:"wasmDecodeError",wasmUseVideoRenderError:"wasmUseVideoRenderError",hlsError:"hlsError",webrtcError:"webrtcError",webglAlignmentError:"webglAlignmentError",wasmWidthOrHeightChange:"wasmWidthOrHeightChange",mseWidthOrHeightChange:"mseWidthOrHeightChange",wcsWidthOrHeightChange:"wcsWidthOrHeightChange",tallWebsocketClosedByError:"tallWebsocketClosedByError",flvDemuxBufferSizeTooLarge:N.flvDemuxBufferSizeTooLarge,wasmDecodeVideoNoResponseError:"wasmDecodeVideoNoResponseError",audioChannelError:"audioChannelError",simdH264DecodeVideoWidthIsTooLarge:"simdH264DecodeVideoWidthIsTooLarge",webglContextLostError:"webglContextLostError"},de="notConnect",fe="open",we={download:"download",base64:"base64",blob:"blob"},Te="download",Be={7:"H264(AVC)",12:"H265(HEVC)",99:"MPEG4"},Oe="H264(AVC)",Ye="H265(HEVC)",Je=10,Hi={AAC:"AAC",ALAW:"ALAW(g711a)",MULAW:"MULAW(g711u)"},xs={10:"AAC",7:"ALAW",8:"MULAW"},Vi=7,Wi=8,Ln=5,Dn=6,$i=32,Ki=33,mi=34,Dr="webcodecs",$t="webgl",Kt="webgpu",Rr="offscreen",qi="mse",Cs='video/mp4; codecs="avc1.64002A"',Ls='video/mp4; codecs="hev1.1.6.L123.b0"',Yi="oneHour",Ds="halfHour",Rs="tenMin",Ji="fiveMin",gi={oneHour:"one-hour",halfHour:"half-hour",tenMin:"ten-min",fiveMin:"five-min"},yi=["oneHour","halfHour","tenMin","fiveMin"],Is=["up","right","down","left","left-up","right-up","left-down","right-down"],Ai="stop",ti="fiStop",Ps="zoomExpand",Bs="zoomNarrow",Us="apertureFar",Ms="apertureNear",Fs="focusFar",Os="focusNear",Qi="g711a",Ir="g711u",Ct={png:"image/png",jpeg:"image/jpeg",webp:"image/webp"},Ns="canplay",js="waiting",Xi="timeupdate",zs="ratechange",Rn="hevc",Gs="The user aborted a request",Hs="AbortError",Vs="AbortError",Zi=0,In=1,Ws="worklet",Pn={encType:Qi,packetType:"rtp",rtpSsrc:"0000000000",numberChannels:1,sampleRate:8e3,sampleBitsWidth:16,debug:!1,debugLevel:Bt,testMicrophone:!1,audioBufferLength:160,engine:Ws,checkGetUserMediaTimeout:!1,getUserMediaTimeout:1e4},bi="worklet",ii="script",Jt="active",Bn={name:"",index:0,icon:"",iconHover:"",iconTitle:"",activeIcon:"",activeIconHover:"",activeIconTitle:"",click:null,activeClick:null},Un={content:"",click:null,index:0},Mn={container:"",maxSplit:4,split:1,supportDblclickContainerFullscreen:!0,style:{border:"#343434",borderSelect:"#FFCC00",background:"#000"}},ri={dblSelected:"multiDblSelected",selected:"multiSelected",mouseOver:"multiMouseover",mouseOut:"multiMouseout",mouseUp:"multiMouseup"},si="3-1",ai="4-1",$s="load-retry",er="load-start";class tr{constructor(e){this.log=function(i){if(e._opt.debug&&e._opt.debugLevel==kt){for(var s=e._opt.debugUuid?`[${e._opt.debugUuid}]`:"",u=arguments.length,c=new Array(1<u?u-1:0),l=1;l<u;l++)c[l-1]=arguments[l];console.log(`JbPro${s}:[✅✅✅][${i}]`,...c)}},this.warn=function(i){if(e._opt.debug&&(e._opt.debugLevel==kt||e._opt.debugLevel==Bt)){for(var s=e._opt.debugUuid?`[${e._opt.debugUuid}]`:"",u=arguments.length,c=new Array(1<u?u-1:0),l=1;l<u;l++)c[l-1]=arguments[l];console.log(`JbPro${s}:[❗❗❗][${i}]`,...c)}},this.error=function(i){for(var s=e._opt.debugUuid?`[${e._opt.debugUuid}]`:"",u=arguments.length,c=new Array(1<u?u-1:0),l=1;l<u;l++)c[l-1]=arguments[l];console.error(`JbPro${s}:[❌❌❌][${i}]`,...c)}}}var pt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ir(D,e){return D(e={exports:{}},e.exports),e.exports}var at=ir(function(D){var e,i,s,u,c;e=typeof window<"u"&&window.document!==void 0?window.document:{},i=D.exports,s=(function(){for(var l,o=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],f=0,_=o.length,g={};f<_;f++)if((l=o[f])&&l[1]in e){for(f=0;f<l.length;f++)g[o[0][f]]=l[f];return g}return!1})(),u={change:s.fullscreenchange,error:s.fullscreenerror},c={request:function(l,o){return new Promise((function(f,_){var g=(function(){this.off("change",g),f()}).bind(this),T=(this.on("change",g),(l=l||e.documentElement)[s.requestFullscreen](o));T instanceof Promise&&T.then(g).catch(_)}).bind(this))},exit:function(){return new Promise((function(l,o){var f,_;this.isFullscreen?(f=(function(){this.off("change",f),l()}).bind(this),this.on("change",f),(_=e[s.exitFullscreen]())instanceof Promise&&_.then(f).catch(o)):l()}).bind(this))},toggle:function(l,o){return this.isFullscreen?this.exit():this.request(l,o)},onchange:function(l){this.on("change",l)},onerror:function(l){this.on("error",l)},on:function(l,o){l=u[l],l&&e.addEventListener(l,o,!1)},off:function(l,o){l=u[l],l&&e.removeEventListener(l,o,!1)},raw:s},s?(Object.defineProperties(c,{isFullscreen:{get:function(){return!!e[s.fullscreenElement]}},element:{enumerable:!0,get:function(){return e[s.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return!!e[s.fullscreenEnabled]}}}),i?D.exports=c:window.screenfull=c):i?D.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}});function Ks(e){var{profile:e,sampleRate:i,channel:s}=e;return new Uint8Array([175,0,e<<3|(14&i)>>1,(1&i)<<7|s<<3])}function qs(D){return D[0]>>4===Je&&D[1]===Zi}at.isEnabled;const Ys=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],Fn=Ys;function Js(D,e){return 1024*(1<arguments.length&&e!==void 0?e:9e4)/D}function Pr(){}function Qs(D){let e=null;var i=["webgl","experimental-webgl","moz-webgl","webkit-3d"];let s=0;for(;!e&&s<i.length;){var u=i[s];try{var c={preserveDrawingBuffer:!0};e=D.getContext(u,c)}catch(l){console.error(l),e=null}e&&typeof e.getParameter=="function"||(e=null),++s}return e}function rr(i){var i=(0<arguments.length&&i!==void 0?i:"").split(","),e=atob(i[1]),i=i[0].replace("data:","").replace(";base64","");let s=e.length,u=new Uint8Array(s);for(;s--;)u[s]=e.charCodeAt(s);return new File([u],"file",{type:i})}function be(){return new Date().getTime()}function ft(D,e,i){return Math.max(Math.min(D,Math.max(e,i)),Math.min(e,i))}function ue(D,e,i){D&&(typeof e=="object"&&Object.keys(e).forEach(s=>{ue(D,s,e[s])}),D.style[e]=i)}function Xs(D,e,i){return i=!(2<arguments.length&&i!==void 0)||i,D?(D=getComputedStyle(D,null).getPropertyValue(e),i?parseFloat(D):D):0}function Zs(){return(performance&&typeof performance.now=="function"?performance:Date).now()}function Br(D){let e=0,i=Zs();return s=>{var u;he(s)&&(e+=s,1e3<=(u=(s=Zs())-i))&&(D(e/u*1e3),i=s,e=0)}}try{if(typeof WebAssembly=="object"&&typeof WebAssembly.instantiate=="function"){var ni=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));ni instanceof WebAssembly.Module&&new WebAssembly.Instance(ni)instanceof WebAssembly.Instance}}catch{}const On='"6-25-2023"';function dt(){return/iphone|ipod|android.*mobile|windows.*phone|blackberry.*mobile/i.test(window.navigator.userAgent.toLowerCase())}function Ur(){const D=window.navigator.userAgent.toLowerCase()||"",e={type:"",version:""},i={IE:window.ActiveXObject||"ActiveXObject"in window,Chrome:-1<D.indexOf("chrome")&&-1<D.indexOf("safari"),Firefox:-1<D.indexOf("firefox"),Opera:-1<D.indexOf("opera"),Safari:-1<D.indexOf("safari")&&D.indexOf("chrome")==-1,Edge:-1<D.indexOf("edge"),QQBrowser:/qqbrowser/.test(D),WeixinBrowser:/MicroMessenger/i.test(D)};for(var s in i)if(i[s]){let c="";if(s==="IE"){const l=D.match(/(msie\s|trident.*rv:)([\w.]+)/);l&&2<l.length&&(c=D.match(/(msie\s|trident.*rv:)([\w.]+)/)[2])}else if(s==="Chrome"){for(var u in navigator.mimeTypes)navigator.mimeTypes[u].type==="application/360softmgrplugin"&&(s="360");const l=D.match(/chrome\/([\d.]+)/);l&&1<l.length&&(c=l[1])}else if(s==="Firefox"){const l=D.match(/firefox\/([\d.]+)/);l&&1<l.length&&(c=l[1])}else if(s==="Opera"){const l=D.match(/opera\/([\d.]+)/);l&&1<l.length&&(c=l[1])}else if(s==="Safari"){const l=D.match(/version\/([\d.]+)/);l&&1<l.length&&(c=l[1])}else if(s==="Edge"){const l=D.match(/edge\/([\d.]+)/);l&&1<l.length&&(c=l[1])}else if(s==="QQBrowser"){const l=D.match(/qqbrowser\/([\d.]+)/);l&&1<l.length&&(c=l[1])}e.type=s,e.version=parseInt(c)}return e}function oi(){var D=window.navigator.userAgent.toLowerCase();return D&&/iphone|ipad|ipod|ios/.test(D)}function Mr(){var D=window.navigator.userAgent;return!D.match(/Chrome/gi)&&D.match(/Safari/gi)}function Fr(D,e){var i;return arguments.length===0?null:(e=e||"{y}-{m}-{d} {h}:{i}:{s}",D=typeof D=="object"?D:(D=+(D=(""+D).length===10?1e3*parseInt(D):D),new Date(D)),i={y:D.getFullYear(),m:D.getMonth()+1,d:D.getDate(),h:D.getHours(),i:D.getMinutes(),s:D.getSeconds(),a:D.getDay()},e.replace(/{(y|m|d|h|i|s|a)+}/g,(s,u)=>{var c=i[u];return u==="a"?["一","二","三","四","五","六","日"][c-1]:(c=0<s.length&&c<10?"0"+c:c)||0}))}function ea(){return"VideoFrame"in window}function Ut(D){var e;return typeof D!="string"||(e=Number(D),isNaN(e))?D:e}function sr(){return"xxxxxxxxxxxx4xxx".replace(/[xy]/g,function(D){var e=16*Math.random()|0;return(D=="x"?e:3&e|8).toString(16)})}function ta(D,e){let i,s,u=!1;return function c(){for(var l=arguments.length,o=new Array(l),f=0;f<l;f++)o[f]=arguments[f];u?(i=o,s=this):(u=!0,D.apply(this,o),setTimeout(()=>{u=!1,i&&(c.apply(s,i),i=null,s=null)},e))}}function ar(D){var e,i;return D==null||D==""?"0 Bytes":(e=new Array("Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"),i=0,D=parseFloat(D),i=Math.floor(Math.log(D)/Math.log(1024)),(D/Math.pow(1024,i)).toFixed(2)+e[i])}function he(D){return Object.prototype.toString.call(D)==="[object Number]"}function ia(){let D=!1;return D="MediaSource"in window&&window.MediaSource.isTypeSupported(Ls)?!0:D}function ra(){var D=Ur();return D.type.toLowerCase()==="chrome"&&107<=D.version}function vi(){let D=!1;return D="MediaStreamTrackGenerator"in window?!0:D}function _i(){let D=!1;return D="MediaStream"in window?!0:D}function wi(D){return D==null}function sa(D){return D===!0||D===!1}function Ue(D){return!wi(D)}function aa(D){var e={left:"",right:"",top:"",bottom:"",opacity:1,backgroundColor:"",image:{src:"",width:"100",height:"60"},text:{content:"",fontSize:"14",color:"#000"},rect:{color:"",lineWidth:2,width:"",height:""},html:""},i=Object.assign(e.image,D.image||{}),s=Object.assign(e.text,D.text||{});return Object.assign(e,D,{image:i,text:s})}function na(D,e){return D={container:D||"",text:"",opacity:"",angle:"",color:"",fontSize:"",fontFamily:""},{watermark_parent_node:(D=Object.assign(D,e)).container,watermark_alpha:D.opacity,watermark_angle:D.angle,watermark_fontsize:D.fontSize,watermark_color:D.color,watermark_font:D.fontFamily,watermark_txt:D.text}}function oa(D,e){return new Promise((i,s)=>{let u=aa(e);if(!u.image.src&&!u.text.content)return i(D);let c=document.createElement("canvas"),l=(c.width=e.width,c.height=e.height,c.getContext("2d")),o=0,f=0;he(u.left)?o=u.left:he(u.right)&&(o=c.width-u.right),he(u.top)?f=u.top:he(u.bottom)&&(f=c.height-u.bottom);const _=new Image;_.src=D,_.onload=()=>{if(l.drawImage(_,0,0),u.image&&u.image.src){const g=new Image;g.src=u.image.src,g.setAttribute("crossOrigin","Anonymous"),g.onload=()=>{o-=u.image.width,l.drawImage(g,o,f,u.image.width,u.image.height),i(c.toDataURL(e.format,e.quality))},g.onerror=T=>{s()}}else u.text&&u.text.content&&(l.font=u.text.fontSize+"px 宋体",l.fillStyle=u.text.color,l.textAlign="right",l.fillText(u.text.content,o,f),i(c.toDataURL(e.format,e.quality)))},_.onerror=g=>{s(g)}})}function Or(D){var e,i;return-1<D&&(e=D%60,i=(i=Math.floor(D/3600))<10?"0"+i+":":i+":",(D=Math.floor(D/60)%60)<10&&(i+="0"),i+=D+":",(e=Math.round(e))<10&&(i+="0"),i+=e.toFixed(0)),i}function nr(D){let e="";var i,s;return-1<D&&(i=Math.floor(D/60/60)%60,s=Math.floor(D/60)%60,D=D%60,s=Math.round(s),e=i<10?"0"+i+":":i+":",s<10&&(e+="0"),e+=s+":",D<10&&(e+="0"),e+=D),e}function or(D,u){var i=Math.floor(u/60/60)%60,s=Math.floor(u/60)%60,u=u%60;return new Date(D).setHours(i,s,u,0)}function Nr(D){return(""+D).length}function jr(D){return!D||Object.keys(D).length!==0}function la(D){return typeof D=="string"}const ha=()=>{var D=window.navigator.userAgent;return/MicroMessenger/i.test(D)};function Mt(D){return D=D||window.event,D.target||D.srcElement}function mt(D){return typeof D=="function"}function da(D){let e=0,i=0;var s=D||window.event;return s.pageX||s.pageY?(e=s.pageX,i=s.pageY):(s.clientX||s.clientY)&&(e=D.clientX+document.documentElement.scrollLeft+document.body.scrollLeft,i=D.clientY+document.documentElement.scrollTop+document.body.scrollTop),{posX:e,posY:i}}function ua(){let D=document.createElement("video"),e=D.canPlayType("application/vnd.apple.mpegurl");return D=null,e}function lr(D){return _e(D.hasAudio)&&(D.useMSE||D.useWCS&&!D.useOffscreen)}function ca(D){return D=D.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1],D=new Blob([D],{type:"application/javascript"}),URL.createObjectURL(D)}function hr(D){D.close?D.close():D.destroy&&D.destroy()}function pa(){return window.location.protocol==="https:"||window.location.hostname==="localhost"}function fa(D,e){let i=(D=e?D.filter(l=>l.type===e):D)[0],s=null,u=1;var c;if(0<D.length&&(c=D[1])&&1e5<c.ts-i.ts&&(i=c,u=2),i)for(let l=u;l<D.length;l++){let o=D[l];!(o=e&&o.type!==e?null:o)||1e3<=o.ts-i.ts&&D[l-1].ts-i.ts<1e3&&(s=l+1)}return s}function ma(D){for(var D=(D+"=".repeat((4-D.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),e=window.atob(D),i=new Uint8Array(e.length),s=0;s<e.length;++s)i[s]=e.charCodeAt(s);return i}function li(D){let e="";if(typeof D=="object")try{e=JSON.stringify(D),e=JSON.parse(e)}catch{e=D}else e=D;return e}function ga(){return li(Wt)}function zr(){return li(ci)}function ya(D){return D[0]>>4===In&&D[1]===Zi}function We(D){return D===!0||D==="true"}function _e(D){return D!==!0&&D!=="true"}function Aa(D){return D.replace(/-([a-z])/g,function(e,i){return i.toUpperCase()})}class dr{constructor(e){this.destroys=[],this.proxy=this.proxy.bind(this),this.master=e}proxy(e,i,s){let u=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};if(e){if(Array.isArray(i))return i.map(l=>this.proxy(e,l,s,u));e.addEventListener(i,s,u);var c=()=>{mt(e.removeEventListener)&&e.removeEventListener(i,s,u)};return this.destroys.push(c),c}}destroy(){this.master.debug&&this.master.debug.log("Events","destroy"),this.destroys.forEach(e=>e()),this.destroys=[]}}var qt=typeof Float32Array<"u"?Float32Array:Array;function Gr(){var D=new qt(16);return qt!=Float32Array&&(D[1]=0,D[2]=0,D[3]=0,D[4]=0,D[6]=0,D[7]=0,D[8]=0,D[9]=0,D[11]=0,D[12]=0,D[13]=0,D[14]=0),D[0]=1,D[5]=1,D[10]=1,D[15]=1,D}function ba(D){D[0]=1,D[1]=0,D[2]=0,D[3]=0,D[4]=0,D[5]=1,D[6]=0,D[7]=0,D[8]=0,D[9]=0,D[10]=1,D[11]=0,D[12]=0,D[13]=0,D[14]=0,D[15]=1}Math.hypot||(Math.hypot=function(){for(var D=0,e=arguments.length;e--;)D+=arguments[e]*arguments[e];return Math.sqrt(D)});function ur(D,e,i){var s=new qt(3);return s[0]=D,s[1]=e,s[2]=i,s}ni=new qt(3),qt!=Float32Array&&(ni[0]=0,ni[1]=0,ni[2]=0),Di=new qt(4),qt!=Float32Array&&(Di[0]=0,Di[1]=0,Di[2]=0,Di[3]=0);class va{constructor(e,i){this.gl=e,i&&this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,1),i=this._initShaderProgram(),this._programInfo={program:i,attribLocations:{vertexPosition:e.getAttribLocation(i,"aVertexPosition"),texturePosition:e.getAttribLocation(i,"aTexturePosition")},uniformLocations:{projectionMatrix:e.getUniformLocation(i,"uProjectionMatrix"),modelMatrix:e.getUniformLocation(i,"uModelMatrix"),viewMatrix:e.getUniformLocation(i,"uViewMatrix"),rgbatexture:e.getUniformLocation(i,"rgbaTexture"),ytexture:e.getUniformLocation(i,"yTexture"),utexture:e.getUniformLocation(i,"uTexture"),vtexture:e.getUniformLocation(i,"vTexture"),isyuv:e.getUniformLocation(i,"isyuv")}},this._buffers=this._initBuffers(),this._rgbatexture=this._createTexture(),this._ytexture=this._createTexture(),this._utexture=this._createTexture(),this._vtexture=this._createTexture()}destroy(){this.gl.deleteProgram(this._programInfo.program),this.gl.deleteBuffer(this._buffers.position),this.gl.deleteBuffer(this._buffers.texPosition),this.gl.deleteBuffer(this._buffers.indices),this.gl.deleteTexture(this._rgbatexture),this.gl.deleteTexture(this._ytexture),this.gl.deleteTexture(this._utexture),this.gl.deleteTexture(this._vtexture),this._programInfo=null,this._buffers=null,this._rgbatexture=null,this._ytexture=null,this._utexture=null,this._vtexture=null}_initShaderProgram(){var e=this._loadShader(this.gl.VERTEX_SHADER,`
            attribute vec4 aVertexPosition;
            attribute vec2 aTexturePosition;
            varying lowp vec2 vTexturePosition;
            void main(void) {
              gl_Position = aVertexPosition;
              vTexturePosition = aTexturePosition;
            }
        `),i=this._loadShader(this.gl.FRAGMENT_SHADER,`
            precision highp float;
            varying highp vec2 vTexturePosition;
            uniform int isyuv;
            uniform sampler2D rgbaTexture;
            uniform sampler2D yTexture;
            uniform sampler2D uTexture;
            uniform sampler2D vTexture;

            const mat4 YUV2RGB = mat4( 1.1643828125, 0, 1.59602734375, -.87078515625,
                                       1.1643828125, -.39176171875, -.81296875, .52959375,
                                       1.1643828125, 2.017234375, 0, -1.081390625,
                                       0, 0, 0, 1);


            void main(void) {

                if (isyuv>0) {

                    highp float y = texture2D(yTexture,  vTexturePosition).r;
                    highp float u = texture2D(uTexture,  vTexturePosition).r;
                    highp float v = texture2D(vTexture,  vTexturePosition).r;
                    gl_FragColor = vec4(y, u, v, 1) * YUV2RGB;

                } else {
                    gl_FragColor =  texture2D(rgbaTexture, vTexturePosition);
                }
            }
        `),s=this.gl.createProgram();return this.gl.attachShader(s,e),this.gl.attachShader(s,i),this.gl.linkProgram(s),this.gl.getProgramParameter(s,this.gl.LINK_STATUS)?s:(console.log("Unable to initialize the shader program: "+this.gl.getProgramInfoLog(s)),null)}_loadShader(u,i){var s=this.gl,u=s.createShader(u);return s.shaderSource(u,i),s.compileShader(u),s.getShaderParameter(u,s.COMPILE_STATUS)?u:(console.log("An error occurred compiling the shaders: "+s.getShaderInfoLog(u)),s.deleteShader(u),null)}_initBuffers(){var e=this.gl,i=e.createBuffer(),s=(e.bindBuffer(e.ARRAY_BUFFER,i),[-1,-1,1,-1,1,1,-1,1]);e.bufferData(e.ARRAY_BUFFER,new Float32Array(s),e.STATIC_DRAW);var c=(c=[]).concat([0,1],[1,1],[1,0],[0,0]),u=e.createBuffer(),c=(e.bindBuffer(e.ARRAY_BUFFER,u),e.bufferData(e.ARRAY_BUFFER,new Float32Array(c),e.STATIC_DRAW),e.createBuffer());return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,c),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),e.STATIC_DRAW),{positions:s,position:i,texPosition:u,indices:c}}_createTexture(){var e=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),e}_drawScene(e,i,s){this.gl.viewport(0,0,e,i),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this._buffers.position),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this._buffers.positions),this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this._programInfo.attribLocations.vertexPosition,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this._programInfo.attribLocations.vertexPosition),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this._buffers.texPosition),this.gl.vertexAttribPointer(this._programInfo.attribLocations.texturePosition,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this._programInfo.attribLocations.texturePosition),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this._buffers.indices),s?(this.gl.activeTexture(this.gl.TEXTURE0+3),this.gl.bindTexture(this.gl.TEXTURE_2D,this._ytexture),this.gl.activeTexture(this.gl.TEXTURE0+4),this.gl.bindTexture(this.gl.TEXTURE_2D,this._utexture),this.gl.activeTexture(this.gl.TEXTURE0+5),this.gl.bindTexture(this.gl.TEXTURE_2D,this._vtexture)):(this.gl.activeTexture(this.gl.TEXTURE0+2),this.gl.bindTexture(this.gl.TEXTURE_2D,this._rgbatexture)),this.gl.useProgram(this._programInfo.program),this.gl.uniform1i(this._programInfo.uniformLocations.rgbatexture,2),this.gl.uniform1i(this._programInfo.uniformLocations.ytexture,3),this.gl.uniform1i(this._programInfo.uniformLocations.utexture,4),this.gl.uniform1i(this._programInfo.uniformLocations.vtexture,5),this.gl.uniform1i(this._programInfo.uniformLocations.isyuv,s?1:0),this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0)}_calRect(_,i,g,f,c,l){var o=2*_/c-1,f=2*(l-i-f)/l-1,_=2*(_+g)/c-1,g=2*(l-i)/l-1;return[o,f,_,f,_,g,o,g]}_clear(){this.gl.clearColor(0,0,0,1),this.gl.clearDepth(1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}render(e,i,s,u,c){var l=this.gl;this._clear(),l.activeTexture(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,this._ytexture),l.texImage2D(l.TEXTURE_2D,0,l.LUMINANCE,e,i,0,l.LUMINANCE,l.UNSIGNED_BYTE,s),l.activeTexture(l.TEXTURE1),l.bindTexture(l.TEXTURE_2D,this._utexture),l.texImage2D(l.TEXTURE_2D,0,l.LUMINANCE,e/2,i/2,0,l.LUMINANCE,l.UNSIGNED_BYTE,u),l.activeTexture(l.TEXTURE2),l.bindTexture(l.TEXTURE_2D,this._vtexture),l.texImage2D(l.TEXTURE_2D,0,l.LUMINANCE,e/2,i/2,0,l.LUMINANCE,l.UNSIGNED_BYTE,c),this._buffers.positions=[-1,-1,1,-1,1,1,-1,1],this._drawScene(e,i,!0)}renderYUV(e,i,l){var u=l.slice(0,e*i),c=l.slice(e*i,e*i*5/4),l=l.slice(e*i*5/4,e*i*3/2),o=this.gl;this._clear(),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,this._ytexture),o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE,e,i,0,o.LUMINANCE,o.UNSIGNED_BYTE,u),o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,this._utexture),o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE,e/2,i/2,0,o.LUMINANCE,o.UNSIGNED_BYTE,c),o.activeTexture(o.TEXTURE2),o.bindTexture(o.TEXTURE_2D,this._vtexture),o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE,e/2,i/2,0,o.LUMINANCE,o.UNSIGNED_BYTE,l),this._buffers.positions=[-1,-1,1,-1,1,1,-1,1],this._drawScene(e,i,!0)}drawDom(e,i,s,u,c){var l=this.gl;l.activeTexture(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,this._rgbatexture),l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,c),this._buffers.positions=this._calRect(s,u,c.width,c.height,e,i),this._drawScene(e,i,!1)}}class Nn{constructor(e){this.gpu=e,this.pipeline=null,this.matrixGroupInfo=null,this.depthTexture=null,this.textureGroupInfo=null,this.hasInited=!1,this.buffers=this._initBuffer(),this._initPipeline().then(i=>{this.pipeline=i,this.matrixGroupInfo=this._initMatrixGroupInfo(),this.hasInited=!0})}destroy(){this.gpu&&(this.gpu.device.destroy(),this.gpu=null),this.hasInited=!1,this.pipeline=null,this.matrixGroupInfo=null,this.depthTexture=null,this.textureGroupInfo=null}_initBuffer(){var e=this.gpu.device,u=new Float32Array([-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1]),i=e.createBuffer({size:u.byteLength,usage:window.GPUBufferUsage.VERTEX|window.GPUBufferUsage.COPY_DST}),u=(e.queue.writeBuffer(i,0,u),new Float32Array([0,1,1,1,1,0,0,0])),s=e.createBuffer({size:u.byteLength,usage:window.GPUBufferUsage.VERTEX|window.GPUBufferUsage.COPY_DST}),u=(e.queue.writeBuffer(s,0,u),new Uint16Array([0,1,2,0,2,3])),c=e.createBuffer({size:u.byteLength,usage:window.GPUBufferUsage.INDEX|window.GPUBufferUsage.COPY_DST});return e.queue.writeBuffer(c,0,u),{positionBuffer:i,texpositionBuffer:s,indexBuffer:c}}_initPipeline(){return new Promise((e,i)=>{var s=this.gpu.device,u=this.gpu.format,u={layout:"auto",vertex:{module:s.createShaderModule({code:`

                  @binding(0) @group(0) var<uniform> uModelMatrix : mat4x4<f32>;
                  @binding(1) @group(0) var<uniform> uViewMatrix : mat4x4<f32>;
                  @binding(2) @group(0) var<uniform> uProjectionMatrix : mat4x4<f32>;

                  struct VertexOutput {
                    @builtin(position) Position : vec4<f32>,
                    @location(0) vTexturePosition : vec2<f32>,
                  }

                  @vertex
                  fn main(
                    @location(0) aVertexPosition : vec4<f32>,
                    @location(1) aTexturePosition : vec2<f32>
                  ) -> VertexOutput {
                    var output : VertexOutput;
                    var tmppos : vec4<f32> = uProjectionMatrix * uViewMatrix * uModelMatrix * aVertexPosition;
                    output.Position = vec4<f32>(tmppos.x, tmppos.y, (tmppos.z+1.)/2., tmppos.w);  // webgl z [-1, 1],  webgpu z [0, 1],  这里z做下调整 z-webgpu = (z-webgl+1)/2
                    output.vTexturePosition = aTexturePosition;
                    return output;
                  }

                `}),entryPoint:"main",buffers:[{arrayStride:12,attributes:[{shaderLocation:0,offset:0,format:"float32x3"}]},{arrayStride:8,attributes:[{shaderLocation:1,offset:0,format:"float32x2"}]}]},primitive:{topology:"triangle-list"},fragment:{module:s.createShaderModule({code:`
                @group(1) @binding(0) var mySampler: sampler;
                @group(1) @binding(1) var yTexture: texture_2d<f32>;
                @group(1) @binding(2) var uTexture: texture_2d<f32>;
                @group(1) @binding(3) var vTexture: texture_2d<f32>;

                const YUV2RGB : mat4x4<f32> = mat4x4<f32>( 1.1643828125, 0, 1.59602734375, -.87078515625,
                                                         1.1643828125, -.39176171875, -.81296875, .52959375,
                                                         1.1643828125, 2.017234375, 0, -1.081390625,
                                                         0, 0, 0, 1);

                @fragment
                fn main(
                  @location(0) vTexturePosition: vec2<f32>
                ) -> @location(0) vec4<f32> {

                    var y : f32= textureSample(yTexture, mySampler, vTexturePosition).r;
                    var u : f32 = textureSample(uTexture,  mySampler, vTexturePosition).r;
                    var v : f32 = textureSample(vTexture, mySampler, vTexturePosition).r;

                    return  vec4<f32>(y, u, v, 1.0)*YUV2RGB;
                }

                `}),entryPoint:"main",targets:[{format:u}]},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"}};s.createRenderPipelineAsync(u).then(c=>{e(c)}).catch(c=>{i(c)})})}_initMatrixGroupInfo(){var e,i,s,u,c,l,o,f,_,g,T,E=this.gpu.device,h=this.pipeline,k=Gr(),t=(e=(i=r=1)/((t=-1)-r),d=1/((s=-1)-i),f=1/((o=.1)-(l=100)),(_=k)[0]=-2*e,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=-2*d,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=2*f,_[11]=0,_[12]=(t+r)*e,_[13]=(i+s)*d,_[14]=(l+o)*f,_[15]=1,Gr()),r=(ba(t),Gr()),n=(e=r,i=ur(0,0,0),s=ur(0,0,-1),d=ur(0,1,0),l=i[0],o=i[1],i=i[2],f=d[0],_=d[1],d=d[2],g=s[0],T=s[1],s=s[2],Math.abs(l-g)<1e-6&&Math.abs(o-T)<1e-6&&Math.abs(i-s)<1e-6?ba(e):(g=l-g,T=o-T,s=i-s,a=_*(s*=n=1/Math.hypot(g,T,s))-d*(T*=n),d=d*(g*=n)-f*s,f=f*T-_*g,(n=Math.hypot(a,d,f))?(a*=n=1/n,d*=n,f*=n):f=d=a=0,_=T*f-s*d,u=s*a-g*f,c=g*d-T*a,(n=Math.hypot(_,u,c))?(_*=n=1/n,u*=n,c*=n):c=u=_=0,e[0]=a,e[1]=_,e[2]=g,e[3]=0,e[4]=d,e[5]=u,e[6]=T,e[7]=0,e[8]=f,e[9]=c,e[10]=s,e[11]=0,e[12]=-(a*l+d*o+f*i),e[13]=-(_*l+u*o+c*i),e[14]=-(g*l+T*o+s*i),e[15]=1),E.createBuffer({size:64,usage:window.GPUBufferUsage.UNIFORM|window.GPUBufferUsage.COPY_DST})),a=(E.queue.writeBuffer(n,0,t),E.createBuffer({size:64,usage:window.GPUBufferUsage.UNIFORM|window.GPUBufferUsage.COPY_DST})),d=(E.queue.writeBuffer(a,0,r),E.createBuffer({size:64,usage:window.GPUBufferUsage.UNIFORM|window.GPUBufferUsage.COPY_DST}));return E.queue.writeBuffer(d,0,k),{modelMatrixBuffer:n,viewMatrixBuffer:a,projectMatrixBuffer:d,group:E.createBindGroup({label:"group0",layout:h.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:n}},{binding:1,resource:{buffer:a}},{binding:2,resource:{buffer:d}}]})}}_initTextureGroupInfo(l,o){var f=this.gpu.device,s=this.pipeline,u=f.createTexture({size:[l,o],format:"r8unorm",usage:window.GPUTextureUsage.TEXTURE_BINDING|window.GPUTextureUsage.COPY_DST|window.GPUTextureUsage.RENDER_ATTACHMENT}),c=f.createTexture({size:[l/2,o/2],format:"r8unorm",usage:window.GPUTextureUsage.TEXTURE_BINDING|window.GPUTextureUsage.COPY_DST|window.GPUTextureUsage.RENDER_ATTACHMENT}),l=f.createTexture({size:[l/2,o/2],format:"r8unorm",usage:window.GPUTextureUsage.TEXTURE_BINDING|window.GPUTextureUsage.COPY_DST|window.GPUTextureUsage.RENDER_ATTACHMENT}),o=f.createSampler({magFilter:"linear",minFilter:"linear"}),f=f.createBindGroup({label:"group1",layout:s.getBindGroupLayout(1),entries:[{binding:0,resource:o},{binding:1,resource:u.createView()},{binding:2,resource:c.createView()},{binding:3,resource:l.createView()}]});return{yTexture:u,uTexture:c,vTexture:l,group:f}}_drawScene(){var e=this.gpu.device,s=this.gpu.context,i=e.createCommandEncoder(),s={colorAttachments:[{view:s.getCurrentTexture().createView(),clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:this.depthTexture.createView(),depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}},s=i.beginRenderPass(s);s.setPipeline(this.pipeline),s.setBindGroup(0,this.matrixGroupInfo.group),s.setBindGroup(1,this.textureGroupInfo.group),s.setVertexBuffer(0,this.buffers.positionBuffer),s.setVertexBuffer(1,this.buffers.texpositionBuffer),s.setIndexBuffer(this.buffers.indexBuffer,"uint16"),s.drawIndexed(6),s.end(),e.queue.submit([i.finish()])}renderYUV(e,i,s){var u,c,l;this.hasInited&&(u=s.slice(0,e*i),c=s.slice(e*i,e*i*5/4),s=s.slice(e*i*5/4,e*i*3/2),l=this.gpu.device,this.depthTexture||(this.depthTexture=this.gpu.device.createTexture({size:[e,i],format:"depth24plus",usage:window.GPUTextureUsage.RENDER_ATTACHMENT})),this.textureGroupInfo||(this.textureGroupInfo=this._initTextureGroupInfo(e,i)),l.queue.writeTexture({texture:this.textureGroupInfo.yTexture},u,{bytesPerRow:e,rowsPerImage:i},[e,i]),l.queue.writeTexture({texture:this.textureGroupInfo.uTexture},c,{bytesPerRow:e/2,rowsPerImage:i/2},[e/2,i/2]),l.queue.writeTexture({texture:this.textureGroupInfo.vTexture},s,{bytesPerRow:e/2,rowsPerImage:i/2},[e/2,i/2]),this._drawScene())}clear(){}}class _a extends Ae{constructor(){super(),this.videoInfo={width:null,height:null,encType:null},this.init=!1}destroy(){this.resetInit(),this.off()}resetInit(){this.videoInfo={width:null,height:null,encType:null},this.init=!1}getHasInit(){return this.init}updateVideoInfo(e){Ue(e.encTypeCode)&&(this.videoInfo.encType=Be[e.encTypeCode]),Ue(e.encType)&&(this.videoInfo.encType=e.encType),Ue(e.width)&&(this.videoInfo.width=e.width),Ue(e.height)&&(this.videoInfo.height=e.height),Ue(this.videoInfo.encType)&&Ue(this.videoInfo.height)&&Ue(this.videoInfo.width)&&!this.init&&(this.player.emit(N.videoInfo,this.videoInfo),this.init=!0)}getVideoInfo(){return this.videoInfo}clearView(){}play(){}pause(){}getType(){return""}getCanvasType(){return""}isPlaying(){return!0}addContentToCanvas(){}getPlaybackQuality(){return null}}var Yt=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof global=="object"&&global.global===global?global:void 0;function Hr(D,e,i){var s=new XMLHttpRequest;s.open("GET",D),s.responseType="blob",s.onload=function(){Si(s.response,e,i)},s.onerror=function(){console.error("could not download file")},s.send()}function wa(D){var e=new XMLHttpRequest;e.open("HEAD",D,!1);try{e.send()}catch{}return 200<=e.status&&e.status<=299}function cr(D){try{D.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),D.dispatchEvent(e)}}var Sa=Yt.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),Si=typeof window!="object"||window!==Yt?function(){}:"download"in HTMLAnchorElement.prototype&&!Sa?function(D,e,i){var s=Yt.URL||Yt.webkitURL,u=document.createElementNS("http://www.w3.org/1999/xhtml","a");e=e||D.name||"download",u.download=e,u.rel="noopener",typeof D=="string"?(u.href=D,u.origin!==location.origin?wa(u.href)?Hr(D,e,i):cr(u,u.target="_blank"):cr(u)):(u.href=s.createObjectURL(D),setTimeout(function(){s.revokeObjectURL(u.href)},4e4),setTimeout(function(){cr(u)},0))}:"msSaveOrOpenBlob"in navigator?function(D,e,i){var s;e=e||D.name||"download",typeof D=="string"?wa(D)?Hr(D,e,i):((s=document.createElement("a")).href=D,s.target="_blank",setTimeout(function(){cr(s)})):navigator.msSaveOrOpenBlob((D=D,(i=i)===void 0?i={autoBom:!1}:typeof i!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),i={autoBom:!i}),i.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(D.type)?new Blob(["\uFEFF",D],{type:D.type}):D),e)}:function(D,o,f,s){if((s=s||open("","_blank"))&&(s.document.title=s.document.body.innerText="downloading..."),typeof D=="string")return Hr(D,o,f);var u,c,l,o=D.type==="application/octet-stream",f=/constructor/i.test(Yt.HTMLElement)||Yt.safari,_=/CriOS\/[\d]+/.test(navigator.userAgent);(_||o&&f||Sa)&&typeof FileReader<"u"?((u=new FileReader).onloadend=function(){var g=u.result,g=_?g:g.replace(/^data:[^;]*;/,"data:attachment/file;");s?s.location.href=g:location=g,s=null},u.readAsDataURL(D)):(c=Yt.URL||Yt.webkitURL,l=c.createObjectURL(D),s?s.location=l:location.href=l,s=null,setTimeout(function(){c.revokeObjectURL(l)},4e4))};class Ea{constructor(e,i){this.gl=e,i&&this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,1),e=this._initShaderProgram(),this.shaderProgram=e,this.programInfo={program:e,attribLocations:{vertexPosition:this.gl.getAttribLocation(e,"aVertexPosition")},uniformLocations:{linewidth:this.gl.getUniformLocation(e,"uLineWidth"),rect:this.gl.getUniformLocation(e,"uRect"),linecolor:this.gl.getUniformLocation(e,"uLineColor"),resolution:this.gl.getUniformLocation(e,"uResolution")}},this.buffers=this._initBuffers()}destroy(){this.gl.deleteProgram(this.shaderProgram),this.gl.deleteBuffer(this.buffers.position),this.gl.deleteBuffer(this.buffers.indices),this.shaderProgram=null,this.buffers=null}_initShaderProgram(){var e=this.gl,i=this._loadShader(e.VERTEX_SHADER,`
          attribute vec4 aVertexPosition;
            void main(void) {
              gl_Position = aVertexPosition;
            }
            `),s=this._loadShader(e.FRAGMENT_SHADER,`
            precision highp float;
            uniform float uLineWidth;
            uniform vec4 uRect;
            uniform vec3 uLineColor;
            uniform vec2 uResolution;


            float inBox(vec2 st, vec4 rect){

                vec2 bl = step(rect.xy,st);
                float pct = bl.x * bl.y;

                vec2 tr = step(st, rect.zw);
                pct *= tr.x * tr.y;

                return pct;
            }

            void main(void) {

                vec2 cur = gl_FragCoord.xy/uResolution;

                float xlinewidth  = uLineWidth/uResolution.x;
                float ylinewidth  = uLineWidth/uResolution.y;

                // vec4 outRect = uRect + vec4(-1.*xlinewidth/2., -1.*ylinewidth/2., xlinewidth/2., ylinewidth/2.);
                // vec4 inRect  = uRect + vec4(xlinewidth/2., ylinewidth/2., -1.*xlinewidth/2., -1.*ylinewidth/2.);

                vec4 outRect = uRect + vec4(-1.*xlinewidth/2., -1.*ylinewidth/2., xlinewidth/2., ylinewidth/2.);
                vec4 inRect  = uRect;

                float a = inBox(cur, outRect);
                float b = inBox(cur, inRect);

                gl_FragColor = mix(vec4(0., 0., 0., 0.), vec4(uLineColor.rgb, 1.0), a-b);

            }
            `),u=e.createProgram();return e.attachShader(u,i),e.attachShader(u,s),e.linkProgram(u),e.getProgramParameter(u,e.LINK_STATUS)?u:(console.log("Unable to initialize the shader program: "+e.getProgramInfoLog(u)),null)}_loadShader(u,i){var s=this.gl,u=s.createShader(u);return s.shaderSource(u,i),s.compileShader(u),s.getShaderParameter(u,s.COMPILE_STATUS)?u:(console.log("An error occurred compiling the shaders: "+s.getShaderInfoLog(u)),s.deleteShader(u),null)}_createTexture(){var e=this.gl,i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),i}_initBuffers(){var e=this.gl,i=e.createBuffer(),s=(e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,1,1,-1,1]),e.STATIC_DRAW),e.createBuffer());return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),e.STATIC_DRAW),{position:i,indices:s}}_drawScene(i){var{canvasWidth:i,canvasHeight:s,rect:u,lineWidth:c,lineColor:l}=i,o=this.gl,f=this.buffers,_=this.programInfo;o.viewport(0,0,i,s),o.enable(o.BLEND),o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),o.bindBuffer(o.ARRAY_BUFFER,f.position),o.vertexAttribPointer(_.attribLocations.vertexPosition,2,o.FLOAT,!1,0,0),o.enableVertexAttribArray(_.attribLocations.vertexPosition),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,f.indices),o.useProgram(_.program),o.uniform2f(_.uniformLocations.resolution,i,s),o.uniform4f(_.uniformLocations.rect,u[0],u[1],u[2],u[3]),o.uniform1f(_.uniformLocations.linewidth,c),o.uniform3f(_.uniformLocations.linecolor,l[0],l[1],l[2]),o.drawElements(o.TRIANGLES,6,o.UNSIGNED_SHORT,0)}drawBox(i){var{x:i,y:s,width:u,height:c,lineWidth:l,lineColor:g,canvasWidth:o,canvasHeight:f}=i,_=(_=i/o,c=(f-s-c)/f,i=(i+u)/o,u=(f-s)/f,(s=new qt(4))[0]=_,s[1]=c,s[2]=i,s[3]=u,s),g=ur(1,0,0);this._drawScene({canvasWidth:o,canvasHeight:f,rect:_,lineWidth:l,lineColor:g})}}class Ta extends _a{constructor(e){super(),this.player=e;var i=document.createElement("canvas");i.style.position="absolute",i.style.top=0,i.style.left=0,this.$videoElement=i,e.$container.appendChild(this.$videoElement),this.context2D=null,this.contextGl=null,this.webglRender=null,this.webglRectRender=null,this.webGPURender=null,this.isWebglContextLost=!1,this.bitmaprenderer=null,this.renderType=null,this.controlHeight=0,this.proxyDestroyList=[],this.tempCanvasContentList=[],this._initCanvasRender()}destroy(){super.destroy(),0<this.proxyDestroyList.length&&(this.proxyDestroyList.forEach(e=>{e&&e()}),this.proxyDestroyList=[]),this.contextGl&&(this.contextGl=null),this.context2D&&(this.context2D=null),this.webglRender&&(this.webglRender.destroy(),this.webglRender=null),this.webglRectRender&&(this.webglRectRender.destroy(),this.webglRectRender=null),this.webGPURender&&(this.webGPURender.destroy(),this.webGPURender=null),this.bitmaprenderer&&(this.bitmaprenderer=null),this.renderType=null,this.isWebglContextLost=!1,this.videoInfo={width:"",height:"",encType:""},this.tempCanvasContentList=[],this.player.$container.removeChild(this.$videoElement),this.init=!1,this.off()}_initContextGl(){var e,i=this.player.events.proxy;this.contextGl=Qs(this.$videoElement),this.contextGl?(e=i(this.$videoElement,"webglcontextlost",s=>{s.preventDefault(),this.player.debug.error("canvasVideo","webglcontextlost error",s),this.isWebglContextLost=!0,this.webglRender&&(this.player.debug.log("CommonCanvasLoader","webglcontextlost error and destroy webglRender"),this.webglRender.destroy(),this.webglRender=null),this.webglRectRender&&(this.player.debug.log("CommonCanvasLoader","webglcontextlost error and destroy webglRectRender"),this.webglRectRender.destroy(),this.webglRectRender=null),this.contextGl=null,setTimeout(()=>{this.player.debug.log("CommonCanvasLoader","createContextGL()"),this.contextGl=Qs(this.$videoElement),this.player.debug.log("CommonCanvasLoader","createContextGL success"),this.contextGl&&this.contextGl.getContextAttributes&&this.contextGl.getContextAttributes().stencil?(this.webglRender=new va(this.contextGl,this.player._opt.openWebglAlignment),this.webglRectRender=new Ea(this.contextGl,this.player._opt.openWebglAlignment),this.isWebglContextLost=!1,this.player.debug.log("CommonCanvasLoader","webglcontextlost error reset and getContextAttributes().stencil is true")):(this.player.debug.error("CommonCanvasLoader","webglcontextlost error, getContextAttributes().stencil is false"),this.player.emitError(H.webglContextLostError))},500)}),i=i(this.$videoElement,"webglcontextrestored",s=>{s.preventDefault(),this.player.debug.log("CommonCanvasLoader","webglcontextrestored ",s)}),this.webglRender=new va(this.contextGl,this.player._opt.openWebglAlignment),this.webglRectRender=new Ea(this.contextGl,this.player._opt.openWebglAlignment),this.proxyDestroyList.push(e,i)):this.player.debug.error("CommonCanvasLoader","_initContextGl() createContextGL error")}_initContextGPU(){var e=this.$videoElement;new Promise((i,s)=>{navigator.gpu?navigator.gpu.requestAdapter().then(u=>{u?u.requestDevice().then(c=>{if(c){var l=e.getContext("webgpu");if(l){const o=navigator.gpu.getPreferredCanvasFormat();l.configure({device:c,format:o,alphaMode:"opaque"}),i({adapter:u,device:c,context:l,format:o})}else s('WebGPU "context" create fail')}else s('WebGPU "device" request fail')}).catch(c=>{s('WebGPU "adapter.requestDevice()" fail')}):s('WebGPU "adapter" request fail is empty')}).catch(u=>{s('WebGPU "navigator.gpu.requestAdapter()" fail')}):s("WebGPU not support!!")}).then(i=>{this.webGPURender=new Nn(i),this.player.debug.log("CommonCanvasLoader","webGPURender init success")}).catch(i=>{this.player.debug.error("CommonCanvasLoader",`createWebGPUContext error is ${i} and next use webgl render`),this.renderType=$t,this._initContextGl()})}initCanvasViewSize(){this.$videoElement.width=this.videoInfo.width,this.$videoElement.height=this.videoInfo.height,this.resize()}screenshot(e,i,o,u){e=e||be(),u=u||we.download;let c=.92;!Ct[i]&&we[i]&&(u=i,i="png",o=void 0),typeof o=="string"&&(u=o,o=void 0),o!==void 0&&(c=Number(o));var l=Ct[i]||Ct.png,o=this.$videoElement.toDataURL(l,c);if(u===we.base64)return o;{const f=rr(o);if(u===we.blob)return f;if(u===we.download){const _=l.split("/")[1];Si(f,e+"."+_)}}}screenshotWatermark(e){return new Promise((i,s)=>{(e=(e=la(e)?{filename:e}:e)||{}).width=this.videoInfo.width,e.height=this.videoInfo.height,e.filename=e.filename||be(),e.format=e.format?Ct[e.format]:Ct.png,e.quality=Number(e.quality)||.92,e.type=e.type||we.download;const u=this.$videoElement.toDataURL(e.format,e.quality);oa(u,e).then(c=>{if(e.type===we.base64)i(u);else{const l=rr(c);if(e.type===we.blob)i(l);else if(e.type===we.download){i();const o=e.format.split("/")[1];Si(l,e.filename+"."+o)}}}).catch(c=>{s(c)})})}render(){}clearView(){}play(){}pause(){}resize(){this.player.debug.log("canvasVideo","resize");var e=this.player._opt;let i=this.player.width,s=this.player.height;if(e.hasControl&&!e.controlAutoHide){const h=this.controlHeight;dt()&&this.player.fullscreen&&e.useWebFullScreen?i-=h:s-=h}let u=this.$videoElement.width,c=this.$videoElement.height;var l=e.rotate,o=(i-u)/2,f=(s-c)/2,_=(l!==270&&l!==90||(u=this.$videoElement.height,c=this.$videoElement.width),i/u),g=s/c;let T=g<_?g:_,E=(e.isResize||_!=g&&(T=_+","+g),"scale("+(T=e.isFullResize?g<_?_:g:T)+")");e.mirrorRotate==="none"&&l&&(E+=" rotate("+l+"deg)"),e.mirrorRotate==="level"?E+=" rotateY(180deg)":e.mirrorRotate==="vertical"&&(E+=" rotateX(180deg)"),this.$videoElement.style.transform=E,this.$videoElement.style.left=o+"px",this.$videoElement.style.top=f+"px"}initFps(){}setStreamFps(){}getStreamFps(){return 25}getType(){return Tt}getCanvasType(){return this.renderType===Kt?Kt:$t}addContentToCanvas(){this.tempCanvasContentList=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[]}}class pr extends Ta{constructor(e){super(e),this.yuvList=[],this.controlHeight=38,this.tempTextCanvas=null,this.tempTextCanvasCtx=null,this.player.debug.log("CanvasVideo","init")}destroy(){super.destroy(),this.yuvList=[],this.tempTextCanvas&&(this.tempTextCanvasCtx.clearRect(0,0,this.tempTextCanvas.width,this.tempTextCanvas.height),this.tempTextCanvas.width=0,this.tempTextCanvas.height=0,this.tempTextCanvas=null),this.player.debug.log("CanvasVideoLoader","destroy")}_initContext2D(){this.context2D=this.$videoElement.getContext("2d",0<arguments.length&&arguments[0]!==void 0?arguments[0]:{})}_initCanvasRender(){this.player._opt.useWCS&&!this._supportOffscreen()?(this.renderType=Dr,this._initContext2D()):this.player._opt.useMSE&&this.player._opt.mseUseCanvasRender?(this.renderType=qi,this._initContext2D()):this.player.isOldHls()&&this.player._opt.useCanvasRender?(this.renderType="hls",this._initContext2D()):this._supportOffscreen()?(this.renderType=Rr,this._bindOffscreen()):this.player._opt.useWebGPU?(this.renderType=Kt,this._initContextGPU()):(this.renderType=$t,this._initContextGl())}_supportOffscreen(){return typeof this.$videoElement.transferControlToOffscreen=="function"&&this.player._opt.useOffscreen}_bindOffscreen(){this.bitmaprenderer=this.$videoElement.getContext("bitmaprenderer")}render(e){this.yuvList.push(e),this.startRender()}startRender(){for(;!(this.yuvList.length<=0);){var e=this.yuvList.shift();this.doRender(e)}}doRender(e){var i;switch(this.player.videoTimestamp=e.ts||0,this.renderType!==qi&&(i={ts:e.ts||0,fps:!0},this.player.updateStats(i)),this.renderType){case Rr:this.bitmaprenderer.transferFromImageBitmap(e.buffer);break;case $t:case Kt:if(this.isWebglContextLost)this.player.debug.warn("CanvasVideoLoader","doRender() and webgl context is lost");else{let s=e.output;if(this.player.faceDetectActive&&this.player.ai&&this.player.ai.faceDetector&&(s=this.player.ai.faceDetector.detect({width:this.$videoElement.width,height:this.$videoElement.height,data:e.output})),this.player.objectDetectActive&&this.player.ai&&this.player.ai.objectDetector&&(s=this.player.ai.objectDetector.detect({width:this.$videoElement.width,height:this.$videoElement.height,data:e.output})),this.renderType===Kt)try{if(!this.webGPURender)return void this.player.debug.warn("CanvasVideoLoader","doRender webgpu render is not init");this.webGPURender.renderYUV(this.$videoElement.width,this.$videoElement.height,s)}catch(u){this.player.debug.error("CanvasVideoLoader","doRender webgpu render and error: "+u.toString())}else if(this.renderType===$t)try{this.webglRender.renderYUV(this.$videoElement.width,this.$videoElement.height,s),this.doAddContentToWebGlCanvas()}catch(u){this.player.debug.error("CanvasVideoLoader",`doRender webgl render context is lost ${this.contextGl&&this.contextGl.isContextLost()}  and error: `+u.toString())}}break;case Dr:if(mt(e.videoFrame.createImageBitmap))try{e.videoFrame.createImageBitmap().then(s=>{this.context2D.drawImage(s,0,0,this.$videoElement.width,this.$videoElement.height),hr(e.videoFrame),this.doAddContentToCanvas()})}catch{}else this.context2D.drawImage(e.videoFrame,0,0,this.$videoElement.width,this.$videoElement.height),hr(e.videoFrame),this.doAddContentToCanvas();break;case qi:case"hls":this.context2D.drawImage(e.$video,0,0,this.$videoElement.width,this.$videoElement.height),this.doAddContentToCanvas()}}clearView(){switch(this.renderType){case Rr:e=this.$videoElement.width,i=this.$videoElement.height,(s=document.createElement("canvas")).width=e,s.height=i,e=window.createImageBitmap(s,0,0,e,i),s.width=0,s.height=0,e.then(u=>{this.bitmaprenderer.transferFromImageBitmap(u)});break;case $t:this.contextGl.clear(this.contextGl.COLOR_BUFFER_BIT);break;case Kt:this.webGPURender.clear();break;case Dr:case qi:case"hls":this.context2D.clearRect(0,0,this.$videoElement.width,this.$videoElement.height)}var e,i,s}_initTempTextCanvas(){this.tempTextCanvas=document.createElement("canvas"),this.tempTextCanvasCtx=this.tempTextCanvas.getContext("2d"),this.tempTextCanvas.width=600,this.tempTextCanvas.height=20}doAddContentToCanvas(){if(0<this.tempCanvasContentList.length&&this.context2D){let{ctx:e,list:i}={ctx:this.context2D,list:this.tempCanvasContentList};e.save(),(i||[]).forEach(s=>{s.type==="text"?(e.font=`${s.fontSize||12}px Arial`,e.fillStyle=s.color||"green",e.fillText(s.text,s.x,s.y)):s.type==="rect"&&(e.strokeStyle=s.color||"green",e.lineWidth=s.lineWidth||2,e.strokeRect(s.x,s.y,s.width,s.height))}),e.restore()}}doAddContentToWebGlCanvas(){0<this.tempCanvasContentList.length&&this.contextGl&&this.webglRectRender&&this.tempCanvasContentList.forEach(e=>{var i=e.x,s=e.y;if(e.type==="rect"){var u=e.width,c=e.height,l=(l=e.color||"#008000",[parseInt(l.substring(1,3),16)/255,parseInt(l.substring(3,5),16)/255,parseInt(l.substring(5,7),16)/255,1]),o=e.lineWidth||4;u&&c&&this.webglRectRender.drawBox({x:i,y:s,width:u,height:c,lineColor:l,lineWidth:o,canvasWidth:this.$videoElement.width,canvasHeight:this.$videoElement.height})}else if(e.type==="text"){const f=e.text||"";f&&(u=e.fontSize||20,c=e.color||"#008000",this.tempTextCanvas||this._initTempTextCanvas(),this.tempTextCanvasCtx.clearRect(0,0,this.tempTextCanvas.width,this.tempTextCanvas.height),this.tempTextCanvasCtx.font=u+"px Arial",this.tempTextCanvasCtx.fillStyle=c,this.tempTextCanvasCtx.textBaseline="top",this.tempTextCanvasCtx.fillText(f,0,0),this.webglRender.drawDom(this.$videoElement.width,this.$videoElement.height,i,s,this.tempTextCanvas))}})}}class ka{constructor(e){this.player=e,this.configList=[],this.shadowRoot=null,this.shadowRootRealDom=null,this.shadowRootInnerDom=null,this.scale=1,this._initDom(),this.player.debug.log("SingleWatermark","int")}destroy(){this.configList=[],this.shadowRootInnerDom=null,this.scale=1,this.shadowRoot&&(this.player.$container.removeChild(this.shadowRootRealDom),this.shadowRoot=null,this.shadowRootInnerDom=null),this.player.debug.log("SingleWatermark","destroy")}resize(){this._resizeDom()}_initDom(){var e=this.player.$container,i=null,s=document.createElement("div"),u=(s.setAttribute("style","pointer-events: none !important;display: block !important;"),i=typeof s.attachShadow=="function"?s.attachShadow({mode:"open"}):s.shadowRoot||s,document.createElement("div")),c=(u.setAttribute("style","position: absolute; top: 0; left: 0; width: 0; height: 0;display: none;"),i.appendChild(u),e.children),l=Math.floor(Math.random()*(c.length-1));c[l]?e.insertBefore(s,c[l]):e.appendChild(s),this.shadowRootInnerDom=u,this.shadowRootRealDom=s,this.shadowRoot=i}update(e){this._removeDom();let i=[];Array.isArray(e)?i=e:jr(e)&&i.push(e),e=i.map(s=>aa(s)),this.configList=e,this._updateDom()}_resizeDom(){this.player.$container;const e=this.player.width,i=this.player.height,s=this.player.getVideoInfo();if(s&&0<s.height&&0<s.width){let g=s.width,T=s.height;var u=this.player._opt;let E=i,h=e;if(u.hasControl&&!u.controlAutoHide){const r=u.playType===pe?48:38;dt()&&this.player.fullscreen&&u.useWebFullScreen?h-=r:E-=r}var c=u.rotate,l=(h-g)/2,o=(E-T)/2,f=(c!==270&&c!==90||(g=s.height,T=s.width),h/g),_=E/T;let k=_<f?_:f,t=(u.isResize||f!=_&&(k=f+","+_),"scale("+(k=u.isFullResize?_<f?f:_:k)+")");u.mirrorRotate==="none"&&c&&(t+=" rotate("+c+"deg)"),u.mirrorRotate==="level"?t+=" rotateY(180deg)":u.mirrorRotate==="vertical"&&(t+=" rotateX(180deg)"),this.scale=(""+k).indexOf(",")!==-1?f:k,this.shadowRootInnerDom.style.transform=t,this.shadowRootInnerDom.style.left=l+"px",this.shadowRootInnerDom.style.top=o+"px",this.shadowRootInnerDom.style.width=s.width+"px",this.shadowRootInnerDom.style.height=s.height+"px",this.shadowRootInnerDom.style.display="block"}}_updateDom(){this.shadowRoot&&this.configList.forEach(e=>{var i=document.createElement("div");let s=null;e.image&&e.image.src?((s=document.createElement("img")).style.height="100%",s.style.width="100%",s.style.objectFit="contain",s.src=e.image.src):e.text&&e.text.content?s=document.createTextNode(e.text.content):(e.rect&&e.rect.color&&e.rect.width||e.html)&&(s=document.createElement("div")),s&&(i.appendChild(s),i.style.visibility="",i.style.position="absolute",i.style.display="block",i.style["-ms-user-select"]="none",i.style["-moz-user-select"]="none",i.style["-webkit-user-select"]="none",i.style["-o-user-select"]="none",i.style["user-select"]="none",i.style["-webkit-touch-callout"]="none",i.style["-webkit-tap-highlight-color"]="rgba(0,0,0,0)",i.style["-webkit-text-size-adjust"]="none",i.style["-webkit-touch-callout"]="none",i.style.opacity=e.opacity,he(e.left)&&(i.style.left=e.left+"px"),he(e.right)&&(i.style.right=e.right+"px"),he(e.top)&&(i.style.top=e.top+"px"),he(e.bottom)&&(i.style.bottom=e.bottom+"px"),e.backgroundColor&&(i.style.backgroundColor=e.backgroundColor),i.style.overflow="hidden",i.style.zIndex="9999999",e.image&&e.image.src?(i.style.width=e.image.width+"px",i.style.height=e.image.height+"px"):e.text&&e.text.content?(i.style.fontSize=e.text.fontSize+"px",i.style.color=e.text.color):e.rect&&e.rect.color&&e.rect.width?(i.style.width=e.rect.width+"px",i.style.height=e.rect.height+"px",i.style.borderWidth=e.rect.lineWidth+"px",i.style.borderStyle="solid",i.style.borderColor=e.rect.color):e.html&&(i.innerHTML=e.html,i.style.width=e.width+"px",i.style.height=e.height+"px"),this.shadowRootInnerDom.appendChild(i))})}remove(){this._removeDom()}_removeDom(){this.shadowRootInnerDom&&(this.shadowRootInnerDom.innerHTML="")}}class Ei extends _a{constructor(e){super(),this.player=e;var i=document.createElement("video"),l=document.createElement("canvas"),l=(i.muted=!0,i.style.position="absolute",i.style.top=0,i.style.left=0,this._delayPlay=!1,e.$container.appendChild(i),this.$videoElement=i,this.$canvasElement=l,this.canvasContext=l.getContext("2d"),this.mediaStream=null,this.vwriter=null,e.canVideoTrackWritter()&&vi()&&_i()&&(this.trackGenerator=new MediaStreamTrackGenerator({kind:"video"}),this.mediaStream=new MediaStream([this.trackGenerator]),i.srcObject=this.mediaStream,this.vwriter=this.trackGenerator.writable.getWriter()),this.fixChromeVideoFlashBug(),this.resize(),this.eventListenList=[],this.tempContentList=[],this.contentWatermark=null,this.player.events).proxy,i=l(this.$videoElement,"canplay",()=>{this.player.debug.log("Video","canplay"),this._delayPlay&&this._play()}),s=l(this.$videoElement,"waiting",()=>{this.player.debug.log("Video","waiting")}),u=l(this.$videoElement,"loadedmetadata",()=>{this.player.debug.log("Video","loadedmetadata")}),c=l(this.$videoElement,"timeupdate",o=>{o=parseInt(o.timeStamp,10),(this.player._opt.isWebrtc||this.player.isOldHls())&&this.player.emit(N.timeUpdate,o),e._opt.isWebrtc&&(e.handleRender(),e.updateStats({fps:!0}))}),l=l(this.$videoElement,"error",()=>{this.player.debug.error("Video","Error "+this.$videoElement.error.code+"; details: "+this.$videoElement.error.message)});this.eventListenList.push(i,s,c,l,u),this.player.debug.log("Video","init")}destroy(){var e;if(super.destroy(),this.eventListenList&&(this.eventListenList.forEach(i=>{i()}),this.eventListenList=[]),this.contentWatermark&&(this.contentWatermark.destroy(),this.contentWatermark=null),this.tempContentList=[],this.player._opt.videoRenderSupportScale&&this._isNeedAddBackDropFilter()&&((e=this.player.$container).style.backdropFilter="none",e.style.transform="none"),this.$canvasElement.height=0,this.$canvasElement.width=0,this.$canvasElement=null,this.canvasContext=null,this.$videoElement){this.$videoElement.pause(),this.$videoElement.currentTime=0,this.$videoElement.srcObject&&(this.$videoElement.srcObject=null,this.$videoElement.removeAttribute("srcObject")),this.$videoElement.src&&(this.$videoElement.src="",this.$videoElement.removeAttribute("src"));try{this.$videoElement.load()}catch{}this.player.$container.removeChild(this.$videoElement),this.$videoElement=null}this.trackGenerator&&(this.trackGenerator.stop(),this.trackGenerator=null),this.vwriter&&(this.vwriter.close(),this.vwriter=null),this._delayPlay=!1,this.mediaStream&&(this.mediaStream.getTracks().forEach(i=>i.stop()),this.mediaStream=null),this.off(),this.player.debug.log("Video","destroy")}fixChromeVideoFlashBug(){var e;this.player._opt.videoRenderSupportScale&&this._isNeedAddBackDropFilter()&&((e=this.player.$container).style.backdropFilter="blur(0px)",e.style.transform="translateZ(0)")}_isNeedAddBackDropFilter(){var e=Ur().type.toLowerCase();return e==="chrome"||e==="edge"}isPause(){let e=!0;return e=this.$videoElement?this.$videoElement.paused:e}_getVideoReadyState(){let e=0;return e=this.$videoElement?this.$videoElement.readyState:e}_getVideoCurrentTime(){let e=0;return e=this.$videoElement?this.$videoElement.currentTime:e}play(){var e;this.$videoElement&&(e=this._getVideoReadyState(),this.player.debug.log("Video","play and readyState: "+e),e===0?(this.player.debug.warn("Video","readyState is 0 and set _delayPlay to true"),this._delayPlay=!0):this._play())}_play(){this.$videoElement&&this.$videoElement.play().then(()=>{this._delayPlay=!1,this.player.debug.log("Video","_play success"),setTimeout(()=>{this.isPlaying()||(this.player.debug.warn("Video","play failed and retry play"),this._play())},100)}).catch(e=>{this.player.debug.error("Video","_play error",e)})}pause(e){this.isPlaying()&&(e?this.$videoElement&&this.$videoElement.pause():setTimeout(()=>{this.$videoElement&&this.$videoElement.pause()},100))}clearView(){this.$videoElement&&(this.$videoElement.pause(),this.$videoElement.currentTime=0,this.$videoElement.src&&(this.$videoElement.src="",this.$videoElement.removeAttribute("src")),this.$videoElement.srcObject)&&(this.$videoElement.srcObject=null,this.$videoElement.removeAttribute("srcObject"))}screenshot(e,i,f,u){if(!this._canScreenshot())return this.player.debug.warn("Video","screenshot failed, video is not ready"),null;e=e||be(),u=u||we.download;let c=.92;!Ct[i]&&we[i]&&(u=i,i="png",f=void 0),typeof f=="string"&&(u=f,f=void 0),f!==void 0&&(c=Number(f));var f=this.$videoElement,l=this.$canvasElement,o=(l.width=f.videoWidth,l.height=f.videoHeight,this.canvasContext.drawImage(f,0,0,l.width,l.height),Ct[i]||Ct.png),f=l.toDataURL(o,c);if(this.canvasContext.clearRect(0,0,l.width,l.height),l.width=0,l.height=0,u===we.base64)return f;{const _=rr(f);if(u===we.blob)return _;if(u===we.download){const g=o.split("/")[1];Si(_,e+"."+g)}}}screenshotWatermark(e){return new Promise((i,s)=>{if(la(e)&&(e={filename:e}),!this._canScreenshot())return this.player.debug.warn("Video","screenshot failed, video is not ready"),s("screenshot failed, video is not ready");var u=this.$videoElement,c=((e=e||{}).width=u.videoWidth,e.height=u.videoHeight,e.filename=e.filename||be(),e.format=e.format?Ct[e.format]:Ct.png,e.quality=Number(e.quality)||.92,e.type=e.type||we.download,this.$canvasElement);c.width=u.videoWidth,c.height=u.videoHeight,this.canvasContext.drawImage(u,0,0,c.width,c.height);const l=c.toDataURL(e.format,e.quality);this.canvasContext.clearRect(0,0,c.width,c.height),c.width=0,c.height=0,oa(l,e).then(o=>{if(e.type===we.base64)i(l);else{var f=rr(o);if(e.type===we.blob)i(f);else if(e.type===we.download){i();const _=e.format.split("/")[1];Si(f,e.filename+"."+_)}}}).catch(o=>{s(o)})})}initCanvasViewSize(){this.resize()}clear(){var e=this.$videoElement,i=e.buffered,i=i.length?i.end(i.length-1):0;e.currentTime=i}render(e){if(this.vwriter){if(this.$videoElement.srcObject||(this.$videoElement.srcObject=this.mediaStream),this.$videoElement.paused&&this.player.debug.warn("Video","render error, video is paused"),this.player.videoTimestamp=e.ts||0,this.player.updateStats({fps:!0,ts:e.ts||0}),e.videoFrame)this.vwriter.write(e.videoFrame),hr(e.videoFrame);else if(e.output){let c=e.output;this.player.faceDetectActive&&this.player.ai&&this.player.ai.faceDetector&&(c=this.player.ai.faceDetector.detect({width:this.videoInfo.width,height:this.videoInfo.height,data:e.output})),this.player.objectDetectActive&&this.player.ai&&this.player.ai.objectDetector&&(c=this.player.ai.objectDetector.detect({width:this.videoInfo.width,height:this.videoInfo.height,data:e.output}));try{s=c,u={format:"I420",codedWidth:this.videoInfo.width,codedHeight:this.videoInfo.height,timestamp:e.ts};var i=new VideoFrame(s,u);this.vwriter.write(i),hr(i)}catch(l){this.player.debug.error("Video","render error",l),this.player.emitError(H.wasmUseVideoRenderError,l)}}this.doAddContentToWatermark()}else this.player.debug.warn("Video","render and this.vwriter is null");var s,u}resize(){let e=this.player.width,i=this.player.height;const s=this.player._opt,u=s.rotate;if(s.hasControl&&!s.controlAutoHide){const _=s.playType===pe?48:38;dt()&&this.player.fullscreen&&s.useWebFullScreen?e-=_:i-=_}this.$videoElement.width=e,this.$videoElement.height=i,u!==270&&u!==90||(this.$videoElement.width=i,this.$videoElement.height=e);let c=(e-this.$videoElement.width)/2,l=(i-this.$videoElement.height)/2,o="contain",f=(s.isResize||(o="fill"),s.isFullResize&&(o="none"),"");s.mirrorRotate==="none"&&u&&(f+=" rotate("+u+"deg)"),s.mirrorRotate==="level"?f+=" rotateY(180deg)":s.mirrorRotate==="vertical"&&(f+=" rotateX(180deg)"),this.player._opt.videoRenderSupportScale&&(this.$videoElement.style.objectFit=o),this.$videoElement.style.transform=f,this.$videoElement.style.left=c+"px",this.$videoElement.style.top=l+"px"}getType(){return vt}isPlaying(){return this.$videoElement&&_e(this.$videoElement.paused)&&_e(this.$videoElement.ended)&&this.$videoElement.playbackRate!==0&&this.$videoElement.readyState!==0}_canScreenshot(){return this.$videoElement&&2<=this.$videoElement.readyState}addContentToCanvas(){this.tempContentList=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[]}doAddContentToWatermark(){var e;0<this.tempContentList.length?(this.contentWatermark||(this.contentWatermark=new ka(this.player),this.contentWatermark.resize()),e=this.tempContentList.map(i=>{var s={left:i.x,top:i.y};return i.type==="text"?s.text={content:i.text,fontSize:i.fontSize,color:i.color}:i.type==="rect"&&(s.rect={width:i.width,height:i.height,color:i.color,lineWidth:i.lineWidth}),s}),this.contentWatermark.update(e)):this.contentWatermark&&this.contentWatermark.remove()}getPlaybackQuality(){let e=null;var i;return this.$videoElement&&(e=mt(this.$videoElement.getVideoPlaybackQuality)?{droppedVideoFrames:(i=this.$videoElement.getVideoPlaybackQuality()).droppedVideoFrames||i.corruptedVideoFrames,totalVideoFrames:i.totalVideoFrames,creationTime:i.creationTime}:{droppedVideoFrames:this.$videoElement.webkitDroppedFrameCount,totalVideoFrames:this.$videoElement.webkitDecodedFrameCount,creationTime:be()})&&(e.renderedVideoFrames=e.totalVideoFrames-e.droppedVideoFrames),e}}class jn extends Ta{constructor(e){super(e),this.controlHeight=48,this.bufferList=[],this.playing=!1,this.playInterval=null,this.fps=1,this.preFps=1,this.streamFps=0,this.playbackRate=1,this._firstTimestamp=null,this._renderFps=0,this._startfpsTime=null,this._startFpsTimestamp=null,this._hasCalcFps=!1,this.player.on(N.playbackPause,i=>{i?(this.pause(),this.player.playback.isPlaybackPauseClearCache&&this.clear()):this.resume()}),this.player.debug.log("CanvasPlaybackLoader","init")}destroy(){this._stopSync(),this._firstTimestamp=null,this.playing=!1,this.playbackRate=1,this.fps=1,this.preFps=1,this.bufferList=[],this._renderFps=0,this._startfpsTime=null,this._startFpsTimestamp=null,this._hasCalcFps=!1,super.destroy(),this.player.debug.log("CanvasPlaybackLoader","destroy")}_initCanvasRender(){this.player._opt.useWebGPU?(this.renderType=Kt,this._initContextGPU()):(this.renderType=$t,this._initContextGl())}_sync(){this._stopSync(),this._doPlay(),this.playInterval=setInterval(()=>{this._doPlay()},this.fragDuration)}_doPlay(){var e;0<this.bufferList.length&&!this.player.seeking&&(e=this.bufferList.shift())&&e.buffer&&(this._doRender(e.buffer),this.player.handleRender(),this.player.playback.updateStats({ts:e.ts,tfTs:e.tfTs}))}_stopSync(){this.playInterval&&(clearInterval(this.playInterval),this.playInterval=null)}_doRender(e){if(this.getCanvasType()===$t)try{this.webglRender.renderYUV(this.$videoElement.width,this.$videoElement.height,e)}catch(i){this.player.debug.error("CanvasPlaybackLoader",`doRender webgl render context is lost ${this.contextGl&&this.contextGl.isContextLost()}  and error: `+i.toString())}else if(this.getCanvasType()===Kt)try{this.webGPURender?this.webGPURender.renderYUV(this.$videoElement.width,this.$videoElement.height,e):this.player.debug.warn("CanvasVideoLoader","doRender webgpu render is not init")}catch(i){this.player.debug.error("CanvasPlaybackLoader","doRender webgpu render and error: "+i.toString())}}_updateStats(e){this.player.updateStats({fps:!0,ts:e}),this._startfpsTime||(this._startfpsTime=e,this._startFpsTimestamp=be());var i=e,s=be(),u=s-this._startFpsTimestamp;u<=1e3?this._renderFps+=1:(this.player.emit(N.playbackStats,{fps:this._renderFps,start:this._startfpsTime,end:i,timestamp:u,dataTimestamp:i-this._startfpsTime,audioBufferSize:this.player.audio?this.player.audio.bufferSize:0,videoBufferSize:this.player.video?this.player.video.bufferSize:0,ts:e}),this._renderFps=0,this._startfpsTime=i,this._startFpsTimestamp=s)}get rate(){return this.playbackRate}get fragDuration(){return Math.ceil(1e3/(this.fps*this.playbackRate))}get bufferSize(){return this.bufferList.length}getStreamFps(){return this.streamFps}initFps(){this._hasCalcFps?this.player.debug.log("CanvasPlaybackLoader","initFps, has calc fps"):(this.preFps=ft(this.player.playback.fps,1,100),this.fps=this.preFps)}setFps(e){e!==this.fps?(100<e&&this.player.debug.warn("CanvasPlaybackLoader","setFps max",e),e<0&&this.player.debug.warn("CanvasPlaybackLoader","setFps min",e),this.fps=ft(e,1,100),this.player.debug.log("CanvasPlaybackLoader",`setFps ${this.preFps} -> `+this.fps),this.player.playback.isUseFpsRender&&this._sync()):this.player.debug.log("CanvasPlaybackLoader","setFps, same fps "+e)}setStreamFps(e){this.player.debug.log("CanvasPlaybackLoader","setStreamFps",e),this._hasCalcFps=!0,this.streamFps=e,this.preFps=e,this.setFps(e)}setRate(e){e!==this.playbackRate&&(this.playbackRate=e,this.player.playback.isUseFpsRender)&&this._sync()}render$2(e){this._firstTimestamp===null&&(this._firstTimestamp=e.ts);var i={tfTs:e.ts-this._firstTimestamp,ts:e.ts,buffer:e.output};this.bufferList.push(i),this.startRender(),this.player.handleRender(),this.player.playback.updateStats({ts:e.ts,tfTs:i.tfTs})}startRender(){for(;!(this.bufferList.length<=0);){var e=this.bufferList.shift();this._doRender(e.buffer)}}pushData(e){this._firstTimestamp===null&&(this._firstTimestamp=e.ts);const i={tfTs:e.ts-this._firstTimestamp,ts:e.ts,buffer:e.output},s=this.player._opt.playbackConfig.isCacheBeforeDecodeForFpsRender;if(s||this.bufferSize>this.fps*this.playbackRate*2&&(this.player.debug.warn("CanvasPlaybackLoader","buffer size is "+this.bufferSize),this._doPlay()),this.bufferList.push(i),!this._hasCalcFps){const u=fa(this.bufferList);u!==null&&u!==this.preFps&&(this.player.debug.log("CanvasPlaybackLoader",`calc fps is ${u} pre fps is ${this.preFps} and updatePreFps`),this.setStreamFps(u))}if(!s){const u=this.bufferList.length,c=u/(this.fps*this.playbackRate);this.player.debug.log("CanvasPlaybackLoader","rate is",c),c<=1?this.setFps(this.preFps):(this.setFps(this.fps+Math.floor(c*this.playbackRate)),this.player.debug.warn("CanvasPlaybackLoader","rate is",c,"fps is",this.fps,"bufferListLength is",u))}}initVideo(){this.player.playback&&this.player.playback.isUseFpsRender&&this._sync(),this.playing=!0}initVideoDelay(){var e=this.player._opt.playbackDelayTime;0<e?this.delayTimeout=setTimeout(()=>{this.initVideo()},e):this.initVideo()}clearView(){this.contextGl.clear(this.contextGl.COLOR_BUFFER_BIT)}clear(){this.bufferList=[]}resume(){this.player.playback.isUseFpsRender&&this._sync(),this.playing=!0}pause(){this.player.playback.isUseFpsRender&&this._stopSync(),this.playing=!1}}class fr{constructor(e){return new(fr.getLoaderFactory(e._opt))(e)}static getLoaderFactory(e){return e.useMSE?e.mseUseCanvasRender?pr:Ei:e.isHls&&_e(e.supportHls265)?e.useCanvasRender?pr:Ei:e.isWebrtc?Ei:e.useWCS?!e.useOffscreen&&e.wcsUseVideoRender?Ei:pr:e.playType===pe?jn:e.wasmUseVideoRender&&!e.useOffscreen?Ei:pr}}class zn extends Ae{constructor(e){super(),this.bufferList=[],this.player=e,this.$audio=null,this.scriptNode=null,this.workletProcessorNode=null,this.hasInitScriptNode=!1,this.audioContext=new(window.AudioContext||window.webkitAudioContext)({sampleRate:48e3}),this.gainNode=this.audioContext.createGain(),e=this.audioContext.createBufferSource(),e.buffer=this.audioContext.createBuffer(1,1,22050),e.connect(this.audioContext.destination),e.noteOn?e.noteOn(0):e.start(0),this.audioBufferSourceNode=e,this.mediaStreamAudioDestinationNode=this.audioContext.createMediaStreamDestination(),this.gainNode.gain.value=0,this.playing=!1,this.audioSyncVideoOption={diff:null},this.audioInfo={encType:"",channels:"",sampleRate:""},this.init=!1,this.hasAudio=!1,this.audioResumeStateTimeout=null,this.on(N.videoSyncAudio,i=>{this.audioSyncVideoOption=i})}destroy(){this.closeAudio(),this.resetInit(),this.audioContext.close(),this.audioContext=null,this.gainNode=null,this.hasAudio=!1,this.playing=!1,this.scriptNode&&(this.scriptNode.onaudioprocess=Pr,this.scriptNode=null),this.workletProcessorNode&&(this.workletProcessorNode.port.onmessage=Pr,this.workletProcessorNode=null),this.audioResumeStateTimeout&&(clearTimeout(this.audioResumeStateTimeout),this.audioResumeStateTimeout=null),this.audioBufferSourceNode=null,this.mediaStreamAudioDestinationNode=null,this.hasInitScriptNode=!1,this.audioSyncVideoOption={diff:null},this.off()}resetInit(){this.audioInfo={encType:"",channels:"",sampleRate:""},this.init=!1}getAudioInfo(){return this.audioInfo}updateAudioInfo(e){e.encTypeCode&&(this.audioInfo.encType=xs[e.encTypeCode]),e.channels&&(this.audioInfo.channels=e.channels),e.sampleRate&&(this.audioInfo.sampleRate=e.sampleRate),this.audioInfo.sampleRate&&this.audioInfo.channels&&this.audioInfo.encType&&!this.init&&(this.player.emit(N.audioInfo,this.audioInfo),this.init=!0)}get isPlaying(){return this.playing}get isMute(){return this.gainNode.gain.value===0}get volume(){return this.gainNode.gain.value}get bufferSize(){return this.bufferList.length}initScriptNode(){}initMobileScriptNode(){}initWorkletScriptNode(){}getEngineType(){return""}mute(e){e?(this.isMute||this.player.emit(N.mute,e),this.setVolume(0),this.clear()):(this.isMute&&this.player.emit(N.mute,e),this.setVolume(.5))}setVolume(e){e=parseFloat(e).toFixed(2),isNaN(e)||(this.audioEnabled(!0),e=ft(e,0,1),this.gainNode.gain.value=e,this.player.emit(N.volumechange,this.player.volume))}closeAudio(){this.hasInitScriptNode&&(this.scriptNode&&this.scriptNode.disconnect(this.gainNode),this.workletProcessorNode&&this.workletProcessorNode.disconnect(this.gainNode),this.gainNode)&&(this.gainNode.disconnect(this.mediaStreamAudioDestinationNode),this.$audio||this.gainNode.disconnect(this.audioContext.destination)),this.clear()}audioEnabled(e){e?this.isStateSuspended()&&(this.audioContext.resume().then(()=>{this.player.emit(N.audioResumeState,{state:this.audioContext.state,isRunning:this.isStateRunning()})}),this.audioResumeStateTimeout=setTimeout(()=>{clearTimeout(this.audioResumeStateTimeout),this.audioResumeStateTimeout=null,this.isStateSuspended()&&this.player.emit(N.audioResumeState,{state:this.audioContext.state,isRunning:this.isStateRunning()})},1e3)):this.isStateRunning()&&this.audioContext.suspend()}isStateRunning(){return this.audioContext.state==="running"}isStateSuspended(){return this.audioContext.state==="suspended"}clear(){this.bufferList=[]}play(e,i){}pause(){this.audioSyncVideoOption={diff:null},this.playing=!1}resume(){this.playing=!0}setRate(e){}getAudioBufferSize(){return 0}}class Gn{constructor(e,i,s,u){this.player=e,this.audio=i,this.channel=s,this.bufferSize=u}extract(e,i){var s=this.provide(i);for(let u=0;u<s.size;u++)e[2*u]=s.left[u],e[2*u+1]=s.right[u];return this.audio.tempAudioTimestamp=s.ts,s.size}provide(e){let i=new Float32Array(e),s=new Float32Array(e),u=0,c=0,l=0,o=e/this.bufferSize;var f=this.audio.bufferList;if(f.length>o){try{for(let _=0;_<o;_++){const g=f.shift();this.channel===2?(i.set(g.buffer[0],l),s.set(g.buffer[1],l)):(i.set(g.buffer[0],l),s.set(g.buffer[0],l)),l+=this.bufferSize,c=g.ts}}catch(_){this.player.debug.warn("Processor","provide()",_),i=new Float32Array(0),s=new Float32Array(0)}u=i.length}return{size:u,ts:c,left:i,right:s}}destroy(){this.buffer=null,this.channel=null}}class Ti{constructor(){this._vector=new Float32Array,this._position=0,this._frameCount=0}get vector(){return this._vector}get position(){return this._position}get startIndex(){return 2*this._position}get frameCount(){return this._frameCount}get endIndex(){return 2*(this._position+this._frameCount)}clear(){this.receive(this._frameCount),this.rewind()}put(e){this._frameCount+=e}putSamples(e,u){let s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;var u=2*(u=u||0),c=2*(s=0<=s?s:(e.length-u)/2),l=(this.ensureCapacity(s+this._frameCount),this.endIndex);this.vector.set(e.subarray(u,u+c),l),this._frameCount+=s}putBuffer(e,i){let s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;i=i||0,0<=s||(s=e.frameCount-i),this.putSamples(e.vector,e.position+i,s)}receive(e){0<=e&&!(e>this._frameCount)||(e=this.frameCount),this._frameCount-=e,this._position+=e}receiveSamples(e){var i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,s=this.startIndex;e.set(this._vector.subarray(s,s+2*i)),this.receive(i)}extract(e){var i=this.startIndex+2*(1<arguments.length&&arguments[1]!==void 0?arguments[1]:0);e.set(this._vector.subarray(i,i+2*(2<arguments.length&&arguments[2]!==void 0?arguments[2]:0)))}ensureCapacity(){var e=parseInt(2*(0<arguments.length&&arguments[0]!==void 0?arguments[0]:0));this._vector.length<e?((e=new Float32Array(e)).set(this._vector.subarray(this.startIndex,this.endIndex)),this._vector=e,this._position=0):this.rewind()}ensureAdditionalCapacity(){this.ensureCapacity(this._frameCount+(0<arguments.length&&arguments[0]!==void 0?arguments[0]:0))}rewind(){0<this._position&&(this._vector.set(this._vector.subarray(this.startIndex,this.endIndex)),this._position=0)}}class xa{constructor(e){e?(this._inputBuffer=new Ti,this._outputBuffer=new Ti):this._inputBuffer=this._outputBuffer=null}get inputBuffer(){return this._inputBuffer}set inputBuffer(e){this._inputBuffer=e}get outputBuffer(){return this._outputBuffer}set outputBuffer(e){this._outputBuffer=e}clear(){this._inputBuffer.clear(),this._outputBuffer.clear()}}class Vr extends xa{constructor(e){super(e),this.reset(),this._rate=1}set rate(e){this._rate=e}reset(){this.slopeCount=0,this.prevSampleL=0,this.prevSampleR=0}clone(){var e=new Vr;return e.rate=this._rate,e}process(){var e=this._inputBuffer.frameCount,e=(this._outputBuffer.ensureAdditionalCapacity(e/this._rate+1),this.transpose(e));this._inputBuffer.receive(),this._outputBuffer.put(e)}transpose(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0;if(e===0)return 0;var i=this._inputBuffer.vector,s=this._inputBuffer.startIndex,u=this._outputBuffer.vector,c=this._outputBuffer.endIndex;let l=0,o=0;for(;this.slopeCount<1;)u[c+2*o]=(1-this.slopeCount)*this.prevSampleL+this.slopeCount*i[s],u[c+2*o+1]=(1-this.slopeCount)*this.prevSampleR+this.slopeCount*i[s+1],o+=1,this.slopeCount+=this._rate;if(--this.slopeCount,e!==1)e:for(;;){for(;1<this.slopeCount;)if(--this.slopeCount,(l+=1)>=e-1)break e;var f=s+2*l;u[c+2*o]=(1-this.slopeCount)*i[f]+this.slopeCount*i[f+2],u[c+2*o+1]=(1-this.slopeCount)*i[f+1]+this.slopeCount*i[f+3],o+=1,this.slopeCount+=this._rate}return this.prevSampleL=i[s+2*e-2],this.prevSampleR=i[s+2*e-1],o}}function Hn(){}class Vn extends class{constructor(e){this._pipe=e}get pipe(){return this._pipe}get inputBuffer(){return this._pipe.inputBuffer}get outputBuffer(){return this._pipe.outputBuffer}fillInputBuffer(){throw new Error("fillInputBuffer() not overridden")}fillOutputBuffer(){let e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0;for(;this.outputBuffer.frameCount<e;){const i=16384-this.inputBuffer.frameCount;if(this.fillInputBuffer(i),this.inputBuffer.frameCount<16384)break;this._pipe.process()}}clear(){this._pipe.clear()}}{constructor(e,i){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Hn;super(i),this.callback=s,this.sourceSound=e,this.historyBufferSize=22050,this._sourcePosition=0,this.outputBufferPosition=0,this._position=0}get position(){return this._position}set position(e){if(e>this._position)throw new RangeError("New position may not be greater than current position");var i=this.outputBufferPosition-(this._position-e);if(i<0)throw new RangeError("New position falls outside of history buffer");this.outputBufferPosition=i,this._position=e}get sourcePosition(){return this._sourcePosition}set sourcePosition(e){this.clear(),this._sourcePosition=e}onEnd(){this.callback()}fillInputBuffer(){var i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,e=new Float32Array(2*i),i=this.sourceSound.extract(e,i,this._sourcePosition);this._sourcePosition+=i,this.inputBuffer.putSamples(e,0,i)}extract(s){var i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,i=(this.fillOutputBuffer(this.outputBufferPosition+i),Math.min(i,this.outputBuffer.frameCount-this.outputBufferPosition)),s=(this.outputBuffer.extract(s,this.outputBufferPosition,i),this.outputBufferPosition+i);return this.outputBufferPosition=Math.min(this.historyBufferSize,s),this.outputBuffer.receive(Math.max(s-this.historyBufferSize,0)),this._position+=i,i}handleSampleData(e){this.extract(e.data,4096)}clear(){super.clear(),this.outputBufferPosition=0}}const Ca=[[124,186,248,310,372,434,496,558,620,682,744,806,868,930,992,1054,1116,1178,1240,1302,1364,1426,1488,0],[-100,-75,-50,-25,25,50,75,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-20,-15,-10,-5,5,10,15,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-4,-3,-2,-1,1,2,3,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];class Wr extends xa{constructor(e){super(e),this._quickSeek=!0,this.midBufferDirty=!1,this.midBuffer=null,this.overlapLength=0,this.autoSeqSetting=!0,this.autoSeekSetting=!0,this._tempo=1,this.setParameters(44100,0,0,8)}clear(){super.clear(),this.clearMidBuffer()}clearMidBuffer(){this.midBufferDirty&&(this.midBufferDirty=!1,this.midBuffer=null)}setParameters(e,i,s,u){0<e&&(this.sampleRate=e),0<u&&(this.overlapMs=u),0<i?(this.sequenceMs=i,this.autoSeqSetting=!1):this.autoSeqSetting=!0,0<s?(this.seekWindowMs=s,this.autoSeekSetting=!1):this.autoSeekSetting=!0,this.calculateSequenceParameters(),this.calculateOverlapLength(this.overlapMs),this.tempo=this._tempo}set tempo(e){this._tempo=e,this.calculateSequenceParameters(),this.nominalSkip=this._tempo*(this.seekWindowLength-this.overlapLength),this.skipFract=0,e=Math.floor(this.nominalSkip+.5),this.sampleReq=Math.max(e+this.overlapLength,this.seekWindowLength)+this.seekLength}get tempo(){return this._tempo}get inputChunkSize(){return this.sampleReq}get outputChunkSize(){return this.overlapLength+Math.max(0,this.seekWindowLength-2*this.overlapLength)}calculateOverlapLength(){var e=this.sampleRate*(0<arguments.length&&arguments[0]!==void 0?arguments[0]:0)/1e3;e=e<16?16:e,this.overlapLength=e-=e%8,this.refMidBuffer=new Float32Array(2*this.overlapLength),this.midBuffer=new Float32Array(2*this.overlapLength)}checkLimits(e,i,s){return e<i?i:s<e?s:e}calculateSequenceParameters(){var e;this.autoSeqSetting&&(e=150+-50*this._tempo,e=this.checkLimits(e,50,125),this.sequenceMs=Math.floor(e+.5)),this.autoSeekSetting&&(e=28.333333333333332+-10/1.5*this._tempo,e=this.checkLimits(e,15,25),this.seekWindowMs=Math.floor(e+.5)),this.seekWindowLength=Math.floor(this.sampleRate*this.sequenceMs/1e3),this.seekLength=Math.floor(this.sampleRate*this.seekWindowMs/1e3)}set quickSeek(e){this._quickSeek=e}clone(){var e=new Wr;return e.tempo=this._tempo,e.setParameters(this.sampleRate,this.sequenceMs,this.seekWindowMs,this.overlapMs),e}seekBestOverlapPosition(){return this._quickSeek?this.seekBestOverlapPositionStereoQuick():this.seekBestOverlapPositionStereo()}seekBestOverlapPositionStereo(){let e,i,s,u=0;for(this.preCalculateCorrelationReferenceStereo(),e=0,i=Number.MIN_VALUE;u<this.seekLength;u+=1)(s=this.calculateCrossCorrelationStereo(2*u,this.refMidBuffer))>i&&(i=s,e=u);return e}seekBestOverlapPositionStereoQuick(){let e,i,s,u,c,l=0;for(this.preCalculateCorrelationReferenceStereo(),i=Number.MIN_VALUE,e=0,u=0,c=0;l<4;l+=1){let o=0;for(;Ca[l][o]&&!((c=u+Ca[l][o])>=this.seekLength);)(s=this.calculateCrossCorrelationStereo(2*c,this.refMidBuffer))>i&&(i=s,e=c),o+=1;u=e}return e}preCalculateCorrelationReferenceStereo(){let e,i,s=0;for(;s<this.overlapLength;s+=1)i=s*(this.overlapLength-s),e=2*s,this.refMidBuffer[e]=this.midBuffer[e]*i,this.refMidBuffer[1+e]=this.midBuffer[1+e]*i}calculateCrossCorrelationStereo(e,i){var s=this._inputBuffer.vector;e+=this._inputBuffer.startIndex;let u=0,c=2;for(var l,o=2*this.overlapLength;c<o;c+=2)l=c+e,u+=s[l]*i[c]+s[l+1]*i[c+1];return u}overlap(e){this.overlapStereo(2*e)}overlapStereo(e){var i=this._inputBuffer.vector,s=(e+=this._inputBuffer.startIndex,this._outputBuffer.vector),u=this._outputBuffer.endIndex;let c,l,o=0;for(var f,_,g,T=1/this.overlapLength;o<this.overlapLength;o+=1)l=(this.overlapLength-o)*T,f=o*T,s[(g=(c=2*o)+u)+0]=i[(_=c+e)+0]*f+this.midBuffer[0+c]*l,s[g+1]=i[_+1]*f+this.midBuffer[1+c]*l}process(){var e;if(this.midBuffer===null){if(this._inputBuffer.frameCount<this.overlapLength)return;this.midBuffer=new Float32Array(2*this.overlapLength),this._inputBuffer.receiveSamples(this.midBuffer,this.overlapLength)}for(;this._inputBuffer.frameCount>=this.sampleReq;){e=this.seekBestOverlapPosition(),this._outputBuffer.ensureAdditionalCapacity(this.overlapLength),this.overlap(Math.floor(e)),this._outputBuffer.put(this.overlapLength),0<(i=this.seekWindowLength-2*this.overlapLength)&&this._outputBuffer.putBuffer(this._inputBuffer,e+this.overlapLength,i);var i=this._inputBuffer.startIndex+2*(e+this.seekWindowLength-this.overlapLength);this.midBuffer.set(this._inputBuffer.vector.subarray(i,i+2*this.overlapLength)),this.skipFract+=this.nominalSkip,e=Math.floor(this.skipFract),this.skipFract-=e,this._inputBuffer.receive(e)}}}function La(D,e){return 1e-10<(e<D?D-e:e-D)}class $r{constructor(){this.transposer=new Vr(!1),this.stretch=new Wr(!1),this._inputBuffer=new Ti,this._intermediateBuffer=new Ti,this._outputBuffer=new Ti,this._rate=0,this._tempo=0,this.virtualPitch=1,this.virtualRate=1,this.virtualTempo=1,this.calculateEffectiveRateAndTempo()}clear(){this.transposer.clear(),this.stretch.clear()}clone(){var e=new $r;return e.rate=this.rate,e.tempo=this.tempo,e}get rate(){return this._rate}set rate(e){this.virtualRate=e,this.calculateEffectiveRateAndTempo()}set rateChange(e){this._rate=1+.01*e}get tempo(){return this._tempo}set tempo(e){this.virtualTempo=e,this.calculateEffectiveRateAndTempo()}set tempoChange(e){this.tempo=1+.01*e}set pitch(e){this.virtualPitch=e,this.calculateEffectiveRateAndTempo()}set pitchOctaves(e){this.pitch=Math.exp(.69314718056*e),this.calculateEffectiveRateAndTempo()}set pitchSemitones(e){this.pitchOctaves=e/12}get inputBuffer(){return this._inputBuffer}get outputBuffer(){return this._outputBuffer}calculateEffectiveRateAndTempo(){var e=this._tempo,i=this._rate;this._tempo=this.virtualTempo/this.virtualPitch,this._rate=this.virtualRate*this.virtualPitch,La(this._tempo,e)&&(this.stretch.tempo=this._tempo),La(this._rate,i)&&(this.transposer.rate=this._rate),1<this._rate?this._outputBuffer!=this.transposer.outputBuffer&&(this.stretch.inputBuffer=this._inputBuffer,this.stretch.outputBuffer=this._intermediateBuffer,this.transposer.inputBuffer=this._intermediateBuffer,this.transposer.outputBuffer=this._outputBuffer):this._outputBuffer!=this.stretch.outputBuffer&&(this.transposer.inputBuffer=this._inputBuffer,this.transposer.outputBuffer=this._intermediateBuffer,this.stretch.inputBuffer=this._intermediateBuffer,this.stretch.outputBuffer=this._outputBuffer)}process(){(1<this._rate?(this.stretch.process(),this.transposer):(this.transposer.process(),this.stretch)).process()}}class Wn{constructor(e,i,s){this.player=e,this.audio=i,this.soundTouch=new $r,this.soundTouch.tempo=1,this.soundTouch.rate=1,this.filter=new Vn(s,this.soundTouch)}setRate(e){e!==this.soundTouch.rate&&(this.soundTouch.tempo=e)}provide(e){var i=new Float32Array(2*e),s=this.filter.extract(i,e),u=new Float32Array(s),c=new Float32Array(s);for(let l=0;l<s;l++)u[l]=i[2*l],c[l]=i[2*l+1];return{size:s,left:u,right:c,ts:this.audio.tempAudioTimestamp||0}}destroy(){this.soundTouch&&(this.soundTouch.clear(),this.soundTouch=null),this.filter&&(this.filter=null)}}class Kr extends zn{constructor(e){super(e),this.defaultPlaybackRate=1,this.playbackRate=1,this.rateProcessor=null,this.processor=null,this.scriptNodeInterval=null,this.engineType=this.getAutoAudioEngineType(),this.audioBufferSize=this.getAudioBufferSizeByType(),this.$audio=null,this._delayPlay=!1,this.eventListenList=[],this.player._opt.supportLockScreenPlayAudio&&oi()&&(this.$audio=document.createElement("audio"),Object.assign(this.$audio.style,{position:"absolute",left:"-100%",top:"-100%"}),(e.$container||document.body).appendChild(this.$audio),this._bindAudioProxy(),this.player.debug.log("AudioContext","create audio element")),this.scriptStartTime=0,this.player.debug.log("AudioContext","init",`engineType: ${this.engineType}, audioBufferSize: `+this.audioBufferSize)}destroy(){super.destroy(),this.eventListenList&&(this.eventListenList.forEach(e=>{e()}),this.eventListenList=[]),this.$audio&&(this.$audio.pause(),this.$audio.srcObject=null,this.$audio.parentNode&&this.$audio.parentNode.removeChild(this.$audio),this.$audio=null),this.processor&&(this.processor.destroy(),this.processor=null),this.rateProcessor&&(this.rateProcessor.destroy(),this.rateProcessor=null),this.scriptNodeInterval&&(clearInterval(this.scriptNodeInterval),this.scriptNodeInterval=null),this.defaultPlaybackRate=1,this.playbackRate=1,this.scriptStartTime=0,this.audioBufferSize=0,this.engineType=ii,this.player.debug.log("AudioContext","destroy")}isAudioPlaying(){return this.$audio&&_e(this.$audio.paused)&&_e(this.$audio.ended)&&this.$audio.playbackRate!==0&&this.$audio.readyState!==0}_bindAudioProxy(){var e=this.player.events.proxy,e=e(this.$audio,"canplay",()=>{this.player.debug.log("AudioContext","canplay"),this._delayPlay&&this._audioElementPlay()});this.eventListenList.push(e)}_getAudioElementReadyState(){let e=0;return e=this.$audio?this.$audio.readyState:e}audioElementPlay(){var e;this.$audio&&(e=this._getAudioElementReadyState(),this.player.debug.log("AudioContext","play and readyState: "+e),e!==0||ha()&&oi()?this._audioElementPlay():(this.player.debug.warn("AudioContext","readyState is 0 and set _delayPlay to true"),this._delayPlay=!0))}_audioElementPlay(){this.$audio&&this.$audio.play().then(()=>{this._delayPlay=!1,this.player.debug.log("AudioContext","_audioElementPlay success"),setTimeout(()=>{this.isAudioPlaying()||(this.player.debug.warn("AudioContext","play failed and retry play"),this._audioElementPlay())},100),this.isAudioPlaying()&&(this.player.debug.log("AudioContext","play success and remove document click event listener"),document.removeEventListener("click",this._audioElementPlay.bind(this)))}).catch(e=>{this.player.debug.error("AudioContext","_audioElementPlay error",e),document.addEventListener("click",this._audioElementPlay.bind(this))})}getAudioBufferSize(){return this.audioBufferSize}get oneBufferDuration(){return this.audioBufferSize/this.audioContext.sampleRate*1e3}get isActiveEngineType(){return this.engineType===Jt}initProcessor(){this.processor=new Gn(this.player,this,this.audioInfo.channels,this.audioBufferSize),this.rateProcessor=new Wn(this.player,this,this.processor)}getAutoAudioEngineType(){let e=this.player._opt.audioEngine||ii;var i=()=>{var s;e=ha()&&(s=window.navigator.userAgent.toLowerCase(),/android/i.test(s))?Jt:(!oi()||!this.player._opt.supportLockScreenPlayAudio)&&pa()?bi:ii};return this.player._opt.audioEngine?this.player._opt.audioEngine===bi&&pa()?e=bi:this.player._opt.audioEngine===Jt?e=Jt:this.player._opt.audioEngine===ii?e=ii:i():i(),e}getAudioBufferSizeByType(){var e=this.engineType,i=(this.player._opt.hasVideo,this.player._opt.weiXinInAndroidAudioBufferSize);return e!==bi&&e===Jt?i||4800:1024}initScriptNode(){this.playing=!0,this.hasInitScriptNode||(this.initProcessor(),this.engineType===bi?this.initWorkletScriptNode():this.engineType===Jt?this.initIntervalScriptNode():this.engineType===ii&&this.initProcessScriptNode(),this.audioElementPlay())}getEngineType(){return this.engineType}isPlaybackRateSpeed(){return this.playbackRate>this.defaultPlaybackRate}initProcessScriptNode(){var e=this.audioContext.createScriptProcessor(this.audioBufferSize,0,this.audioInfo.channels);e.onaudioprocess=i=>{i=i.outputBuffer,this.handleScriptNodeCallback(i)},e.connect(this.gainNode),this.scriptNode=e,this.gainNode.connect(this.mediaStreamAudioDestinationNode),this.$audio?this.$audio.srcObject=this.mediaStreamAudioDestinationNode.stream:this.gainNode.connect(this.audioContext.destination),this.hasInitScriptNode=!0}initIntervalScriptNode(){this.scriptStartTime=0;var e=1e3*this.audioBufferSize/this.audioContext.sampleRate;this.scriptNodeInterval=setInterval(()=>{const i=this.audioContext.createBufferSource(),s=this.audioContext.createBuffer(this.audioInfo.channels,this.audioBufferSize,this.audioContext.sampleRate);this.handleScriptNodeCallback(s,()=>{this.scriptStartTime<this.audioContext.currentTime&&(this.player.debug.log("AudioContext",`script start time ${this.scriptStartTime} is less than current time `+this.audioContext.currentTime),this.scriptStartTime=this.audioContext.currentTime),i.buffer=s,i.connect(this.gainNode),i.start(this.scriptStartTime),this.scriptStartTime+=s.duration})},e),this.gainNode.connect(this.mediaStreamAudioDestinationNode),this.$audio?this.$audio.srcObject=this.mediaStreamAudioDestinationNode.stream:this.gainNode.connect(this.audioContext.destination),this.hasInitScriptNode=!0}initWorkletScriptNode(){this.audioContext&&this.audioContext.audioWorklet.addModule(ca(function(){class e extends AudioWorkletProcessor{constructor(){super(),this.audioBufferSize=1024,this.start=!1,this.channels=1,this.samplesArray=[],this.offset=0,this.state=0,this.port.onmessage=s=>{s.data.message==="init"?(this.audioBufferSize=s.data.audioBufferSize,this.start=s.data.start,this.channels=s.data.channels,this.state=0,this.offset=0,this.samplesArray=[]):s.data.message==="stop"?(this.state=0,this.start=!1,this.offset=0,this.samplesArray=[]):s.data.message==="data"?this.samplesArray.push(s.data.buffer):s.data.message==="zero"&&this.samplesArray.push({left:new Float32Array(this.audioBufferSize).fill(0),right:new Float32Array(this.audioBufferSize).fill(0)})}}process(s,u,c){var l=u[0][0],o=u[0][1];if(this.offset===0&&this.port.postMessage({message:"beep"}),this.state===0)this.state=1;else if(this.state===1&&4<=this.samplesArray.length)this.state=2;else if(this.state===2){const f=this.samplesArray[0];for(let _=0;_<l.length;_++)this.channels===1?l[_]=f.left[_+this.offset]:this.channels===2&&(l[_]=f.left[_+this.offset],o)&&(o[_]=f.right[_+this.offset])}else this.channels===1?l.fill(0):this.channels===2&&(l.fill(0),o)&&o.fill(0);return this.offset+=128,this.offset===this.audioBufferSize&&(this.offset=0,this.state===2&&this.samplesArray.shift(),this.samplesArray.length===0)&&(this.state=0),this.start}}registerProcessor("worklet-processor",e)})).then(()=>{if(this.audioContext){let e=[1];this.audioInfo.channels===2&&(e=[1,1]),this.workletProcessorNode=new AudioWorkletNode(this.audioContext,"worklet-processor",{numberOfOutputs:this.audioInfo.channels,outputChannelCount:e}),this.workletProcessorNode.connect(this.gainNode),this.gainNode.connect(this.mediaStreamAudioDestinationNode),this.$audio?this.$audio.srcObject=this.mediaStreamAudioDestinationNode.stream:this.gainNode.connect(this.audioContext.destination),this.hasInitScriptNode=!0,this.workletProcessorNode.port.postMessage({message:"init",audioBufferSize:this.audioBufferSize,start:!0,channels:this.audioInfo.channels}),this.workletProcessorNode.port.onmessage=i=>{this.workletProcessorNode?this.audioContext?this.handleScriptNodeCallback(this.workletProcessorNode,null,!0):this.workletProcessorNode.port.postMessage({message:"zero"}):this.player.debug.error("AudioContext","workletProcessorNode is null")}}else this.player.debug.error("AudioContext","initWorkletScriptNode audioContext is null")})}handleScriptNodeCallback(e,i){let s,u=2<arguments.length&&arguments[2]!==void 0&&arguments[2],c=(i=i||Pr,e.length);u&&(s=e,c=this.audioBufferSize);var l,o=this.audioInfo.channels;this.bufferList.length&&this.playing?(l=this.player._opt).syncAudioAndVideo&&l.hasVideo&&(this.calcPlaybackRateBySync(),1e3<this.audioSyncVideoOption.diff)?(this.player.debug.warn("AudioContext",`audioSyncVideoOption more than diff :${this.audioSyncVideoOption.diff}, waiting`),u?s.port.postMessage({message:"zero"}):this.fillScriptNodeOutputBuffer(e,o)):(l=this._provide(c)).size===0?u?s.port.postMessage({message:"zero"}):this.fillScriptNodeOutputBuffer(e,o):(l&&l.ts&&(this.player.audioTimestamp=l.ts),u?s.port.postMessage({message:"data",buffer:l}):this.fillScriptNodeOutputBuffer(e,o,l)):u?s.port.postMessage({message:"zero"}):this.fillScriptNodeOutputBuffer(e,o),i()}fillScriptNodeOutputBuffer(e,i,s){if(i===1){const u=e.getChannelData(0);!s||s.size===0?u.fill(0):u.set(s.left)}else if(i===2){const u=e.getChannelData(0),c=e.getChannelData(1);!s||s.size===0?(u.fill(0),c.fill(0)):(u.set(s.left),c.set(s.right))}}play(e,i){this.isMute||(this.hasInitScriptNode?(this.hasAudio=!0,this.bufferList.push({buffer:e,ts:i}),this.player._opt.syncAudioAndVideo||this.calcPlaybackRateByBuffer()):this.player.debug.warn("AudioContext","play has not init script node"))}calcPlaybackRateBySync(){if(!this.isMute&&this.playing){let e=this.playbackRate;this.audioSyncVideoOption.diff<-1e3?(e=this.defaultPlaybackRate+.1,this.player.debug.warn("AudioContext",`audioSyncVideoOption -1000 less than diff :${this.audioSyncVideoOption.diff}, speed up, playbackRate is `+e)):-500<this.audioSyncVideoOption.diff&&(e=this.defaultPlaybackRate),this.updatePlaybackRate(e)}}calcPlaybackRateByBuffer(){if(!this.isMute&&this.playing&&this.getEngineType()!==Jt){let s=this.playbackRate;var e=Math.floor(1e3/this.oneBufferDuration),i=Math.floor(5e3/this.oneBufferDuration);this.bufferList.length>i?(this.player.debug.warn("AudioContext",`bufferList length ${this.bufferList.length} more than ${i}, and drop`),this.clear()):(this.bufferList.length>e?(s=this.defaultPlaybackRate+.1,this.player.debug.warn("AudioContext",`bufferList length ${this.bufferList.length} more than ${e}, speed up, playbackRate is `+s)):this.bufferList.length<e/2&&(s=this.defaultPlaybackRate),this.updatePlaybackRate(s))}}updatePlaybackRate(e){this.rateProcessor&&(this.playbackRate=e,this.rateProcessor.setRate(this.playbackRate))}_provide(e){return(this.playbackRate===1?this.processor:this.rateProcessor).provide(e)}}class $n extends Ae{constructor(e){super(),this.player=e,this.$video=e.video.$videoElement,this.init=!1,this.player._opt.hlsUseCanvasRender&&(this.$video=this.player.hlsDecoder.$videoElement),this.audioInfo={encType:"",channels:"",sampleRate:""},this.player.debug.log("Audio","init")}destroy(){this.resetInit(),this.off(),this.player.debug.log("Audio","destroy")}resetInit(){this.init=!1,this.audioInfo={encType:"",channels:"",sampleRate:""}}getAudioInfo(){return this.audioInfo}updateAudioInfo(e){Ue(e.encTypeCode)&&(this.audioInfo.encType=xs[e.encTypeCode]),Ue(e.encType)&&(this.audioInfo.encType=e.encType),Ue(e.channels)&&(this.audioInfo.channels=e.channels),Ue(e.sampleRate)&&(this.audioInfo.sampleRate=e.sampleRate),Ue(this.audioInfo.sampleRate)&&Ue(this.audioInfo.channels)&&Ue(this.audioInfo.encType)&&!this.init&&(this.player.emit(N.audioInfo,this.audioInfo),this.init=!0)}get isPlaying(){return!0}get volume(){return We(this.$video.muted)?0:this.$video.volume}get isMute(){return this.$video.volume===0||We(this.$video.muted)}mute(e){this.setVolume(e?0:this.player.lastVolume||.5)}setVolume(e){e=parseFloat(e),isNaN(e)||(e=ft(e,0,1),this.$video.muted&&(this.$video.muted=!1),this.$video.volume=e,this.player.emit(N.volumechange,this.player.volume))}clear(){}play(){}pause(){}resume(){}getEngineType(){return"audio"}isPlaybackRateSpeed(){return!1}getAudioBufferSize(){return 0}}class Kn extends Kr{constructor(e){super(e),this.delayTimeout=null,this.player.on(N.playbackPause,i=>{this.listenPlaybackPause(i)}),this.player.debug.log("AudioPlaybackContext","init")}destroy(){this.delayTimeout&&(clearTimeout(this.delayTimeout),this.delayTimeout=null),super.destroy(),this.player.debug.log("AudioPlaybackLoader","destroy")}listenPlaybackPause(e){e?(this.pause(),this.player.playback.isPlaybackPauseClearCache&&this.clear()):this.resume()}initScriptNodeDelay(){var e=this.player._opt.playbackDelayTime;0<e?this.delayTimeout=setTimeout(()=>{this.initScriptNode()},e):this.initScriptNode()}setRate(e){e!==this.defaultPlaybackRate&&this.rateProcessor&&(this.player.debug.log("AudioPlaybackContext","setRate",e),this.defaultPlaybackRate=e,this.updatePlaybackRate(e))}}class qn extends Kr{constructor(e){super(e),this.TAG_NAME="AudioPlayerLoader",this.player.debug.log(this.TAG_NAME,"init")}destroy(){super.destroy(),this.player.debug.log(this.TAG_NAME,"destroy")}play(e,i){_e(this.playing)||super.play(e,i)}pause(){this.player.debug.log(this.TAG_NAME,"pause"),this.playing=!1,this.clear()}resume(){this.player.debug.log(this.TAG_NAME,"resume"),this.playing=!0}}class mr{constructor(e){return new(mr.getLoaderFactory(e._opt))(e)}static getLoaderFactory(e){return e.playType===pe?Kn:e.playType===It?qn:e.isHls&&_e(e.supportHls265)||e.isWebrtc?$n:Kr}}class Yn extends Ae{constructor(e){super(),this.player=e,this.playing=!1,this.abortController=new AbortController,this.streamRate=Br(i=>{e.emit(N.kBps,(i/1024).toFixed(2))}),this.streamRateInterval=null,e.debug.log("FetchStream","init")}destroy(){this.abort(),this.off(),this.streamRate=null,this.stopStreamRateInterval(),this.player.debug.log("FetchStream","destroy")}startStreamRateInterval(){this.stopStreamRateInterval(),this.streamRateInterval=setInterval(()=>{this.streamRate&&this.streamRate(0)},1e3)}stopStreamRateInterval(){this.streamRateInterval&&(clearInterval(this.streamRateInterval),this.streamRateInterval=null)}fetchStream(e){var i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};const s=this.player.demux;this.player._times.streamStart=be(),i=Object.assign({signal:this.abortController.signal},{headers:i.headers||{}}),fetch(e,i).then(u=>{if(u.ok&&200<=u.status&&u.status<=299)if(this.emit(N.streamSuccess),this.startStreamRateInterval(),typeof WritableStream<"u")u.body.pipeTo(new WritableStream({write:c=>(this.streamRate&&this.streamRate(c.byteLength),s.dispatch(c)),close:()=>{s.close()},abort:c=>{s.close();var l=c.toString();l.indexOf(Gs)===-1&&l.indexOf(Hs)===-1&&c.name!==Vs&&(this.abort(),this.emit(H.fetchError,c))}}));else{this.player.debug.log("FetchStream","not support WritableStream and use getReader() to read stream");const c=u.body.getReader(),l=()=>{c.read().then(f=>{var{done:f,value:_}=f;f?s.close():(this.streamRate&&this.streamRate(_.byteLength),s.dispatch(_),l())}).catch(o=>{s.close();var f=o.toString();f.indexOf(Gs)===-1&&f.indexOf(Hs)===-1&&o.name!==Vs&&(this.abort(),this.emit(H.fetchError,o))})};l()}else this.player.debug.error("FetchStream",`fetch response status is ${u.status} and ok is ${u.ok} and emit error and next abort()`),this.abort(),this.emit(H.fetchError,`fetch response status is ${u.status} and ok is `+u.ok)}).catch(u=>{u.name!=="AbortError"&&(s.close(),this.abort(),this.emit(H.fetchError,u))})}abort(){this.abortController&&(this.abortController.abort(),this.abortController=null)}getStreamType(){return Xe}}class Jn extends Ae{constructor(e){super(),this.player=e,this.socket=null,this.socketStatus=de,this.wsUrl=null,this.socketDestroyFnList=[],this.streamRate=Br(i=>{e.emit(N.kBps,(i/1024).toFixed(2))}),this.streamRateInterval=null,e.debug.log("WebsocketStream","init")}destroy(){this._closeWebSocket(),this.stopStreamRateInterval(),this.wsUrl=null,this.off(),this.player.debug.log("WebsocketStream","destroy")}startStreamRateInterval(){this.stopStreamRateInterval(),this.streamRateInterval=setInterval(()=>{this.streamRate&&this.streamRate(0)},1e3)}stopStreamRateInterval(){this.streamRateInterval&&(clearInterval(this.streamRateInterval),this.streamRateInterval=null)}_createWebSocket(){const e=this.player,{debug:i,events:{proxy:s},demux:u}=e;this.socket=new WebSocket(this.wsUrl),this.socket.binaryType="arraybuffer";var c=s(this.socket,"open",()=>{i.log("WebsocketStream","socket open"),this.socketStatus=fe,this.emit(N.streamSuccess),this.player.emit(N.websocketOpen),this.startStreamRateInterval()}),l=s(this.socket,"message",_=>{this.streamRate&&this.streamRate(_.data.byteLength),this._handleMessage(_.data)}),o=s(this.socket,"close",_=>{i.log("WebsocketStream","socket close and code is "+_.code),_.code===1006&&i.error("WebsocketStream","socket close abnormally and code is "+_.code),u.close(),this.socketStatus="close",this.player.emit(N.websocketClose),this.emit(N.streamEnd)}),f=s(this.socket,"error",_=>{i.error("WebsocketStream","socket error",_),this.socketStatus="error",this.emit(H.websocketError,_),u.close(),i.log("WebsocketStream","socket error:",_.isTrusted?"websocket user aborted":"websocket error")});this.socketDestroyFnList.push(c,l,o,f)}_closeWebSocket(){this.socketDestroyFnList.forEach(e=>e()),this.socket&&(this.socket.close(1e3,"Client disconnecting"),this.socket=null),this.socketStatus=de,this.streamRate=null}_handleMessage(e){var i=this.player.demux;i?i.dispatch(e):this.player.debug.warn("WebsocketStream","websocket handle message demux is null")}fetchStream(e,i){this.player._times.streamStart=be(),this.wsUrl=e,this._createWebSocket()}sendMessage(e){this.socket?this.socketStatus===fe?this.socket.send(e):this.player.debug.error("WebsocketStream","websocket send message error and  socket status is "+this.socketStatus):this.player.debug.error("WebsocketStream","websocket send message socket is null")}resetFetchStream(){this._closeWebSocket(),this._createWebSocket()}getStreamType(){return He}}class Qn extends Ae{constructor(e){super(),(this.player=e).debug.log("HlsStream","init")}destroy(){this.off(),this.player.debug.log("HlsStream","destroy")}fetchStream(e){var i=this.player.hlsDecoder;this.player._times.streamStart=be(),i.loadSource(e).then(()=>{this.player.debug.log("HlsStream","loadSource success"),this.emit(N.streamSuccess)}).catch(s=>{this.emit(H.hlsError,s)})}getStreamType(){return"hls"}}class Xn extends Ae{constructor(e){super(),this.player=e,this.webrctUrl=null,e.debug.log("WebrtcStream","init")}destroy(){this.webrctUrl=null,this.off(),this.player.debug.log("WebrtcStream","destroy")}fetchStream(e){var i=this.player.webrtc;this.player._times.streamStart=be(),this.webrctUrl=e.replace("webrtc:",window.location.protocol),i.loadSource(this.webrctUrl).then(()=>{this.player.debug.log("WebrtcStream","loadSource success"),this.emit(N.streamSuccess)}).catch(s=>{this.emit(H.webrtcError,s)})}getStreamType(){return"webrtc"}}class Zn extends Ae{constructor(e){super(),this.player=e,this.transport=null,this.wtUrl=null,this.streamRate=Br(i=>{e.emit(N.kBps,(i/1024).toFixed(2))}),this.streamRateInterval=null,e.debug.log("WebTransportLoader","init")}destroy(){this.abort(),this.off(),this.player.debug.log("WebTransportLoader","destroy")}startStreamRateInterval(){this.stopStreamRateInterval(),this.streamRateInterval=setInterval(()=>{this.streamRate&&this.streamRate(0)},1e3)}stopStreamRateInterval(){this.streamRateInterval&&(clearInterval(this.streamRateInterval),this.streamRateInterval=null)}_createWebTransport(){const e=this.player,{demux:i}=e;try{this.transport=new WebTransport(this.wtUrl),this.transport.ready.then(()=>{this.emit(N.streamSuccess),this.startStreamRateInterval(),this.transport.createBidirectionalStream().then(s=>{s.readable.pipeTo(new WritableStream(i.input))})}).catch(s=>{this.player.debug.warn("WebTransportLoader","_createWebTransport-ready",s)})}catch(s){this.player.debug.warn("WebTransportLoader","_createWebTransport",s)}}fetchStream(e){this.player._times.streamStart=be(),this.wtUrl=e.replace(/^wt/,"https"),this._createWebTransport()}abort(){if(this.transport)try{this.transport.close(),this.transport=null}catch{this.transport=null}}getStreamType(){return"webTransport"}}class Da extends Ae{constructor(e){super(),this.player=e,this.workUrl=null,e.debug.log("WorkerStream","init")}destroy(){this.workUrl=null,this.off(),this.player.debug.log("WorkerStream","destroy")}sendMessage(e){this.player.decoderWorker.workerSendMessage(e)}fetchStream(e){this.workUrl=e,this.player._times.streamStart=be(),this.player.decoderWorker.workerFetchStream(e)}getStreamType(){var e=this.player._opt.protocol;return ve+" "+(e===2?Xe:He)}}class qr{constructor(e){return new(qr.getLoaderFactory(e._opt))(e)}static getLoaderFactory(e){var{protocol:i,useWasm:s,playType:u}=e;return i===2?u===It||u!==Ie||s&&!lr(e)?Da:Yn:i===1?u===It||u!==Ie||s&&!lr(e)?Da:Jn:i===3?Qn:i===4?Xn:i===5?Zn:void 0}}var eo=ir(function(f){function e(M,w){if(!M)throw"First parameter is required.";w=new i(M,w=w||{type:"video"});var R=this;function O(W){W&&(w.initCallback=function(){W(),W=w.initCallback=null});var X=new s(M,w);(V=new X(M,w)).record(),$("recording"),w.disableLogs||console.log("Initialized recorderType:",V.constructor.name,"for output-type:",w.type)}function j(W){function X(se){if(V){Object.keys(V).forEach(function(me){typeof V[me]!="function"&&(R[me]=V[me])});var ie,ne=V.blob;if(!ne){if(!se)throw"Recording failed.";V.blob=ne=se}if(ne&&!w.disableLogs&&console.log(ne.type,"->",r(ne.size)),W){try{ie=_.createObjectURL(ne)}catch{}typeof W.call=="function"?W.call(R,ie):W(ie)}w.autoWriteToDisk&&G(function(me){var ce={};ce[w.type+"Blob"]=me,A.Store(ce)})}else typeof W.call=="function"?W.call(R,""):W("")}W=W||function(){},V?R.state==="paused"?(R.resumeRecording(),setTimeout(function(){j(W)},1)):(R.state==="recording"||w.disableLogs||console.warn('Recording state should be: "recording", however current state is: ',R.state),w.disableLogs||console.log("Stopped recording "+w.type+" stream."),w.type!=="gif"?V.stop(X):(V.stop(),X()),$("stopped")):J()}function z(W){postMessage(new FileReaderSync().readAsDataURL(W))}function G(W,X){if(!W)throw"Pass a callback function over getDataURL.";var se,ie=(X||V||{}).blob;ie?typeof Worker>"u"||navigator.mozGetUserMedia?((se=new FileReader).readAsDataURL(ie),se.onload=function(ne){W(ne.target.result)}):((se=(function(ne){try{var me=_.createObjectURL(new Blob([ne.toString(),"this.onmessage =  function (eee) {"+ne.name+"(eee.data);}"],{type:"application/javascript"})),ce=new Worker(me);return _.revokeObjectURL(me),ce}catch{}})(z)).onmessage=function(ne){W(ne.data)},se.postMessage(ie)):(w.disableLogs||console.warn("Blob encoder did not finish its job yet."),setTimeout(function(){G(W,X)},1e3))}function K(W){W=W||0,R.state!=="paused"?R.state!=="stopped"&&(W>=R.recordingDuration?j(R.onRecordingStopped):(W+=1e3,setTimeout(function(){K(W)},1e3))):setTimeout(function(){K(W)},1e3)}function $(W){R&&(R.state=W,typeof R.onStateChanged.call=="function"?R.onStateChanged.call(R,W):R.onStateChanged(W))}var V,q='It seems that recorder is destroyed or "startRecording" is not invoked for '+w.type+" recorder.";function J(){w.disableLogs!==!0&&console.warn(q)}var re={startRecording:function(W){return w.disableLogs||console.log("RecordRTC version: ",R.version),(w=W?new i(M,W):w).disableLogs||console.log("started recording "+w.type+" stream."),V?(V.clearRecordedData(),V.record(),$("recording"),R.recordingDuration&&K()):O(function(){R.recordingDuration&&K()}),R},stopRecording:j,pauseRecording:function(){V?R.state==="recording"?($("paused"),V.pause(),w.disableLogs||console.log("Paused recording.")):w.disableLogs||console.warn("Unable to pause the recording. Recording state: ",R.state):J()},resumeRecording:function(){V?R.state==="paused"?($("recording"),V.resume(),w.disableLogs||console.log("Resumed recording.")):w.disableLogs||console.warn("Unable to resume the recording. Recording state: ",R.state):J()},initRecorder:O,setRecordingDuration:function(W,X){if(W===void 0)throw"recordingDuration is required.";if(typeof W!="number")throw"recordingDuration must be a number.";return R.recordingDuration=W,R.onRecordingStopped=X||function(){},{onRecordingStopped:function(se){R.onRecordingStopped=se}}},clearRecordedData:function(){V?(V.clearRecordedData(),w.disableLogs||console.log("Cleared old recorded data.")):J()},getBlob:function(){if(V)return V.blob;J()},getDataURL:G,toURL:function(){if(V)return _.createObjectURL(V.blob);J()},getInternalRecorder:function(){return V},save:function(W){V?n(V.blob,W):J()},getFromDisk:function(W){V?e.getFromDisk(w.type,W):J()},setAdvertisementArray:function(W){w.advertisement=[];for(var X=W.length,se=0;se<X;se++)w.advertisement.push({duration:se,image:W[se]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,reset:function(){R.state!=="recording"||w.disableLogs||console.warn("Stop an active recorder."),V&&typeof V.clearRecordedData=="function"&&V.clearRecordedData(),V=null,$("inactive"),R.blob=null},onStateChanged:function(W){w.disableLogs||console.log("Recorder state changed:",W)},state:"inactive",getState:function(){return R.state},destroy:function(){var W=w.disableLogs;w={disableLogs:!0},R.reset(),$("destroyed"),re=R=null,m.AudioContextConstructor&&(m.AudioContextConstructor.close(),m.AudioContextConstructor=null),w.disableLogs=W,w.disableLogs||console.log("RecordRTC is destroyed.")},version:"5.6.2"};if(this){for(var Z in re)this[Z]=re[Z];R=this}else R=re;return re}function i(M,w){return w.recorderType||w.type||(w.audio&&w.video?w.type="video":w.audio&&!w.video&&(w.type="audio")),w.recorderType&&!w.type&&(w.recorderType===y||w.recorderType===v||w.recorderType===F?w.type="video":w.recorderType===I?w.type="gif":w.recorderType===C?w.type="audio":w.recorderType===b&&(d(M,"audio").length&&d(M,"video").length||!d(M,"audio").length&&d(M,"video").length?w.type="video":d(M,"audio").length&&!d(M,"video").length&&(w.type="audio"))),typeof MediaRecorder<"u"&&"requestData"in MediaRecorder.prototype&&(w.mimeType||(w.mimeType="video/webm"),w.type||(w.type=w.mimeType.split("/")[0]),w.bitsPerSecond),w.type||(w.mimeType&&(w.type=w.mimeType.split("/")[0]),w.type)||(w.type="audio"),w}function s(M,w){var R;return(h||g||T)&&(R=C),typeof MediaRecorder<"u"&&"requestData"in MediaRecorder.prototype&&!h&&(R=b),w.type==="video"&&(h||T)&&(R=y,typeof ReadableStream<"u")&&(R=F),w.type==="gif"&&(R=I),w.type==="canvas"&&(R=v),x()&&R!==v&&R!==I&&typeof MediaRecorder<"u"&&"requestData"in MediaRecorder.prototype&&(d(M,"video").length||d(M,"audio").length)&&(w.type==="audio"?typeof MediaRecorder.isTypeSupported=="function"&&MediaRecorder.isTypeSupported("audio/webm")&&(R=b):typeof MediaRecorder.isTypeSupported=="function"&&MediaRecorder.isTypeSupported("video/webm")&&(R=b)),M instanceof Array&&M.length&&(R=P),w.recorderType&&(R=w.recorderType),!w.disableLogs&&R&&R.name&&console.log("Using recorderType:",R.name||R.constructor.name),R=!R&&k?b:R}function u(M){this.addStream=function(w){w&&(M=w)},this.mediaType={audio:!0,video:!0},this.startRecording=function(){var w,R,O,j,z=this.mediaType,G=this.mimeType||{audio:null,video:null,gif:null};if(typeof z.audio!="function"&&x()&&!d(M,"audio").length&&(z.audio=!1),typeof z.video!="function"&&x()&&!d(M,"video").length&&(z.video=!1),typeof z.gif!="function"&&x()&&!d(M,"video").length&&(z.gif=!1),!z.audio&&!z.video&&!z.gif)throw"MediaStream must have either audio or video tracks.";z.audio&&(w=null,typeof z.audio=="function"&&(w=z.audio),this.audioRecorder=new e(M,{type:"audio",bufferSize:this.bufferSize,sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:w,mimeType:G.audio,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp}),z.video||this.audioRecorder.startRecording()),z.video&&(w=null,typeof z.video=="function"&&(w=z.video),R=M,x()&&z.audio&&typeof z.audio=="function"&&(j=d(M,"video")[0],E?((R=new t).addTrack(j),w&&w===y&&(w=b)):(R=new t).addTrack(j)),this.videoRecorder=new e(R,{type:"video",video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:w,mimeType:G.video,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp,workerPath:this.workerPath,webAssemblyPath:this.webAssemblyPath,frameRate:this.frameRate,bitrate:this.bitrate}),z.audio||this.videoRecorder.startRecording()),z.audio&&z.video&&(O=this,j=x()===!0,(j=z.audio instanceof C&&z.video||z.audio!==!0&&z.video!==!0&&z.audio!==z.video?!1:j)===!0?(O.audioRecorder=null,O.videoRecorder.startRecording()):O.videoRecorder.initRecorder(function(){O.audioRecorder.initRecorder(function(){O.videoRecorder.startRecording(),O.audioRecorder.startRecording()})})),z.gif&&(w=null,typeof z.gif=="function"&&(w=z.gif),this.gifRecorder=new e(M,{type:"gif",frameRate:this.frameRate||200,quality:this.quality||10,disableLogs:this.disableLogs,recorderType:w,mimeType:G.gif}),this.gifRecorder.startRecording())},this.stopRecording=function(w){w=w||function(){},this.audioRecorder&&this.audioRecorder.stopRecording(function(R){w(R,"audio")}),this.videoRecorder&&this.videoRecorder.stopRecording(function(R){w(R,"video")}),this.gifRecorder&&this.gifRecorder.stopRecording(function(R){w(R,"gif")})},this.pauseRecording=function(){this.audioRecorder&&this.audioRecorder.pauseRecording(),this.videoRecorder&&this.videoRecorder.pauseRecording(),this.gifRecorder&&this.gifRecorder.pauseRecording()},this.resumeRecording=function(){this.audioRecorder&&this.audioRecorder.resumeRecording(),this.videoRecorder&&this.videoRecorder.resumeRecording(),this.gifRecorder&&this.gifRecorder.resumeRecording()},this.getBlob=function(w){var R={};return this.audioRecorder&&(R.audio=this.audioRecorder.getBlob()),this.videoRecorder&&(R.video=this.videoRecorder.getBlob()),this.gifRecorder&&(R.gif=this.gifRecorder.getBlob()),w&&w(R),R},this.destroy=function(){this.audioRecorder&&(this.audioRecorder.destroy(),this.audioRecorder=null),this.videoRecorder&&(this.videoRecorder.destroy(),this.videoRecorder=null),this.gifRecorder&&(this.gifRecorder.destroy(),this.gifRecorder=null)},this.getDataURL=function(w){function R(O,j){var z;typeof Worker<"u"?((z=(function($){var K,$=_.createObjectURL(new Blob([$.toString(),"this.onmessage =  function (eee) {"+$.name+"(eee.data);}"],{type:"application/javascript"})),V=new Worker($);if(_!==void 0)K=_;else{if(typeof webkitURL>"u")throw"Neither URL nor webkitURL detected.";K=webkitURL}return K.revokeObjectURL($),V})(function(G){postMessage(new FileReaderSync().readAsDataURL(G))})).onmessage=function(G){j(G.data)},z.postMessage(O)):((z=new FileReader).readAsDataURL(O),z.onload=function(G){j(G.target.result)})}this.getBlob(function(O){O.audio&&O.video?R(O.audio,function(j){R(O.video,function(z){w({audio:j,video:z})})}):O.audio?R(O.audio,function(j){w({audio:j})}):O.video&&R(O.video,function(j){w({video:j})})})},this.writeToDisk=function(){e.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})},this.save=function(w){(w=w||{audio:!0,video:!0,gif:!0}).audio&&this.audioRecorder&&this.audioRecorder.save(typeof w.audio=="string"?w.audio:""),w.video&&this.videoRecorder&&this.videoRecorder.save(typeof w.video=="string"?w.video:""),w.gif&&this.gifRecorder&&this.gifRecorder.save(typeof w.gif=="string"?w.gif:"")}}e.version="5.6.2",(f.exports=e).getFromDisk=function(M,w){if(!w)throw"callback is mandatory.";console.log("Getting recorded "+(M==="all"?"blobs":M+" blob ")+" from disk!"),A.Fetch(function(R,O){M!=="all"&&O===M+"Blob"&&w&&w(R),M==="all"&&w&&w(R,O.replace("Blob",""))})},e.writeToDisk=function(M){console.log("Writing recorded blob(s) to disk!"),(M=M||{}).audio&&M.video&&M.gif?M.audio.getDataURL(function(w){M.video.getDataURL(function(R){M.gif.getDataURL(function(O){A.Store({audioBlob:w,videoBlob:R,gifBlob:O})})})}):M.audio&&M.video?M.audio.getDataURL(function(w){M.video.getDataURL(function(R){A.Store({audioBlob:w,videoBlob:R})})}):M.audio&&M.gif?M.audio.getDataURL(function(w){M.gif.getDataURL(function(R){A.Store({audioBlob:w,gifBlob:R})})}):M.video&&M.gif?M.video.getDataURL(function(w){M.gif.getDataURL(function(R){A.Store({videoBlob:w,gifBlob:R})})}):M.audio?M.audio.getDataURL(function(w){A.Store({audioBlob:w})}):M.video?M.video.getDataURL(function(w){A.Store({videoBlob:w})}):M.gif&&M.gif.getDataURL(function(w){A.Store({gifBlob:w})})},u.getFromDisk=e.getFromDisk,u.writeToDisk=e.writeToDisk,e.MRecordRTC=u,(f=pt!==void 0?pt:null)&&typeof window>"u"&&pt!==void 0&&(pt.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},pt.console||(pt.console={}),pt.console.log!==void 0&&pt.console.error!==void 0||(pt.console.error=pt.console.log=pt.console.log||function(){console.log(arguments)}),typeof document>"u"&&(f.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var M={getContext:function(){return M},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""},style:{}};return M},f.HTMLVideoElement=function(){}),typeof location>"u"&&(f.location={protocol:"file:",href:"",hash:""}),typeof screen>"u"&&(f.screen={width:0,height:0}),_===void 0&&(f.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),f.window=pt);var c,l=window.requestAnimationFrame,o=(l===void 0&&(typeof webkitRequestAnimationFrame<"u"?l=webkitRequestAnimationFrame:typeof mozRequestAnimationFrame<"u"?l=mozRequestAnimationFrame:typeof msRequestAnimationFrame<"u"?l=msRequestAnimationFrame:l===void 0&&(c=0,l=function(M,w){var R=new Date().getTime(),O=Math.max(0,16-(R-c)),j=setTimeout(function(){M(R+O)},O);return c=R+O,j})),window.cancelAnimationFrame),f=(o===void 0&&(typeof webkitCancelAnimationFrame<"u"?o=webkitCancelAnimationFrame:typeof mozCancelAnimationFrame<"u"?o=mozCancelAnimationFrame:typeof msCancelAnimationFrame<"u"?o=msCancelAnimationFrame:o===void 0&&(o=function(M){clearTimeout(M)})),window.AudioContext),_=(f===void 0&&(typeof webkitAudioContext<"u"&&(f=webkitAudioContext),typeof mozAudioContext<"u")&&(f=mozAudioContext),window.URL),g=(_===void 0&&typeof webkitURL<"u"&&(_=webkitURL),typeof navigator<"u"&&navigator.getUserMedia===void 0&&(navigator.webkitGetUserMedia!==void 0&&(navigator.getUserMedia=navigator.webkitGetUserMedia),navigator.mozGetUserMedia!==void 0)&&(navigator.getUserMedia=navigator.mozGetUserMedia),!(navigator.userAgent.indexOf("Edge")===-1||!navigator.msSaveBlob&&!navigator.msSaveOrOpenBlob)),T=!!window.opera||navigator.userAgent.indexOf("OPR/")!==-1,E=-1<navigator.userAgent.toLowerCase().indexOf("firefox")&&"netscape"in window&&/ rv:/.test(navigator.userAgent),h=!T&&!g&&!!navigator.webkitGetUserMedia||a()||navigator.userAgent.toLowerCase().indexOf("chrome/")!==-1,k=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),t=(k&&!h&&navigator.userAgent.indexOf("CriOS")!==-1&&(h=!(k=!1)),window.MediaStream);function r(M){var w;return M===0?"0 Bytes":(w=parseInt(Math.floor(Math.log(M)/Math.log(1e3)),10),(M/Math.pow(1e3,w)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB"][w])}function n(M,w){if(!M)throw"Blob object is required.";if(!M.type)try{M.type="video/webm"}catch{}var R=(M.type||"video/webm").split("/")[1],O=(R.indexOf(";")!==-1&&(R=R.split(";")[0]),w&&w.indexOf(".")!==-1&&(w=(O=w.split("."))[0],R=O[1]),(w||Math.round(9999999999*Math.random())+888888888)+"."+R);return navigator.msSaveOrOpenBlob!==void 0?navigator.msSaveOrOpenBlob(M,O):navigator.msSaveBlob!==void 0?navigator.msSaveBlob(M,O):((w=document.createElement("a")).href=_.createObjectURL(M),w.download=O,w.style="display:none;opacity:0;color:transparent;",(document.body||document.documentElement).appendChild(w),typeof w.click=="function"?w.click():(w.target="_blank",w.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}))),void _.revokeObjectURL(w.href))}function a(){return typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||!(typeof process>"u"||typeof process.versions!="object"||!process.versions.electron)||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&0<=navigator.userAgent.indexOf("Electron")}function d(M,w){return M&&M.getTracks?M.getTracks().filter(function(R){return R.kind===(w||"audio")}):[]}function p(M,w){!("srcObject"in w)&&"mozSrcObject"in w?w.mozSrcObject=M:w.srcObject=M}(t=t===void 0&&typeof webkitMediaStream<"u"?webkitMediaStream:t)!==void 0&&t.prototype.stop===void 0&&(t.prototype.stop=function(){this.getTracks().forEach(function(M){M.stop()})}),e.invokeSaveAsDialog=n,e.getTracks=d,e.getSeekableBlob=function(M,w){if(typeof EBML>"u")throw new Error("Please link: https://www.webrtc-experiment.com/EBML.js");var R=new EBML.Reader,O=new EBML.Decoder,j=EBML.tools,z=new FileReader;z.onload=function(G){O.decode(this.result).forEach(function(V){R.read(V)}),R.stop();var $=j.makeMetadataSeekable(R.metadatas,R.duration,R.cues),K=this.result.slice(R.metadataSize),$=new Blob([$,K],{type:"video/webm"});w($)},z.readAsArrayBuffer(M)},e.bytesToSize=r,e.isElectron=a;var m={};function x(){var M,w,R,O;return!!(E||k||g)||(w=navigator.userAgent,R=""+parseFloat(navigator.appVersion),O=parseInt(navigator.appVersion,10),(h||T)&&(M=w.indexOf("Chrome"),R=w.substring(M+7)),(w=(R=(w=R.indexOf(";"))!==-1?R.substring(0,w):R).indexOf(" "))!==-1&&(R=R.substring(0,w)),O=parseInt(""+R,10),isNaN(O)&&(R=""+parseFloat(navigator.appVersion),O=parseInt(navigator.appVersion,10)),49<=O)}function b(M,w){var R,O=this;if(M===void 0)throw'First argument "MediaStream" is required.';if(typeof MediaRecorder>"u")throw"Your browser does not support the Media Recorder API. Please try other modules e.g. WhammyRecorder or StereoAudioRecorder.";(w=w||{mimeType:"video/webm"}).type==="audio"&&(d(M,"video").length&&d(M,"audio").length&&(navigator.mozGetUserMedia?(R=new t).addTrack(d(M,"audio")[0]):R=new t(d(M,"audio")),M=R),w.mimeType&&w.mimeType.toString().toLowerCase().indexOf("audio")!==-1||(w.mimeType=h?"audio/webm":"audio/ogg"),w.mimeType)&&w.mimeType.toString().toLowerCase()!=="audio/ogg"&&navigator.mozGetUserMedia&&(w.mimeType="audio/ogg");var j,z=[];function G(){O.timestamps.push(new Date().getTime()),typeof w.onTimeStamp=="function"&&w.onTimeStamp(O.timestamps[O.timestamps.length-1],O.timestamps)}function K(q){return j&&j.mimeType?j.mimeType:q.mimeType||"video/webm"}function $(){z=[],j=null,O.timestamps=[]}this.getArrayOfBlobs=function(){return z},this.record=function(){O.blob=null,O.clearRecordedData(),O.timestamps=[],V=[],z=[];var q=w;w.disableLogs||console.log("Passing following config over MediaRecorder API.",q),j=j&&null,h&&!x()&&(q="video/vp8"),typeof MediaRecorder.isTypeSupported=="function"&&q.mimeType&&!MediaRecorder.isTypeSupported(q.mimeType)&&(w.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",q.mimeType),q.mimeType=w.type==="audio"?"audio/webm":"video/webm");try{j=new MediaRecorder(M,q),w.mimeType=q.mimeType}catch{j=new MediaRecorder(M)}q.mimeType&&!MediaRecorder.isTypeSupported&&"canRecordMimeType"in j&&j.canRecordMimeType(q.mimeType)===!1&&(w.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",q.mimeType)),j.ondataavailable=function(J){J.data&&V.push("ondataavailable: "+r(J.data.size)),typeof w.timeSlice!="number"?!J.data||!J.data.size||J.data.size<100||O.blob?O.recordingCallback&&(O.recordingCallback(new Blob([],{type:K(q)})),O.recordingCallback=null):(O.blob=w.getNativeBlob?J.data:new Blob([J.data],{type:K(q)}),O.recordingCallback&&(O.recordingCallback(O.blob),O.recordingCallback=null)):J.data&&J.data.size&&(z.push(J.data),G(),typeof w.ondataavailable=="function")&&(J=w.getNativeBlob?J.data:new Blob([J.data],{type:K(q)}),w.ondataavailable(J))},j.onstart=function(){V.push("started")},j.onpause=function(){V.push("paused")},j.onresume=function(){V.push("resumed")},j.onstop=function(){V.push("stopped")},j.onerror=function(J){J&&(J.name||(J.name="UnknownError"),V.push("error: "+J),w.disableLogs||(J.name.toString().toLowerCase().indexOf("invalidstate")!==-1?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed.",J):J.name.toString().toLowerCase().indexOf("notsupported")!==-1?console.error("MIME type (",q.mimeType,") is not supported.",J):J.name.toString().toLowerCase().indexOf("security")!==-1?console.error("MediaRecorder security error",J):J.name==="OutOfMemory"?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute.",J):J.name==="IllegalStreamModification"?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute.",J):J.name==="OtherRecordingError"?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute.",J):J.name==="GenericError"?console.error("The UA cannot provide the codec or recording option that has been requested.",J):console.error("MediaRecorder Error",J)),!O.manuallyStopped&&j&&j.state==="inactive"?(delete w.timeslice,j.start(6e5)):setTimeout(void 0,1e3),j.state!=="inactive")&&j.state!=="stopped"&&j.stop()},typeof w.timeSlice=="number"?(G(),j.start(w.timeSlice)):j.start(36e5),w.initCallback&&w.initCallback()},this.timestamps=[],this.stop=function(q){q=q||function(){},O.manuallyStopped=!0,j&&(this.recordingCallback=q,j.state==="recording"&&j.stop(),typeof w.timeSlice=="number")&&setTimeout(function(){O.blob=new Blob(z,{type:K(w)}),O.recordingCallback(O.blob)},100)},this.pause=function(){j&&j.state==="recording"&&j.pause()},this.resume=function(){j&&j.state==="paused"&&j.resume()},this.clearRecordedData=function(){j&&j.state==="recording"&&O.stop($),$()},this.getInternalRecorder=function(){return j},this.blob=null,this.getState=function(){return j&&j.state||"inactive"};var V=[];this.getAllStates=function(){return V},w.checkForInactiveTracks===void 0&&(w.checkForInactiveTracks=!1),O=this,(function q(){if(j&&w.checkForInactiveTracks!==!1)return(function(){if("active"in M){if(!M.active)return!1}else if("ended"in M&&M.ended)return!1;return!0})()===!1?(w.disableLogs||console.log("MediaStream seems stopped."),void O.stop()):void setTimeout(q,1e3)})(),this.name="MediaStreamRecorder",this.toString=function(){return this.name}}function C(M,w){if(!d(M,"audio").length)throw"Your stream has no audio tracks.";var R,O=this,j=[],z=[],G=!1,K=0,$=2,V=(w=w||{}).desiredSampRate;function q(){if(w.checkForInactiveTracks!==!1){if("active"in M){if(!M.active)return!1}else if("ended"in M&&M.ended)return!1}return!0}function J(ye,Ee){function xe(Re,ot){var it,$e=Re.numberOfAudioChannels,je=Re.leftBuffers.slice(0),Rt=Re.rightBuffers.slice(0),Ke=Re.sampleRate,ht=Re.internalInterleavedLength,Re=Re.desiredSampRate;function At(Qe,_t,bt){var qe=Math.round(Qe.length*(_t/bt)),rt=[],zt=Number((Qe.length-1)/(qe-1));rt[0]=Qe[0];for(var ui,kr=1;kr<qe-1;kr++){var Ts=kr*zt,Tn=Number(Math.floor(Ts)).toFixed(),ks=Number(Math.ceil(Ts)).toFixed();rt[kr]=(ui=Qe[Tn],ks=Qe[ks],ui+(ks-ui)*(Ts-Tn))}return rt[qe-1]=Qe[Qe.length-1],rt}function lt(Qe,_t){for(var bt=new Float64Array(_t),qe=0,rt=Qe.length,zt=0;zt<rt;zt++){var ui=Qe[zt];bt.set(ui,qe),qe+=ui.length}return bt}function Ve(Qe,_t,bt){for(var qe=bt.length,rt=0;rt<qe;rt++)Qe.setUint8(_t+rt,bt.charCodeAt(rt))}$e===2&&(je=lt(je,ht),Rt=lt(Rt,ht),Re)&&(je=At(je,Re,Ke),Rt=At(Rt,Re,Ke)),$e===1&&(je=lt(je,ht),Re)&&(je=At(je,Re,Ke)),Re&&(Ke=Re),$e===2&&(it=(function(Qe,_t){for(var bt=Qe.length+_t.length,qe=new Float64Array(bt),rt=0,zt=0;zt<bt;)qe[zt++]=Qe[rt],qe[zt++]=_t[rt],rt++;return qe})(je,Rt));var ht=(it=$e===1?je:it).length,Re=new ArrayBuffer(44+2*ht),ze=new DataView(Re);Ve(ze,0,"RIFF"),ze.setUint32(4,36+2*ht,!0),Ve(ze,8,"WAVE"),Ve(ze,12,"fmt "),ze.setUint32(16,16,!0),ze.setUint16(20,1,!0),ze.setUint16(22,$e,!0),ze.setUint32(24,Ke,!0),ze.setUint32(28,Ke*$e*2,!0),ze.setUint16(32,2*$e,!0),ze.setUint16(34,16,!0),Ve(ze,36,"data"),ze.setUint32(40,2*ht,!0);for(var Tr=ht,zi=44,Gi=0;Gi<Tr;Gi++)ze.setInt16(zi,32767*it[Gi],!0),zi+=2;if(ot)return ot({buffer:Re,view:ze});postMessage({buffer:Re,view:ze})}var ke,Le,De;ye.noWorker?xe(ye,function(Ne){Ee(Ne.buffer,Ne.view)}):(ke=xe,ke=_.createObjectURL(new Blob([ke.toString(),";this.onmessage =  function (eee) {"+ke.name+"(eee.data);}"],{type:"application/javascript"})),(Le=new Worker(ke)).workerURL=ke,(De=Le).onmessage=function(Ne){Ee(Ne.data.buffer,Ne.data.view),_.revokeObjectURL(De.workerURL),De.terminate()},De.postMessage(ye))}w.leftChannel===!0&&($=1),(!($=w.numberOfAudioChannels===1?1:$)||$<1)&&($=2),w.disableLogs||console.log("StereoAudioRecorder is set to record number of channels: "+$),w.checkForInactiveTracks===void 0&&(w.checkForInactiveTracks=!0),this.record=function(){if(q()===!1)throw"Please make sure MediaStream is active.";ne(),ce=ie=!1,G=!0,w.timeSlice!==void 0&&ge()},this.stop=function(ye){ye=ye||function(){},G=!1,J({desiredSampRate:V,sampleRate:se,numberOfAudioChannels:$,internalInterleavedLength:K,leftBuffers:j,rightBuffers:$===1?[]:z,noWorker:w.noWorker},function(Ee,xe){O.blob=new Blob([xe],{type:"audio/wav"}),O.buffer=new ArrayBuffer(xe.buffer.byteLength),O.view=xe,O.sampleRate=V||se,O.bufferSize=X,O.length=K,ce=!1,ye&&ye(O.blob)})},(e.Storage=e.Storage===void 0?{AudioContextConstructor:null,AudioContext:window.AudioContext||window.webkitAudioContext}:e.Storage).AudioContextConstructor&&e.Storage.AudioContextConstructor.state!=="closed"||(e.Storage.AudioContextConstructor=new e.Storage.AudioContext);var re=e.Storage.AudioContextConstructor,Z=re.createMediaStreamSource(M),W=[0,256,512,1024,2048,4096,8192,16384],X=w.bufferSize===void 0?4096:w.bufferSize;if(W.indexOf(X)!==-1||w.disableLogs||console.log("Legal values for buffer-size are "+JSON.stringify(W,null,"	")),re.createJavaScriptNode)R=re.createJavaScriptNode(X,$,$);else{if(!re.createScriptProcessor)throw"WebAudio API has no support on this browser.";R=re.createScriptProcessor(X,$,$)}Z.connect(R),w.bufferSize||(X=R.bufferSize);var se=w.sampleRate!==void 0?w.sampleRate:re.sampleRate||44100,ie=((se<22050||96e3<se)&&!w.disableLogs&&console.log("sample-rate must be under range 22050 and 96000."),w.disableLogs||w.desiredSampRate&&console.log("Desired sample-rate: "+w.desiredSampRate),!1);function ne(){j=[],K=0,ie=G=ce=!(z=[]),re=null,O.leftchannel=j,O.rightchannel=z,O.numberOfAudioChannels=$,O.desiredSampRate=V,O.sampleRate=se,O.recordingLength=K,le={left:[],right:[],recordingLength:0}}function me(){R&&(R.onaudioprocess=null,R.disconnect(),R=null),Z&&(Z.disconnect(),Z=null),ne()}this.pause=function(){ie=!0},this.resume=function(){if(q()===!1)throw"Please make sure MediaStream is active.";G?ie=!1:(w.disableLogs||console.log("Seems recording has been restarted."),this.record())},this.clearRecordedData=function(){w.checkForInactiveTracks=!1,G&&this.stop(me),me()},this.name="StereoAudioRecorder";var ce=!(this.toString=function(){return this.name}),le=(R.onaudioprocess=function(ye){var Ee,xe;ie||(q()===!1&&(w.disableLogs||console.log("MediaStream seems stopped."),R.disconnect(),G=!1),G?(ce||(ce=!0,w.onAudioProcessStarted&&w.onAudioProcessStarted(),w.initCallback&&w.initCallback()),Ee=ye.inputBuffer.getChannelData(0),Ee=new Float32Array(Ee),j.push(Ee),$===2&&(ye=ye.inputBuffer.getChannelData(1),xe=new Float32Array(ye),z.push(xe)),K+=X,O.recordingLength=K,w.timeSlice!==void 0&&(le.recordingLength+=X,le.left.push(Ee),$===2)&&le.right.push(xe)):Z&&(Z.disconnect(),Z=null))},re.createMediaStreamDestination?R.connect(re.createMediaStreamDestination()):R.connect(re.destination),this.leftchannel=j,this.rightchannel=z,this.numberOfAudioChannels=$,this.desiredSampRate=V,this.sampleRate=se,O.recordingLength=K,{left:[],right:[],recordingLength:0});function ge(){G&&typeof w.ondataavailable=="function"&&w.timeSlice!==void 0&&(le.left.length?(J({desiredSampRate:V,sampleRate:se,numberOfAudioChannels:$,internalInterleavedLength:le.recordingLength,leftBuffers:le.left,rightBuffers:$===1?[]:le.right},function(ye,Ee){Ee=new Blob([Ee],{type:"audio/wav"}),w.ondataavailable(Ee),setTimeout(ge,w.timeSlice)}),le={left:[],right:[],recordingLength:0}):setTimeout(ge,w.timeSlice))}}function v(M,w){if(typeof html2canvas>"u")throw"Please link: https://www.webrtc-experiment.com/screenshot.js";(w=w||{}).frameInterval||(w.frameInterval=10);var R=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(W){W in document.createElement("canvas")&&(R=!0)});var O,j,z,G=!(!window.webkitRTCPeerConnection&&!window.webkitGetUserMedia||!window.chrome),K=50,$=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);if(G&&$&&$[2]&&(K=parseInt($[2],10)),G&&K<52&&(R=!1),R=w.useWhammyRecorder?!1:R)if(w.disableLogs||console.log("Your browser supports both MediRecorder API and canvas.captureStream!"),M instanceof HTMLCanvasElement)O=M;else{if(!(M instanceof CanvasRenderingContext2D))throw"Please pass either HTMLCanvasElement or CanvasRenderingContext2D.";O=M.canvas}else!navigator.mozGetUserMedia||w.disableLogs||console.error("Canvas recording is NOT supported in Firefox.");this.record=function(){if(z=!0,R&&!w.useWhammyRecorder){var W;"captureStream"in O?W=O.captureStream(25):"mozCaptureStream"in O?W=O.mozCaptureStream(25):"webkitCaptureStream"in O&&(W=O.webkitCaptureStream(25));try{var X=new t;X.addTrack(d(W,"video")[0]),W=X}catch{}if(!W)throw"captureStream API are NOT available.";(j=new b(W,{mimeType:w.mimeType||"video/webm"})).record()}else Z.frames=[],re=new Date().getTime(),J();w.initCallback&&w.initCallback()},this.getWebPImages=function(W){var X;M.nodeName.toLowerCase()==="canvas"&&(X=Z.frames.length,Z.frames.forEach(function(se,ie){var ne=X-ie,ne=(w.disableLogs||console.log(ne+"/"+X+" frames remaining"),w.onEncodingCallback&&w.onEncodingCallback(ne,X),se.image.toDataURL("image/webp",1));Z.frames[ie].image=ne}),w.disableLogs||console.log("Generating WebM")),W()};var V=!(this.stop=function(W){z=!1;var X=this;R&&j?j.stop(W):this.getWebPImages(function(){Z.compile(function(se){w.disableLogs||console.log("Recording finished!"),X.blob=se,X.blob.forEach&&(X.blob=new Blob([],{type:"video/webm"})),W&&W(X.blob),Z.frames=[]})})});function q(){Z.frames=[],V=z=!1}function J(){if(V)return re=new Date().getTime(),setTimeout(J,500);var W,X,se;M.nodeName.toLowerCase()==="canvas"?(W=new Date().getTime()-re,re=new Date().getTime(),Z.frames.push({image:(se=(X=document.createElement("canvas")).getContext("2d"),X.width=M.width,X.height=M.height,se.drawImage(M,0,0),X),duration:W}),z&&setTimeout(J,w.frameInterval)):html2canvas(M,{grabMouse:w.showMousePointer===void 0||w.showMousePointer,onrendered:function(ie){var ne=new Date().getTime()-re;if(!ne)return setTimeout(J,w.frameInterval);re=new Date().getTime(),Z.frames.push({image:ie.toDataURL("image/webp",1),duration:ne}),z&&setTimeout(J,w.frameInterval)}})}this.pause=function(){V=!0,j instanceof b&&j.pause()},this.resume=function(){V=!1,j instanceof b?j.resume():z||this.record()},this.clearRecordedData=function(){z&&this.stop(q),q()},this.name="CanvasRecorder",this.toString=function(){return this.name};var re=new Date().getTime(),Z=new S.Video(100)}function y(M,w){function R(J){J=J!==void 0?J:10;var re=new Date().getTime()-K;return re?j?(K=new Date().getTime(),setTimeout(R,100)):(K=new Date().getTime(),G.paused&&G.play(),q.drawImage(G,0,0,V.width,V.height),$.frames.push({duration:re,image:V.toDataURL("image/webp")}),void(O||setTimeout(R,J,J))):setTimeout(R,J,J)}(w=w||{}).frameInterval||(w.frameInterval=10),w.disableLogs||console.log("Using frames-interval:",w.frameInterval);var O=!(this.record=function(){w.width||(w.width=320),w.height||(w.height=240),w.video||(w.video={width:w.width,height:w.height}),w.canvas||(w.canvas={width:w.width,height:w.height}),V.width=w.canvas.width||320,V.height=w.canvas.height||240,q=V.getContext("2d"),w.video&&w.video instanceof HTMLVideoElement?(G=w.video.cloneNode(),w.initCallback&&w.initCallback()):(G=document.createElement("video"),p(M,G),G.onloadedmetadata=function(){w.initCallback&&w.initCallback()},G.width=w.video.width,G.height=w.video.height),G.muted=!0,G.play(),K=new Date().getTime(),$=new S.Video,w.disableLogs||(console.log("canvas resolutions",V.width,"*",V.height),console.log("video width/height",G.width||V.width,"*",G.height||V.height)),R(w.frameInterval)}),j=!(this.stop=function(J){J=J||function(){},O=!0;var re=this;setTimeout(function(){var Z,W,X,se,ie,ne,me,ce,le,ge,ye,Ee,xe,ke,Le,De,Ne;Z=$.frames,W=-1,se=X=null,ie=function(ot){$.frames=ot,w.advertisement&&w.advertisement.length&&($.frames=w.advertisement.concat($.frames)),$.compile(function(it){re.blob=it,re.blob.forEach&&(re.blob=new Blob([],{type:"video/webm"})),J&&J(re.blob)})},(ne=document.createElement("canvas")).width=V.width,ne.height=V.height,ce=ne.getContext("2d"),le=[],ge=W===-1,ye=W&&0<W&&W<=Z.length?W:Z.length,Ee=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),xe=X&&0<=X&&X<=1?X:0,ke=se&&0<=se&&se<=1?se:0,Le=!1,De=-1,Ne=(me={length:ye,functionToLoop:function(ot,it){function $e(){!Le&&Ke-je<=Ke*ke||(ge&&(Le=!0),le.push(Z[it])),ot()}var je,Rt,Ke,At;Le?$e():((At=new Image).onload=function(){ce.drawImage(At,0,0,V.width,V.height);var lt=ce.getImageData(0,0,V.width,V.height);je=0,Rt=lt.data.length,Ke=lt.data.length/4;for(var Ve=0;Ve<Rt;Ve+=4){var ht=lt.data[Ve],Re=lt.data[Ve+1],ze=lt.data[Ve+2];Math.sqrt(Math.pow(+ht,2)+Math.pow(+Re,2)+Math.pow(+ze,2))<=Ee*xe&&je++}$e()},At.src=Z[it].image)},callback:function(){(le=le.concat(Z.slice(ye))).length<=0&&le.push(Z[Z.length-1]),ie(le)}}).length,(function ot(){++De!==Ne?setTimeout(function(){me.functionToLoop(ot,De)},1):me.callback()})()},10)});function z(){$.frames=[],j=!(O=!0)}this.pause=function(){j=!0},this.resume=function(){j=!1,O&&this.record()},this.clearRecordedData=function(){O||this.stop(z),z()},this.name="WhammyRecorder",this.toString=function(){return this.name};var G,K,$,V=document.createElement("canvas"),q=V.getContext("2d")}f!==void 0?m.AudioContext=f:typeof webkitAudioContext<"u"&&(m.AudioContext=webkitAudioContext),e.Storage=m,e.MediaStreamRecorder=b,e.StereoAudioRecorder=C,e.CanvasRecorder=v,e.WhammyRecorder=y,L.prototype.add=function(M,w){if("toDataURL"in(M="canvas"in M?M.canvas:M)&&(M=M.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/gi.test(M))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:M,duration:w||this.duration})},L.prototype.compile=function(M){R=B,R=_.createObjectURL(new Blob([R.toString(),"this.onmessage =  function (eee) {"+R.name+"(eee.data);}"],{type:"application/javascript"})),w=new Worker(R),_.revokeObjectURL(R);var w,R=w;R.onmessage=function(O){O.data.error?console.error(O.data.error):M(O.data)},R.postMessage(this.frames)};var S={Video:L};function L(M){this.frames=[],this.duration=M||1,this.quality=.8}function B(M){function w(j){var z=[];j=(j.length%8?new Array(9-j.length%8).join("0"):"")+j;for(var G=0;G<j.length;G+=8)z.push(parseInt(j.substr(G,8),2));return new Uint8Array(z)}function R(j){for(var z=[],G=0;G<j.length;G++){var K=j[G].data,$=(K=typeof(K=typeof(K=typeof K=="object"?R(K):K)=="number"?w(K.toString(2)):K)=="string"?new Uint8Array(K.split("").map(function(q){return q.charCodeAt(0)})):K).size||K.byteLength||K.length,V=Math.ceil(Math.ceil(Math.log($)/Math.log(2))/8),$=$.toString(2),$=new Array(7*V+7+1-$.length).join("0")+$,V=new Array(V).join("0")+"1"+$;z.push((function(q){for(var J=[];0<q;)J.push(255&q),q>>=8;return new Uint8Array(J.reverse())})(j[G].id)),z.push(w(V)),z.push(K)}return new Blob(z,{type:"video/webm"})}function O(j){for(var z=0,G={};z<j.length;){var K=j.substr(z,4),$=($=z,parseInt(j.substr($+4,4).split("").map(function(q){return q=q.charCodeAt(0).toString(2),new Array(8-q.length+1).join("0")+q}).join(""),2)),V=j.substr(z+4+4,$);z+=8+$,G[K]=G[K]||[],K==="RIFF"||K==="LIST"?G[K].push(O(V)):G[K].push(V)}return G}M=new function(j){var z=(function(Z){if(Z[0]){for(var W=Z[0].width,X=Z[0].height,se=Z[0].duration,ie=1;ie<Z.length;ie++)se+=Z[ie].duration;return{duration:se,width:W,height:X}}postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."})})(j);if(!z)return[];for(var G,K=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:(G=z.duration,[].slice.call(new Uint8Array(new Float64Array([G]).buffer),0).map(function(Z){return String.fromCharCode(Z)}).reverse().join("")),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:z.width,id:176},{data:z.height,id:186}]}]}]}]}],$=0,V=0;$<j.length;){for(var q=[],J=0;q.push(j[$]),J+=j[$].duration,++$<j.length&&J<3e4;);var re={id:524531317,data:(function(Z,W,X){return[{data:Z,id:231}].concat(X.map(function(se){var ie=(function(ne){var me=0;return me|=128,127<ne.trackNum,[128|ne.trackNum,ne.timecode>>8,255&ne.timecode,me].map(function(ce){return String.fromCharCode(ce)}).join("")+ne.frame})({frame:se.data.slice(4),trackNum:1,timecode:Math.round(W)});return W+=se.duration,{data:ie,id:163}}))})(V,0,q)};K[1].data.push(re),V+=J}return R(K)}(M.map(function(j){var z=(function(G){for(var K=G.RIFF[0].WEBP[0],$=K.indexOf("*"),V=0,q=[];V<4;V++)q[V]=K.charCodeAt($+3+V);return{width:16383&(q[1]<<8|q[0]),height:16383&(q[3]<<8|q[2]),data:K,riff:G}})(O(atob(j.image.slice(23))));return z.duration=j.duration,z})),postMessage(M)}e.Whammy=S;var A={init:function(){var M,w,R,O=this;function j(G){G.createObjectStore(O.dataStoreName)}function z(){var G=M.transaction([O.dataStoreName],"readwrite");function K($){G.objectStore(O.dataStoreName).get($).onsuccess=function(V){O.callback&&O.callback(V.target.result,$)}}O.videoBlob&&G.objectStore(O.dataStoreName).put(O.videoBlob,"videoBlob"),O.gifBlob&&G.objectStore(O.dataStoreName).put(O.gifBlob,"gifBlob"),O.audioBlob&&G.objectStore(O.dataStoreName).put(O.audioBlob,"audioBlob"),K("audioBlob"),K("videoBlob"),K("gifBlob")}typeof indexedDB<"u"&&indexedDB.open!==void 0?(w=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),(R=indexedDB.open(w,1)).onerror=O.onError,R.onsuccess=function(){(M=R.result).onerror=O.onError,M.setVersion&&M.version!==1?M.setVersion(1).onsuccess=function(){j(M),z()}:z()},R.onupgradeneeded=function(G){j(G.target.result)}):console.error("IndexedDB API are not available in this browser.")},Fetch:function(M){return this.callback=M,this.init(),this},Store:function(M){return this.audioBlob=M.audioBlob,this.videoBlob=M.videoBlob,this.gifBlob=M.gifBlob,this.init(),this},onError:function(M){console.error(JSON.stringify(M,null,"	"))},dataStoreName:"recordRTC",dbName:null};function I(M,w){typeof GIFEncoder>"u"&&((R=document.createElement("script")).src="https://www.webrtc-experiment.com/gif-recorder.js",(document.body||document.documentElement).appendChild(R)),w=w||{};var R,O,j=M instanceof CanvasRenderingContext2D||M instanceof HTMLCanvasElement,z=(this.record=function(){typeof GIFEncoder<"u"&&$?(j||(w.width||(w.width=O.offsetWidth||320),w.height||(w.height=O.offsetHeight||240),w.video||(w.video={width:w.width,height:w.height}),w.canvas||(w.canvas={width:w.width,height:w.height}),G.width=w.canvas.width||320,G.height=w.canvas.height||240,O.width=w.video.width||320,O.height=w.video.height||240),(q=new GIFEncoder).setRepeat(0),q.setDelay(w.frameRate||200),q.setQuality(w.quality||10),q.start(),typeof w.onGifRecordingStarted=="function"&&w.onGifRecordingStarted(),J=l(function Z(W){if(re.clearedRecordedData!==!0){if(z)return setTimeout(function(){Z(W)},100);J=l(Z),W-V<90||(!j&&O.paused&&O.play(),j||K.drawImage(O,0,0,G.width,G.height),w.onGifPreview&&w.onGifPreview(G.toDataURL("image/png")),q.addFrame(K),V=W)}}),w.initCallback&&w.initCallback()):setTimeout(re.record,1e3)},!(this.stop=function(Z){Z=Z||function(){},J&&o(J),this.blob=new Blob([new Uint8Array(q.stream().bin)],{type:"image/gif"}),Z(this.blob),q.stream().bin=[]})),G=(this.pause=function(){z=!0},this.resume=function(){z=!1},this.clearRecordedData=function(){re.clearedRecordedData=!0,q&&(q.stream().bin=[])},this.name="GifRecorder",this.toString=function(){return this.name},document.createElement("canvas")),K=G.getContext("2d"),$=(j&&(M instanceof CanvasRenderingContext2D?G=(K=M).canvas:M instanceof HTMLCanvasElement&&(K=M.getContext("2d"),G=M)),!0);j||((O=document.createElement("video")).muted=!0,O.autoplay=!0,O.playsInline=!0,$=!1,O.onloadedmetadata=function(){$=!0},p(M,O),O.play());var V,q,J=null,re=this}function U(M,w){w=w||"multi-streams-mixer";var R=[],O=!1,j=document.createElement("canvas"),z=j.getContext("2d"),G=(j.style.opacity=0,j.style.position="absolute",j.style.zIndex=-1,j.style.top="-1000em",j.style.left="-1000em",j.className=w,(document.body||document.documentElement).appendChild(j),this.disableLogs=!1,this.frameInterval=10,this.width=360,this.height=240,this.useGainNode=!0,this),K=window.AudioContext;K===void 0&&(typeof webkitAudioContext<"u"&&(K=webkitAudioContext),typeof mozAudioContext<"u")&&(K=mozAudioContext),typeof navigator<"u"&&navigator.getUserMedia===void 0&&(navigator.webkitGetUserMedia!==void 0&&(navigator.getUserMedia=navigator.webkitGetUserMedia),navigator.mozGetUserMedia!==void 0)&&(navigator.getUserMedia=navigator.mozGetUserMedia);var $=window.MediaStream,V=(($=$===void 0&&typeof webkitMediaStream<"u"?webkitMediaStream:$)!==void 0&&$.prototype.stop===void 0&&($.prototype.stop=function(){this.getTracks().forEach(function(W){W.stop()})}),{});function q(){var W,X,se;O||(W=R.length,X=!1,se=[],R.forEach(function(ie){ie.stream||(ie.stream={}),ie.stream.fullcanvas?X=ie:se.push(ie)}),X?(j.width=X.stream.width,j.height=X.stream.height):se.length?(j.width=1<W?2*se[0].width:se[0].width,j.height=se[0].height*(W!==9&&W!==10?W!==7&&W!==8?W!==5&&W!==6?W!==3&&W!==4?1:2:3:4:5)):(j.width=G.width||360,j.height=G.height||240),X&&X instanceof HTMLVideoElement&&J(X),se.forEach(function(ie,ne){J(ie,ne)}),setTimeout(q,G.frameInterval))}function J(W,X){var se,ie,ne,me;O||(ie=se=0,ne=W.width,me=W.height,X===1&&(se=W.width),X===2&&(ie=W.height),X===3&&(se=W.width,ie=W.height),X===4&&(ie=2*W.height),X===5&&(se=W.width,ie=2*W.height),X===6&&(ie=3*W.height),X===7&&(se=W.width,ie=3*W.height),W.stream.left!==void 0&&(se=W.stream.left),W.stream.top!==void 0&&(ie=W.stream.top),W.stream.width!==void 0&&(ne=W.stream.width),W.stream.height!==void 0&&(me=W.stream.height),z.drawImage(W,se,ie,ne,me),typeof W.stream.onRender=="function"&&W.stream.onRender(z,se,ie,ne,me,X))}function re(W){var X,se,ie=document.createElement("video");return X=W,!("srcObject"in(se=ie))&&"mozSrcObject"in se?se.mozSrcObject=X:se.srcObject=X,ie.className=w,ie.muted=!0,ie.volume=0,ie.width=W.width||G.width||360,ie.height=W.height||G.height||240,ie.play(),ie}function Z(W){R=[],(W=W||M).forEach(function(X){var se;X.getTracks().filter(function(ie){return ie.kind==="video"}).length&&((se=re(X)).stream=X,R.push(se))})}K!==void 0?V.AudioContext=K:typeof webkitAudioContext<"u"&&(V.AudioContext=webkitAudioContext),this.startDrawingFrames=function(){q()},this.appendStreams=function(W){if(!W)throw"First parameter is required.";(W=W instanceof Array?W:[W]).forEach(function(X){var se,ie=new $;X.getTracks().filter(function(ne){return ne.kind==="video"}).length&&((se=re(X)).stream=X,R.push(se),ie.addTrack(X.getTracks().filter(function(ne){return ne.kind==="video"})[0])),X.getTracks().filter(function(ne){return ne.kind==="audio"}).length&&(se=G.audioContext.createMediaStreamSource(X),G.audioDestination=G.audioContext.createMediaStreamDestination(),se.connect(G.audioDestination),ie.addTrack(G.audioDestination.stream.getTracks().filter(function(ne){return ne.kind==="audio"})[0])),M.push(ie)})},this.releaseStreams=function(){R=[],O=!0,G.gainNode&&(G.gainNode.disconnect(),G.gainNode=null),G.audioSources.length&&(G.audioSources.forEach(function(W){W.disconnect()}),G.audioSources=[]),G.audioDestination&&(G.audioDestination.disconnect(),G.audioDestination=null),G.audioContext&&G.audioContext.close(),G.audioContext=null,z.clearRect(0,0,j.width,j.height),j.stream&&(j.stream.stop(),j.stream=null)},this.resetVideoStreams=function(W){Z(W=!W||W instanceof Array?W:[W])},this.name="MultiStreamsMixer",this.toString=function(){return this.name},this.getMixedStream=function(){O=!1,Z(),"captureStream"in j?se=j.captureStream():"mozCaptureStream"in j?se=j.mozCaptureStream():G.disableLogs||console.error("Upgrade to latest Chrome or otherwise enable this flag: chrome://flags/#enable-experimental-web-platform-features"),W=new $,se.getTracks().filter(function(ie){return ie.kind==="video"}).forEach(function(ie){W.addTrack(ie)});var W,X=j.stream=W,se=(function(){V.AudioContextConstructor||(V.AudioContextConstructor=new V.AudioContext),G.audioContext=V.AudioContextConstructor,G.audioSources=[],G.useGainNode===!0&&(G.gainNode=G.audioContext.createGain(),G.gainNode.connect(G.audioContext.destination),G.gainNode.gain.value=0);var ie=0;if(M.forEach(function(ne){ne.getTracks().filter(function(me){return me.kind==="audio"}).length&&(ie++,ne=G.audioContext.createMediaStreamSource(ne),G.useGainNode===!0&&ne.connect(G.gainNode),G.audioSources.push(ne))}),ie)return G.audioDestination=G.audioContext.createMediaStreamDestination(),G.audioSources.forEach(function(ne){ne.connect(G.audioDestination)}),G.audioDestination.stream})();return se&&se.getTracks().filter(function(ie){return ie.kind==="audio"}).forEach(function(ie){X.addTrack(ie)}),M.forEach(function(ie){ie.fullcanvas}),X}}function P(M,w){M=M||[];var R,O,j=this;(w=w||{elementClass:"multi-streams-mixer",mimeType:"video/webm",video:{width:360,height:240}}).frameInterval||(w.frameInterval=10),w.video||(w.video={}),w.video.width||(w.video.width=360),w.video.height||(w.video.height=240),this.record=function(){var z;R=new U(M,w.elementClass||"multi-streams-mixer"),z=[],M.forEach(function(G){d(G,"video").forEach(function(K){z.push(K)})}),z.length&&(R.frameInterval=w.frameInterval||10,R.width=w.video.width||360,R.height=w.video.height||240,R.startDrawingFrames()),w.previewStream&&typeof w.previewStream=="function"&&w.previewStream(R.getMixedStream()),(O=new b(R.getMixedStream(),w)).record()},this.stop=function(z){O&&O.stop(function(G){j.blob=G,z(G),j.clearRecordedData()})},this.pause=function(){O&&O.pause()},this.resume=function(){O&&O.resume()},this.clearRecordedData=function(){O&&(O.clearRecordedData(),O=null),R&&(R.releaseStreams(),R=null)},this.addStreams=function(z){if(!z)throw"First parameter is required.";z instanceof Array||(z=[z]),M.concat(z),O&&R&&(R.appendStreams(z),w.previewStream)&&typeof w.previewStream=="function"&&w.previewStream(R.getMixedStream())},this.resetVideoStreams=function(z){R&&(!z||z instanceof Array||(z=[z]),R.resetVideoStreams(z))},this.getMixer=function(){return R},this.name="MultiStreamRecorder",this.toString=function(){return this.name}}function F(M,w){var R,O,j;function z(K,$){if(!w.workerPath&&!$)return R=!1,fetch("https://unpkg.com/webm-wasm@latest/dist/webm-worker.js").then(function(V){V.arrayBuffer().then(function(q){z(K,q)})});!w.workerPath&&$ instanceof ArrayBuffer&&($=new Blob([$],{type:"text/javascript"}),w.workerPath=_.createObjectURL($)),w.workerPath||console.error("workerPath parameter is missing."),(O=new Worker(w.workerPath)).postMessage(w.webAssemblyPath||"https://unpkg.com/webm-wasm@latest/dist/webm-wasm.wasm"),O.addEventListener("message",function(V){V.data==="READY"?(O.postMessage({width:w.width,height:w.height,bitrate:w.bitrate||1200,timebaseDen:w.frameRate||30,realtime:w.realtime}),new ReadableStream({start:function(q){var J=document.createElement("canvas"),re=document.createElement("video"),Z=!0;re.srcObject=M,re.muted=!0,re.height=w.height,re.width=w.width,re.volume=0,re.onplaying=function(){J.width=w.width,J.height=w.height;var W=J.getContext("2d"),X=1e3/w.frameRate,se=setInterval(function(){if(R&&(clearInterval(se),q.close()),Z&&(Z=!1,w.onVideoProcessStarted)&&w.onVideoProcessStarted(),W.drawImage(re,0,0),q._controlledReadableStream.state!=="closed")try{q.enqueue(W.getImageData(0,0,w.width,w.height))}catch{}},X)},re.play()}}).pipeTo(new WritableStream({write:function(q){R?console.error("Got image, but recorder is finished!"):O.postMessage(q.data.buffer,[q.data.buffer])}}))):!V.data||j||G.push(V.data)})}typeof ReadableStream<"u"&&typeof WritableStream<"u"||console.error("Following polyfill is strongly recommended: https://unpkg.com/@mattiasbuelens/web-streams-polyfill/dist/polyfill.min.js"),(w=w||{}).width=w.width||640,w.height=w.height||480,w.frameRate=w.frameRate||30,w.bitrate=w.bitrate||1200,w.realtime=w.realtime||!0,this.record=function(){j=!(G=[]),this.blob=null,z(M),typeof w.initCallback=="function"&&w.initCallback()},this.pause=function(){j=!0},this.resume=function(){j=!1};var G=[];this.stop=function(K){R=!0;var $,V=this;$=function(){V.blob=new Blob(G,{type:"video/webm"}),K(V.blob)},O?(O.addEventListener("message",function(q){q.data===null&&(O.terminate(),O=null,$())}),O.postMessage(null)):$()},this.name="WebAssemblyRecorder",this.toString=function(){return this.name},this.clearRecordedData=function(){j=!(G=[]),this.blob=null},this.blob=null}e.DiskStorage=A,e.GifRecorder=I,e.MultiStreamRecorder=P,e.RecordRTCPromisesHandler=function(M,w){if(!this)throw'Use "new RecordRTCPromisesHandler()"';if(M===void 0)throw'First argument "MediaStream" is required.';var R=this;R.recordRTC=new e(M,w),this.startRecording=function(){return new Promise(function(O,j){try{R.recordRTC.startRecording(),O()}catch(z){j(z)}})},this.stopRecording=function(){return new Promise(function(O,j){try{R.recordRTC.stopRecording(function(z){R.blob=R.recordRTC.getBlob(),R.blob&&R.blob.size?O(z):j("Empty blob.",R.blob)})}catch(z){j(z)}})},this.pauseRecording=function(){return new Promise(function(O,j){try{R.recordRTC.pauseRecording(),O()}catch(z){j(z)}})},this.resumeRecording=function(){return new Promise(function(O,j){try{R.recordRTC.resumeRecording(),O()}catch(z){j(z)}})},this.getDataURL=function(O){return new Promise(function(j,z){try{R.recordRTC.getDataURL(function(G){j(G)})}catch(G){z(G)}})},this.getBlob=function(){return new Promise(function(O,j){try{O(R.recordRTC.getBlob())}catch(z){j(z)}})},this.getInternalRecorder=function(){return new Promise(function(O,j){try{O(R.recordRTC.getInternalRecorder())}catch(z){j(z)}})},this.reset=function(){return new Promise(function(O,j){try{O(R.recordRTC.reset())}catch(z){j(z)}})},this.destroy=function(){return new Promise(function(O,j){try{O(R.recordRTC.destroy())}catch(z){j(z)}})},this.getState=function(){return new Promise(function(O,j){try{O(R.recordRTC.getState())}catch(z){j(z)}})},this.blob=null,this.version="5.6.2"},e.WebAssemblyRecorder=F});class ki{constructor(e){this._buffer=e,this._buffer_index=0,this._total_bytes=e.byteLength,this._total_bits=8*e.byteLength,this._current_word=0,this._current_word_bits_left=0}destroy(){this._buffer=null}_fillCurrentWord(){var e,i=this._total_bytes-this._buffer_index;i<=0?console.error("ExpGolomb: _fillCurrentWord() but no bytes available",this._total_bytes,this._buffer_index):(i=Math.min(4,i),(e=new Uint8Array(4)).set(this._buffer.subarray(this._buffer_index,this._buffer_index+i)),this._current_word=new DataView(e.buffer).getUint32(0,!1),this._buffer_index+=i,this._current_word_bits_left=8*i)}readBits(e){var i,s;return 32<e&&console.error("ExpGolomb: readBits() bits exceeded max 32bits!"),e<=this._current_word_bits_left?(i=this._current_word>>>32-e,this._current_word<<=e,this._current_word_bits_left-=e,i):(i=this._current_word_bits_left?this._current_word:0,i>>>=32-this._current_word_bits_left,e=e-this._current_word_bits_left,this._fillCurrentWord(),e=Math.min(e,this._current_word_bits_left),s=this._current_word>>>32-e,this._current_word<<=e,this._current_word_bits_left-=e,i<<e|s)}readBool(){return this.readBits(1)===1}readByte(){return this.readBits(8)}_skipLeadingZero(){let e;for(e=0;e<this._current_word_bits_left;e++)if((this._current_word&2147483648>>>e)!=0)return this._current_word<<=e,this._current_word_bits_left-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}readUEG(){var e=this._skipLeadingZero();return this.readBits(e+1)-1}readSEG(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}}class et{static _ebsp2rbsp(e){let i=e,s=i.byteLength,u=new Uint8Array(s),c=0;for(let l=0;l<s;l++)2<=l&&i[l]===3&&i[l-1]===0&&i[l-2]===0||(u[c]=i[l],c++);return new Uint8Array(u.buffer,0,c)}static parseSPS(T){let i=et._ebsp2rbsp(T),s=new ki(i);s.readByte();var T=s.readByte(),B=(s.readByte(),s.readByte());s.readUEG();let u=et.getProfileString(T),c=et.getLevelString(B),l=1,o=420,f=8;if((T===100||T===110||T===122||T===244||T===44||T===83||T===86||T===118||T===128||T===138||T===144)&&((l=s.readUEG())===3&&s.readBits(1),l<=3&&(o=[0,420,422,444][l]),f=s.readUEG()+8,s.readUEG(),s.readBits(1),s.readBool())){var _=l!==3?8:12;for(let A=0;A<_;A++)s.readBool()&&(A<6?et._skipScalingList(s,16):et._skipScalingList(s,64))}if(s.readUEG(),B=s.readUEG(),B===0)s.readUEG();else if(B===1){s.readBits(1),s.readSEG(),s.readSEG();var g=s.readUEG();for(let A=0;A<g;A++)s.readSEG()}var T=s.readUEG(),B=(s.readBits(1),s.readUEG()),E=s.readUEG(),h=s.readBits(1);h===0&&s.readBits(1),s.readBits(1);let k=0,t=0,r=0,n=0,a=(s.readBool()&&(k=s.readUEG(),t=s.readUEG(),r=s.readUEG(),n=s.readUEG()),1),d=1,p=0,m=!0,x=0,b=0,C=(s.readBool()&&(s.readBool()&&(0<(L=s.readByte())&&L<16?(a=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][L-1],d=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][L-1]):L===255&&(a=s.readByte()<<8|s.readByte(),d=s.readByte()<<8|s.readByte())),s.readBool()&&s.readBool(),s.readBool()&&(s.readBits(4),s.readBool())&&s.readBits(24),s.readBool()&&(s.readUEG(),s.readUEG()),s.readBool())&&(L=s.readBits(32),S=s.readBits(32),m=s.readBool(),x=S,b=2*L,p=x/b),1),v=(a===1&&d===1||(C=a/d),0),y=0;y=l===0?(v=1,2-h):(v=l===3?1:2,(l===1?2:1)*(2-h));var S=16*(B+1),L=16*(E+1)*(2-h),B=(S-=(k+t)*v,L-=(r+n)*y,Math.ceil(S*C));return s.destroy(),s=null,{profile_string:u,level_string:c,bit_depth:f,ref_frames:T,chroma_format:o,chroma_format_string:et.getChromaFormatString(o),frame_rate:{fixed:m,fps:p,fps_den:b,fps_num:x},sar_ratio:{width:a,height:d},codec_size:{width:S,height:L},present_size:{width:B,height:L}}}static parseSPS$2(l){let i=l.subarray(1,4),s="avc1.";for(let M=0;M<3;M++){let w=i[M].toString(16);w.length<2&&(w="0"+w),s+=w}let u=et._ebsp2rbsp(l),c=new ki(u);c.readByte();var l=c.readByte(),o=(c.readByte(),c.readByte());c.readUEG();let f=et.getProfileString(l),_=et.getLevelString(o),g=1,T=420,E=8,h=8;if((l===100||l===110||l===122||l===244||l===44||l===83||l===86||l===118||l===128||l===138||l===144)&&((g=c.readUEG())===3&&c.readBits(1),g<=3&&(T=[0,420,422,444][g]),E=c.readUEG()+8,h=c.readUEG()+8,c.readBits(1),c.readBool())){var k=g!==3?8:12;for(let M=0;M<k;M++)c.readBool()&&(M<6?et._skipScalingList(c,16):et._skipScalingList(c,64))}c.readUEG();var r=c.readUEG();if(r===0)c.readUEG();else if(r===1){c.readBits(1),c.readSEG(),c.readSEG();var t=c.readUEG();for(let M=0;M<t;M++)c.readSEG()}var r=c.readUEG(),F=(c.readBits(1),c.readUEG()),n=c.readUEG(),a=c.readBits(1);a===0&&c.readBits(1),c.readBits(1);let d=0,p=0,m=0,x=0,b=(c.readBool()&&(d=c.readUEG(),p=c.readUEG(),m=c.readUEG(),x=c.readUEG()),1),C=1,v=0,y=!0,S=0,L=0,B=(c.readBool()&&(c.readBool()&&(0<(P=c.readByte())&&P<16?(b=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][P-1],C=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][P-1]):P===255&&(b=c.readByte()<<8|c.readByte(),C=c.readByte()<<8|c.readByte())),c.readBool()&&c.readBool(),c.readBool()&&(c.readBits(4),c.readBool())&&c.readBits(24),c.readBool()&&(c.readUEG(),c.readUEG()),c.readBool())&&(P=c.readBits(32),U=c.readBits(32),y=c.readBool(),S=U,L=2*P,v=S/L),1),A=(b===1&&C===1||(B=b/C),0),I=0;I=g===0?(A=1,2-a):(A=g===3?1:2,(g===1?2:1)*(2-a));var U=16*(F+1),P=16*(n+1)*(2-a),F=(U-=(d+p)*A,P-=(m+x)*I,Math.ceil(U*B));return c.destroy(),c=null,{codec_mimetype:s,profile_idc:l,level_idc:o,profile_string:f,level_string:_,chroma_format_idc:g,bit_depth:E,bit_depth_luma:E,bit_depth_chroma:h,ref_frames:r,chroma_format:T,chroma_format_string:et.getChromaFormatString(T),frame_rate:{fixed:y,fps:v,fps_den:L,fps_num:S},sar_ratio:{width:b,height:C},codec_size:{width:U,height:P},present_size:{width:F,height:P}}}static _skipScalingList(e,i){let s=8,u=8,c;for(let l=0;l<i;l++)u!==0&&(c=e.readSEG(),u=(s+c+256)%256),s=u===0?s:u}static getProfileString(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}static getLevelString(e){return(e/10).toFixed(1)}static getChromaFormatString(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}}class Ra{constructor(e){this.buffer=e,this.buflen=e.length,this.bufpos=0,this.bufoff=0,this.iserro=!1}read(e){let i=0,s;for(;e;){if(e<0||this.bufpos>=this.buflen)return this.iserro=!0,0;this.iserro=!1,s=8<this.bufoff+e?8-this.bufoff:e,i=(i<<=s)+(this.buffer[this.bufpos]>>8-this.bufoff-s&255>>8-s),this.bufoff+=s,e-=s,this.bufoff==8&&(this.bufpos++,this.bufoff=0)}return i}look(u){var i=this.bufpos,s=this.bufoff,u=this.read(u);return this.bufpos=i,this.bufoff=s,u}read_golomb(){let e;for(e=0;this.read(1)===0&&!this.iserro;e++);return(1<<e)+this.read(e)-1}}function gr(D){const e={},i=new DataView(D.buffer);let s=i.getUint8(0),u=i.getUint8(1);if(i.getUint8(2),i.getUint8(3),s!==1||u===0)return{};var c=1+(3&i.getUint8(4));if(c!=3&&c!=4)return{};var l=31&i.getUint8(5);if(l==0)return{};let o=6;for(let k=0;k<l;k++){var f=i.getUint16(o,!1);if(o+=2,f!==0){var _=new Uint8Array(D.buffer,o,f),f=(o+=f,et.parseSPS(_));if(k===0){e.sps=_,e.timescale=1e3,e.codecWidth=f.codec_size.width,e.codecHeight=f.codec_size.height,e.presentWidth=f.present_size.width,e.presentHeight=f.present_size.height,e.profile=f.profile_string,e.level=f.level_string,e.bitDepth=f.bit_depth,e.chromaFormat=f.chroma_format,e.sarRatio=f.sar_ratio,e.frameRate=f.frame_rate,f.frame_rate.fixed!==!1&&f.frame_rate.fps_num!==0&&f.frame_rate.fps_den!==0||(e.frameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3});var f=e.frameRate.fps_den,g=e.frameRate.fps_num;e.refSampleDuration=e.timescale*(f/g);let n=_.subarray(1,4),a="avc1.";for(let d=0;d<3;d++){let p=n[d].toString(16);p.length<2&&(p="0"+p),a+=p}e.codec=a}}}var T=i.getUint8(o);if(T===0)return{};o++;for(let k=0;k<T;k++){var E,h=i.getUint16(o,!1);o+=2,h!==0&&(E=new Uint8Array(D.buffer,o,h),o+=h,e.pps=E)}if(e.videoType="avc",e.sps){const k=e.sps.byteLength,t=new Uint8Array([k>>>24&255,k>>>16&255,k>>>8&255,255&k]),r=new Uint8Array(k+4);r.set(t,0),r.set(e.sps,4),e.sps=r}if(e.pps){const k=e.pps.byteLength,t=new Uint8Array([k>>>24&255,k>>>16&255,k>>>8&255,255&k]),r=new Uint8Array(k+4);r.set(t,0),r.set(e.pps,4),e.pps=r}return e}function Ia(f){let{sps:e,pps:i}=f,s=8+e.byteLength+1+2+i.byteLength,u=!1;var f=et.parseSPS$2(e),c=(e[3]!==66&&e[3]!==77&&e[3]!==88&&(u=!0,s+=4),new Uint8Array(s)),o=(c[0]=1,c[1]=e[1],c[2]=e[2],c[3]=e[3],c[4]=255,c[5]=225,e.byteLength),l=(c[6]=o>>>8,c[7]=255&o,8),o=(c.set(e,8),c[l+=o]=1,i.byteLength),o=(c[l+1]=o>>>8,c[l+2]=255&o,c.set(i,l+3),l+=3+o,u&&(c[l]=252|f.chroma_format_idc,c[l+1]=248|f.bit_depth_luma-8,c[l+2]=248|f.bit_depth_chroma-8,c[l+3]=0,l+=4),[23,0,0,0,0]),f=new Uint8Array(o.length+c.byteLength);return f.set(o,0),f.set(c,o.length),f}function Yr(D,s){var i=[],s=(i[0]=s?23:39,i[1]=1,i[2]=0,i[3]=0,i[4]=0,new Uint8Array(i.length+D.byteLength));return s.set(i,0),s.set(D,i.length),s}function Jr(D){var i=D.byteLength,e=new Uint8Array(4),i=(e[0]=i>>>24&255,e[1]=i>>>16&255,e[2]=i>>>8&255,e[3]=255&i,new Uint8Array(i+4));return i.set(e,0),i.set(D,4),i}function hi(D){return 31&D[0]}function Pa(D){return D===Dn}function Qr(D){return(e=D)!==Vi&&e!==Wi&&!Pa(D);var e}function Ba(D){return D===Ln}const Xr=D=>{let e=D,i=e.byteLength,s=new Uint8Array(i),u=0;for(let c=0;c<i;c++)2<=c&&e[c]===3&&e[c-1]===0&&e[c-2]===0||(s[u]=e[c],u++);return new Uint8Array(s.buffer,0,u)},to=D=>{switch(D){case 0:return"4:0:0";case 1:return"4:2:0";case 2:return"4:2:2";case 3:return"4:4:4";default:return"Unknown"}};function yr(D){var e={width:0,height:0,profile:0,level:0};D=D.slice(5);do{var i={};if(D.length<23||(i.configurationVersion=D[0],i.configurationVersion!=1))break;i.general_profile_space=D[1]>>6&3,i.general_tier_flag=D[1]>>5&1,i.general_profile_idc=31&D[1],i.general_profile_compatibility_flags=D[2]<<24|D[3]<<16|D[4]<<8|D[5],i.general_constraint_indicator_flags=D[6]<<24|D[7]<<16|D[8]<<8|D[9],i.general_constraint_indicator_flags=i.general_constraint_indicator_flags<<16|D[10]<<8|D[11],i.general_level_idc=D[12],i.min_spatial_segmentation_idc=(15&D[13])<<8|D[14],i.parallelismType=3&D[15],i.chromaFormat=3&D[16],i.bitDepthLumaMinus8=7&D[17],i.bitDepthChromaMinus8=7&D[18],i.avgFrameRate=D[19]<<8|D[20],i.constantFrameRate=D[21]>>6&3,i.numTemporalLayers=D[21]>>3&7,i.temporalIdNested=D[21]>>2&1,i.lengthSizeMinusOne=3&D[21];let o=D[22],f=D.slice(23);for(let _=0;_<o&&!(f.length<3);_++){var s=63&f[0],u=f[1]<<8|f[2];f=f.slice(3);for(let g=0;g<u&&!(f.length<2);g++){var c,l=f[0]<<8|f[1];if(f.length<2+l)break;f=f.slice(2),s==33&&((c=new Uint8Array(l)).set(f.slice(0,l),0),i.psps=(function(T){var E={},h=T.length,k=[],t=new Ra(T);t.read(1),t.read(6),t.read(6),t.read(3);for(let a=2;a<h;a++)a+2<h&&t.look(24)==3?(k.push(t.read(8)),k.push(t.read(8)),a+=2,t.read(8)):k.push(t.read(8));T=new Uint8Array(k),T=new Ra(T);{var r,n;E.sps_video_parameter_set_id=T.read(4),E.sps_max_sub_layers_minus1=T.read(3),E.sps_temporal_id_nesting_flag=T.read(1),E.profile_tier_level=(function(a,d){var p={};p.profile_space=a.read(2),p.tier_flag=a.read(1),p.profile_idc=a.read(5),p.profile_compatibility_flags=a.read(32),p.general_progressive_source_flag=a.read(1),p.general_interlaced_source_flag=a.read(1),p.general_non_packed_constraint_flag=a.read(1),p.general_frame_only_constraint_flag=a.read(1),a.read(32),a.read(12),p.level_idc=a.read(8),p.sub_layer_profile_present_flag=[],p.sub_layer_level_present_flag=[];for(let m=0;m<d;m++)p.sub_layer_profile_present_flag[m]=a.read(1),p.sub_layer_level_present_flag[m]=a.read(1);if(0<d)for(let m=d;m<8;m++)a.read(2);p.sub_layer_profile_space=[],p.sub_layer_tier_flag=[],p.sub_layer_profile_idc=[],p.sub_layer_profile_compatibility_flag=[],p.sub_layer_progressive_source_flag=[],p.sub_layer_interlaced_source_flag=[],p.sub_layer_non_packed_constraint_flag=[],p.sub_layer_frame_only_constraint_flag=[],p.sub_layer_level_idc=[];for(let m=0;m<d;m++)p.sub_layer_profile_present_flag[m]&&(p.sub_layer_profile_space[m]=a.read(2),p.sub_layer_tier_flag[m]=a.read(1),p.sub_layer_profile_idc[m]=a.read(5),p.sub_layer_profile_compatibility_flag[m]=a.read(32),p.sub_layer_progressive_source_flag[m]=a.read(1),p.sub_layer_interlaced_source_flag[m]=a.read(1),p.sub_layer_non_packed_constraint_flag[m]=a.read(1),p.sub_layer_frame_only_constraint_flag[m]=a.read(1),a.read(32),a.read(12)),p.sub_layer_level_present_flag[m]?p.sub_layer_level_idc[m]=a.read(8):p.sub_layer_level_idc[m]=1;return p})(T,E.sps_max_sub_layers_minus1),E.sps_seq_parameter_set_id=T.read_golomb(),E.chroma_format_idc=T.read_golomb(),E.separate_colour_plane_flag=E.chroma_format_idc==3?T.read(1):0,E.pic_width_in_luma_samples=T.read_golomb(),E.pic_height_in_luma_samples=T.read_golomb(),E.conformance_window_flag=T.read(1),E.conformance_window_flag?(r=1+(E.chroma_format_idc<2),n=1+(E.chroma_format_idc<3),E.conf_win_left_offset=T.read_golomb()*n,E.conf_win_right_offset=T.read_golomb()*n,E.conf_win_top_offset=T.read_golomb()*r,E.conf_win_bottom_offset=T.read_golomb()*r):(E.conf_win_left_offset=0,E.conf_win_right_offset=0,E.conf_win_top_offset=0,E.conf_win_bottom_offset=0)}return E})(c),e.profile=i.general_profile_idc,e.level=i.general_level_idc/30,e.width=i.psps.pic_width_in_luma_samples-(i.psps.conf_win_left_offset+i.psps.conf_win_right_offset),e.height=i.psps.pic_height_in_luma_samples-(i.psps.conf_win_top_offset+i.psps.conf_win_bottom_offset)),f=f.slice(l)}}}while(!1);return e.codecWidth=e.width||1920,e.codecHeight=e.height||1080,e.presentHeight=e.codecHeight,e.presentWidth=e.codecWidth,e.timescale=1e3,e.refSampleDuration=1e3/23976*1e3,e.videoType=Rn,e}function Ua(e){var{vps:e,pps:i,sps:s}=e,u={configurationVersion:1},o=(f=>(f=Xr(f),f=new ki(f),f.readByte(),f.readByte(),f.readBits(4),f.readBits(2),f.readBits(6),{num_temporal_layers:f.readBits(3)+1,temporal_id_nested:f.readBool()}))(e),c=(r=>{let _=Xr(r),g=new ki(_),T=(g.readByte(),g.readByte(),0),E=0,h=0,k=0;g.readBits(4);var t=g.readBits(3),r=(g.readBool(),g.readBits(2)),n=g.readBool(),a=g.readBits(5),d=g.readByte(),p=g.readByte(),m=g.readByte(),x=g.readByte(),b=g.readByte(),C=g.readByte(),v=g.readByte(),y=g.readByte(),S=g.readByte(),L=g.readByte(),B=g.readByte(),A=[],I=[];for(let le=0;le<t;le++)A.push(g.readBool()),I.push(g.readBool());if(0<t)for(let le=t;le<8;le++)g.readBits(2);for(let le=0;le<t;le++)A[le]&&(g.readByte(),g.readByte(),g.readByte(),g.readByte(),g.readByte(),g.readByte(),g.readByte(),g.readByte(),g.readByte(),g.readByte(),g.readByte()),A[le]&&g.readByte();g.readUEG();var U,P=g.readUEG(),F=(P==3&&g.readBits(1),g.readUEG()),M=g.readUEG(),w=(g.readBool()&&(T+=g.readUEG(),E+=g.readUEG(),h+=g.readUEG(),k+=g.readUEG()),g.readUEG()),R=g.readUEG(),O=g.readUEG();for(let le=g.readBool()?0:t;le<=t;le++)g.readUEG(),g.readUEG(),g.readUEG();if(g.readUEG(),g.readUEG(),g.readUEG(),g.readUEG(),g.readUEG(),g.readUEG(),g.readBool()&&g.readBool())for(let le=0;le<4;le++)for(let ge=0;ge<(le===3?2:6);ge++)if(g.readBool()){var j=Math.min(64,1<<4+(le<<1));1<le&&g.readSEG();for(let ye=0;ye<j;ye++)g.readSEG()}else g.readUEG();g.readBool(),g.readBool(),g.readBool()&&(g.readByte(),g.readUEG(),g.readUEG(),g.readBool());let z=g.readUEG(),G=0;for(let le=0;le<z;le++){let ge=!1;if(ge=le!==0?g.readBool():ge){le===z&&g.readUEG(),g.readBool(),g.readUEG();let ye=0;for(let Ee=0;Ee<=G;Ee++){let xe=g.readBool(),ke=!1;xe||(ke=g.readBool()),(xe||ke)&&ye++}G=ye}else{var K=g.readUEG(),$=g.readUEG();G=K+$;for(let ye=0;ye<K;ye++)g.readUEG(),g.readBool();for(let ye=0;ye<$;ye++)g.readUEG(),g.readBool()}}if(g.readBool()){var V=g.readUEG();for(let le=0;le<V;le++){for(let ge=0;ge<O+4;ge++)g.readBits(1);g.readBits(1)}}let q=0,J=1,re=1,Z=!1,W=1,X=1;if(g.readBool(),g.readBool(),g.readBool()){if(g.readBool()&&(0<(U=g.readByte())&&U<16?(J=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][U-1],re=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][U-1]):U===255&&(J=g.readBits(16),re=g.readBits(16))),g.readBool()&&g.readBool(),g.readBool()&&(g.readBits(3),g.readBool(),g.readBool())&&(g.readByte(),g.readByte(),g.readByte()),g.readBool()&&(g.readUEG(),g.readUEG()),g.readBool(),g.readBool(),g.readBool(),g.readBool()&&(T+=g.readUEG(),E+=g.readUEG(),h+=g.readUEG(),k+=g.readUEG()),g.readBool()&&(W=g.readBits(32),X=g.readBits(32),g.readBool())&&(g.readUEG(),g.readBool())){let le,ge,ye=!1;le=g.readBool(),ge=g.readBool(),(le||ge)&&((ye=g.readBool())&&(g.readByte(),g.readBits(5),g.readBool(),g.readBits(5)),g.readBits(4),g.readBits(4),ye&&g.readBits(4),g.readBits(5),g.readBits(5),g.readBits(5));for(let Ee=0;Ee<=t;Ee++){var se=g.readBool();Z=se;let xe=!1,ke=!1;if((xe=se?xe:g.readBool())?g.readSEG():ke=g.readBool(),ke||(cpbcnt=g.readUEG()+1),le)for(let Le=0;Le<1;Le++)g.readUEG(),g.readUEG(),ye&&(g.readUEG(),g.readUEG());if(ge)for(let Le=0;Le<1;Le++)g.readUEG(),g.readUEG(),ye&&(g.readUEG(),g.readUEG())}}g.readBool()&&(g.readBool(),g.readBool(),g.readBool(),q=g.readUEG(),g.readUEG(),g.readUEG(),g.readUEG(),g.readUEG())}g.readBool();let ie=`hvc1.${a}.1.L${B}.B0`,ne=F,me=M,ce=1;return J!==1&&re!==1&&(ce=J/re),g.destroy(),g=null,{codec_mimetype:ie,level_string:(B/30).toFixed(1),profile_idc:a,bit_depth:w+8,ref_frames:1,chroma_format:P,chroma_format_string:to(P),general_level_idc:B,general_profile_space:r,general_tier_flag:n,general_profile_idc:a,general_profile_compatibility_flags_1:d,general_profile_compatibility_flags_2:p,general_profile_compatibility_flags_3:m,general_profile_compatibility_flags_4:x,general_constraint_indicator_flags_1:b,general_constraint_indicator_flags_2:C,general_constraint_indicator_flags_3:v,general_constraint_indicator_flags_4:y,general_constraint_indicator_flags_5:S,general_constraint_indicator_flags_6:L,min_spatial_segmentation_idc:q,constant_frame_rate:0,chroma_format_idc:P,bit_depth_luma_minus8:w,bit_depth_chroma_minus8:R,frame_rate:{fixed:Z,fps:X/W,fps_den:W,fps_num:X},sar_ratio:{width:J,height:re},codec_size:{width:ne,height:me},present_size:{width:ne*ce,height:me}}})(s),l=(f=>{f=Xr(f),f=new ki(f),f.readByte(),f.readByte(),f.readUEG(),f.readUEG(),f.readBool(),f.readBool(),f.readBits(3),f.readBool(),f.readBool(),f.readUEG(),f.readUEG(),f.readSEG(),f.readBool(),f.readBool(),f.readBool()&&f.readUEG(),f.readSEG(),f.readSEG(),f.readBool(),f.readBool(),f.readBool(),f.readBool();let _=f.readBool(),g=f.readBool(),T=1;return g&&_?T=0:g?T=3:_&&(T=2),{parallelismType:T}})(i),u=Object.assign(u,o,c,l),o=23+(5+e.byteLength)+(5+s.byteLength)+(5+i.byteLength),c=new Uint8Array(o),l=(c[0]=1,c[1]=(3&u.general_profile_space)<<6|(u.general_tier_flag?1:0)<<5|31&u.general_profile_idc,c[2]=u.general_profile_compatibility_flags_1||0,c[3]=u.general_profile_compatibility_flags_2||0,c[4]=u.general_profile_compatibility_flags_3||0,c[5]=u.general_profile_compatibility_flags_4||0,c[6]=u.general_constraint_indicator_flags_1||0,c[7]=u.general_constraint_indicator_flags_2||0,c[8]=u.general_constraint_indicator_flags_3||0,c[9]=u.general_constraint_indicator_flags_4||0,c[10]=u.general_constraint_indicator_flags_5||0,c[11]=u.general_constraint_indicator_flags_6||0,c[12]=60,c[13]=240|(3840&u.min_spatial_segmentation_idc)>>8,c[14]=255&u.min_spatial_segmentation_idc,c[15]=252|3&u.parallelismType,c[16]=252|3&u.chroma_format_idc,c[17]=248|7&u.bit_depth_luma_minus8,c[18]=248|7&u.bit_depth_chroma_minus8,c[19]=0,c[20]=0,c[21]=(3&u.constant_frame_rate)<<6|(7&u.num_temporal_layers)<<3|(u.temporal_id_nested?1:0)<<2|3,c[22]=3,c[23]=128|$i,c[24]=0,c[25]=1,c[26]=(65280&e.byteLength)>>8,c[27]=(255&e.byteLength)>>0,c.set(e,28),c[23+(5+e.byteLength)+0]=128|Ki,c[23+(5+e.byteLength)+1]=0,c[23+(5+e.byteLength)+2]=1,c[23+(5+e.byteLength)+3]=(65280&s.byteLength)>>8,c[23+(5+e.byteLength)+4]=(255&s.byteLength)>>0,c.set(s,23+(5+e.byteLength)+5),c[23+(5+e.byteLength+5+s.byteLength)+0]=128|mi,c[23+(5+e.byteLength+5+s.byteLength)+1]=0,c[23+(5+e.byteLength+5+s.byteLength)+2]=1,c[23+(5+e.byteLength+5+s.byteLength)+3]=(65280&i.byteLength)>>8,c[23+(5+e.byteLength+5+s.byteLength)+4]=(255&i.byteLength)>>0,c.set(i,23+(5+e.byteLength+5+s.byteLength)+5),[28,0,0,0,0]),o=new Uint8Array(l.length+c.byteLength);return o.set(l,0),o.set(c,l.length),o}function Ma(D,s){var i=[],s=(i[0]=s?28:44,i[1]=1,i[2]=0,i[3]=0,i[4]=0,new Uint8Array(i.length+D.byteLength));return s.set(i,0),s.set(D,i.length),s}function Zr(D){return(126&D[0])>>1}function Fa(D){return!(32<=D&&D<=40)}class Oa extends Ae{constructor(e){super(),this.player=e,this.fileName="",this._isRecording=!1,this._recordingTimestamp=0,this.recordingInterval=null,this.sps=null,this.pps=null,this.vps=null,this.codecId=null,this.mdatBytesLength=0,this.metaInfo={codecWidth:0,codecHeight:0,presentWidth:0,presentHeight:0,refSampleDuration:0,timescale:1e3,avcc:null,videoType:""}}destroy(){this._reset()}get isH264(){return this.codecId===7}get isH265(){return this.codecId===12}setFileName(e){this.fileName=e}get isRecording(){return this._isRecording}get recording(){return this._isRecording}get recordTime(){return this._recordingTimestamp}startRecord(){}handleAddNaluTrack(e,i,s,u){}handleAddTrack(e){}stopRecordAndSave(){}startRecordingInterval(){}stopRecordingInterval(){this.recordingInterval&&clearInterval(this.recordingInterval),this.recordingInterval=null}getToTalByteLength(){}_reset(){this.fileName="",this._isRecording=!1,this._recordingTimestamp=0,this.stopRecordingInterval(),this.sps=null,this.pps=null,this.vps=null,this.codecId=null,this.mdatBytesLength=0}initMetaData(e,i){let s;var u=e.slice(5);if(this.codecId=i,this.metaInfo.avcc=u,i===7)s=gr(u);else if(i===12){s=(function(g){var k=23,o=g[23];if((63&o)!==$i)return console.warn("parseHEVCDecoderVPSAndSPSAndPPS and vpsTag is "+o),{};k+=2,++k;var o=g[27]|g[26]<<8,f=(k+=2,g.slice(28,28+o)),h=g[k+=o];if((63&h)!==Ki)return console.warn("parseHEVCDecoderVPSAndSPSAndPPS and sps tag is "+h),{};k+=2;var h=g[1+ ++k]|g[k]<<8,t=g.slice(k+=2,k+h),_=g[k+=h];if((63&_)!==mi)return console.warn("parseHEVCDecoderVPSAndSPSAndPPS and pps tag is "+_),{};k+=2;var _=g[1+ ++k]|g[k]<<8,g=g.slice(k+=2,k+_),k=new Uint8Array([h>>>24&255,h>>>16&255,h>>>8&255,255&h]),T=new Uint8Array([_>>>24&255,_>>>16&255,_>>>8&255,255&_]),E=new Uint8Array([o>>>24&255,o>>>16&255,o>>>8&255,255&o]),h=new Uint8Array(4+h),k=(h.set(k,0),h.set(t,4),new Uint8Array(4+_)),t=(k.set(T,0),k.set(g,4),new Uint8Array(4+o));return t.set(E,0),t.set(f,4),{sps:h,pps:k,vps:t}})(u);const c=yr(e);s=Object.assign(s,c)}s&&(s.vps&&(this.vps=s.vps),s.pps&&(this.pps=s.pps),s.sps&&(this.sps=s.sps),s.presentWidth&&(this.metaInfo.presentWidth=s.presentWidth),s.presentHeight&&(this.metaInfo.presentHeight=s.presentHeight),s.codecWidth&&(this.metaInfo.codecWidth=s.codecWidth),s.codecHeight&&(this.metaInfo.codecHeight=s.codecHeight),s.timescale&&(this.metaInfo.timescale=s.timescale),s.refSampleDuration&&(this.metaInfo.refSampleDuration=s.refSampleDuration),s.videoType)&&(this.metaInfo.videoType=s.videoType)}}class io extends Oa{constructor(e){super(e),this.totalByteLength=0,this._startRecordingTimestamp=null,e.debug.log("RecorderRTC","init")}_reset(){super._reset(),this.totalByteLength=0,this._startRecordingTimestamp=null,this.recorder&&(this.recorder.destroy(),this.recorder=null)}destroy(){super.destroy(),this._reset(),this.player.debug.log("RecorderRTC","destroy")}getSeekableBlob(e){const i=new EBML.Reader,s=new EBML.Decoder,u=EBML.tools,c=new FileReader;return new Promise((l,o)=>{c.onload=function(f){s.decode(this.result).forEach(function(T){i.read(T)}),i.stop();var g=u.makeMetadataSeekable(i.metadatas,i.duration,i.cues),_=this.result.slice(i.metadataSize),g=new Blob([g,_],{type:"video/webm"});l(g)},c.readAsArrayBuffer(e)})}startRecord(){const e=this.player.debug,i={type:"video",mimeType:"video/webm;codecs=h264",timeSlice:1e3,onTimeStamp:s=>{e.log("RecorderRTC","record timestamp :"+s),this._startRecordingTimestamp===null&&(this._startRecordingTimestamp=s),this._recordingTimestamp=(s-this._startRecordingTimestamp)/1e3},ondataavailable:s=>{this.totalByteLength+=s.size,e.log("RecorderRTC","ondataavailable",s.size)},disableLogs:!this.player._opt.debug};try{let s=null;if(this.player.getRenderType()===Tt?s=this.player.video.$videoElement.captureStream(25):this.player.video.mediaStream?s=this.player.video.mediaStream:this.player.isOldHls()||this.player._opt.useMSE||this.player._opt.useWCS?s=this.player.video.$videoElement.captureStream(25):this.player._opt.isWebrtc&&(s=this.player.webrtc.videoStream),s){if(this.player.audio&&this.player.audio.mediaStreamAudioDestinationNode&&this.player.audio.mediaStreamAudioDestinationNode.stream&&!this.player.audio.isStateSuspended()&&this.player.audio.hasAudio&&this.player._opt.hasAudio){const u=this.player.audio.mediaStreamAudioDestinationNode.stream;if(0<u.getAudioTracks().length){const c=u.getAudioTracks()[0];c&&c.enabled&&s.addTrack(c)}}this.recorder=eo(s,i)}else e.error("RecorderRTC","startRecord error and can not create stream"),this.emit(N.recordCreateError)}catch(s){e.error("RecorderRTC","startRecord error",s),this.emit(N.recordCreateError)}this.recorder&&(this._isRecording=!0,this.player.emit(N.recording,!0),this.recorder.startRecording(),e.log("RecorderRTC","start recording"),this.player.emit(N.recordStart),this.startRecordingInterval())}startRecordingInterval(){this.stopRecordingInterval(),this.recordingInterval=window.setInterval(()=>{this.player.emit(N.recordingTimestamp,this._recordingTimestamp)},1e3)}stopRecordAndSave(){let e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:Te,i=1<arguments.length?arguments[1]:void 0;return new Promise((s,u)=>{this.recorder&&this._isRecording||u("recorder is not ready"),i&&this.setFileName(i),this.recorder.stopRecording(()=>{this.player.debug.log("RecorderRTC","stop recording");var c=(this.fileName||be())+"."+Gt;if(this.recorder.getBlob(),e==="blob"){const l=this.recorder.getBlob();s(l),this.player.emit(N.recordBlob,l)}else s(),this.recorder.save(c);this.player.emit(N.recordEnd),this._reset(),this.player.emit(N.recording,!1)})})}getToTalByteLength(){return this.totalByteLength}getTotalDuration(){return this.recordTime}getType(){return Gt}initMetaData(){}}class ee{static init(){for(var e in ee.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[],free:[],edts:[],elst:[],stss:[]},ee.types)ee.types.hasOwnProperty(e)&&(ee.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var i=ee.constants={};i.FTYP=new Uint8Array([105,115,111,109,0,0,2,0,105,115,111,109,105,115,111,50,97,118,99,49,109,112,52,49,0,0,0,0]),i.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),i.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),i.STSC=i.STCO=i.STTS,i.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),i.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),i.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),i.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}static box(e){let i=8,s=null,u=Array.prototype.slice.call(arguments,1),c=u.length;for(let o=0;o<c;o++)i+=u[o].byteLength;(s=new Uint8Array(i))[0]=i>>>24&255,s[1]=i>>>16&255,s[2]=i>>>8&255,s[3]=255&i,s.set(e,4);let l=8;for(let o=0;o<c;o++)s.set(u[o],l),l+=u[o].byteLength;return s}static generateInitSegment(e,i,s){let u=ee.box(ee.types.ftyp,ee.constants.FTYP),c=ee.box(ee.types.free),l=8,o=new Uint8Array;s+l>=Math.pow(2,32)-1?(l=16,(o=new Uint8Array(s+l)).set(new Uint8Array([0,0,0,1]),0),o.set(ee.types.mdat,4),o.set(new Uint8Array([s+8>>>56&255,s+8>>>48&255,s+8>>>40&255,s+8>>>32&255,s+8>>>24&255,s+8>>>16&255,s+8>>>8&255,s+8&255]),8)):((o=new Uint8Array(s+l))[0]=s+8>>>24&255,o[1]=s+8>>>16&255,o[2]=s+8>>>8&255,o[3]=s+8&255,o.set(ee.types.mdat,4));for(let g=0;g<i.length;g++){var f=i[g];f.duration=f.refSampleDuration*f.sequenceNumber;for(let T=0;T<f.sequenceNumber;T++){var _=f.samples[T],_=(_.chunkOffset=u.byteLength+c.byteLength+l,_.data);o.set(_,l),l+=_.byteLength}}return s=ee.moov(e,i),e=new Uint8Array(u.byteLength+s.byteLength+o.byteLength+c.byteLength),e.set(u,0),e.set(c,u.byteLength),e.set(o,u.byteLength+c.byteLength),e.set(s,u.byteLength+o.byteLength+c.byteLength),e}static moov(e,i){let s=e.timescale,u=e.duration,c=i.length,l=ee.mvhd(s,u),o=new Uint8Array;for(let g=0;g<c;g++){var f=ee.trak(i[g]),_=new Uint8Array(f.byteLength+o.byteLength);_.set(o,0),_.set(f,o.byteLength),(o=new Uint8Array(_.byteLength)).set(_,0)}return ee.box(ee.types.moov,l,o)}static mvhd(e,i){return ee.box(ee.types.mvhd,new Uint8Array([0,0,0,0,206,186,253,168,206,186,253,168,e>>>24&255,e>>>16&255,e>>>8&255,255&e,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3]))}static trak(e){return ee.box(ee.types.trak,ee.tkhd(e),ee.mdia(e))}static tkhd(c){var i=c.id,s=c.duration,u=c.presentWidth,c=c.presentHeight;return ee.box(ee.types.tkhd,new Uint8Array([0,0,0,15,206,186,253,168,206,186,253,168,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,255&s,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,u>>>8&255,255&u,0,0,c>>>8&255,255&c,0,0]))}static edts(e,i){return ee.box(ee.types.edts,ee.elst(e,i))}static elst(e,i){let s=0;for(let c=0;c<i;c++)e[c].type==="video"&&(s+=e[c].duration);var u=e[i].duration;return s===0&&(s=e[i].refSampleDuration),ee.box(ee.types.elst,new Uint8Array([0,0,0,0,0,0,0,2,s>>>24&255,s>>>16&255,s>>>8&255,255&s,255,255,255,255,0,1,0,0,u>>>24&255,u>>>16&255,u>>>8&255,255&u,0,0,0,0,0,1,0,0]))}static mdia(e){return ee.box(ee.types.mdia,ee.mdhd(e),ee.hdlr(e),ee.minf(e))}static mdhd(s){var i=s.timescale/s.refSampleDuration,s=i*s.duration/s.timescale;return ee.box(ee.types.mdhd,new Uint8Array([0,0,0,0,206,186,253,168,206,186,253,168,i>>>24&255,i>>>16&255,i>>>8&255,255&i,s>>>24&255,s>>>16&255,s>>>8&255,255&s,85,196,0,0]))}static hdlr(e){var i=ee.constants.HDLR_VIDEO;return ee.box(ee.types.hdlr,i)}static minf(e){var i=ee.box(ee.types.vmhd,ee.constants.VMHD);return ee.box(ee.types.minf,i,ee.dinf(),ee.stbl(e))}static dinf(){return ee.box(ee.types.dinf,ee.box(ee.types.dref,ee.constants.DREF))}static stbl(e){var i=e.samples,s=[{No:1,num:0,sampleDelte:1,chunkNo:1,duration:i[0].duration}],u=[i[0].duration],c=i.length;for(let l=0;l<c;l++)for(let o=0;o<s.length;o++)i[l].duration===s[o].duration?s[o].num++:u.indexOf(i[l].duration)<0&&(u.push(i[l].duration),s.push({No:2,num:0,sampleDelte:1,chunkNo:l+1,duration:i[l].duration}));return ee.box(ee.types.stbl,ee.stsd(e),ee.stts(s),ee.stss(i),ee.stsc(s),ee.stsz(i),ee.stco(s,i))}static stts(e){let i=e.length,s=new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i]),u=s.byteLength,c=new Uint8Array(u+8*i);c.set(s,0);for(let l=0;l<i;l++)c.set(new Uint8Array([e[l].num>>>24&255,e[l].num>>>16&255,e[l].num>>>8&255,255&e[l].num,e[l].sampleDelte>>>24&255,e[l].sampleDelte>>>16&255,e[l].sampleDelte>>>8&255,255&e[l].sampleDelte]),u),u+=8;return ee.box(ee.types.stts,c)}static stss(e){var i=[],s=e.length;for(let f=0;f<s;f++)e[f].isKeyframe===!0&&i.push(f+1);let u=i.length,c=new Uint8Array([0,0,0,0,u>>>24&255,u>>>16&255,u>>>8&255,255&u]),l=c.byteLength,o=new Uint8Array(l+4*u);o.set(c,0);for(let f=0;f<u;f++)o.set(new Uint8Array([i[f]>>>24&255,i[f]>>>16&255,i[f]>>>8&255,255&i[f]]),l),l+=4;return ee.box(ee.types.stss,o)}static stsc(e){let i=e.length,s=new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i]),u=s.byteLength,c=new Uint8Array(u+12*i);c.set(s,0);for(let _=0;_<i;_++){var l=e[_].chunkNo,o=e[_].num,f=e[_].sampleDelte;c.set(new Uint8Array([l>>>24&255,l>>>16&255,l>>>8&255,255&l,o>>>24&255,o>>>16&255,o>>>8&255,255&o,f>>>24&255,f>>>16&255,f>>>8&255,255&f]),u),u+=12}return ee.box(ee.types.stsc,c)}static stsz(e){let i=e.length,s=new Uint8Array([0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i]),u=s.byteLength,c=new Uint8Array(u+4*i);c.set(s,0);for(let o=0;o<i;o++){var l=e[o].data.byteLength;c.set(new Uint8Array([l>>>24&255,l>>>16&255,l>>>8&255,255&l]),u),u+=4}return ee.box(ee.types.stsz,c)}static stco(e,i){return i=i[0].chunkOffset,ee.box(ee.types.stco,new Uint8Array([0,0,0,0,0,0,0,1,i>>>24&255,i>>>16&255,i>>>8&255,255&i]))}static stsd(e){return e.type==="audio"?e.codec==="mp3"?ee.box(ee.types.stsd,ee.constants.STSD_PREFIX,ee.mp3(e)):ee.box(ee.types.stsd,ee.constants.STSD_PREFIX,ee.mp4a(e)):e.videoType==="avc"?ee.box(ee.types.stsd,ee.constants.STSD_PREFIX,ee.avc1(e)):ee.box(ee.types.stsd,ee.constants.STSD_PREFIX,ee.hvc1(e))}static mp3(i){var s=i.channelCount,i=i.audioSampleRate,s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,s,0,16,0,0,0,0,i>>>8&255,255&i,0,0]);return ee.box(ee.types[".mp3"],s)}static mp4a(e){var s=e.channelCount,i=e.audioSampleRate,s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,s,0,16,0,0,0,0,i>>>8&255,255&i,0,0]);return ee.box(ee.types.mp4a,s,ee.esds(e))}static esds(i){var i=i.config||[],s=i.length,s=new Uint8Array([0,0,0,0,3,23+s,0,1,0,4,15+s,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([s]).concat(i).concat([6,1,2]));return ee.box(ee.types.esds,s)}static avc1(s){var i=s.avcc,u=s.codecWidth,s=s.codecHeight,u=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>>8&255,255&u,s>>>8&255,255&s,0,72,0,0,0,72,0,0,0,0,0,0,0,1,13,106,101,115,115,105,98,117,99,97,45,112,114,111,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return ee.box(ee.types.avc1,u,ee.box(ee.types.avcC,i))}static hvc1(s){var i=s.avcc,u=s.codecWidth,s=s.codecHeight,u=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>>8&255,255&u,s>>>8&255,255&s,0,72,0,0,0,72,0,0,0,0,0,0,0,1,13,106,101,115,115,105,98,117,99,97,45,112,114,111,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return ee.box(ee.types.hvc1,u,ee.box(ee.types.hvcC,i))}static mvex(e){return ee.box(ee.types.mvex,ee.trex(e))}static trex(e){return e=e.id,e=new Uint8Array([0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]),ee.box(ee.types.trex,e)}static moof(e,i){return ee.box(ee.types.moof,ee.mfhd(e.sequenceNumber),ee.traf(e,i))}static mfhd(e){return e=new Uint8Array([0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e]),ee.box(ee.types.mfhd,e)}static traf(l,u){var s=l.id,s=ee.box(ee.types.tfhd,new Uint8Array([0,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,255&s])),u=ee.box(ee.types.tfdt,new Uint8Array([0,0,0,0,u>>>24&255,u>>>16&255,u>>>8&255,255&u])),c=ee.sdtp(l),l=ee.trun(l,c.byteLength+16+16+8+16+8+8);return ee.box(ee.types.traf,s,u,l,c)}static sdtp(e){var i=e.samples||[],s=i.length,u=new Uint8Array(4+s);for(let l=0;l<s;l++){var c=i[l].flags;u[l+4]=c.isLeading<<6|c.dependsOn<<4|c.isDependedOn<<2|c.hasRedundancy}return ee.box(ee.types.sdtp,u)}static trun(c,i){var s=c.samples||[],u=s.length,c=12+16*u,l=new Uint8Array(c);l.set([0,0,15,1,u>>>24&255,u>>>16&255,u>>>8&255,255&u,(i+=8+c)>>>24&255,i>>>16&255,i>>>8&255,255&i],0);for(let T=0;T<u;T++){var o=s[T].duration,f=s[T].size,_=s[T].flags,g=s[T].cts;l.set([o>>>24&255,o>>>16&255,o>>>8&255,255&o,f>>>24&255,f>>>16&255,f>>>8&255,255&f,_.isLeading<<2|_.dependsOn,_.isDependedOn<<6|_.hasRedundancy<<4|_.isNonSync,0,0,g>>>24&255,g>>>16&255,g>>>8&255,255&g],12+16*T)}return ee.box(ee.types.trun,l)}static mdat(e){return ee.box(ee.types.mdat,e)}}ee.init();class ro extends Oa{constructor(e){super(e),this.tagName="recorderMP4",this.totalDuration=0,this.totalByteLength=0,this.bufferList=[],this.cacheTrack={},this.sequenceNumber=0,e.debug.log(this.tagName,"init")}destroy(){super.destroy(),this._reset(),this.player.debug.log(this.tagName,"destroy")}_reset(){super._reset(),this.totalDuration=0,this.totalByteLength=0,this.sequenceNumber=0,this.cacheTrack={},this.bufferList=[]}startRecord(){var e=this.player.debug;this._isRecording=!0,this.player.emit(N.recording,!0),e.log(this.tagName,"start recording"),this.player.emit(N.recordStart),this.startRecordingInterval()}startRecordingInterval(){this.stopRecordingInterval(),this.recordingInterval=window.setInterval(()=>{this.player.emit(N.recordingTimestamp,this.getTotalDuration())},1e3)}formatFmp4Track(e,i,s,u){return{id:1,sequenceNumber:++this.sequenceNumber,size:e.byteLength,dts:s,cts:u,isKeyframe:i,data:e,duration:0,flags:{isLeading:0,dependsOn:i?2:1,isDependedOn:i?1:0,hasRedundancy:0,isNonSync:i?0:1}}}handleAddNaluTrack(e,i,s,u){this.cacheTrack.id&&s>=this.cacheTrack.dts?(this.cacheTrack.duration=s-this.cacheTrack.dts,this.handleAddFmp4Track(this.cacheTrack)):this.cacheTrack={},this.cacheTrack=this.formatFmp4Track(e,i,s,u)}handleAddFmp4Track(e){if(this.isRecording)if(this.sps!==null&&this.pps!==null||!this.isH264)if(this.sps!==null&&this.pps!==null&&this.vps!==null||!this.isH265){var i=Object.assign({},e),s=(i.pts=i.dts+i.cts,i.data);if(i.isKeyframe){if(this.isH264){const c=new Uint8Array(this.sps.byteLength+this.pps.byteLength);c.set(this.sps,0),c.set(this.pps,this.sps.byteLength);var u=new Uint8Array(c.byteLength+s.byteLength);u.set(c,0),u.set(s,c.byteLength),i.data=u}else if(this.isH265){const c=new Uint8Array(this.sps.byteLength+this.pps.byteLength+this.vps.byteLength);c.set(this.vps,0),c.set(this.sps,this.vps.byteLength),c.set(this.pps,this.vps.byteLength+this.sps.byteLength),u=new Uint8Array(c.byteLength+s.byteLength),u.set(c,0),u.set(s,c.byteLength),i.data=u}}i.size=i.data.byteLength,this.totalDuration+=i.duration,this.totalByteLength+=i.data.byteLength,i.duration=0,i.originalDts=i.dts,delete i.id,delete i.sequenceNumber,this.bufferList.push(i)}else this.player.debug.error(this.tagName,"handleAddFmp4Track, is h265 and this.sps or this.pps or this.vps is null ");else this.player.debug.error(this.tagName,"handleAddFmp4Track, is h264 and this.sps or this.pps is null ");else this.player.debug.error(this.tagName,"handleAddFmp4Track, isRecording is false ")}getTotalDuration(){return this.totalDuration/1e3}getType(){return Ze}getToTalByteLength(){return this.totalByteLength}stopRecordAndSave(){let e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:Te,i=1<arguments.length?arguments[1]:void 0;return new Promise((s,u)=>{if(!this.isRecording)return this.player.debug.error(this.tagName,"stop recording fail, isRecording is false "),u("stop recording fail, isRecording is false ");if(this.bufferList.length===0)return this.player.debug.error(this.tagName,"stop recording fail, this.bufferList.length is 0 "),u("stop recording fail, this.bufferList.length is 0 ");if(i&&this.setFileName(i),u={id:1,type:"video",sps:this.sps,pps:this.pps,samples:this.bufferList,sequenceNumber:this.bufferList.length,length:0,addSampleNum:1,duration:0,...this.metaInfo},u=ee.generateInitSegment({timescale:1e3,duration:this.totalDuration},[u],this.totalByteLength),this.player.debug.log(this.tagName,"stop recording"),u=new Blob([u],{type:"application/octet-stream"}),e==="blob")s(u),this.player.emit(N.recordBlob,u);else{s();{s=(this.fileName||be())+"."+Ze;let c=window.URL.createObjectURL(u),l=window.document.createElement("a");l.download=s,l.href=c,s=window.document.createEvent("MouseEvents"),s.initEvent("click",!0,!0),l.dispatchEvent(s),setTimeout(()=>{window.URL.revokeObjectURL(c)},oi()?1e3:0)}}this._reset(),this.player.emit(N.recording,!1)})}}class es{constructor(e){return new(es.getLoaderFactory(e._opt))(e)}static getLoaderFactory(e){return e.recordType===Ze&&(e.useWasm||e.useMSE||e.useWCS)?ro:io}}class Na{constructor(e){this.player=e,this.destroyResolve=null;let i=e._opt.decoder;if((i=_e(this.player._opt.useWasm)?e._opt.decoderAudio:i).indexOf("http")===0&&this.player._opt.isDecoderUseCDN){const s=new Blob([`importScripts("${i}")`],{type:"application/javascript"});i=window.URL.createObjectURL(s)}this.decoderWorker=new Worker(i),this._initDecoderWorker(),e.debug.log("decoderWorker","init"),e.on(N.visibilityChange,()=>{this.updateWorkConfig({key:"visibility",value:e.visibility})})}destroy(){return new Promise((e,i)=>{this.player.loaded?(this.player.debug.log("decoderWorker","has loaded and post message to destroy"),this.decoderWorker?(this.decoderWorker.postMessage({cmd:"close"}),this.destroyResolve=e):(this.player.debug.warn("decoderWorker","has loaded but decoderWorker is null and destroy directly"),this._destroy(),setTimeout(()=>{e()},0))):(this.player.debug.log("decoderWorker","has not loaded and destroy directly"),this._destroy(),setTimeout(()=>{e()},0))})}_destroy(){this.decoderWorker&&(this.decoderWorker.terminate(),this.decoderWorker=null),this.player.debug.log("decoderWorker","destroy"),this.destroyResolve&&(this.destroyResolve(),this.destroyResolve=null)}_initDecoderWorker(){const{debug:e}=this.player;this.decoderWorker.onmessage=i=>{var s=i.data;switch(s.cmd){case ei:e.log("decoderWorker","onmessage:",ei),this.decoderWorker&&this._initWork(),this.player.loaded||this.player.emit(N.load),this.player.emit(N.decoderWorkerInit);break;case Se:e.log("decoderWorker","onmessage:",Se,s.code),this.player._times.decodeStart||(this.player._times.decodeStart=be()),this.player.video.updateVideoInfo({encTypeCode:s.code});break;case Y:e.log("decoderWorker","onmessage:",Y,s.codecId),this.player.recorder&&this.player.recorder.initMetaData(s.buffer,s.codecId);break;case Me:e.log("decoderWorker","onmessage:",Me,s.code),this.player.audio&&this.player.audio.updateAudioInfo({encTypeCode:s.code});break;case pi:e.log("decoderWorker","onmessage:",pi,`width:${s.w},height:`+s.h),this.player.video.updateVideoInfo({width:s.w,height:s.h}),this.player._opt.openWebglAlignment||s.w/2%4==0||this.player.getRenderType()!==Tt?(this.player.video.initCanvasViewSize(),this.player._opt.playType===pe&&(this.player.video.initFps(),this.player.video.initVideoDelay())):this.player.emit(H.webglAlignmentError);break;case fi:e.log("decoderWorker","onmessage:",fi,`channels:${s.channels},sampleRate:`+s.sampleRate),2<s.channels?this.player.emitError(H.audioChannelError,`audio channel is ${s.channels}, max is 2`):this.player.audio&&(this.player.audio.updateAudioInfo(s),this.player._opt.playType===Ie?this.player.audio.initScriptNode():this.player._opt.playType===pe&&this.player.audio.initScriptNodeDelay());break;case"render":if(this.player.video)if(this.player._opt.playType===Ie){if(_e(this.player.video.getHasInit()))return void e.warn("decoderWorker","onmessage render but video has not init");this.player.video.render(s),this.player.handleRender(),this.player.emit(N.timeUpdate,s.ts),this.player.updateStats({dfps:!0,buf:s.delay}),this.player._times.videoStart||(this.player._times.videoStart=be(),this.player.handlePlayToRenderTimes())}else this.player._opt.playType===pe&&(this.player.updateStats({dfps:!0}),_e(this.player.playbackPause)?(this.player.playback.isUseLocalCalculateTime&&this.player.playback.increaseLocalTimestamp(),this.player.playback.isUseFpsRender?this.player.video.pushData(s):this.player.video.render$2(s)):!this.player.playback.isPlaybackPauseClearCache&&this.player.playback.isCacheBeforeDecodeForFpsRender&&this.player.playback.isUseFpsRender&&this.player.video.pushData(s));else e.warn("decoderWorker","onmessage render but video is null");break;case"videoNalu":this.player.recorder&&this.player.recorder.isRecording&&this.player._opt.recordType===Ze&&this.player.recorder.handleAddNaluTrack(s.buffer,s.isIFrame,s.ts,s.cts);break;case"playAudio":this.player.audio?(this.player.playing&&this.player.audio||!this.player.video)&&(this.player._opt.hasVideo||this.player.handleRender(),this.player._opt.playType===Ie||this.player._opt.playType===pe&&(_e(this.player.playbackPause)||!this.player.playback.isPlaybackPauseClearCache&&this.player.playback.isCacheBeforeDecodeForFpsRender&&this.player.playback.isUseFpsRender))&&this.player.audio.play(s.buffer,s.ts):e.warn("decoderWorker","onmessage playAudio but audio is null");break;case"workerFetch":if(s.type===N.streamSuccess)this.player.stream?this.player.stream.emit(N.streamSuccess):e.warn("decoderWorker","onmessage and workerFetch response stream success but stream is null");else if(s.type===N.streamRate)this.player.emit(N.kBps,(s.value/1024).toFixed(2));else if(s.type===N.streamEnd)this.player?(s.value===He&&this.player.emit(N.websocketClose),this.player.stream?this.player.stream.emit(N.streamEnd):e&&e.warn("decoderWorker","onmessage and workerFetch response stream end but player.stream is null")):e&&e.warn("decoderWorker","onmessage and workerFetch response stream end but player is null");else if(s.type===H.websocketError)this.player&&this.player.stream?this.player.stream.emit(H.websocketError,s.value):e&&e.warn("decoderWorker","onmessage and workerFetch response websocket error but stream is null");else if(s.type===H.fetchError)this.player&&this.player.stream?this.player.stream.emit(H.fetchError,s.value):e&&e.warn("decoderWorker","onmessage and workerFetch response fetch error but stream is null");else if(s.type===N.streamAbps)this.player.updateStats({abps:s.value});else if(s.type===N.streamVbps)this.player._times.demuxStart||(this.player._times.demuxStart=be()),this.player.updateStats({vbps:s.value});else if(s.type===N.streamDts)this.player.updateStats({dts:s.value});else if(s.type===N.netBuf)this.player.updateStats({netBuf:s.value});else if(s.type===N.networkDelayTimeout)this.player.emit(N.networkDelayTimeout,s.value);else if(s.type===N.streamStats){const u=JSON.parse(s.value);this.player.updateStats({workerStats:u})}else s.type===N.websocketOpen&&this.player.emit(N.websocketOpen);break;case"iframeIntervalTs":this.player&&(this.player.videoIframeIntervalTs=s.value);break;case"playbackStreamVideoFps":this.player&&this.player.video&&this.player.video.setStreamFps(s.value);break;case"wasmError":s.message&&s.message.indexOf("Invalid NAL unit size")!==-1&&this.player.emitError(H.wasmDecodeError,"");break;case"wasmDecodeVideoNoResponseError":this.player.emitError(H.wasmDecodeVideoNoResponseError);break;case"simdH264DecodeVideoWidthIsTooLarge":this.player.emitError(H.simdH264DecodeVideoWidthIsTooLarge);break;case"wasmWidthOrHeightChange":this.player.emitError(H.wasmWidthOrHeightChange);break;case Q:e.log("decoderWorker","onmessage:",Q),this._destroy();break;default:this.player[s.cmd]&&this.player[s.cmd](s)}}}_initWork(){var e={debug:this.player._opt.debug,debugLevel:this.player._opt.debugLevel,debugUuid:this.player._opt.debugUuid,useOffscreen:this.player._opt.useOffscreen,useWCS:this.player._opt.useWCS,videoBuffer:this.player._opt.videoBuffer,videoBufferDelay:this.player._opt.videoBufferDelay,openWebglAlignment:this.player._opt.openWebglAlignment,playType:this.player._opt.playType,hasAudio:this.player._opt.hasAudio,hasVideo:this.player._opt.hasVideo,playbackRate:1,playbackForwardMaxRateDecodeIFrame:this.player._opt.playbackForwardMaxRateDecodeIFrame,playbackIsCacheBeforeDecodeForFpsRender:this.player._opt.playbackConfig.isCacheBeforeDecodeForFpsRender,sampleRate:this.player.audio&&this.player.audio.audioContext&&this.player.audio.audioContext.sampleRate||0,audioBufferSize:this.player.audio&&this.player.audio.getAudioBufferSize()||1024,networkDelay:this.player._opt.networkDelay,visibility:this.player.visibility,useSIMD:this.player._opt.useSIMD,recordType:this.player._opt.recordType,isNakedFlow:this.player._opt.isNakedFlow,checkFirstIFrame:this.player._opt.checkFirstIFrame,isCrypto:this.player._opt.isCrypto,isHls265:this.player.isUseHls265(),isFmp4Private:this.player._opt.isFmp4Private};this.decoderWorker.postMessage({cmd:"init",opt:JSON.stringify(e)}),this.player._opt.isCrypto&&(this.updateWorkConfig({key:"cryptoKey",value:this.player._opt.cryptoKey}),this.updateWorkConfig({key:"cryptoIV",value:this.player._opt.cryptoIV}))}decodeVideo(e,i,s){this.player._opt.playType===Ie?this.player.isUseHls265()?this._decodeVideoNoDelay(e,i,s):this._decodeVideo(e,i,s):this.player._opt.playType===pe&&(this.player.video.rate>=this.player._opt.playbackForwardMaxRateDecodeIFrame?s&&(this.player.debug.log("decoderWorker",`current rate is ${this.player.video.rate},only decode i frame`),this._decodeVideoNoDelay(e,i,s)):this.player.video.rate===1?this._decodeVideo(e,i,s):this._decodeVideoNoDelay(e,i,s))}_decodeVideo(e,i,s){i={type:2,ts:Math.max(i,0),isIFrame:s},this.decoderWorker.postMessage({cmd:"decode",buffer:e,options:i},[e.buffer])}_decodeVideoNoDelay(e,i,s){this.decoderWorker.postMessage({cmd:"videoDecode",buffer:e,ts:Math.max(i,0),isIFrame:s},[e.buffer])}decodeAudio(e,i){this.player._opt.playType===Ie?this.player._opt.useWCS||this.player._opt.useMSE||this.player.isUseHls265()?this._decodeAudioNoDelay(e,i):this._decodeAudio(e,i):this.player._opt.playType===pe&&(this.player.video.rate===1?this._decodeAudio(e,i):this._decodeAudioNoDelay(e,i))}_decodeAudio(e,i){i={type:1,ts:Math.max(i,0)},this.decoderWorker.postMessage({cmd:"decode",buffer:e,options:i},[e.buffer])}_decodeAudioNoDelay(e,i){this.decoderWorker.postMessage({cmd:"audioDecode",buffer:e,ts:Math.max(i,0)},[e.buffer])}updateWorkConfig(e){this.decoderWorker&&this.decoderWorker.postMessage({cmd:"updateConfig",key:e.key,value:e.value})}workerFetchStream(e){var i=this.player._opt,i={protocol:i.protocol,isFlv:i.isFlv,isFmp4:i.isFmp4,isMpeg4:i.isMpeg4};this.decoderWorker.postMessage({cmd:"fetchStream",url:e,opt:JSON.stringify(i)})}clearWorkBuffer(){this.decoderWorker.postMessage({cmd:"clearBuffer",needClear:0<arguments.length&&arguments[0]!==void 0&&arguments[0]})}workerSendMessage(e){this.decoderWorker.postMessage({cmd:"sendWsMessage",message:e})}}class Qt extends Ae{constructor(e){super(),this.player=e,this.stopId=null,this.firstTimestamp=null,this.startTimestamp=null,this.preDelayTimestamp=null,this.preLoopTimestamp=null,this.bufferStartDts=null,this.bufferStartLocalTs=null,this.preIframeTs=null,this.preTimestamp=null,this.preTimestampDuration=0,this.prevPayloadBufferSize=0,this.isStreamTsMoreThanLocal=!1,this.delay=-1,this.pushLatestDelay=-1,this.bufferList=[],this.dropping=!1,this.isPushDropping=!1,this.initInterval(),this.player.debug.log("CommonDemux","init")}destroy(){this.bufferList=[],this.stopId&&(clearInterval(this.stopId),this.stopId=null),this.firstTimestamp=null,this.startTimestamp=null,this.bufferStartDts=null,this.bufferStartLocalTs=null,this.preDelayTimestamp=null,this.preLoopTimestamp=null,this.preIframeTs=null,this.preTimestamp=null,this.preTimestampDuration=0,this.prevPayloadBufferSize=0,this.isStreamTsMoreThanLocal=!1,this.delay=-1,this.pushLatestDelay=-1,this.dropping=!1,this.isPushDropping=!1,this.off(),this.player.debug.log("CommonDemux","destroy")}isDropping(){return this.dropping||this.isPushDropping}getDelay(e){var i,s;return e&&this.player.isDemuxDecodeFirstIIframeInit()?(this.preDelayTimestamp&&this.preDelayTimestamp>e?1e3<this.preDelayTimestamp-e&&this.player.debug.warn("CommonDemux",`getDelay and preDelayTimestamp is ${this.preDelayTimestamp} > timestamp is ${e} more than ${this.preDelayTimestamp-e}ms`):this.firstTimestamp?e&&(i=Date.now()-this.startTimestamp,(s=e-this.firstTimestamp)<=i?(this.isStreamTsMoreThanLocal=!1,this.delay=i-s):(this.isStreamTsMoreThanLocal=!0,this.delay=s-i)):(this.firstTimestamp=e,this.startTimestamp=Date.now(),this.delay=-1),this.preDelayTimestamp=e,this.delay):-1}getDelayNotUpdateDelay(e){if(e&&this.player.isDemuxDecodeFirstIIframeInit()){if(this.preDelayTimestamp&&1e3<this.preDelayTimestamp-e)this.player.debug.warn("CommonDemux",`getDelayNotUpdateDelay and preDelayTimestamp is ${this.preDelayTimestamp} > timestamp is ${e} more than ${this.preDelayTimestamp-e}ms`);else if(this.firstTimestamp){let s=-1;var i;return e&&(i=Date.now()-this.startTimestamp,e=e-this.firstTimestamp,s=e<=i?i-e:e-i),s}}return-1}resetDelay(){this.firstTimestamp=null,this.startTimestamp=null,this.delay=-1,this.dropping=!1}resetAllDelay(){this.resetDelay(),this.preDelayTimestamp=null}initInterval(){this.player.debug.log("CommonDemux","initInterval()"),this.player.isUseHls265()?this.player.debug.log("CommonDemux","initInterval() and is hls and support hls265 so return"):(this._loop(),this.stopId=setInterval(()=>{var e=new Date().getTime(),e=(this.preLoopTimestamp||(this.preLoopTimestamp=e),e-this.preLoopTimestamp);100<e&&this.player.debug.warn("CommonDemux","loop demux diff time is "+e),this._loop(),this.preLoopTimestamp=new Date().getTime()},10))}_loop(){let e;const i=this.player._opt.videoBuffer,s=this.player._opt.videoBufferDelay,u=this.player._opt.playType===Ie;if(this.bufferList.length)if(this.isPushDropping)this.player.debug.warn("CommonDemux","_loop isPushDropping is true and bufferList length is "+this.bufferList.length);else if(this.player._opt.useMSE&&this.player.mseDecoder&&this.player.mseDecoder.getSourceBufferUpdating())this.player.debug.warn("CommonDemux","_loop getSourceBufferUpdating is true and bufferList length is "+this.bufferList.length);else if(this.dropping){e=this.bufferList.shift();const c=this.getDelayNotUpdateDelay(e.ts);for(this.player.debug.warn("CommonDemux",`_loop is dropping and data.ts is ${e.ts}, data.isIFrame is ${e.isIFrame} tempDelay is ${c}, delay is `+this.delay);!e.isIFrame&&this.bufferList.length;)e=this.bufferList.shift();e.isIFrame&&c<=this.getNotDroppingDelayTs()&&(this.player.debug.log("CommonDemux","_loop data isIFrame is true and delay is "+this.delay),this.dropping=!1,this._doDecoderDecode(e))}else e=this.bufferList[0],this.getDelay(e.ts)===-1?(this.bufferList.shift(),this._doDecoderDecode(e)):this.delay>s+i&&u?this.hasIframeInBufferList()?(this.player.debug.warn("CommonDemux",`_loop delay is ${this.delay}, set dropping is true`),this.resetAllDelay(),this.dropping=!0):(this.bufferList.shift(),this._doDecoderDecode(e)):this.delay>i?(this.bufferList.shift(),this._doDecoderDecode(e)):this.delay<0&&this.player.debug.warn("CommonDemux",`_loop delay is ${this.delay} bufferList is `+this.bufferList);else this.delay!==-1&&this.player.debug.log("CommonDemux","loop() bufferList is empty and reset delay"),this.resetAllDelay()}_doDecode(e,i,s,u){var c=this.player,l={ts:s,cts:4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,type:i,isIFrame:!1};i===2&&c._opt.playType===Ie&&this.calcNetworkDelay(s),c._opt.useWCS&&!c._opt.useOffscreen||c._opt.useMSE?(i===2&&(l.isIFrame=u),this.pushBuffer(e,l)):i===2?c.decoderWorker&&c.decoderWorker.decodeVideo(e,s,u):i===1&&c._opt.hasAudio&&c.decoderWorker&&c.decoderWorker.decodeAudio(e,s)}_doDecodeByHls(e,i,s,u){var c=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,l=this.player,{webcodecsDecoder:o,mseDecoder:f}=l;i===2?l._opt.useWCS&&!l._opt.useOffscreen?o.decodeVideo(e,s,u,c):l._opt.useMSE?f.decodeVideo(e,s,u,c):l.decoderWorker&&l.decoderWorker.decodeVideo(e,s,u):i===1&&l._opt.hasAudio&&l.decoderWorker&&l.decoderWorker.decodeAudio(e,s)}_doDecodeByFmp4(e,i,s,u){this._doDecode(e,i,s,u,4<arguments.length&&arguments[4]!==void 0?arguments[4]:0)}_doDecoderDecode(e){var i=this.player,{webcodecsDecoder:s,mseDecoder:u}=i;e.type===1?i._opt.hasAudio&&i.decoderWorker&&i.decoderWorker.decodeAudio(e.payload,e.ts):e.type===2&&(i._opt.useWCS&&!i._opt.useOffscreen?s.decodeVideo(e.payload,e.ts,e.isIFrame,e.cts):i._opt.useMSE&&u.decodeVideo(e.payload,e.ts,e.isIFrame,e.cts))}pushBuffer(e,i){const s=this.player._opt.videoBuffer,u=this.player._opt.videoBufferDelay,c=this.player._opt.playType===Ie;if(i.type===1&&qs(e))this.player.debug.log("CommonDemux",`pushBuffer audio ts is ${i.ts}, isAacCodecPacket is `+qs(e)),this._doDecoderDecode({ts:i.ts,payload:e,type:1});else{if(0<this.preTimestampDuration&&0<this.preTimestamp&&i.type===2){const o=i.ts-this.preTimestamp;o>=2*this.preTimestampDuration-5&&this.player.debug.warn("CommonDemux",`pushBuffer video
                ts is ${i.ts}, preTimestamp is ${this.preTimestamp},
                diff is ${o} and preTimestampDuration is ${this.preTimestampDuration}
                maybe trigger black screen or flower screen`)}if(0<this.preTimestamp&&i.ts<this.preTimestamp&&i.type===2&&36e5<this.preTimestamp-i.ts&&(this.player.debug.warn("CommonDemux",`pushBuffer video
            ts is ${i.ts}, preTimestamp is ${this.preTimestamp},
            diff is ${this.preTimestamp-i.ts} more than 3600000
            and resetAllDelay()`),this.resetAllDelay()),i.ts<=this.preTimestamp&&0<this.preTimestamp&&i.type===2&&this.player.debug.warn("CommonDemux",`pushBuffer video
            ts is ${i.ts} less than (or equal) preTimestamp is ${this.preTimestamp} and
            payloadBufferSize is ${e.byteLength} and prevPayloadBufferSize is `+this.prevPayloadBufferSize),c&&this.player.isDemuxDecodeFirstIIframeInit()){var l=this.getDelayNotUpdateDelay(i.ts);this.pushLatestDelay=l;const o=u+s;this.player._opt.useMSE?l>o&&this.delay<o&&0<this.delay&&this.hasIframeInBufferList()&&this.isPushDropping===!1&&this.player.mseDecoder.getSourceBufferUpdating()===!1&&(this.player.debug.warn("CommonDemux",`useMSE, pushLatestDelay is ${l} > ${u+s}, bufferList is ${this.bufferList.length}, delay is ${this.delay} and dropBuffer$2()`),this.dropBuffer$2()):l>o&&this.delay<o&&0<this.delay&&this.hasIframeInBufferList()&&this.isPushDropping===!1&&(this.player.debug.warn("CommonDemux",`useWCS, pushLatestDelay is ${l} > ${u+s},bufferList is ${this.bufferList.length}, delay is ${this.delay} and dropBuffer$2()`),this.dropBuffer$2())}i.type===2&&(0<this.preTimestamp&&(this.preTimestampDuration=i.ts-this.preTimestamp),this.prevPayloadBufferSize=e.byteLength,this.preTimestamp=i.ts),i.type===1?this.bufferList.push({ts:i.ts,payload:e,type:1}):i.type===2&&this.bufferList.push({ts:i.ts,cts:i.cts,payload:e,type:2,isIFrame:i.isIFrame})}}dropBuffer$2(){if(0<this.bufferList.length){this.isPushDropping=!0;let u=this.bufferList.findIndex(c=>We(c.isIFrame)&&c.type===2);if(this.isAllIframeInBufferList())for(let c=0;c<this.bufferList.length;c++){var e=this.bufferList[c],e=this.getDelayNotUpdateDelay(e.ts);if(e>=this.getNotDroppingDelayTs()){this.player.debug.log("CommonDemux",`dropBuffer$2() isAllIframeInBufferList() is true, and index is ${c} and tempDelay is ${e} and notDroppingDelayTs is `+this.getNotDroppingDelayTs()),u=c;break}}var i,s;0<=u?(this.bufferList=this.bufferList.slice(u),i=this.bufferList.shift(),s=this.getDelayNotUpdateDelay(i.ts),this._doDecoderDecode(i),this.isPushDropping=!1,this.player.debug.log("CommonDemux",`dropBuffer$2() iFrameIndex is ${u},and bufferList length is ${this.bufferList.length} and tempDelay is ${s} ,delay is ${this.delay} `)):this.isPushDropping=!1}this.bufferList.length===0&&(this.isPushDropping=!1)}clearBuffer(){var e=0<arguments.length&&arguments[0]!==void 0&&arguments[0];this.player.debug.log("CommonDemux",`clearBuffer,buffer length is ${this.bufferList.length}, need clear is `+e),e&&(this.bufferList=[]),this.resetAllDelay(),this.dropping=!0}calcNetworkDelay(e){var i,s,u;this.player.isDemuxDecodeFirstIIframeInit()&&0<e&&(this.bufferStartDts===null?(this.bufferStartDts=e,this.bufferStartLocalTs=be()):e<this.bufferStartDts&&(this.player.debug.warn("CommonDemux",`calcNetworkDelay dts is ${e} and bufferStartDts is `+this.bufferStartDts),this.bufferStartDts=e,this.bufferStartLocalTs=be()),(u=(i=e-this.bufferStartDts)<(s=be()-this.bufferStartLocalTs)?s-i:0)>this.player._opt.networkDelay&&this.player._opt.playType===Ie&&(this.player.debug.warn("CommonDemux",`delay is more than networkDelay and now dts:${e},start dts is ${this.bufferStartDts}, vs start is ${i},local diff is ${s} ,delay is ${u}, _opt.networkDelay is `+this.player._opt.networkDelay),this.player.emit(N.networkDelayTimeout,u)),this.player.updateStats({netBuf:u}))}calcIframeIntervalTimestamp(e){var i;this.preIframeTs===null?this.preIframeTs=e:this.preIframeTs<e&&(i=e-this.preIframeTs,this.player&&(this.player.videoIframeIntervalTs=i),this.preIframeTs=e)}getNotDroppingDelayTs(){return this.player._opt.videoBuffer+this.player._opt.videoBufferDelay/2}getMaxDelayTs(){return this.player._opt.videoBuffer+this.player._opt.videoBufferDelay}getPushLatestDelay(){return this.pushLatestDelay}getVideoBufferLength(){let e=0;return this.bufferList.forEach(i=>{i.type===2&&(e+=1)}),e}hasIframeInBufferList(){return this.bufferList.some(e=>e.type===2&&e.isIFrame)}isAllIframeInBufferList(){var e=this.getVideoBufferLength();let i=0;return this.bufferList.forEach(s=>{s.type===2&&s.isIFrame&&(i+=1)}),e===i}getInputByteLength(){return 0}getIsStreamTsMoreThanLocal(){return this.isStreamTsMoreThanLocal}close(){}reset(){}}const ts=Symbol(32),is=Symbol(16),rs=Symbol(8);class Ar{constructor(e){this.g=e,this.consumed=0,e&&(this.need=e.next().value)}setG(e){this.g=e,this.demand(e.next().value,!0)}consume(){this.buffer&&this.consumed&&(this.buffer.copyWithin(0,this.consumed),this.buffer=this.buffer.subarray(0,this.buffer.length-this.consumed),this.consumed=0)}demand(e,i){return i&&this.consume(),this.need=e,this.flush()}read(e){return i=this,c=function*(){return this.lastReadPromise&&(yield this.lastReadPromise),this.lastReadPromise=new Promise((l,o)=>{this.reject=o,this.resolve=f=>{delete this.lastReadPromise,delete this.resolve,delete this.need,l(f)},this.demand(e,!0)||(o=this.pull)==null||o.call(this,e)})},new(u=(u=s=void 0)||Promise)(function(l,o){function f(T){try{g(c.next(T))}catch(E){o(E)}}function _(T){try{g(c.throw(T))}catch(E){o(E)}}function g(T){var E;T.done?l(T.value):((E=T.value)instanceof u?E:new u(function(h){h(E)})).then(f,_)}g((c=c.apply(i,s||[])).next())});var i,s,u,c}readU32(){return this.read(ts)}readU16(){return this.read(is)}readU8(){return this.read(rs)}close(){var e;this.g&&this.g.return(),this.buffer&&this.buffer.subarray(0,0),(e=this.reject)!=null&&e.call(this,new Error("EOF")),delete this.lastReadPromise}flush(){if(this.buffer&&this.need){let i=null;const s=this.buffer.subarray(this.consumed);let u=0;var e=c=>s.length<(u=c);if(typeof this.need=="number"){if(e(this.need))return;i=s.subarray(0,u)}else if(this.need===ts){if(e(4))return;i=s[0]<<24|s[1]<<16|s[2]<<8|s[3]}else if(this.need===is){if(e(2))return;i=s[0]<<8|s[1]}else if(this.need===rs){if(e(1))return;i=s[0]}else if("buffer"in this.need){if("byteOffset"in this.need){if(e(this.need.byteLength-this.need.byteOffset))return;new Uint8Array(this.need.buffer,this.need.byteOffset).set(s.subarray(0,u)),i=this.need}else if(this.g)return void this.g.throw(new Error("Unsupported type"))}else{if(e(this.need.byteLength))return;new Uint8Array(this.need).set(s.subarray(0,u)),i=this.need}return this.consumed+=u,this.g?this.demand(this.g.next(i).value,!0):this.resolve&&this.resolve(i),i}}write(e){if(e instanceof Uint8Array?this.malloc(e.length).set(e):"buffer"in e?this.malloc(e.byteLength).set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength)):this.malloc(e.byteLength).set(new Uint8Array(e)),!this.g&&!this.resolve)return new Promise(i=>this.pull=i);this.flush()}writeU32(e){this.malloc(4).set([e>>24&255,e>>16&255,e>>8&255,255&e]),this.flush()}writeU16(e){this.malloc(2).set([e>>8&255,255&e]),this.flush()}writeU8(e){this.malloc(1)[0]=e,this.flush()}malloc(e){if(this.buffer){var i=this.buffer.length,s=i+e;if(s<=this.buffer.buffer.byteLength-this.buffer.byteOffset)this.buffer=new Uint8Array(this.buffer.buffer,this.buffer.byteOffset,s);else{const u=new Uint8Array(s);u.set(this.buffer),this.buffer=u}return this.buffer.subarray(i,s)}return this.buffer=new Uint8Array(e),this.buffer}}Ar.U32=ts,Ar.U16=is,Ar.U8=rs;var br,ja="application/json, text/javascript",za="text/html",so=/^(?:text|application)\/xml/i,ao=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,no=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,oo=/^\s*$/,ss={},as={},Ga="",xi={type:"GET",beforeSend:Ft,success:Ft,error:Ft,complete:Ft,context:null,xhr:function(){return new window.XMLHttpRequest},accepts:{json:ja,xml:"application/xml, text/xml",html:za,text:"text/plain","*":"*/".concat("*")},crossDomain:!1,timeout:0,username:null,password:null,processData:!0,promise:Ft,contentType:"application/x-www-form-urlencoded; charset=UTF-8"};function Ft(){}function Ot(D,e){typeof D=="object"&&(e=D,D=void 0);var i,s=Li({},e=e||{});for(i in xi)s[i]===void 0&&(s[i]=xi[i]);try{var u={},g=new Promise(function(p,m){u.resolve=p,u.reject=m});g.resolve=u.resolve,g.reject=u.reject,s.promise=g}catch{s.promise={resolve:Ft,reject:Ft}}var c,l,o,f,_,g=no.exec(window.location.href.toLowerCase())||[],T=(s.url=((D||s.url||window.location.href)+"").replace(/#.*$/,"").replace(/^\/\//,g[1]+"//"),s.url),E=(s.crossDomain||(s.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(s.url)&&RegExp.$2!==window.location.href),s.dataType);if(E==="jsonp")return/=\?/.test(s.url)||(g=(s.jsonp||"callback")+"=?",s.url=ns(s.url,g)),o=(c=s).jsonpCallback||"jsonp"+ls(),f=window.document.createElement("script"),_={abort:function(){o in window&&(window[o]=Ft)}},g=window.document.getElementsByTagName("head")[0]||window.document.documentElement,f.onerror=function(d){d=d,window.clearTimeout(l),_.abort(),Ci(d.type,_,d.type,c),h()},window[o]=function(d){window.clearTimeout(l),Ha(d,_,c),h()},$a(c),f.src=c.url.replace(/=\?/,"="+o),f.src=ns(f.src,"_="+new Date().getTime()),f.async=!0,c.scriptCharset&&(f.charset=c.scriptCharset),g.insertBefore(f,g.firstChild),0<c.timeout&&(l=window.setTimeout(function(){_.abort(),Ci("timeout",_,"timeout",c),h()},c.timeout)),c.promise.abort=function(){_.abort()},c.promise.xhr=_,c.promise;function h(){f.clearAttributes?f.clearAttributes():f.onload=f.onreadystatechange=f.onerror=null,f.parentNode&&f.parentNode.removeChild(f),f=null,delete window[o]}$a(s);var n=s.accepts[E]||s.accepts["*"],k={};/^([\w-]+:)\/\//.test(s.url)?RegExp.$1:window.location.protocol;var t,r=xi.xhr(),n=(s.crossDomain||k["X-Requested-With"]||(k["X-Requested-With"]="XMLHttpRequest"),s.ifModified&&(ss[T]&&(k["If-Modified-Since"]=ss[T]),as[T])&&(k["If-None-Match"]=as[T]),n&&(-1<(k.Accept=n).indexOf(",")&&(n=n.split(",",2)[0]),r.overrideMimeType)&&r.overrideMimeType(n),!/^(?:GET|HEAD)$/.test(s.type.toUpperCase())),n=((s.data&&n&&s.contentType!==!1||e.contentType)&&(k["Content-Type"]=s.contentType),s.cache!==!1||n||(s.url=(e=/([?&])_=[^&]*/).test(T)?T.replace(e,"$1_="+ls()):T+(/\?/.test(T)?"&":"?")+"_="+ls()),s.headers=Li(k,s.headers||{}),r.onreadystatechange=function(){if(r.readyState===4){clearTimeout(t);var d,p=!1;if(200<=r.status&&r.status<300||r.status===304){Ga=r.getAllResponseHeaders(),s.ifModified&&((m=Wa("Last-Modified"))&&(ss[T]=m),m=Wa("etag"))&&(as[T]=m),E=E||(m=r.getResponseHeader("content-type"))&&(m===za?"html":m===ja?"json":so.test(m)&&"xml")||"text",d=r.responseText;try{E==="xml"?d=r.responseXML:E==="json"&&(d=oo.test(d)?null:JSON.parse(d))}catch(x){p=x}p?Ci(p,"parseerror",r,s):Ha(d,r,s)}else Ci(null,"error",r,s)}var m},!("async"in s)||s.async);if(r.open(s.type,s.url,n,s.username,s.password),s.xhrFields)for(var a in s.xhrFields)r[a]=s.xhrFields[a];for(a in s.mimeType&&r.overrideMimeType&&r.overrideMimeType(s.mimeType),s.headers)s.headers[a]!==void 0&&r.setRequestHeader(a,s.headers[a]+"");return(function(d){var p=d.context;if(d.beforeSend.call(p,r,d)===!1)return!1})(s)===!1?(r.abort(),!1):(0<s.timeout&&(t=window.setTimeout(function(){r.onreadystatechange=Ft,r.abort(),Ci(null,"timeout",r,s)},s.timeout)),r.send(s.data||null),s.promise.abort=function(){r.abort()},s.promise)}function Ha(D,e,i){var s=i.context,u="success";i.success.call(s,D,u,e),i.promise.resolve(D,u,e),Va(u,e,i)}function Va(D,e,i){var s=i.context;i.complete.call(s,e,D)}function Ci(D,e,i,s){var u=s.context;s.error.call(u,i,e,D),s.promise.reject(i,e,D),Va(e,i,s)}function Wa(D){var e;if(!br){for(br={};e=ao.exec(Ga);)br[e[1].toLowerCase()]=e[2];e=br[D.toLowerCase()]}return e===null?null:e}function ns(D,e){return(D+"&"+e).replace(/[&?]{1,2}/,"?")}function $a(D){var e,i;!Ka(D)||D.data instanceof FormData||!D.processData||(D.data=(e=D.data,(i=[]).add=function(s,u){this.push(encodeURIComponent(s)+"="+encodeURIComponent(u))},(function s(u,c,l,o){var f=(function(T){return Object.prototype.toString.call(T)==="[object Array]"})(c);for(var _ in c){var g=c[_];o&&(_=o+"["+(f?"":_)+"]"),!o&&f?u.add(g.name,g.value):Ka(g)?s(u,g,l,_):u.add(_,g)}})(i,e,void 0),i.join("&").replace("%20","+"))),!D.data||D.type&&D.type.toUpperCase()!=="GET"||(D.url=ns(D.url,D.data))}function Li(D){for(var e=Array.prototype.slice.call(arguments,1),i=0,s=e.length;i<s;i++){var u,c=e[i]||{};for(u in c)c.hasOwnProperty(u)&&c[u]!==void 0&&(D[u]=c[u])}return D}function Ka(D){var e=typeof D;return e=="function"||e=="object"&&!!D}function os(D){return typeof D=="function"}function ls(){return new Date().getTime()}function hs(D){return parseInt(D)===D}function qa(D){if(hs(D.length)){for(var e=0;e<D.length;e++)if(!hs(D[e])||D[e]<0||255<D[e])return;return 1}}function ut(D,e){if(D.buffer&&D.name==="Uint8Array")return D=e?D.slice?D.slice():Array.prototype.slice.call(D):D;if(Array.isArray(D)){if(qa(D))return new Uint8Array(D);throw new Error("Array contains invalid value: "+D)}if(hs(D.length)&&qa(D))return new Uint8Array(D);throw new Error("unsupported array-like object")}function nt(D){return new Uint8Array(D)}function gt(D,e,i,s,u){s==null&&u==null||(D=D.slice?D.slice(s,u):Array.prototype.slice.call(D,s,u)),e.set(D,i)}Ot.get=function(D,e,i,s){return os(e)&&(s=s||i,i=e,e=void 0),Ot({url:D,data:e,success:i,dataType:s})},Ot.post=function(D,e,i,s){return os(e)&&(s=s||i,i=e,e=void 0),Ot({type:"POST",url:D,data:e,success:i,dataType:s})},Ot.getJSON=function(D,e,i){return os(e)&&(i=e,e=void 0),Ot({url:D,data:e,success:i,dataType:"json"})},Ot.ajaxSetup=function(D,e){return e?Li(Li(D,xi),e):Li(xi,D)};var ds,Di={},Ri=(ds="0123456789abcdef",{toBytes:function(D){for(var e=[],i=0;i<D.length;i+=2)e.push(parseInt(D.substr(i,2),16));return e},fromBytes:function(D){for(var e=[],i=0;i<D.length;i++){var s=D[i];e.push(ds[(240&s)>>4]+ds[15&s])}return e.join("")}}),lo={16:10,24:12,32:14},ho=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],yt=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],vr=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125],uo=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],co=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],po=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],fo=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],mo=[1374988112,2118214995,437757123,975658646,1001089995,530400753,2902087851,1273168787,540080725,2910219766,2295101073,4110568485,1340463100,3307916247,641025152,3043140495,3736164937,632953703,1172967064,1576976609,3274667266,2169303058,2370213795,1809054150,59727847,361929877,3211623147,2505202138,3569255213,1484005843,1239443753,2395588676,1975683434,4102977912,2572697195,666464733,3202437046,4035489047,3374361702,2110667444,1675577880,3843699074,2538681184,1649639237,2976151520,3144396420,4269907996,4178062228,1883793496,2403728665,2497604743,1383856311,2876494627,1917518562,3810496343,1716890410,3001755655,800440835,2261089178,3543599269,807962610,599762354,33778362,3977675356,2328828971,2809771154,4077384432,1315562145,1708848333,101039829,3509871135,3299278474,875451293,2733856160,92987698,2767645557,193195065,1080094634,1584504582,3178106961,1042385657,2531067453,3711829422,1306967366,2438237621,1908694277,67556463,1615861247,429456164,3602770327,2302690252,1742315127,2968011453,126454664,3877198648,2043211483,2709260871,2084704233,4169408201,0,159417987,841739592,504459436,1817866830,4245618683,260388950,1034867998,908933415,168810852,1750902305,2606453969,607530554,202008497,2472011535,3035535058,463180190,2160117071,1641816226,1517767529,470948374,3801332234,3231722213,1008918595,303765277,235474187,4069246893,766945465,337553864,1475418501,2943682380,4003061179,2743034109,4144047775,1551037884,1147550661,1543208500,2336434550,3408119516,3069049960,3102011747,3610369226,1113818384,328671808,2227573024,2236228733,3535486456,2935566865,3341394285,496906059,3702665459,226906860,2009195472,733156972,2842737049,294930682,1206477858,2835123396,2700099354,1451044056,573804783,2269728455,3644379585,2362090238,2564033334,2801107407,2776292904,3669462566,1068351396,742039012,1350078989,1784663195,1417561698,4136440770,2430122216,775550814,2193862645,2673705150,1775276924,1876241833,3475313331,3366754619,270040487,3902563182,3678124923,3441850377,1851332852,3969562369,2203032232,3868552805,2868897406,566021896,4011190502,3135740889,1248802510,3936291284,699432150,832877231,708780849,3332740144,899835584,1951317047,4236429990,3767586992,866637845,4043610186,1106041591,2144161806,395441711,1984812685,1139781709,3433712980,3835036895,2664543715,1282050075,3240894392,1181045119,2640243204,25965917,4203181171,4211818798,3009879386,2463879762,3910161971,1842759443,2597806476,933301370,1509430414,3943906441,3467192302,3076639029,3776767469,2051518780,2631065433,1441952575,404016761,1942435775,1408749034,1610459739,3745345300,2017778566,3400528769,3110650942,941896748,3265478751,371049330,3168937228,675039627,4279080257,967311729,135050206,3635733660,1683407248,2076935265,3576870512,1215061108,3501741890],go=[1347548327,1400783205,3273267108,2520393566,3409685355,4045380933,2880240216,2471224067,1428173050,4138563181,2441661558,636813900,4233094615,3620022987,2149987652,2411029155,1239331162,1730525723,2554718734,3781033664,46346101,310463728,2743944855,3328955385,3875770207,2501218972,3955191162,3667219033,768917123,3545789473,692707433,1150208456,1786102409,2029293177,1805211710,3710368113,3065962831,401639597,1724457132,3028143674,409198410,2196052529,1620529459,1164071807,3769721975,2226875310,486441376,2499348523,1483753576,428819965,2274680428,3075636216,598438867,3799141122,1474502543,711349675,129166120,53458370,2592523643,2782082824,4063242375,2988687269,3120694122,1559041666,730517276,2460449204,4042459122,2706270690,3446004468,3573941694,533804130,2328143614,2637442643,2695033685,839224033,1973745387,957055980,2856345839,106852767,1371368976,4181598602,1033297158,2933734917,1179510461,3046200461,91341917,1862534868,4284502037,605657339,2547432937,3431546947,2003294622,3182487618,2282195339,954669403,3682191598,1201765386,3917234703,3388507166,0,2198438022,1211247597,2887651696,1315723890,4227665663,1443857720,507358933,657861945,1678381017,560487590,3516619604,975451694,2970356327,261314535,3535072918,2652609425,1333838021,2724322336,1767536459,370938394,182621114,3854606378,1128014560,487725847,185469197,2918353863,3106780840,3356761769,2237133081,1286567175,3152976349,4255350624,2683765030,3160175349,3309594171,878443390,1988838185,3704300486,1756818940,1673061617,3403100636,272786309,1075025698,545572369,2105887268,4174560061,296679730,1841768865,1260232239,4091327024,3960309330,3497509347,1814803222,2578018489,4195456072,575138148,3299409036,446754879,3629546796,4011996048,3347532110,3252238545,4270639778,915985419,3483825537,681933534,651868046,2755636671,3828103837,223377554,2607439820,1649704518,3270937875,3901806776,1580087799,4118987695,3198115200,2087309459,2842678573,3016697106,1003007129,2802849917,1860738147,2077965243,164439672,4100872472,32283319,2827177882,1709610350,2125135846,136428751,3874428392,3652904859,3460984630,3572145929,3593056380,2939266226,824852259,818324884,3224740454,930369212,2801566410,2967507152,355706840,1257309336,4148292826,243256656,790073846,2373340630,1296297904,1422699085,3756299780,3818836405,457992840,3099667487,2135319889,77422314,1560382517,1945798516,788204353,1521706781,1385356242,870912086,325965383,2358957921,2050466060,2388260884,2313884476,4006521127,901210569,3990953189,1014646705,1503449823,1062597235,2031621326,3212035895,3931371469,1533017514,350174575,2256028891,2177544179,1052338372,741876788,1606591296,1914052035,213705253,2334669897,1107234197,1899603969,3725069491,2631447780,2422494913,1635502980,1893020342,1950903388,1120974935],yo=[2807058932,1699970625,2764249623,1586903591,1808481195,1173430173,1487645946,59984867,4199882800,1844882806,1989249228,1277555970,3623636965,3419915562,1149249077,2744104290,1514790577,459744698,244860394,3235995134,1963115311,4027744588,2544078150,4190530515,1608975247,2627016082,2062270317,1507497298,2200818878,567498868,1764313568,3359936201,2305455554,2037970062,1047239e3,1910319033,1337376481,2904027272,2892417312,984907214,1243112415,830661914,861968209,2135253587,2011214180,2927934315,2686254721,731183368,1750626376,4246310725,1820824798,4172763771,3542330227,48394827,2404901663,2871682645,671593195,3254988725,2073724613,145085239,2280796200,2779915199,1790575107,2187128086,472615631,3029510009,4075877127,3802222185,4107101658,3201631749,1646252340,4270507174,1402811438,1436590835,3778151818,3950355702,3963161475,4020912224,2667994737,273792366,2331590177,104699613,95345982,3175501286,2377486676,1560637892,3564045318,369057872,4213447064,3919042237,1137477952,2658625497,1119727848,2340947849,1530455833,4007360968,172466556,266959938,516552836,0,2256734592,3980931627,1890328081,1917742170,4294704398,945164165,3575528878,958871085,3647212047,2787207260,1423022939,775562294,1739656202,3876557655,2530391278,2443058075,3310321856,547512796,1265195639,437656594,3121275539,719700128,3762502690,387781147,218828297,3350065803,2830708150,2848461854,428169201,122466165,3720081049,1627235199,648017665,4122762354,1002783846,2117360635,695634755,3336358691,4234721005,4049844452,3704280881,2232435299,574624663,287343814,612205898,1039717051,840019705,2708326185,793451934,821288114,1391201670,3822090177,376187827,3113855344,1224348052,1679968233,2361698556,1058709744,752375421,2431590963,1321699145,3519142200,2734591178,188127444,2177869557,3727205754,2384911031,3215212461,2648976442,2450346104,3432737375,1180849278,331544205,3102249176,4150144569,2952102595,2159976285,2474404304,766078933,313773861,2570832044,2108100632,1668212892,3145456443,2013908262,418672217,3070356634,2594734927,1852171925,3867060991,3473416636,3907448597,2614737639,919489135,164948639,2094410160,2997825956,590424639,2486224549,1723872674,3157750862,3399941250,3501252752,3625268135,2555048196,3673637356,1343127501,4130281361,3599595085,2957853679,1297403050,81781910,3051593425,2283490410,532201772,1367295589,3926170974,895287692,1953757831,1093597963,492483431,3528626907,1446242576,1192455638,1636604631,209336225,344873464,1015671571,669961897,3375740769,3857572124,2973530695,3747192018,1933530610,3464042516,935293895,3454686199,2858115069,1863638845,3683022916,4085369519,3292445032,875313188,1080017571,3279033885,621591778,1233856572,2504130317,24197544,3017672716,3835484340,3247465558,2220981195,3060847922,1551124588,1463996600],Ao=[4104605777,1097159550,396673818,660510266,2875968315,2638606623,4200115116,3808662347,821712160,1986918061,3430322568,38544885,3856137295,718002117,893681702,1654886325,2975484382,3122358053,3926825029,4274053469,796197571,1290801793,1184342925,3556361835,2405426947,2459735317,1836772287,1381620373,3196267988,1948373848,3764988233,3385345166,3263785589,2390325492,1480485785,3111247143,3780097726,2293045232,548169417,3459953789,3746175075,439452389,1362321559,1400849762,1685577905,1806599355,2174754046,137073913,1214797936,1174215055,3731654548,2079897426,1943217067,1258480242,529487843,1437280870,3945269170,3049390895,3313212038,923313619,679998e3,3215307299,57326082,377642221,3474729866,2041877159,133361907,1776460110,3673476453,96392454,878845905,2801699524,777231668,4082475170,2330014213,4142626212,2213296395,1626319424,1906247262,1846563261,562755902,3708173718,1040559837,3871163981,1418573201,3294430577,114585348,1343618912,2566595609,3186202582,1078185097,3651041127,3896688048,2307622919,425408743,3371096953,2081048481,1108339068,2216610296,0,2156299017,736970802,292596766,1517440620,251657213,2235061775,2933202493,758720310,265905162,1554391400,1532285339,908999204,174567692,1474760595,4002861748,2610011675,3234156416,3693126241,2001430874,303699484,2478443234,2687165888,585122620,454499602,151849742,2345119218,3064510765,514443284,4044981591,1963412655,2581445614,2137062819,19308535,1928707164,1715193156,4219352155,1126790795,600235211,3992742070,3841024952,836553431,1669664834,2535604243,3323011204,1243905413,3141400786,4180808110,698445255,2653899549,2989552604,2253581325,3252932727,3004591147,1891211689,2487810577,3915653703,4237083816,4030667424,2100090966,865136418,1229899655,953270745,3399679628,3557504664,4118925222,2061379749,3079546586,2915017791,983426092,2022837584,1607244650,2118541908,2366882550,3635996816,972512814,3283088770,1568718495,3499326569,3576539503,621982671,2895723464,410887952,2623762152,1002142683,645401037,1494807662,2595684844,1335535747,2507040230,4293295786,3167684641,367585007,3885750714,1865862730,2668221674,2960971305,2763173681,1059270954,2777952454,2724642869,1320957812,2194319100,2429595872,2815956275,77089521,3973773121,3444575871,2448830231,1305906550,4021308739,2857194700,2516901860,3518358430,1787304780,740276417,1699839814,1592394909,2352307457,2272556026,188821243,1729977011,3687994002,274084841,3594982253,3613494426,2701949495,4162096729,322734571,2837966542,1640576439,484830689,1202797690,3537852828,4067639125,349075736,3342319475,4157467219,4255800159,1030690015,1155237496,2951971274,1757691577,607398968,2738905026,499347990,3794078908,1011452712,227885567,2818666809,213114376,3034881240,1455525988,3414450555,850817237,1817998408,3092726480],bo=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],vo=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],_o=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],wo=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];function us(D){for(var e=[],i=0;i<D.length;i+=4)e.push(D[i]<<24|D[i+1]<<16|D[i+2]<<8|D[i+3]);return e}var Nt=function(D){if(!(this instanceof Nt))throw Error("AES must be instanitated with `new`");Object.defineProperty(this,"key",{value:ut(D,!0)}),this._prepare()},cs=(Nt.prototype._prepare=function(){var D=lo[this.key.length];if(D==null)throw new Error("invalid key size (must be 16, 24 or 32 bytes)");this._Ke=[],this._Kd=[];for(var e=0;e<=D;e++)this._Ke.push([0,0,0,0]),this._Kd.push([0,0,0,0]);for(var i,s=4*(D+1),u=this.key.length/4,c=us(this.key),e=0;e<u;e++)this._Ke[i=e>>2][e%4]=c[e],this._Kd[D-i][e%4]=c[e];for(var l,o=0,f=u;f<s;){if(l=c[u-1],c[0]^=yt[l>>16&255]<<24^yt[l>>8&255]<<16^yt[255&l]<<8^yt[l>>24&255]^ho[o]<<24,o+=1,u!=8)for(e=1;e<u;e++)c[e]^=c[e-1];else{for(e=1;e<u/2;e++)c[e]^=c[e-1];for(l=c[u/2-1],c[u/2]^=yt[255&l]^yt[l>>8&255]<<8^yt[l>>16&255]<<16^yt[l>>24&255]<<24,e=u/2+1;e<u;e++)c[e]^=c[e-1]}for(e=0;e<u&&f<s;)this._Ke[_=f>>2][g=f%4]=c[e],this._Kd[D-_][g]=c[e++],f++}for(var _=1;_<D;_++)for(var g=0;g<4;g++)l=this._Kd[_][g],this._Kd[_][g]=bo[l>>24&255]^vo[l>>16&255]^_o[l>>8&255]^wo[255&l]},Nt.prototype.encrypt=function(D){if(D.length!=16)throw new Error("invalid plaintext size (must be 16 bytes)");for(var e=this._Ke.length-1,i=[0,0,0,0],s=us(D),u=0;u<4;u++)s[u]^=this._Ke[0][u];for(var c=1;c<e;c++){for(u=0;u<4;u++)i[u]=uo[s[u]>>24&255]^co[s[(u+1)%4]>>16&255]^po[s[(u+2)%4]>>8&255]^fo[255&s[(u+3)%4]]^this._Ke[c][u];s=i.slice()}for(var l,o=nt(16),u=0;u<4;u++)l=this._Ke[e][u],o[4*u]=255&(yt[s[u]>>24&255]^l>>24),o[4*u+1]=255&(yt[s[(u+1)%4]>>16&255]^l>>16),o[4*u+2]=255&(yt[s[(u+2)%4]>>8&255]^l>>8),o[4*u+3]=255&(yt[255&s[(u+3)%4]]^l);return o},Nt.prototype.decrypt=function(D){if(D.length!=16)throw new Error("invalid ciphertext size (must be 16 bytes)");for(var e=this._Kd.length-1,i=[0,0,0,0],s=us(D),u=0;u<4;u++)s[u]^=this._Kd[0][u];for(var c=1;c<e;c++){for(u=0;u<4;u++)i[u]=mo[s[u]>>24&255]^go[s[(u+3)%4]>>16&255]^yo[s[(u+2)%4]>>8&255]^Ao[255&s[(u+1)%4]]^this._Kd[c][u];s=i.slice()}for(var l,o=nt(16),u=0;u<4;u++)l=this._Kd[e][u],o[4*u]=255&(vr[s[u]>>24&255]^l>>24),o[4*u+1]=255&(vr[s[(u+3)%4]>>16&255]^l>>16),o[4*u+2]=255&(vr[s[(u+2)%4]>>8&255]^l>>8),o[4*u+3]=255&(vr[255&s[(u+1)%4]]^l);return o},function(D){if(!(this instanceof cs))throw Error("AES must be instanitated with `new`");this.description="Electronic Code Block",this.name="ecb",this._aes=new Nt(D)}),ps=(cs.prototype.encrypt=function(D){if((D=ut(D)).length%16!=0)throw new Error("invalid plaintext size (must be multiple of 16 bytes)");for(var e=nt(D.length),i=nt(16),s=0;s<D.length;s+=16)gt(D,i,0,s,s+16),gt(i=this._aes.encrypt(i),e,s);return e},cs.prototype.decrypt=function(D){if((D=ut(D)).length%16!=0)throw new Error("invalid ciphertext size (must be multiple of 16 bytes)");for(var e=nt(D.length),i=nt(16),s=0;s<D.length;s+=16)gt(D,i,0,s,s+16),gt(i=this._aes.decrypt(i),e,s);return e},function(D,e){if(!(this instanceof ps))throw Error("AES must be instanitated with `new`");if(this.description="Cipher Block Chaining",this.name="cbc",e){if(e.length!=16)throw new Error("invalid initialation vector size (must be 16 bytes)")}else e=nt(16);this._lastCipherblock=ut(e,!0),this._aes=new Nt(D)}),fs=(ps.prototype.encrypt=function(D){if((D=ut(D)).length%16!=0)throw new Error("invalid plaintext size (must be multiple of 16 bytes)");for(var e=nt(D.length),i=nt(16),s=0;s<D.length;s+=16){gt(D,i,0,s,s+16);for(var u=0;u<16;u++)i[u]^=this._lastCipherblock[u];this._lastCipherblock=this._aes.encrypt(i),gt(this._lastCipherblock,e,s)}return e},ps.prototype.decrypt=function(D){if((D=ut(D)).length%16!=0)throw new Error("invalid ciphertext size (must be multiple of 16 bytes)");for(var e=nt(D.length),i=nt(16),s=0;s<D.length;s+=16){gt(D,i,0,s,s+16);for(var i=this._aes.decrypt(i),u=0;u<16;u++)e[s+u]=i[u]^this._lastCipherblock[u];gt(D,this._lastCipherblock,0,s,s+16)}return e},function(D,e,i){if(!(this instanceof fs))throw Error("AES must be instanitated with `new`");if(this.description="Cipher Feedback",this.name="cfb",e){if(e.length!=16)throw new Error("invalid initialation vector size (must be 16 size)")}else e=nt(16);this.segmentSize=i=i||1,this._shiftRegister=ut(e,!0),this._aes=new Nt(D)}),_r=(fs.prototype.encrypt=function(D){if(D.length%this.segmentSize!=0)throw new Error("invalid plaintext size (must be segmentSize bytes)");for(var e=ut(D,!0),i=0;i<e.length;i+=this.segmentSize){for(var s=this._aes.encrypt(this._shiftRegister),u=0;u<this.segmentSize;u++)e[i+u]^=s[u];gt(this._shiftRegister,this._shiftRegister,0,this.segmentSize),gt(e,this._shiftRegister,16-this.segmentSize,i,i+this.segmentSize)}return e},fs.prototype.decrypt=function(D){if(D.length%this.segmentSize!=0)throw new Error("invalid ciphertext size (must be segmentSize bytes)");for(var e=ut(D,!0),i=0;i<e.length;i+=this.segmentSize){for(var s=this._aes.encrypt(this._shiftRegister),u=0;u<this.segmentSize;u++)e[i+u]^=s[u];gt(this._shiftRegister,this._shiftRegister,0,this.segmentSize),gt(D,this._shiftRegister,16-this.segmentSize,i,i+this.segmentSize)}return e},function(D,e){if(!(this instanceof _r))throw Error("AES must be instanitated with `new`");if(this.description="Output Feedback",this.name="ofb",e){if(e.length!=16)throw new Error("invalid initialation vector size (must be 16 bytes)")}else e=nt(16);this._lastPrecipher=ut(e,!0),this._lastPrecipherIndex=16,this._aes=new Nt(D)}),Xt=(_r.prototype.encrypt=function(D){for(var e=ut(D,!0),i=0;i<e.length;i++)this._lastPrecipherIndex===16&&(this._lastPrecipher=this._aes.encrypt(this._lastPrecipher),this._lastPrecipherIndex=0),e[i]^=this._lastPrecipher[this._lastPrecipherIndex++];return e},_r.prototype.decrypt=_r.prototype.encrypt,function(D){if(!(this instanceof Xt))throw Error("Counter must be instanitated with `new`");typeof(D=D!==0?D||1:D)=="number"?(this._counter=nt(16),this.setValue(D)):this.setBytes(D)}),Ii=(Xt.prototype.setValue=function(D){if(typeof D!="number"||parseInt(D)!=D)throw new Error("invalid counter value (must be an integer)");if(D>Number.MAX_SAFE_INTEGER)throw new Error("integer value out of safe range");for(var e=15;0<=e;--e)this._counter[e]=D%256,D=parseInt(D/256)},Xt.prototype.setBytes=function(D){if((D=ut(D,!0)).length!=16)throw new Error("invalid counter bytes size (must be 16 bytes)");this._counter=D},Xt.prototype.increment=function(){for(var D=15;0<=D;D--){if(this._counter[D]!==255){this._counter[D]++;break}this._counter[D]=0}},function(D,e){if(!(this instanceof Ii))throw Error("AES must be instanitated with `new`");this.description="Counter",this.name="ctr",e instanceof Xt||(e=new Xt(e)),this._counter=e,this._remainingCounter=null,this._remainingCounterIndex=16,this._aes=new Nt(D)});Ii.prototype.encrypt=function(D){for(var e=ut(D,!0),i=0;i<e.length;i++)this._remainingCounterIndex===16&&(this._remainingCounter=this._aes.encrypt(this._counter._counter),this._remainingCounterIndex=0,this._counter.increment()),e[i]^=this._remainingCounter[this._remainingCounterIndex++];return e},Ii.prototype.decrypt=Ii.prototype.encrypt;const Ya={Counter:Xt,ModeOfOperation:{ctr:Ii}};class Ja extends Qt{constructor(e){super(e),this.input=new Ar(this.demux()),e.debug.log("FlvDemux","init")}destroy(){super.destroy(),this.input=null,this.player.debug.log("FlvDemux","destroy")}dispatch(e){this.input?this.input.write(e):this.player&&this.player.debug.warn("FlvDemux","dispatch() this.input is null")}*demux(){yield 9;const e=new ArrayBuffer(4),i=new Uint8Array(e),s=new Uint32Array(e),u=this.player;for(;;){if(!this.input)return;i[3]=0;const _=yield 15,g=_[4];i[0]=_[7],i[1]=_[6],i[2]=_[5];var c=s[0],l=(i[0]=_[10],i[1]=_[9],i[2]=_[8],i[3]=_[11],s[0]),o=(yield c).slice();if(!u)return;switch(g){case 8:u._opt.hasAudio&&(u.updateStats({abps:o.byteLength}),0<o.byteLength)&&this._doDecode(o,1,l);break;case 9:if(u._opt.hasVideo){u.updateStats({vbps:o.byteLength,dts:l});const T=o[0]>>4&15,E=T==1;if(T!=1&&T!=2&&u.debug.warn("FlvDemux",`frameType is ${T} is not keyFrame or interFrame`),E&&this.calcIframeIntervalTimestamp(l),0<o.byteLength){s[0]=o[4],s[1]=o[3],s[2]=o[2],s[3]=0;var f=s[0];u._times.demuxStart||(u._times.demuxStart=be());let h=o;u._opt.isCrypto&&(u._opt.cryptoKey&&0<u._opt.cryptoKey.byteLength&&u._opt.cryptoIV&&0<u._opt.cryptoIV.byteLength?h=(function(k,t,r){t=new Uint8Array(t),r=new Uint8Array(r);const n=k.byteLength;let a=5;for(;a<n&&(p=(p=k.slice(a,a+4))[3]|p[2]<<8|p[1]<<16|p[0]<<24,!(p>n));){var d=k[a+4];if((d&=31)==1||d==5){const m=k.slice(a+4+2,a+4+p);let x=new Ya.ModeOfOperation.ctr(t,new Ya.Counter(r));d=x.decrypt(m),x=null,k.set(d,a+4+2)}a=a+4+p}var p;return k})(o,u._opt.cryptoKey,u._opt.cryptoIV):u.debug.error("FlvDemux",`cryptoKey.length is ${u._opt.cryptoKey&&u._opt.cryptoKey.byteLength} or cryptoIV.length is ${u._opt.cryptoIV&&u._opt.cryptoIV.byteLength} null`)),this._doDecode(h,2,l,E,f)}}break;default:u.debug.log("FlvDemux","demux() type is "+g)}}}close(){this.input=null}getInputByteLength(){let e=0;return e=this.input&&this.input.buffer?this.input.buffer.byteLength:e}}class So extends Qt{constructor(e){super(e),e.debug.log("M7sDemux","init")}destroy(){super.destroy(),this.player.debug.log("M7sDemux","destroy")}dispatch(e){const i=this.player,s=new DataView(e),u=s.getUint8(0),c=s.getUint32(1,!1);switch(u){case 1:if(i._opt.hasAudio){const f=new Uint8Array(e,5);i.updateStats({abps:f.byteLength}),0<f.byteLength&&this._doDecode(f,u,c)}break;case 2:if(i._opt.hasVideo)if(i._times.demuxStart||(i._times.demuxStart=be()),5<s.byteLength){var l=new Uint8Array(e,5),o=s.getUint8(5)>>4==1;let f=c;this.player._opt.useMSE&&Ue(this.player.mseDecoder.firstRenderTime)&&(f=c-this.player.mseDecoder.firstRenderTime),i.updateStats({vbps:l.byteLength,dts:f}),0<l.byteLength&&(o&&this.calcIframeIntervalTimestamp(c),this._doDecode(l,u,c,o))}else this.player.debug.warn("M7sDemux","dispatch","dv byteLength is",s.byteLength)}}}class Eo extends Ja{constructor(e){super(e),e.debug.log("WebTransportDemux","init")}destroy(){this.player.debug.log("WebTransportDemux","destroy"),super.destroy()}}class To extends Qt{TAG_NAME="NakedFlowDemux";constructor(e){super(e),this.lastBuf=null,this.vps=null,this.sps=null,this.pps=null,this.streamVideoType=null,this.streamAudioType=null,this.tempNaluBufferList=new Uint8Array(0),this.localDts=0,this.isSendSeqHeader=!1,this.isSendAACSeqHeader=!1,e.debug.log(this.TAG_NAME,"init")}destroy(){super.destroy(),this.lastBuf=null,this.vps=null,this.sps=null,this.pps=null,this.streamVideoType=null,this.streamAudioType=null,this.tempNaluBufferList=new Uint8Array(0),this.localDts=0,this.localAudioDts=0,this.isSendSeqHeader=!1,this.isSendAACSeqHeader=!1,this.player.debug.log(this.TAG_NAME,"destroy")}dispatch(e){this.player,e=new Uint8Array(e),this.extractNALu$2(e)}addNaluToBuffer(e){var i=e.byteLength+this.tempNaluBufferList.byteLength,i=new Uint8Array(i);i.set(this.tempNaluBufferList,0),i.set(e,this.tempNaluBufferList.byteLength),this.tempNaluBufferList=i}downloadNakedFlowFile(){var e=new Blob([this.tempNaluBufferList]);try{var i=document.createElement("a");i.href=window.URL.createObjectURL(e),i.download=Date.now()+".h264",i.click()}catch(s){console.error("downloadTempNalu",s)}}getNaluDts(){var e=this.player._opt.nakedFlowFps;return this.localDts=this.localDts+parseInt(1e3/e),this.localDts}getNaluAudioDts(){var e=this.player.audio.audioContext.sampleRate,i=this.player.audio.audioBufferSize;return this.localDts+parseInt(i/e*1e3)}extractNALu(e){let i,s,u=0,c=e.byteLength,l=0,o=[];for(;u<c;)switch(i=e[u++],l){case 0:i===0&&(l=1);break;case 1:l=i===0?2:0;break;case 2:case 3:l=i===0?3:(i===1&&u<c&&(e[u],s&&o.push(e.subarray(s,u-l-1)),s=u),0)}return s&&o.push(e.subarray(s,c)),o}extractNALu$2(e){let i=null;if(e&&!(e.byteLength<1)){this.lastBuf?((i=new Uint8Array(e.byteLength+this.lastBuf.length)).set(this.lastBuf),i.set(new Uint8Array(e),this.lastBuf.length)):i=new Uint8Array(e);let u=0,c=-1,l=-2;var s=new Array;for(let o=0;o<i.length;o+=2){const f=i[o],_=i[o+1];c==0&&f==0&&_==0?s.push(o-1):_==1&&f==0&&c==0&&l==0&&s.push(o-2),l=f,c=_}if(1<s.length)for(let o=0;o<s.length-1;++o){const f=i.subarray(s[o],s[o+1]+1);this.handleNALu(f),u=s[o+1]}else u=s[0];if(u!=0&&u<i.length)this.lastBuf=i.subarray(u);else{this.lastBuf||(this.lastBuf=i);const o=new Uint8Array(this.lastBuf.length+e.byteLength);o.set(this.lastBuf),o.set(new Uint8Array(e),this.lastBuf.length),this.lastBuf=o}}}handleNALu(e){e.byteLength<4?this.player.debug.warn(this.TAG_NAME,`handleNALu nalu byteLength is ${e.byteLength} <= 4`):(e=e.slice(4),this.handleVideoNalu(e))}handleVideoNalu(e){const i=new Uint8Array(e);if(this.streamVideoType||(this.streamVideoType=(function(s){let u=null,c=31&s[0];return u=(u=c!==Vi&&c!==Wi?u:Oe)||(c=(126&s[0])>>1)!==$i&&c!==Ki&&c!==mi?u:Ye})(i)),this.streamVideoType===Oe){const s=this.handleAddNaluStartCode(i),u=this.extractNALu(s);if(u.length===0)this.player.debug.warn(this.TAG_NAME,"handleVideoNalu","naluList.length === 0");else{const c=[];if(u.forEach(l=>{var o=hi(l);o===Wi||o===Vi?this.handleVideoH264Nalu(l):Qr(o)&&c.push(l)}),c.length===1)this.handleVideoH264Nalu(c[0]);else if((function(o){if(o.length===0)return!1;var f=hi(o[0]);for(let _=1;_<o.length;_++)if(f!==hi(o[_]))return!1;return!0})(c)){const o=hi(c[0]),f=Ba(o);this.handleVideoH264NaluList(c,f,o)}else c.forEach(o=>{this.handleVideoH264Nalu(o)})}}else this.streamVideoType===Ye?Zr(i)===mi?this.extractH265PPS(i):this.handleVideoH265Nalu(i):this.player.debug.error(this.TAG_NAME," this.streamVideoType is null")}extractH264PPS(e){e=this.handleAddNaluStartCode(e),this.extractNALu(e).forEach(i=>{Pa(hi(i))?this.extractH264SEI(i):this.handleVideoH264Nalu(i)})}extractH265PPS(e){e=this.handleAddNaluStartCode(e),this.extractNALu(e).forEach(i=>{Zr(i)===39?this.extractH265SEI(i):this.handleVideoH265Nalu(i)})}extractH264SEI(e){e=this.handleAddNaluStartCode(e),this.extractNALu(e).forEach(i=>{this.handleVideoH264Nalu(i)})}extractH265SEI(e){e=this.handleAddNaluStartCode(e),this.extractNALu(e).forEach(i=>{this.handleVideoH265Nalu(i)})}handleAddNaluStartCode(e){var i=[0,0,0,1],s=new Uint8Array(e.length+i.length);return s.set(i),s.set(e,i.length),s}handleAudioAACNalu(e){if(e&&!(e.byteLength<1)){this.streamAudioType||(this.streamAudioType=Hi.AAC);let s=new Uint8Array(e);var i=s.slice(0,7);if(s=s.slice(7),!this.isSendAACSeqHeader){const l=(192&i[2])>>6,o=(60&i[2])>>2,f=(1&i[2])<<2|(192&i[3])>>6,_=new Uint8Array([175,0,l<<3|(14&o)>>1,(1&o)<<7|f<<3]);this.isSendAACSeqHeader=!0,this._doDecode(_,1,0,!1,0)}const u=this.getNaluAudioDts(),c=new Uint8Array(s.length+2);c.set([175,1],0),c.set(s,2),this._doDecode(c,1,u,!1,0)}}handleAudioG711ANalu(e){var i,s;!e||e.byteLength<1||(this.streamAudioType||(this.streamAudioType=Hi.ALAW),e=new Uint8Array(e),i=this.getNaluAudioDts(),(s=new Uint8Array(e.length+1)).set([114],0),s.set(e,1),this._doDecode(s,1,i,!1,0))}handleAudioG711UNalu(e){var i,s;!e||e.byteLength<1||(this.streamAudioType||(this.streamAudioType=Hi.MULAW),e=new Uint8Array(e),i=this.getNaluAudioDts(),(s=new Uint8Array(e.length+1)).set([130],0),s.set(e,1),this._doDecode(s,1,i,!1,0))}handleVideoH264Nalu(e){var i,s,u,c=hi(e);switch(c){case Vi:this.sps=e;break;case Wi:this.pps=e}if(this.isSendSeqHeader)if(Qr(c)){this.player._times.demuxStart||(this.player._times.demuxStart=be());const l=Ba(c),o=this.getNaluDts(),f=(i=e,(s=[])[0]=l?23:39,s[1]=1,s[2]=0,s[3]=0,s[4]=0,s[5]=i.byteLength>>24&255,s[6]=i.byteLength>>16&255,s[7]=i.byteLength>>8&255,s[8]=255&i.byteLength,(u=new Uint8Array(s.length+i.byteLength)).set(s,0),u.set(i,s.length),u);this.player.updateStats({vbps:f.byteLength,dts:o}),l&&this.calcIframeIntervalTimestamp(o),this._doDecode(f,2,o,l,0)}else this.player.debug.warn(this.TAG_NAME,"handleVideoH264Nalu is avc seq head nalType is "+c);else if(this.sps&&this.pps){this.isSendSeqHeader=!0;const l=Ia({sps:this.sps,pps:this.pps});this._doDecode(l,2,0,!0,0)}}handleVideoH264NaluList(e,i,s){if(this.isSendSeqHeader){this.player._times.demuxStart||(this.player._times.demuxStart=be());const u=this.getNaluDts(),c=Yr(e.reduce((f,_)=>{var f=Jr(f),_=Jr(_),g=new Uint8Array(f.byteLength+_.byteLength);return g.set(f,0),g.set(_,f.byteLength),g}),i);this.player.updateStats({vbps:c.byteLength,dts:u}),i&&this.calcIframeIntervalTimestamp(u),this._doDecode(c,2,u,i,0)}else this.player.debug.warn(this.TAG_NAME,"handleVideoH264NaluList isSendSeqHeader is false")}handleVideoH265Nalu(e){var i,s,u=Zr(e);switch(u){case $i:this.vps=e;break;case Ki:this.sps=e;break;case mi:this.pps=e}if(this.isSendSeqHeader){if(Fa(u)){this.player._times.demuxStart||(this.player._times.demuxStart=be());const c=16<=u&&u<=21,l=this.getNaluDts(),o=(u=e,(i=[])[0]=c?28:44,i[1]=1,i[2]=0,i[3]=0,i[4]=0,i[5]=u.byteLength>>24&255,i[6]=u.byteLength>>16&255,i[7]=u.byteLength>>8&255,i[8]=255&u.byteLength,(s=new Uint8Array(i.length+u.byteLength)).set(i,0),s.set(u,i.length),s);this.player.updateStats({vbps:o.byteLength,dts:l}),c&&this.calcIframeIntervalTimestamp(l),this._doDecode(o,2,l,c,0)}}else if(this.vps&&this.sps&&this.pps){this.isSendSeqHeader=!0;const c=Ua({vps:this.vps,sps:this.sps,pps:this.pps});this._doDecode(c,2,0,!0,0)}}getInputByteLength(){let e=0;return e=this.lastBuf?this.lastBuf.byteLength:e}}class ko extends Qt{constructor(e){super(e),(this.player=e).debug.log("EmptyDemux","init")}destroy(){super.destroy(),this.player.debug.log("EmptyDemux","destroy")}}var ct=ir(function(D,e){function i(t){if(!(t instanceof ArrayBuffer))throw"Needs an array buffer";this.buffer=t,this.dataview=new DataView(t),this.position=0}function s(t,r,n){this._byteOffset=r||0,t instanceof ArrayBuffer?this.buffer=t:typeof t=="object"?(this.dataView=t,r&&(this._byteOffset+=r)):this.buffer=new ArrayBuffer(t||0),this.position=0,this.endianness=n??s.LITTLE_ENDIAN}function u(t){this.buffers=[],this.bufferIndex=-1,t&&(this.insertBuffer(t),this.bufferIndex=0)}function c(){var t=[],r=(t[3]="ES_Descriptor",t[4]="DecoderConfigDescriptor",t[5]="DecoderSpecificInfo",t[6]="SLConfigDescriptor",this.getDescriptorName=function(a){return t[a]},this),n={};return this.parseOneDescriptor=function(a){for(var d=0,p=a.readUint8(),m=a.readUint8();128&m;)d=(127&m)<<7,m=a.readUint8();return T.debug("MPEG4DescriptorParser","Found "+(t[p]||"Descriptor "+p)+", size "+(d+=127&m)+" at position "+a.getPosition()),(p=new(t[p]?n[t[p]]:n.Descriptor)(d)).parse(a),p},n.Descriptor=function(a,d){this.tag=a,this.size=d,this.descs=[]},n.Descriptor.prototype.parse=function(a){this.data=a.readUint8Array(this.size)},n.Descriptor.prototype.findDescriptor=function(a){for(var d=0;d<this.descs.length;d++)if(this.descs[d].tag==a)return this.descs[d];return null},n.Descriptor.prototype.parseRemainingDescriptors=function(a){for(var d=a.position;a.position<d+this.size;){var p=r.parseOneDescriptor(a);this.descs.push(p)}},n.ES_Descriptor=function(a){n.Descriptor.call(this,3,a)},n.ES_Descriptor.prototype=new n.Descriptor,n.ES_Descriptor.prototype.parse=function(a){var d;this.ES_ID=a.readUint16(),this.flags=a.readUint8(),this.size-=3,128&this.flags?(this.dependsOn_ES_ID=a.readUint16(),this.size-=2):this.dependsOn_ES_ID=0,64&this.flags?(d=a.readUint8(),this.URL=a.readString(d),this.size-=d+1):this.URL="",32&this.flags?(this.OCR_ES_ID=a.readUint16(),this.size-=2):this.OCR_ES_ID=0,this.parseRemainingDescriptors(a)},n.ES_Descriptor.prototype.getOTI=function(a){var d=this.findDescriptor(4);return d?d.oti:0},n.ES_Descriptor.prototype.getAudioConfig=function(a){var d,p=this.findDescriptor(4);return(p=p&&p.findDescriptor(5))&&p.data?(d=(248&p.data[0])>>3)===31&&2<=p.data.length?32+((7&p.data[0])<<3)+((224&p.data[1])>>5):d:null},n.DecoderConfigDescriptor=function(a){n.Descriptor.call(this,4,a)},n.DecoderConfigDescriptor.prototype=new n.Descriptor,n.DecoderConfigDescriptor.prototype.parse=function(a){this.oti=a.readUint8(),this.streamType=a.readUint8(),this.bufferSize=a.readUint24(),this.maxBitrate=a.readUint32(),this.avgBitrate=a.readUint32(),this.size-=13,this.parseRemainingDescriptors(a)},n.DecoderSpecificInfo=function(a){n.Descriptor.call(this,5,a)},n.DecoderSpecificInfo.prototype=new n.Descriptor,n.SLConfigDescriptor=function(a){n.Descriptor.call(this,6,a)},n.SLConfigDescriptor.prototype=new n.Descriptor,this}function l(){}function o(){}function f(t){this.stream=t||new u,this.boxes=[],this.mdats=[],this.moofs=[],this.isProgressive=!1,this.moovStartFound=!1,this.onMoovStart=null,this.moovStartSent=!1,this.onReady=null,this.readySent=!1,this.onSegment=null,this.onSamples=null,this.onError=null,this.sampleListBuilt=!1,this.fragmentedTracks=[],this.extractedTracks=[],this.isFragmentationInitialized=!1,this.sampleProcessingStarted=!1,this.nextMoofNumber=0,this.itemListBuilt=!1,this.onSidx=null,this.sidxSent=!1}_=new Date,g=4;var _,g,T={setLogLevel:function(t){g=t==this.debug?1:t==this.info?2:t==this.warn?3:(this.error,4)},debug:function(t,r){console.debug===void 0&&(console.debug=console.log),g<=1&&console.debug("["+T.getDurationString(new Date-_,1e3)+"]","["+t+"]",r)},log:function(t,r){this.debug(t.msg)},info:function(t,r){g<=2&&console.info("["+T.getDurationString(new Date-_,1e3)+"]","["+t+"]",r)},warn:function(t,r){g<=3&&console.warn("["+T.getDurationString(new Date-_,1e3)+"]","["+t+"]",r)},error:function(t,r){g<=4&&console.error("["+T.getDurationString(new Date-_,1e3)+"]","["+t+"]",r)}},E=(T.getDurationString=function(d,p){var n;function a(b,C){for(var v=(""+b).split(".");v[0].length<C;)v[0]="0"+v[0];return v.join(".")}d<0?(n=!0,d=-d):n=!1;var d=d/(p||1),p=Math.floor(d/3600),m=(d-=3600*p,Math.floor(d/60)),x=1e3*(d-=60*m);return x-=1e3*(d=Math.floor(d)),x=Math.floor(x),(n?"-":"")+p+":"+a(m,2)+":"+a(d,2)+"."+a(x,3)},T.printRanges=function(t){var r=t.length;if(0<r){for(var n="",a=0;a<r;a++)0<a&&(n+=","),n+="["+T.getDurationString(t.start(a))+","+T.getDurationString(t.end(a))+"]";return n}return"(empty)"},e.Log=T,i.prototype.getPosition=function(){return this.position},i.prototype.getEndPosition=function(){return this.buffer.byteLength},i.prototype.getLength=function(){return this.buffer.byteLength},i.prototype.seek=function(t){return t=Math.max(0,Math.min(this.buffer.byteLength,t)),this.position=isNaN(t)||!isFinite(t)?0:t,!0},i.prototype.isEos=function(){return this.getPosition()>=this.getEndPosition()},i.prototype.readAnyInt=function(t,r){var n=0;if(this.position+t<=this.buffer.byteLength){switch(t){case 1:n=r?this.dataview.getInt8(this.position):this.dataview.getUint8(this.position);break;case 2:n=r?this.dataview.getInt16(this.position):this.dataview.getUint16(this.position);break;case 3:if(r)throw"No method for reading signed 24 bits values";n=this.dataview.getUint8(this.position)<<16,n=(n|=this.dataview.getUint8(this.position+1)<<8)|this.dataview.getUint8(this.position+2);break;case 4:n=r?this.dataview.getInt32(this.position):this.dataview.getUint32(this.position);break;case 8:if(r)throw"No method for reading signed 64 bits values";n=this.dataview.getUint32(this.position)<<32,n|=this.dataview.getUint32(this.position+4);break;default:throw"readInt method not implemented for size: "+t}return this.position+=t,n}throw"Not enough bytes in buffer"},i.prototype.readUint8=function(){return this.readAnyInt(1,!1)},i.prototype.readUint16=function(){return this.readAnyInt(2,!1)},i.prototype.readUint24=function(){return this.readAnyInt(3,!1)},i.prototype.readUint32=function(){return this.readAnyInt(4,!1)},i.prototype.readUint64=function(){return this.readAnyInt(8,!1)},i.prototype.readString=function(t){if(this.position+t<=this.buffer.byteLength){for(var r="",n=0;n<t;n++)r+=String.fromCharCode(this.readUint8());return r}throw"Not enough bytes in buffer"},i.prototype.readCString=function(){for(var t=[];;){var r=this.readUint8();if(r===0)break;t.push(r)}return String.fromCharCode.apply(null,t)},i.prototype.readInt8=function(){return this.readAnyInt(1,!0)},i.prototype.readInt16=function(){return this.readAnyInt(2,!0)},i.prototype.readInt32=function(){return this.readAnyInt(4,!0)},i.prototype.readInt64=function(){return this.readAnyInt(8,!1)},i.prototype.readUint8Array=function(t){for(var r=new Uint8Array(t),n=0;n<t;n++)r[n]=this.readUint8();return r},i.prototype.readInt16Array=function(t){for(var r=new Int16Array(t),n=0;n<t;n++)r[n]=this.readInt16();return r},i.prototype.readUint16Array=function(t){for(var r=new Int16Array(t),n=0;n<t;n++)r[n]=this.readUint16();return r},i.prototype.readUint32Array=function(t){for(var r=new Uint32Array(t),n=0;n<t;n++)r[n]=this.readUint32();return r},i.prototype.readInt32Array=function(t){for(var r=new Int32Array(t),n=0;n<t;n++)r[n]=this.readInt32();return r},e.MP4BoxStream=i,(s.prototype={}).getPosition=function(){return this.position},s.prototype._realloc=function(t){if(this._dynamicSize){var r=this._byteOffset+this.position+t,n=this._buffer.byteLength;if(r<=n)r>this._byteLength&&(this._byteLength=r);else{for(n<1&&(n=1);n<r;)n*=2;var t=new ArrayBuffer(n),a=new Uint8Array(this._buffer);new Uint8Array(t,0,a.length).set(a),this.buffer=t,this._byteLength=r}}},s.prototype._trimAlloc=function(){var t,r,n;this._byteLength!=this._buffer.byteLength&&(t=new ArrayBuffer(this._byteLength),r=new Uint8Array(t),n=new Uint8Array(this._buffer,0,r.length),r.set(n),this.buffer=t)},s.BIG_ENDIAN=!1,s.LITTLE_ENDIAN=!0,s.prototype._byteLength=0,Object.defineProperty(s.prototype,"byteLength",{get:function(){return this._byteLength-this._byteOffset}}),Object.defineProperty(s.prototype,"buffer",{get:function(){return this._trimAlloc(),this._buffer},set:function(t){this._buffer=t,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(s.prototype,"byteOffset",{get:function(){return this._byteOffset},set:function(t){this._byteOffset=t,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(s.prototype,"dataView",{get:function(){return this._dataView},set:function(t){this._byteOffset=t.byteOffset,this._buffer=t.buffer,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._byteOffset+t.byteLength}}),s.prototype.seek=function(t){t=Math.max(0,Math.min(this.byteLength,t)),this.position=isNaN(t)||!isFinite(t)?0:t},s.prototype.isEof=function(){return this.position>=this._byteLength},s.prototype.mapUint8Array=function(t){this._realloc(+t);var r=new Uint8Array(this._buffer,this.byteOffset+this.position,t);return this.position+=+t,r},s.prototype.readInt32Array=function(t,r){t=t??this.byteLength-this.position/4;var n=new Int32Array(t);return s.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,t*n.BYTES_PER_ELEMENT),s.arrayToNative(n,r??this.endianness),this.position+=n.byteLength,n},s.prototype.readInt16Array=function(t,r){t=t??this.byteLength-this.position/2;var n=new Int16Array(t);return s.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,t*n.BYTES_PER_ELEMENT),s.arrayToNative(n,r??this.endianness),this.position+=n.byteLength,n},s.prototype.readInt8Array=function(t){t=t??this.byteLength-this.position;var r=new Int8Array(t);return s.memcpy(r.buffer,0,this.buffer,this.byteOffset+this.position,t*r.BYTES_PER_ELEMENT),this.position+=r.byteLength,r},s.prototype.readUint32Array=function(t,r){t=t??this.byteLength-this.position/4;var n=new Uint32Array(t);return s.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,t*n.BYTES_PER_ELEMENT),s.arrayToNative(n,r??this.endianness),this.position+=n.byteLength,n},s.prototype.readUint16Array=function(t,r){t=t??this.byteLength-this.position/2;var n=new Uint16Array(t);return s.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,t*n.BYTES_PER_ELEMENT),s.arrayToNative(n,r??this.endianness),this.position+=n.byteLength,n},s.prototype.readUint8Array=function(t){t=t??this.byteLength-this.position;var r=new Uint8Array(t);return s.memcpy(r.buffer,0,this.buffer,this.byteOffset+this.position,t*r.BYTES_PER_ELEMENT),this.position+=r.byteLength,r},s.prototype.readFloat64Array=function(t,r){t=t??this.byteLength-this.position/8;var n=new Float64Array(t);return s.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,t*n.BYTES_PER_ELEMENT),s.arrayToNative(n,r??this.endianness),this.position+=n.byteLength,n},s.prototype.readFloat32Array=function(t,r){t=t??this.byteLength-this.position/4;var n=new Float32Array(t);return s.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,t*n.BYTES_PER_ELEMENT),s.arrayToNative(n,r??this.endianness),this.position+=n.byteLength,n},s.prototype.readInt32=function(t){return t=this._dataView.getInt32(this.position,t??this.endianness),this.position+=4,t},s.prototype.readInt16=function(t){return t=this._dataView.getInt16(this.position,t??this.endianness),this.position+=2,t},s.prototype.readInt8=function(){var t=this._dataView.getInt8(this.position);return this.position+=1,t},s.prototype.readUint32=function(t){return t=this._dataView.getUint32(this.position,t??this.endianness),this.position+=4,t},s.prototype.readUint16=function(t){return t=this._dataView.getUint16(this.position,t??this.endianness),this.position+=2,t},s.prototype.readUint8=function(){var t=this._dataView.getUint8(this.position);return this.position+=1,t},s.prototype.readFloat32=function(t){return t=this._dataView.getFloat32(this.position,t??this.endianness),this.position+=4,t},s.prototype.readFloat64=function(t){return t=this._dataView.getFloat64(this.position,t??this.endianness),this.position+=8,t},s.endianness=0<new Int8Array(new Int16Array([1]).buffer)[0],s.memcpy=function(t,r,n,a,d){t=new Uint8Array(t,r,d),r=new Uint8Array(n,a,d),t.set(r)},s.arrayToNative=function(t,r){return r==this.endianness?t:this.flipArrayEndianness(t)},s.nativeToEndian=function(t,r){return this.endianness==r?t:this.flipArrayEndianness(t)},s.flipArrayEndianness=function(t){for(var r=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),n=0;n<t.byteLength;n+=t.BYTES_PER_ELEMENT)for(var a=n+t.BYTES_PER_ELEMENT-1,d=n;d<a;a--,d++){var p=r[d];r[d]=r[a],r[a]=p}return t},s.prototype.failurePosition=0,String.fromCharCodeUint8=function(t){for(var r=[],n=0;n<t.length;n++)r[n]=t[n];return String.fromCharCode.apply(null,r)},s.prototype.readString=function(t,r){return r==null||r=="ASCII"?String.fromCharCodeUint8.apply(null,[this.mapUint8Array(t??this.byteLength-this.position)]):new TextDecoder(r).decode(this.mapUint8Array(t))},s.prototype.readCString=function(t){var r=this.byteLength-this.position,n=new Uint8Array(this._buffer,this._byteOffset+this.position),a=r;t!=null&&(a=Math.min(t,r));for(var d=0;d<a&&n[d]!==0;d++);var p=String.fromCharCodeUint8.apply(null,[this.mapUint8Array(d)]);return t!=null?this.position+=a-d:d!=r&&(this.position+=1),p},Math.pow(2,32)),h=(s.prototype.readInt64=function(){return this.readInt32()*E+this.readUint32()},s.prototype.readUint64=function(){return this.readUint32()*E+this.readUint32()},s.prototype.readInt64=function(){return this.readUint32()*E+this.readUint32()},s.prototype.readUint24=function(){return(this.readUint8()<<16)+(this.readUint8()<<8)+this.readUint8()},(e.DataStream=s).prototype.save=function(t){var r=new Blob([this.buffer]);if(!window.URL||!URL.createObjectURL)throw"DataStream.save: Can't create object URL.";var r=window.URL.createObjectURL(r),n=document.createElement("a");document.body.appendChild(n),n.setAttribute("href",r),n.setAttribute("download",t),n.setAttribute("target","_self"),n.click(),window.URL.revokeObjectURL(r)},s.prototype._dynamicSize=!0,Object.defineProperty(s.prototype,"dynamicSize",{get:function(){return this._dynamicSize},set:function(t){t||this._trimAlloc(),this._dynamicSize=t}}),s.prototype.shift=function(t){var r=new ArrayBuffer(this._byteLength-t),n=new Uint8Array(r),a=new Uint8Array(this._buffer,t,n.length);n.set(a),this.buffer=r,this.position-=t},s.prototype.writeInt32Array=function(t,r){if(this._realloc(4*t.length),t instanceof Int32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)s.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt32Array(t.length,r);else for(var n=0;n<t.length;n++)this.writeInt32(t[n],r)},s.prototype.writeInt16Array=function(t,r){if(this._realloc(2*t.length),t instanceof Int16Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)s.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt16Array(t.length,r);else for(var n=0;n<t.length;n++)this.writeInt16(t[n],r)},s.prototype.writeInt8Array=function(t){if(this._realloc(+t.length),t instanceof Int8Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)s.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt8Array(t.length);else for(var r=0;r<t.length;r++)this.writeInt8(t[r])},s.prototype.writeUint32Array=function(t,r){if(this._realloc(4*t.length),t instanceof Uint32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)s.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint32Array(t.length,r);else for(var n=0;n<t.length;n++)this.writeUint32(t[n],r)},s.prototype.writeUint16Array=function(t,r){if(this._realloc(2*t.length),t instanceof Uint16Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)s.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint16Array(t.length,r);else for(var n=0;n<t.length;n++)this.writeUint16(t[n],r)},s.prototype.writeUint8Array=function(t){if(this._realloc(+t.length),t instanceof Uint8Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)s.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint8Array(t.length);else for(var r=0;r<t.length;r++)this.writeUint8(t[r])},s.prototype.writeFloat64Array=function(t,r){if(this._realloc(8*t.length),t instanceof Float64Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)s.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapFloat64Array(t.length,r);else for(var n=0;n<t.length;n++)this.writeFloat64(t[n],r)},s.prototype.writeFloat32Array=function(t,r){if(this._realloc(4*t.length),t instanceof Float32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)s.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapFloat32Array(t.length,r);else for(var n=0;n<t.length;n++)this.writeFloat32(t[n],r)},s.prototype.writeInt32=function(t,r){this._realloc(4),this._dataView.setInt32(this.position,t,r??this.endianness),this.position+=4},s.prototype.writeInt16=function(t,r){this._realloc(2),this._dataView.setInt16(this.position,t,r??this.endianness),this.position+=2},s.prototype.writeInt8=function(t){this._realloc(1),this._dataView.setInt8(this.position,t),this.position+=1},s.prototype.writeUint32=function(t,r){this._realloc(4),this._dataView.setUint32(this.position,t,r??this.endianness),this.position+=4},s.prototype.writeUint16=function(t,r){this._realloc(2),this._dataView.setUint16(this.position,t,r??this.endianness),this.position+=2},s.prototype.writeUint8=function(t){this._realloc(1),this._dataView.setUint8(this.position,t),this.position+=1},s.prototype.writeFloat32=function(t,r){this._realloc(4),this._dataView.setFloat32(this.position,t,r??this.endianness),this.position+=4},s.prototype.writeFloat64=function(t,r){this._realloc(8),this._dataView.setFloat64(this.position,t,r??this.endianness),this.position+=8},s.prototype.writeUCS2String=function(t,r,n){n==null&&(n=t.length);for(var a=0;a<t.length&&a<n;a++)this.writeUint16(t.charCodeAt(a),r);for(;a<n;a++)this.writeUint16(0)},s.prototype.writeString=function(t,r,n){var a=0;if(r==null||r=="ASCII")if(n!=null){for(var d=Math.min(t.length,n),a=0;a<d;a++)this.writeUint8(t.charCodeAt(a));for(;a<n;a++)this.writeUint8(0)}else for(a=0;a<t.length;a++)this.writeUint8(t.charCodeAt(a));else this.writeUint8Array(new TextEncoder(r).encode(t.substring(0,n)))},s.prototype.writeCString=function(t,r){var n=0;if(r!=null){for(var a=Math.min(t.length,r),n=0;n<a;n++)this.writeUint8(t.charCodeAt(n));for(;n<r;n++)this.writeUint8(0)}else{for(n=0;n<t.length;n++)this.writeUint8(t.charCodeAt(n));this.writeUint8(0)}},s.prototype.writeStruct=function(t,r){for(var n=0;n<t.length;n+=2){var a=t[n+1];this.writeType(a,r[t[n]],r)}},s.prototype.writeType=function(t,r,m){var a;if(typeof t=="function")return t(this,r);if(typeof t=="object"&&!(t instanceof Array))return t.set(this,r,m);var d=null,p="ASCII",m=this.position;switch(typeof t=="string"&&/:/.test(t)&&(t=(a=t.split(":"))[0],d=parseInt(a[1])),typeof t=="string"&&/,/.test(t)&&(t=(a=t.split(","))[0],p=parseInt(a[1])),t){case"uint8":this.writeUint8(r);break;case"int8":this.writeInt8(r);break;case"uint16":this.writeUint16(r,this.endianness);break;case"int16":this.writeInt16(r,this.endianness);break;case"uint32":this.writeUint32(r,this.endianness);break;case"int32":this.writeInt32(r,this.endianness);break;case"float32":this.writeFloat32(r,this.endianness);break;case"float64":this.writeFloat64(r,this.endianness);break;case"uint16be":this.writeUint16(r,s.BIG_ENDIAN);break;case"int16be":this.writeInt16(r,s.BIG_ENDIAN);break;case"uint32be":this.writeUint32(r,s.BIG_ENDIAN);break;case"int32be":this.writeInt32(r,s.BIG_ENDIAN);break;case"float32be":this.writeFloat32(r,s.BIG_ENDIAN);break;case"float64be":this.writeFloat64(r,s.BIG_ENDIAN);break;case"uint16le":this.writeUint16(r,s.LITTLE_ENDIAN);break;case"int16le":this.writeInt16(r,s.LITTLE_ENDIAN);break;case"uint32le":this.writeUint32(r,s.LITTLE_ENDIAN);break;case"int32le":this.writeInt32(r,s.LITTLE_ENDIAN);break;case"float32le":this.writeFloat32(r,s.LITTLE_ENDIAN);break;case"float64le":this.writeFloat64(r,s.LITTLE_ENDIAN);break;case"cstring":this.writeCString(r,d);break;case"string":this.writeString(r,p,d);break;case"u16string":this.writeUCS2String(r,this.endianness,d);break;case"u16stringle":this.writeUCS2String(r,s.LITTLE_ENDIAN,d);break;case"u16stringbe":this.writeUCS2String(r,s.BIG_ENDIAN,d);break;default:if(t.length==3)for(var x=t[1],b=0;b<r.length;b++)this.writeType(x,r[b]);else this.writeStruct(t,r)}d!=null&&(this.position=m,this._realloc(d),this.position=m+d)},s.prototype.writeUint64=function(t){var r=Math.floor(t/E);this.writeUint32(r),this.writeUint32(4294967295&t)},s.prototype.writeUint24=function(t){this.writeUint8((16711680&t)>>16),this.writeUint8((65280&t)>>8),this.writeUint8(255&t)},s.prototype.adjustUint32=function(t,r){var n=this.position;this.seek(t),this.writeUint32(r),this.seek(n)},s.prototype.mapInt32Array=function(t,r){this._realloc(4*t);var n=new Int32Array(this._buffer,this.byteOffset+this.position,t);return s.arrayToNative(n,r??this.endianness),this.position+=4*t,n},s.prototype.mapInt16Array=function(t,r){this._realloc(2*t);var n=new Int16Array(this._buffer,this.byteOffset+this.position,t);return s.arrayToNative(n,r??this.endianness),this.position+=2*t,n},s.prototype.mapInt8Array=function(t){this._realloc(+t);var r=new Int8Array(this._buffer,this.byteOffset+this.position,t);return this.position+=+t,r},s.prototype.mapUint32Array=function(t,r){this._realloc(4*t);var n=new Uint32Array(this._buffer,this.byteOffset+this.position,t);return s.arrayToNative(n,r??this.endianness),this.position+=4*t,n},s.prototype.mapUint16Array=function(t,r){this._realloc(2*t);var n=new Uint16Array(this._buffer,this.byteOffset+this.position,t);return s.arrayToNative(n,r??this.endianness),this.position+=2*t,n},s.prototype.mapFloat64Array=function(t,r){this._realloc(8*t);var n=new Float64Array(this._buffer,this.byteOffset+this.position,t);return s.arrayToNative(n,r??this.endianness),this.position+=8*t,n},s.prototype.mapFloat32Array=function(t,r){this._realloc(4*t);var n=new Float32Array(this._buffer,this.byteOffset+this.position,t);return s.arrayToNative(n,r??this.endianness),this.position+=4*t,n},(u.prototype=new s(new ArrayBuffer,0,s.BIG_ENDIAN)).initialized=function(){var t;return-1<this.bufferIndex||(0<this.buffers.length?(t=this.buffers[0]).fileStart===0?(this.buffer=t,this.bufferIndex=0,T.debug("MultiBufferStream","Stream ready for parsing"),!0):(T.warn("MultiBufferStream","The first buffer should have a fileStart of 0"),this.logBufferLevel(),!1):(T.warn("MultiBufferStream","No buffer to start parsing from"),this.logBufferLevel(),!1))},ArrayBuffer.concat=function(t,r){T.debug("ArrayBuffer","Trying to create a new buffer of size: "+(t.byteLength+r.byteLength));var n=new Uint8Array(t.byteLength+r.byteLength);return n.set(new Uint8Array(t),0),n.set(new Uint8Array(r),t.byteLength),n.buffer},u.prototype.reduceBuffer=function(t,r,n){var a;return(a=new Uint8Array(n)).set(new Uint8Array(t,r,n)),a.buffer.fileStart=t.fileStart+r,a.buffer.usedBytes=0,a.buffer},u.prototype.insertBuffer=function(t){for(var r=!0,n=0;n<this.buffers.length;n++){var a=this.buffers[n];if(t.fileStart<=a.fileStart){if(t.fileStart===a.fileStart){if(t.byteLength>a.byteLength){this.buffers.splice(n,1),n--;continue}T.warn("MultiBufferStream","Buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+") already appended, ignoring")}else t.fileStart+t.byteLength<=a.fileStart||(t=this.reduceBuffer(t,0,a.fileStart-t.fileStart)),T.debug("MultiBufferStream","Appending new buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+")"),this.buffers.splice(n,0,t),n===0&&(this.buffer=t);r=!1;break}if(t.fileStart<a.fileStart+a.byteLength){var a=a.fileStart+a.byteLength-t.fileStart,d=t.byteLength-a;if(!(0<d)){r=!1;break}t=this.reduceBuffer(t,a,d)}}r&&(T.debug("MultiBufferStream","Appending new buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+")"),this.buffers.push(t),n===0)&&(this.buffer=t)},u.prototype.logBufferLevel=function(t){for(var r,n,a=[],d="",p=0,m=0,x=0;x<this.buffers.length;x++)r=this.buffers[x],x===0?(a.push(n={}),n.start=r.fileStart,n.end=r.fileStart+r.byteLength,d+="["+n.start+"-"):n.end===r.fileStart?n.end=r.fileStart+r.byteLength:((n={}).start=r.fileStart,d+=a[a.length-1].end-1+"], ["+n.start+"-",n.end=r.fileStart+r.byteLength,a.push(n)),p+=r.usedBytes,m+=r.byteLength;0<a.length&&(d+=n.end-1+"]"),t=t?T.info:T.debug,this.buffers.length===0?t("MultiBufferStream","No more buffer in memory"):t("MultiBufferStream",this.buffers.length+" stored buffer(s) ("+p+"/"+m+" bytes), continuous ranges: "+d)},u.prototype.cleanBuffers=function(){for(var t,r=0;r<this.buffers.length;r++)(t=this.buffers[r]).usedBytes===t.byteLength&&(T.debug("MultiBufferStream","Removing buffer #"+r),this.buffers.splice(r,1),r--)},u.prototype.mergeNextBuffer=function(){var t,r,n,a;return this.bufferIndex+1<this.buffers.length&&(t=this.buffers[this.bufferIndex+1]).fileStart===this.buffer.fileStart+this.buffer.byteLength&&(r=this.buffer.byteLength,n=this.buffer.usedBytes,a=this.buffer.fileStart,this.buffers[this.bufferIndex]=ArrayBuffer.concat(this.buffer,t),this.buffer=this.buffers[this.bufferIndex],this.buffers.splice(this.bufferIndex+1,1),this.buffer.usedBytes=n,this.buffer.fileStart=a,T.debug("ISOFile","Concatenating buffer for box parsing (length: "+r+"->"+this.buffer.byteLength+")"),!0)},u.prototype.findPosition=function(t,r,n){for(var a=null,d=-1,p=t===!0?0:this.bufferIndex;p<this.buffers.length&&(a=this.buffers[p]).fileStart<=r;)d=p,n&&(a.fileStart+a.byteLength<=r?a.usedBytes=a.byteLength:a.usedBytes=r-a.fileStart,this.logBufferLevel()),p++;return d!==-1&&(a=this.buffers[d]).fileStart+a.byteLength>=r?(T.debug("MultiBufferStream","Found position in existing buffer #"+d),d):-1},u.prototype.findEndContiguousBuf=function(a){var r,n,a=a!==void 0?a:this.bufferIndex,d=this.buffers[a];if(this.buffers.length>a+1)for(r=a+1;r<this.buffers.length&&(n=this.buffers[r]).fileStart===d.fileStart+d.byteLength;r++)d=n;return d.fileStart+d.byteLength},u.prototype.getEndFilePositionAfter=function(t){var r=this.findPosition(!0,t,!1);return r!==-1?this.findEndContiguousBuf(r):t},u.prototype.addUsedBytes=function(t){this.buffer.usedBytes+=t,this.logBufferLevel()},u.prototype.setAllUsedBytes=function(){this.buffer.usedBytes=this.buffer.byteLength,this.logBufferLevel()},u.prototype.seek=function(t,r,n){return(r=this.findPosition(r,t,n))!==-1?(this.buffer=this.buffers[r],this.bufferIndex=r,this.position=t-this.buffer.fileStart,T.debug("MultiBufferStream","Repositioning parser at buffer position: "+this.position),!0):(T.debug("MultiBufferStream","Position "+t+" not found in buffered data"),!1)},u.prototype.getPosition=function(){if(this.bufferIndex===-1||this.buffers[this.bufferIndex]===null)throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.position},u.prototype.getLength=function(){return this.byteLength},u.prototype.getEndPosition=function(){if(this.bufferIndex===-1||this.buffers[this.bufferIndex]===null)throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.byteLength},e.MultiBufferStream=u,e.MPEG4DescriptorParser=c,{ERR_INVALID_DATA:-1,ERR_NOT_ENOUGH_DATA:0,OK:1,BASIC_BOXES:["mdat","idat","free","skip","meco","strk"],FULL_BOXES:["hmhd","nmhd","iods","xml ","bxml","ipro","mere"],CONTAINER_BOXES:[["moov",["trak","pssh"]],["trak"],["edts"],["mdia"],["minf"],["dinf"],["stbl",["sgpd","sbgp"]],["mvex",["trex"]],["moof",["traf"]],["traf",["trun","sgpd","sbgp"]],["vttc"],["tref"],["iref"],["mfra",["tfra"]],["meco"],["hnti"],["hinf"],["strk"],["strd"],["sinf"],["rinf"],["schi"],["trgr"],["udta",["kind"]],["iprp",["ipma"]],["ipco"]],boxCodes:[],fullBoxCodes:[],containerBoxCodes:[],sampleEntryCodes:{},sampleGroupEntryCodes:[],trackGroupTypes:[],UUIDBoxes:{},UUIDs:[],initialize:function(){h.FullBox.prototype=new h.Box,h.ContainerBox.prototype=new h.Box,h.SampleEntry.prototype=new h.Box,h.TrackGroupTypeBox.prototype=new h.FullBox,h.BASIC_BOXES.forEach(function(t){h.createBoxCtor(t)}),h.FULL_BOXES.forEach(function(t){h.createFullBoxCtor(t)}),h.CONTAINER_BOXES.forEach(function(t){h.createContainerBoxCtor(t[0],null,t[1])})},Box:function(t,r,n){this.type=t,this.size=r,this.uuid=n},FullBox:function(t,r,n){h.Box.call(this,t,r,n),this.flags=0,this.version=0},ContainerBox:function(t,r,n){h.Box.call(this,t,r,n),this.boxes=[]},SampleEntry:function(t,r,n,a){h.ContainerBox.call(this,t,r),this.hdr_size=n,this.start=a},SampleGroupEntry:function(t){this.grouping_type=t},TrackGroupTypeBox:function(t,r){h.FullBox.call(this,t,r)},createBoxCtor:function(t,r){h.boxCodes.push(t),h[t+"Box"]=function(n){h.Box.call(this,t,n)},h[t+"Box"].prototype=new h.Box,r&&(h[t+"Box"].prototype.parse=r)},createFullBoxCtor:function(t,r){h[t+"Box"]=function(n){h.FullBox.call(this,t,n)},h[t+"Box"].prototype=new h.FullBox,h[t+"Box"].prototype.parse=function(n){this.parseFullHeader(n),r&&r.call(this,n)}},addSubBoxArrays:function(t){if(t)for(var r=(this.subBoxNames=t).length,n=0;n<r;n++)this[t[n]+"s"]=[]},createContainerBoxCtor:function(t,r,n){h[t+"Box"]=function(a){h.ContainerBox.call(this,t,a),h.addSubBoxArrays.call(this,n)},h[t+"Box"].prototype=new h.ContainerBox,r&&(h[t+"Box"].prototype.parse=r)},createMediaSampleEntryCtor:function(t,r,n){h.sampleEntryCodes[t]=[],h[t+"SampleEntry"]=function(a,d){h.SampleEntry.call(this,a,d),h.addSubBoxArrays.call(this,n)},h[t+"SampleEntry"].prototype=new h.SampleEntry,r&&(h[t+"SampleEntry"].prototype.parse=r)},createSampleEntryCtor:function(t,r,n,a){h.sampleEntryCodes[t].push(r),h[r+"SampleEntry"]=function(d){h[t+"SampleEntry"].call(this,r,d),h.addSubBoxArrays.call(this,a)},h[r+"SampleEntry"].prototype=new h[t+"SampleEntry"],n&&(h[r+"SampleEntry"].prototype.parse=n)},createEncryptedSampleEntryCtor:function(t,r,n){h.createSampleEntryCtor.call(this,t,r,n,["sinf"])},createSampleGroupCtor:function(t,r){h[t+"SampleGroupEntry"]=function(n){h.SampleGroupEntry.call(this,t,n)},h[t+"SampleGroupEntry"].prototype=new h.SampleGroupEntry,r&&(h[t+"SampleGroupEntry"].prototype.parse=r)},createTrackGroupCtor:function(t,r){h[t+"TrackGroupTypeBox"]=function(n){h.TrackGroupTypeBox.call(this,t,n)},h[t+"TrackGroupTypeBox"].prototype=new h.TrackGroupTypeBox,r&&(h[t+"TrackGroupTypeBox"].prototype.parse=r)},createUUIDBox:function(t,r,n,a){h.UUIDs.push(t),h.UUIDBoxes[t]=function(d){(r?h.FullBox:n?h.ContainerBox:h.Box).call(this,"uuid",d,t)},h.UUIDBoxes[t].prototype=new(r?h.FullBox:n?h.ContainerBox:h.Box),a&&(h.UUIDBoxes[t].prototype.parse=r?function(d){this.parseFullHeader(d),a&&a.call(this,d)}:a)}});h.initialize(),h.TKHD_FLAG_ENABLED=1,h.TKHD_FLAG_IN_MOVIE=2,h.TKHD_FLAG_IN_PREVIEW=4,h.TFHD_FLAG_BASE_DATA_OFFSET=1,h.TFHD_FLAG_SAMPLE_DESC=2,h.TFHD_FLAG_SAMPLE_DUR=8,h.TFHD_FLAG_SAMPLE_SIZE=16,h.TFHD_FLAG_SAMPLE_FLAGS=32,h.TFHD_FLAG_DUR_EMPTY=65536,h.TFHD_FLAG_DEFAULT_BASE_IS_MOOF=131072,h.TRUN_FLAGS_DATA_OFFSET=1,h.TRUN_FLAGS_FIRST_FLAG=4,h.TRUN_FLAGS_DURATION=256,h.TRUN_FLAGS_SIZE=512,h.TRUN_FLAGS_FLAGS=1024,h.TRUN_FLAGS_CTS_OFFSET=2048,h.Box.prototype.add=function(t){return this.addBox(new h[t+"Box"])},h.Box.prototype.addBox=function(t){return this.boxes.push(t),this[t.type+"s"]?this[t.type+"s"].push(t):this[t.type]=t,t},h.Box.prototype.set=function(t,r){return this[t]=r,this},h.Box.prototype.addEntry=function(t,r){return r=r||"entries",this[r]||(this[r]=[]),this[r].push(t),this},(e.BoxParser=h).parseUUID=function(t){return h.parseHex16(t)},h.parseHex16=function(t){for(var r="",n=0;n<16;n++){var a=t.readUint8().toString(16);r+=a.length===1?"0"+a:a}return r},h.parseOneBox=function(t,r,n){var a,d,p=t.getPosition(),m=0;if(t.getEndPosition()-p<8)return T.debug("BoxParser","Not enough data in stream to parse the type and size of the box"),{code:h.ERR_NOT_ENOUGH_DATA};if(n&&n<8)return T.debug("BoxParser","Not enough bytes left in the parent box to parse a new box"),{code:h.ERR_NOT_ENOUGH_DATA};var x=t.readUint32(),b=t.readString(4),C=b;if(T.debug("BoxParser","Found box of type '"+b+"' and size "+x+" at position "+p),m=8,b=="uuid"){if(t.getEndPosition()-t.getPosition()<16||n-m<16)return t.seek(p),T.debug("BoxParser","Not enough bytes left in the parent box to parse a UUID box"),{code:h.ERR_NOT_ENOUGH_DATA};m+=16,C=d=h.parseUUID(t)}if(x==1){if(t.getEndPosition()-t.getPosition()<8||n&&n-m<8)return t.seek(p),T.warn("BoxParser",'Not enough data in stream to parse the extended size of the "'+b+'" box'),{code:h.ERR_NOT_ENOUGH_DATA};x=t.readUint64(),m+=8}else if(x===0){if(n)x=n;else if(b!=="mdat")return T.error("BoxParser","Unlimited box size not supported for type: '"+b+"'"),a=new h.Box(b,x),{code:h.OK,box:a,size:a.size}}return x!==0&&x<m?(T.error("BoxParser","Box of type "+b+" has an invalid size "+x+" (too small to be a box)"),{code:h.ERR_NOT_ENOUGH_DATA,type:b,size:x,hdr_size:m,start:p}):x!==0&&n&&n<x?(T.error("BoxParser","Box of type '"+b+"' has a size "+x+" greater than its container size "+n),{code:h.ERR_NOT_ENOUGH_DATA,type:b,size:x,hdr_size:m,start:p}):x!==0&&p+x>t.getEndPosition()?(t.seek(p),T.info("BoxParser","Not enough data in stream to parse the entire '"+b+"' box"),{code:h.ERR_NOT_ENOUGH_DATA,type:b,size:x,hdr_size:m,start:p}):r?{code:h.OK,type:b,size:x,hdr_size:m,start:p}:(h[b+"Box"]?a=new h[b+"Box"](x):b!=="uuid"?(T.warn("BoxParser","Unknown box type: '"+b+"'"),(a=new h.Box(b,x)).has_unparsed_data=!0):h.UUIDBoxes[d]?a=new h.UUIDBoxes[d](x):(T.warn("BoxParser","Unknown uuid type: '"+d+"'"),(a=new h.Box(b,x)).uuid=d,a.has_unparsed_data=!0),a.hdr_size=m,a.start=p,a.write===h.Box.prototype.write&&a.type!=="mdat"&&(T.info("BoxParser","'"+C+"' box writing not yet implemented, keeping unparsed data in memory for later write"),a.parseDataAndRewind(t)),a.parse(t),(n=t.getPosition()-(a.start+a.size))<0?(T.warn("BoxParser","Parsing of box '"+C+"' did not read the entire indicated box data size (missing "+-n+" bytes), seeking forward"),t.seek(a.start+a.size)):0<n&&(T.error("BoxParser","Parsing of box '"+C+"' read "+n+" more bytes than the indicated box data size, seeking backwards"),a.size!==0)&&t.seek(a.start+a.size),{code:h.OK,box:a,size:a.size})},h.Box.prototype.parse=function(t){this.type!="mdat"?this.data=t.readUint8Array(this.size-this.hdr_size):this.size===0?t.seek(t.getEndPosition()):t.seek(this.start+this.size)},h.Box.prototype.parseDataAndRewind=function(t){this.data=t.readUint8Array(this.size-this.hdr_size),t.position-=this.size-this.hdr_size},h.FullBox.prototype.parseDataAndRewind=function(t){this.parseFullHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size),this.hdr_size-=4,t.position-=this.size-this.hdr_size},h.FullBox.prototype.parseFullHeader=function(t){this.version=t.readUint8(),this.flags=t.readUint24(),this.hdr_size+=4},h.FullBox.prototype.parse=function(t){this.parseFullHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size)},h.ContainerBox.prototype.parse=function(t){for(;t.getPosition()<this.start+this.size;){if((n=h.parseOneBox(t,!1,this.size-(t.getPosition()-this.start))).code!==h.OK)return;var r,n=n.box;this.boxes.push(n),this.subBoxNames&&this.subBoxNames.indexOf(n.type)!=-1?this[this.subBoxNames[this.subBoxNames.indexOf(n.type)]+"s"].push(n):this[r=n.type!=="uuid"?n.type:n.uuid]?T.warn("Box of type "+r+" already stored in field of this type"):this[r]=n}},h.Box.prototype.parseLanguage=function(t){this.language=t.readUint16(),t=[],t[0]=this.language>>10&31,t[1]=this.language>>5&31,t[2]=31&this.language,this.languageString=String.fromCharCode(t[0]+96,t[1]+96,t[2]+96)},h.SAMPLE_ENTRY_TYPE_VISUAL="Visual",h.SAMPLE_ENTRY_TYPE_AUDIO="Audio",h.SAMPLE_ENTRY_TYPE_HINT="Hint",h.SAMPLE_ENTRY_TYPE_METADATA="Metadata",h.SAMPLE_ENTRY_TYPE_SUBTITLE="Subtitle",h.SAMPLE_ENTRY_TYPE_SYSTEM="System",h.SAMPLE_ENTRY_TYPE_TEXT="Text",h.SampleEntry.prototype.parseHeader=function(t){t.readUint8Array(6),this.data_reference_index=t.readUint16(),this.hdr_size+=8},h.SampleEntry.prototype.parse=function(t){this.parseHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size)},h.SampleEntry.prototype.parseDataAndRewind=function(t){this.parseHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size),this.hdr_size-=8,t.position-=this.size-this.hdr_size},h.SampleEntry.prototype.parseFooter=function(t){h.ContainerBox.prototype.parse.call(this,t)},h.createMediaSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_HINT),h.createMediaSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_METADATA),h.createMediaSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_SUBTITLE),h.createMediaSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_SYSTEM),h.createMediaSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_TEXT),h.createMediaSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,function(t){var r;this.parseHeader(t),t.readUint16(),t.readUint16(),t.readUint32Array(3),this.width=t.readUint16(),this.height=t.readUint16(),this.horizresolution=t.readUint32(),this.vertresolution=t.readUint32(),t.readUint32(),this.frame_count=t.readUint16(),r=Math.min(31,t.readUint8()),this.compressorname=t.readString(r),r<31&&t.readString(31-r),this.depth=t.readUint16(),t.readUint16(),this.parseFooter(t)}),h.createMediaSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_AUDIO,function(t){this.parseHeader(t),t.readUint32Array(2),this.channel_count=t.readUint16(),this.samplesize=t.readUint16(),t.readUint16(),t.readUint16(),this.samplerate=t.readUint32()/65536,this.parseFooter(t)}),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"avc1"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"avc2"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"avc3"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"avc4"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"av01"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"hvc1"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"hev1"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"vvc1"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"vvi1"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"vvs1"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"vvcN"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"vp08"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"vp09"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_AUDIO,"mp4a"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_AUDIO,"ac-3"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_AUDIO,"ec-3"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_AUDIO,"Opus"),h.createEncryptedSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"encv"),h.createEncryptedSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_AUDIO,"enca"),h.createEncryptedSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_SUBTITLE,"encu"),h.createEncryptedSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_SYSTEM,"encs"),h.createEncryptedSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_TEXT,"enct"),h.createEncryptedSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_METADATA,"encm"),h.createBoxCtor("a1lx",function(t){var r=16*(1+(1&t.readUint8()));this.layer_size=[];for(var n=0;n<3;n++)this.layer_size[n]=r==16?t.readUint16():t.readUint32()}),h.createBoxCtor("a1op",function(t){this.op_index=t.readUint8()}),h.createFullBoxCtor("auxC",function(t){this.aux_type=t.readCString();var r=this.size-this.hdr_size-(this.aux_type.length+1);this.aux_subtype=t.readUint8Array(r)}),h.createBoxCtor("av1C",function(t){var r=t.readUint8();if(r>>7&!1)T.error("av1C marker problem");else if(this.version=127&r,this.version===1)if(r=t.readUint8(),this.seq_profile=r>>5&7,this.seq_level_idx_0=31&r,r=t.readUint8(),this.seq_tier_0=r>>7&1,this.high_bitdepth=r>>6&1,this.twelve_bit=r>>5&1,this.monochrome=r>>4&1,this.chroma_subsampling_x=r>>3&1,this.chroma_subsampling_y=r>>2&1,this.chroma_sample_position=3&r,r=t.readUint8(),this.reserved_1=r>>5&7,this.reserved_1===0){if(this.initial_presentation_delay_present=r>>4&1,this.initial_presentation_delay_present===1)this.initial_presentation_delay_minus_one=15&r;else if(this.reserved_2=15&r,this.reserved_2!==0)return void T.error("av1C reserved_2 parsing problem");r=this.size-this.hdr_size-4,this.configOBUs=t.readUint8Array(r)}else T.error("av1C reserved_1 parsing problem");else T.error("av1C version "+this.version+" not supported")}),h.createBoxCtor("avcC",function(t){var r,n;for(this.configurationVersion=t.readUint8(),this.AVCProfileIndication=t.readUint8(),this.profile_compatibility=t.readUint8(),this.AVCLevelIndication=t.readUint8(),this.lengthSizeMinusOne=3&t.readUint8(),this.nb_SPS_nalus=31&t.readUint8(),n=this.size-this.hdr_size-6,this.SPS=[],r=0;r<this.nb_SPS_nalus;r++)this.SPS[r]={},this.SPS[r].length=t.readUint16(),this.SPS[r].nalu=t.readUint8Array(this.SPS[r].length),n-=2+this.SPS[r].length;for(this.nb_PPS_nalus=t.readUint8(),n--,this.PPS=[],r=0;r<this.nb_PPS_nalus;r++)this.PPS[r]={},this.PPS[r].length=t.readUint16(),this.PPS[r].nalu=t.readUint8Array(this.PPS[r].length),n-=2+this.PPS[r].length;0<n&&(this.ext=t.readUint8Array(n))}),h.createBoxCtor("btrt",function(t){this.bufferSizeDB=t.readUint32(),this.maxBitrate=t.readUint32(),this.avgBitrate=t.readUint32()}),h.createBoxCtor("clap",function(t){this.cleanApertureWidthN=t.readUint32(),this.cleanApertureWidthD=t.readUint32(),this.cleanApertureHeightN=t.readUint32(),this.cleanApertureHeightD=t.readUint32(),this.horizOffN=t.readUint32(),this.horizOffD=t.readUint32(),this.vertOffN=t.readUint32(),this.vertOffD=t.readUint32()}),h.createBoxCtor("clli",function(t){this.max_content_light_level=t.readUint16(),this.max_pic_average_light_level=t.readUint16()}),h.createFullBoxCtor("co64",function(t){var r,n=t.readUint32();if(this.chunk_offsets=[],this.version===0)for(r=0;r<n;r++)this.chunk_offsets.push(t.readUint64())}),h.createFullBoxCtor("CoLL",function(t){this.maxCLL=t.readUint16(),this.maxFALL=t.readUint16()}),h.createBoxCtor("colr",function(t){var r;this.colour_type=t.readString(4),this.colour_type==="nclx"?(this.colour_primaries=t.readUint16(),this.transfer_characteristics=t.readUint16(),this.matrix_coefficients=t.readUint16(),r=t.readUint8(),this.full_range_flag=r>>7):this.colour_type!=="rICC"&&this.colour_type!=="prof"||(this.ICC_profile=t.readUint8Array(this.size-4))}),h.createFullBoxCtor("cprt",function(t){this.parseLanguage(t),this.notice=t.readCString()}),h.createFullBoxCtor("cslg",function(t){this.version===0&&(this.compositionToDTSShift=t.readInt32(),this.leastDecodeToDisplayDelta=t.readInt32(),this.greatestDecodeToDisplayDelta=t.readInt32(),this.compositionStartTime=t.readInt32(),this.compositionEndTime=t.readInt32())}),h.createFullBoxCtor("ctts",function(t){var r,n=t.readUint32();if(this.sample_counts=[],this.sample_offsets=[],this.version===0)for(r=0;r<n;r++){this.sample_counts.push(t.readUint32());var a=t.readInt32();a<0&&T.warn("BoxParser","ctts box uses negative values without using version 1"),this.sample_offsets.push(a)}else if(this.version==1)for(r=0;r<n;r++)this.sample_counts.push(t.readUint32()),this.sample_offsets.push(t.readInt32())}),h.createBoxCtor("dac3",function(a){var r=a.readUint8(),n=a.readUint8(),a=a.readUint8();this.fscod=r>>6,this.bsid=r>>1&31,this.bsmod=(1&r)<<2|n>>6&3,this.acmod=n>>3&7,this.lfeon=n>>2&1,this.bit_rate_code=3&n|a>>5&7}),h.createBoxCtor("dec3",function(t){var r=t.readUint16();this.data_rate=r>>3,this.num_ind_sub=7&r,this.ind_subs=[];for(var n=0;n<this.num_ind_sub+1;n++){var a={},d=(this.ind_subs.push(a),t.readUint8()),p=t.readUint8(),m=t.readUint8();a.fscod=d>>6,a.bsid=d>>1&31,a.bsmod=(1&d)<<4|p>>4&15,a.acmod=p>>1&7,a.lfeon=1&p,a.num_dep_sub=m>>1&15,0<a.num_dep_sub&&(a.chan_loc=(1&m)<<8|t.readUint8())}}),h.createFullBoxCtor("dfLa",function(t){var r=[],n=["STREAMINFO","PADDING","APPLICATION","SEEKTABLE","VORBIS_COMMENT","CUESHEET","PICTURE","RESERVED"];for(this.parseFullHeader(t);;){var a=t.readUint8(),d=Math.min(127&a,n.length-1);if(d?t.readUint8Array(t.readUint24()):(t.readUint8Array(13),this.samplerate=t.readUint32()>>12,t.readUint8Array(20)),r.push(n[d]),128&a)break}this.numMetadataBlocks=r.length+" ("+r.join(", ")+")"}),h.createBoxCtor("dimm",function(t){this.bytessent=t.readUint64()}),h.createBoxCtor("dmax",function(t){this.time=t.readUint32()}),h.createBoxCtor("dmed",function(t){this.bytessent=t.readUint64()}),h.createBoxCtor("dOps",function(t){if(this.Version=t.readUint8(),this.OutputChannelCount=t.readUint8(),this.PreSkip=t.readUint16(),this.InputSampleRate=t.readUint32(),this.OutputGain=t.readInt16(),this.ChannelMappingFamily=t.readUint8(),this.ChannelMappingFamily!==0){this.StreamCount=t.readUint8(),this.CoupledCount=t.readUint8(),this.ChannelMapping=[];for(var r=0;r<this.OutputChannelCount;r++)this.ChannelMapping[r]=t.readUint8()}}),h.createFullBoxCtor("dref",function(t){var r;this.entries=[];for(var n=t.readUint32(),a=0;a<n;a++){if((r=h.parseOneBox(t,!1,this.size-(t.getPosition()-this.start))).code!==h.OK)return;r=r.box,this.entries.push(r)}}),h.createBoxCtor("drep",function(t){this.bytessent=t.readUint64()}),h.createFullBoxCtor("elng",function(t){this.extended_language=t.readString(this.size-this.hdr_size)}),h.createFullBoxCtor("elst",function(t){this.entries=[];for(var r=t.readUint32(),n=0;n<r;n++){var a={};this.entries.push(a),this.version===1?(a.segment_duration=t.readUint64(),a.media_time=t.readInt64()):(a.segment_duration=t.readUint32(),a.media_time=t.readInt32()),a.media_rate_integer=t.readInt16(),a.media_rate_fraction=t.readInt16()}}),h.createFullBoxCtor("emsg",function(t){this.version==1?(this.timescale=t.readUint32(),this.presentation_time=t.readUint64(),this.event_duration=t.readUint32(),this.id=t.readUint32(),this.scheme_id_uri=t.readCString(),this.value=t.readCString()):(this.scheme_id_uri=t.readCString(),this.value=t.readCString(),this.timescale=t.readUint32(),this.presentation_time_delta=t.readUint32(),this.event_duration=t.readUint32(),this.id=t.readUint32());var r=this.size-this.hdr_size-(16+(this.scheme_id_uri.length+1)+(this.value.length+1));this.version==1&&(r-=4),this.message_data=t.readUint8Array(r)}),h.createFullBoxCtor("esds",function(r){var r=r.readUint8Array(this.size-this.hdr_size),n=new c;this.esd=n.parseOneDescriptor(new s(r.buffer,0,s.BIG_ENDIAN))}),h.createBoxCtor("fiel",function(t){this.fieldCount=t.readUint8(),this.fieldOrdering=t.readUint8()}),h.createBoxCtor("frma",function(t){this.data_format=t.readString(4)}),h.createBoxCtor("ftyp",function(t){var r=this.size-this.hdr_size;this.major_brand=t.readString(4),this.minor_version=t.readUint32(),r-=8,this.compatible_brands=[];for(var n=0;4<=r;)this.compatible_brands[n]=t.readString(4),r-=4,n++}),h.createFullBoxCtor("hdlr",function(t){this.version===0&&(t.readUint32(),this.handler=t.readString(4),t.readUint32Array(3),this.name=t.readString(this.size-this.hdr_size-20),this.name[this.name.length-1]==="\0")&&(this.name=this.name.slice(0,-1))}),h.createBoxCtor("hvcC",function(t){this.configurationVersion=t.readUint8(),n=t.readUint8(),this.general_profile_space=n>>6,this.general_tier_flag=(32&n)>>5,this.general_profile_idc=31&n,this.general_profile_compatibility=t.readUint32(),this.general_constraint_indicator=t.readUint8Array(6),this.general_level_idc=t.readUint8(),this.min_spatial_segmentation_idc=4095&t.readUint16(),this.parallelismType=3&t.readUint8(),this.chroma_format_idc=3&t.readUint8(),this.bit_depth_luma_minus8=7&t.readUint8(),this.bit_depth_chroma_minus8=7&t.readUint8(),this.avgFrameRate=t.readUint16(),n=t.readUint8(),this.constantFrameRate=n>>6,this.numTemporalLayers=(13&n)>>3,this.temporalIdNested=(4&n)>>2,this.lengthSizeMinusOne=3&n,this.nalu_arrays=[];for(var r,n,a=t.readUint8(),d=0;d<a;d++)for(var p=[],m=(this.nalu_arrays.push(p),n=t.readUint8(),p.completeness=(128&n)>>7,p.nalu_type=63&n,t.readUint16()),x=0;x<m;x++){var b={};p.push(b),r=t.readUint16(),b.data=t.readUint8Array(r)}}),h.createFullBoxCtor("iinf",function(t){var r;this.version===0?this.entry_count=t.readUint16():this.entry_count=t.readUint32(),this.item_infos=[];for(var n=0;n<this.entry_count;n++){if((r=h.parseOneBox(t,!1,this.size-(t.getPosition()-this.start))).code!==h.OK)return;r.box.type!=="infe"&&T.error("BoxParser","Expected 'infe' box, got "+r.box.type),this.item_infos[n]=r.box}}),h.createFullBoxCtor("iloc",function(t){var r=t.readUint8(),n=(this.offset_size=r>>4&15,this.length_size=15&r,r=t.readUint8(),this.base_offset_size=r>>4&15,this.version===1||this.version===2?this.index_size=15&r:this.index_size=0,this.items=[],0);if(this.version<2)n=t.readUint16();else{if(this.version!==2)throw"version of iloc box not supported";n=t.readUint32()}for(var a=0;a<n;a++){var d={};if(this.items.push(d),!(this.version<2)&&this.version!==2)throw"version of iloc box not supported";switch(d.item_ID=t.readUint16(),this.version===1||this.version===2?d.construction_method=15&t.readUint16():d.construction_method=0,d.data_reference_index=t.readUint16(),this.base_offset_size){case 0:d.base_offset=0;break;case 4:d.base_offset=t.readUint32();break;case 8:d.base_offset=t.readUint64();break;default:throw"Error reading base offset size"}var p=t.readUint16();d.extents=[];for(var m=0;m<p;m++){var x={};if(d.extents.push(x),this.version===1||this.version===2)switch(this.index_size){case 0:x.extent_index=0;break;case 4:x.extent_index=t.readUint32();break;case 8:x.extent_index=t.readUint64();break;default:throw"Error reading extent index"}switch(this.offset_size){case 0:x.extent_offset=0;break;case 4:x.extent_offset=t.readUint32();break;case 8:x.extent_offset=t.readUint64();break;default:throw"Error reading extent index"}switch(this.length_size){case 0:x.extent_length=0;break;case 4:x.extent_length=t.readUint32();break;case 8:x.extent_length=t.readUint64();break;default:throw"Error reading extent index"}}}}),h.createBoxCtor("imir",function(t){t=t.readUint8(),this.reserved=t>>7,this.axis=1&t}),h.createFullBoxCtor("infe",function(t){this.version!==0&&this.version!==1||(this.item_ID=t.readUint16(),this.item_protection_index=t.readUint16(),this.item_name=t.readCString(),this.content_type=t.readCString(),this.content_encoding=t.readCString()),this.version===1?(this.extension_type=t.readString(4),T.warn("BoxParser","Cannot parse extension type"),t.seek(this.start+this.size)):2<=this.version&&(this.version===2?this.item_ID=t.readUint16():this.version===3&&(this.item_ID=t.readUint32()),this.item_protection_index=t.readUint16(),this.item_type=t.readString(4),this.item_name=t.readCString(),this.item_type==="mime"?(this.content_type=t.readCString(),this.content_encoding=t.readCString()):this.item_type==="uri "&&(this.item_uri_type=t.readCString()))}),h.createFullBoxCtor("ipma",function(t){var r,n;for(entry_count=t.readUint32(),this.associations=[],r=0;r<entry_count;r++){var a={},d=(this.associations.push(a),this.version<1?a.id=t.readUint16():a.id=t.readUint32(),t.readUint8());for(a.props=[],n=0;n<d;n++){var p=t.readUint8(),m={};a.props.push(m),m.essential=(128&p)>>7==1,1&this.flags?m.property_index=(127&p)<<8|t.readUint8():m.property_index=127&p}}}),h.createFullBoxCtor("iref",function(t){var r;for(this.references=[];t.getPosition()<this.start+this.size;){if((r=h.parseOneBox(t,!0,this.size-(t.getPosition()-this.start))).code!==h.OK)return;(r=new(this.version===0?h.SingleItemTypeReferenceBox:h.SingleItemTypeReferenceBoxLarge)(r.type,r.size,r.hdr_size,r.start)).write===h.Box.prototype.write&&r.type!=="mdat"&&(T.warn("BoxParser",r.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),r.parseDataAndRewind(t)),r.parse(t),this.references.push(r)}}),h.createBoxCtor("irot",function(t){this.angle=3&t.readUint8()}),h.createFullBoxCtor("ispe",function(t){this.image_width=t.readUint32(),this.image_height=t.readUint32()}),h.createFullBoxCtor("kind",function(t){this.schemeURI=t.readCString(),this.value=t.readCString()}),h.createFullBoxCtor("leva",function(t){var r=t.readUint8();this.levels=[];for(var n=0;n<r;n++){var a={},d=((this.levels[n]=a).track_ID=t.readUint32(),t.readUint8());switch(a.padding_flag=d>>7,a.assignment_type=127&d,a.assignment_type){case 0:a.grouping_type=t.readString(4);break;case 1:a.grouping_type=t.readString(4),a.grouping_type_parameter=t.readUint32();break;case 2:case 3:break;case 4:a.sub_track_id=t.readUint32();break;default:T.warn("BoxParser","Unknown leva assignement type")}}}),h.createBoxCtor("lsel",function(t){this.layer_id=t.readUint16()}),h.createBoxCtor("maxr",function(t){this.period=t.readUint32(),this.bytes=t.readUint32()}),h.createBoxCtor("mdcv",function(t){this.display_primaries=[],this.display_primaries[0]={},this.display_primaries[0].x=t.readUint16(),this.display_primaries[0].y=t.readUint16(),this.display_primaries[1]={},this.display_primaries[1].x=t.readUint16(),this.display_primaries[1].y=t.readUint16(),this.display_primaries[2]={},this.display_primaries[2].x=t.readUint16(),this.display_primaries[2].y=t.readUint16(),this.white_point={},this.white_point.x=t.readUint16(),this.white_point.y=t.readUint16(),this.max_display_mastering_luminance=t.readUint32(),this.min_display_mastering_luminance=t.readUint32()}),h.createFullBoxCtor("mdhd",function(t){this.version==1?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.timescale=t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.timescale=t.readUint32(),this.duration=t.readUint32()),this.parseLanguage(t),t.readUint16()}),h.createFullBoxCtor("mehd",function(t){1&this.flags&&(T.warn("BoxParser","mehd box incorrectly uses flags set to 1, converting version to 1"),this.version=1),this.version==1?this.fragment_duration=t.readUint64():this.fragment_duration=t.readUint32()}),h.createFullBoxCtor("meta",function(t){this.boxes=[],h.ContainerBox.prototype.parse.call(this,t)}),h.createFullBoxCtor("mfhd",function(t){this.sequence_number=t.readUint32()}),h.createFullBoxCtor("mfro",function(t){this._size=t.readUint32()}),h.createFullBoxCtor("mvhd",function(t){this.version==1?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.timescale=t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.timescale=t.readUint32(),this.duration=t.readUint32()),this.rate=t.readUint32(),this.volume=t.readUint16()>>8,t.readUint16(),t.readUint32Array(2),this.matrix=t.readUint32Array(9),t.readUint32Array(6),this.next_track_id=t.readUint32()}),h.createBoxCtor("npck",function(t){this.packetssent=t.readUint32()}),h.createBoxCtor("nump",function(t){this.packetssent=t.readUint64()}),h.createFullBoxCtor("padb",function(t){var r=t.readUint32();this.padbits=[];for(var n=0;n<Math.floor((r+1)/2);n++)this.padbits=t.readUint8()}),h.createBoxCtor("pasp",function(t){this.hSpacing=t.readUint32(),this.vSpacing=t.readUint32()}),h.createBoxCtor("payl",function(t){this.text=t.readString(this.size-this.hdr_size)}),h.createBoxCtor("payt",function(t){this.payloadID=t.readUint32();var r=t.readUint8();this.rtpmap_string=t.readString(r)}),h.createFullBoxCtor("pdin",function(t){var r=(this.size-this.hdr_size)/8;this.rate=[],this.initial_delay=[];for(var n=0;n<r;n++)this.rate[n]=t.readUint32(),this.initial_delay[n]=t.readUint32()}),h.createFullBoxCtor("pitm",function(t){this.version===0?this.item_id=t.readUint16():this.item_id=t.readUint32()}),h.createFullBoxCtor("pixi",function(t){var r;for(this.num_channels=t.readUint8(),this.bits_per_channels=[],r=0;r<this.num_channels;r++)this.bits_per_channels[r]=t.readUint8()}),h.createBoxCtor("pmax",function(t){this.bytes=t.readUint32()}),h.createFullBoxCtor("prft",function(t){this.ref_track_id=t.readUint32(),this.ntp_timestamp=t.readUint64(),this.version===0?this.media_time=t.readUint32():this.media_time=t.readUint64()}),h.createFullBoxCtor("pssh",function(t){if(this.system_id=h.parseHex16(t),0<this.version){var r=t.readUint32();this.kid=[];for(var n=0;n<r;n++)this.kid[n]=h.parseHex16(t)}var a=t.readUint32();0<a&&(this.data=t.readUint8Array(a))}),h.createFullBoxCtor("clef",function(t){this.width=t.readUint32(),this.height=t.readUint32()}),h.createFullBoxCtor("enof",function(t){this.width=t.readUint32(),this.height=t.readUint32()}),h.createFullBoxCtor("prof",function(t){this.width=t.readUint32(),this.height=t.readUint32()}),h.createContainerBoxCtor("tapt",null,["clef","prof","enof"]),h.createBoxCtor("rtp ",function(t){this.descriptionformat=t.readString(4),this.sdptext=t.readString(this.size-this.hdr_size-4)}),h.createFullBoxCtor("saio",function(t){1&this.flags&&(this.aux_info_type=t.readUint32(),this.aux_info_type_parameter=t.readUint32());var r=t.readUint32();this.offset=[];for(var n=0;n<r;n++)this.version===0?this.offset[n]=t.readUint32():this.offset[n]=t.readUint64()}),h.createFullBoxCtor("saiz",function(t){1&this.flags&&(this.aux_info_type=t.readUint32(),this.aux_info_type_parameter=t.readUint32()),this.default_sample_info_size=t.readUint8();var r=t.readUint32();if(this.sample_info_size=[],this.default_sample_info_size===0)for(var n=0;n<r;n++)this.sample_info_size[n]=t.readUint8()}),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_METADATA,"mett",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)}),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_METADATA,"metx",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.namespace=t.readCString(),this.schema_location=t.readCString(),this.parseFooter(t)}),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_SUBTITLE,"sbtt",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)}),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_SUBTITLE,"stpp",function(t){this.parseHeader(t),this.namespace=t.readCString(),this.schema_location=t.readCString(),this.auxiliary_mime_types=t.readCString(),this.parseFooter(t)}),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_SUBTITLE,"stxt",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)}),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_SUBTITLE,"tx3g",function(t){this.parseHeader(t),this.displayFlags=t.readUint32(),this.horizontal_justification=t.readInt8(),this.vertical_justification=t.readInt8(),this.bg_color_rgba=t.readUint8Array(4),this.box_record=t.readInt16Array(4),this.style_record=t.readUint8Array(12),this.parseFooter(t)}),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_METADATA,"wvtt",function(t){this.parseHeader(t),this.parseFooter(t)}),h.createSampleGroupCtor("alst",function(t){var r,n=t.readUint16();for(this.first_output_sample=t.readUint16(),this.sample_offset=[],r=0;r<n;r++)this.sample_offset[r]=t.readUint32();var a=this.description_length-4-4*n;for(this.num_output_samples=[],this.num_total_samples=[],r=0;r<a/4;r++)this.num_output_samples[r]=t.readUint16(),this.num_total_samples[r]=t.readUint16()}),h.createSampleGroupCtor("avll",function(t){this.layerNumber=t.readUint8(),this.accurateStatisticsFlag=t.readUint8(),this.avgBitRate=t.readUint16(),this.avgFrameRate=t.readUint16()}),h.createSampleGroupCtor("avss",function(t){this.subSequenceIdentifier=t.readUint16(),this.layerNumber=t.readUint8();var r=t.readUint8();this.durationFlag=r>>7,this.avgRateFlag=r>>6&1,this.durationFlag&&(this.duration=t.readUint32()),this.avgRateFlag&&(this.accurateStatisticsFlag=t.readUint8(),this.avgBitRate=t.readUint16(),this.avgFrameRate=t.readUint16()),this.dependency=[];for(var n=t.readUint8(),a=0;a<n;a++){var d={};this.dependency.push(d),d.subSeqDirectionFlag=t.readUint8(),d.layerNumber=t.readUint8(),d.subSequenceIdentifier=t.readUint16()}}),h.createSampleGroupCtor("dtrt",function(t){T.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),h.createSampleGroupCtor("mvif",function(t){T.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),h.createSampleGroupCtor("prol",function(t){this.roll_distance=t.readInt16()}),h.createSampleGroupCtor("rap ",function(t){t=t.readUint8(),this.num_leading_samples_known=t>>7,this.num_leading_samples=127&t}),h.createSampleGroupCtor("rash",function(t){if(this.operation_point_count=t.readUint16(),this.description_length!==2+(this.operation_point_count===1?2:6*this.operation_point_count)+9)T.warn("BoxParser","Mismatch in "+this.grouping_type+" sample group length"),this.data=t.readUint8Array(this.description_length-2);else{if(this.operation_point_count===1)this.target_rate_share=t.readUint16();else{this.target_rate_share=[],this.available_bitrate=[];for(var r=0;r<this.operation_point_count;r++)this.available_bitrate[r]=t.readUint32(),this.target_rate_share[r]=t.readUint16()}this.maximum_bitrate=t.readUint32(),this.minimum_bitrate=t.readUint32(),this.discard_priority=t.readUint8()}}),h.createSampleGroupCtor("roll",function(t){this.roll_distance=t.readInt16()}),h.SampleGroupEntry.prototype.parse=function(t){T.warn("BoxParser","Unknown Sample Group type: "+this.grouping_type),this.data=t.readUint8Array(this.description_length)},h.createSampleGroupCtor("scif",function(t){T.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),h.createSampleGroupCtor("scnm",function(t){T.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),h.createSampleGroupCtor("seig",function(t){this.reserved=t.readUint8();var r=t.readUint8();this.crypt_byte_block=r>>4,this.skip_byte_block=15&r,this.isProtected=t.readUint8(),this.Per_Sample_IV_Size=t.readUint8(),this.KID=h.parseHex16(t),this.constant_IV_size=0,this.constant_IV=0,this.isProtected===1&&this.Per_Sample_IV_Size===0&&(this.constant_IV_size=t.readUint8(),this.constant_IV=t.readUint8Array(this.constant_IV_size))}),h.createSampleGroupCtor("stsa",function(t){T.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),h.createSampleGroupCtor("sync",function(t){t=t.readUint8(),this.NAL_unit_type=63&t}),h.createSampleGroupCtor("tele",function(t){t=t.readUint8(),this.level_independently_decodable=t>>7}),h.createSampleGroupCtor("tsas",function(t){T.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),h.createSampleGroupCtor("tscl",function(t){T.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),h.createSampleGroupCtor("vipr",function(t){T.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),h.createFullBoxCtor("sbgp",function(t){this.grouping_type=t.readString(4),this.version===1?this.grouping_type_parameter=t.readUint32():this.grouping_type_parameter=0,this.entries=[];for(var r=t.readUint32(),n=0;n<r;n++){var a={};this.entries.push(a),a.sample_count=t.readInt32(),a.group_description_index=t.readInt32()}}),h.createFullBoxCtor("schm",function(t){this.scheme_type=t.readString(4),this.scheme_version=t.readUint32(),1&this.flags&&(this.scheme_uri=t.readString(this.size-this.hdr_size-8))}),h.createBoxCtor("sdp ",function(t){this.sdptext=t.readString(this.size-this.hdr_size)}),h.createFullBoxCtor("sdtp",function(t){var r,n=this.size-this.hdr_size;this.is_leading=[],this.sample_depends_on=[],this.sample_is_depended_on=[],this.sample_has_redundancy=[];for(var a=0;a<n;a++)r=t.readUint8(),this.is_leading[a]=r>>6,this.sample_depends_on[a]=r>>4&3,this.sample_is_depended_on[a]=r>>2&3,this.sample_has_redundancy[a]=3&r}),h.createFullBoxCtor("senc"),h.createFullBoxCtor("sgpd",function(t){this.grouping_type=t.readString(4),T.debug("BoxParser","Found Sample Groups of type "+this.grouping_type),this.version===1?this.default_length=t.readUint32():this.default_length=0,2<=this.version&&(this.default_group_description_index=t.readUint32()),this.entries=[];for(var r=t.readUint32(),n=0;n<r;n++){var a=new(h[this.grouping_type+"SampleGroupEntry"]?h[this.grouping_type+"SampleGroupEntry"]:h.SampleGroupEntry)(this.grouping_type);this.entries.push(a),this.version===1&&this.default_length===0?a.description_length=t.readUint32():a.description_length=this.default_length,a.write===h.SampleGroupEntry.prototype.write&&(T.info("BoxParser","SampleGroup for type "+this.grouping_type+" writing not yet implemented, keeping unparsed data in memory for later write"),a.data=t.readUint8Array(a.description_length),t.position-=a.description_length),a.parse(t)}}),h.createFullBoxCtor("sidx",function(t){this.reference_ID=t.readUint32(),this.timescale=t.readUint32(),this.version===0?(this.earliest_presentation_time=t.readUint32(),this.first_offset=t.readUint32()):(this.earliest_presentation_time=t.readUint64(),this.first_offset=t.readUint64()),t.readUint16(),this.references=[];for(var r=t.readUint16(),n=0;n<r;n++){var a={},d=(this.references.push(a),t.readUint32());a.reference_type=d>>31&1,a.referenced_size=2147483647&d,a.subsegment_duration=t.readUint32(),d=t.readUint32(),a.starts_with_SAP=d>>31&1,a.SAP_type=d>>28&7,a.SAP_delta_time=268435455&d}}),h.SingleItemTypeReferenceBox=function(t,r,n,a){h.Box.call(this,t,r),this.hdr_size=n,this.start=a},h.SingleItemTypeReferenceBox.prototype=new h.Box,h.SingleItemTypeReferenceBox.prototype.parse=function(t){this.from_item_ID=t.readUint16();var r=t.readUint16();this.references=[];for(var n=0;n<r;n++)this.references[n]=t.readUint16()},h.SingleItemTypeReferenceBoxLarge=function(t,r,n,a){h.Box.call(this,t,r),this.hdr_size=n,this.start=a},h.SingleItemTypeReferenceBoxLarge.prototype=new h.Box,h.SingleItemTypeReferenceBoxLarge.prototype.parse=function(t){this.from_item_ID=t.readUint32();var r=t.readUint16();this.references=[];for(var n=0;n<r;n++)this.references[n]=t.readUint32()},h.createFullBoxCtor("SmDm",function(t){this.primaryRChromaticity_x=t.readUint16(),this.primaryRChromaticity_y=t.readUint16(),this.primaryGChromaticity_x=t.readUint16(),this.primaryGChromaticity_y=t.readUint16(),this.primaryBChromaticity_x=t.readUint16(),this.primaryBChromaticity_y=t.readUint16(),this.whitePointChromaticity_x=t.readUint16(),this.whitePointChromaticity_y=t.readUint16(),this.luminanceMax=t.readUint32(),this.luminanceMin=t.readUint32()}),h.createFullBoxCtor("smhd",function(t){this.balance=t.readUint16(),t.readUint16()}),h.createFullBoxCtor("ssix",function(t){this.subsegments=[];for(var r=t.readUint32(),n=0;n<r;n++){var a={};this.subsegments.push(a),a.ranges=[];for(var d=t.readUint32(),p=0;p<d;p++){var m={};a.ranges.push(m),m.level=t.readUint8(),m.range_size=t.readUint24()}}}),h.createFullBoxCtor("stco",function(t){var r=t.readUint32();if(this.chunk_offsets=[],this.version===0)for(var n=0;n<r;n++)this.chunk_offsets.push(t.readUint32())}),h.createFullBoxCtor("stdp",function(t){var r=(this.size-this.hdr_size)/2;this.priority=[];for(var n=0;n<r;n++)this.priority[n]=t.readUint16()}),h.createFullBoxCtor("sthd"),h.createFullBoxCtor("stri",function(t){this.switch_group=t.readUint16(),this.alternate_group=t.readUint16(),this.sub_track_id=t.readUint32();var r=(this.size-this.hdr_size-8)/4;this.attribute_list=[];for(var n=0;n<r;n++)this.attribute_list[n]=t.readUint32()}),h.createFullBoxCtor("stsc",function(t){var r,n=t.readUint32();if(this.first_chunk=[],this.samples_per_chunk=[],this.sample_description_index=[],this.version===0)for(r=0;r<n;r++)this.first_chunk.push(t.readUint32()),this.samples_per_chunk.push(t.readUint32()),this.sample_description_index.push(t.readUint32())}),h.createFullBoxCtor("stsd",function(t){var r,n,a,d;for(this.entries=[],a=t.readUint32(),r=1;r<=a;r++){if((n=h.parseOneBox(t,!0,this.size-(t.getPosition()-this.start))).code!==h.OK)return;h[n.type+"SampleEntry"]?((d=new h[n.type+"SampleEntry"](n.size)).hdr_size=n.hdr_size,d.start=n.start):(T.warn("BoxParser","Unknown sample entry type: "+n.type),d=new h.SampleEntry(n.type,n.size,n.hdr_size,n.start)),d.write===h.SampleEntry.prototype.write&&(T.info("BoxParser","SampleEntry "+d.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),d.parseDataAndRewind(t)),d.parse(t),this.entries.push(d)}}),h.createFullBoxCtor("stsg",function(t){this.grouping_type=t.readUint32();var r=t.readUint16();this.group_description_index=[];for(var n=0;n<r;n++)this.group_description_index[n]=t.readUint32()}),h.createFullBoxCtor("stsh",function(t){var r,n=t.readUint32();if(this.shadowed_sample_numbers=[],this.sync_sample_numbers=[],this.version===0)for(r=0;r<n;r++)this.shadowed_sample_numbers.push(t.readUint32()),this.sync_sample_numbers.push(t.readUint32())}),h.createFullBoxCtor("stss",function(t){var r,n=t.readUint32();if(this.version===0)for(this.sample_numbers=[],r=0;r<n;r++)this.sample_numbers.push(t.readUint32())}),h.createFullBoxCtor("stsz",function(t){var r;if(this.sample_sizes=[],this.version===0)for(this.sample_size=t.readUint32(),this.sample_count=t.readUint32(),r=0;r<this.sample_count;r++)this.sample_size===0?this.sample_sizes.push(t.readUint32()):this.sample_sizes[r]=this.sample_size}),h.createFullBoxCtor("stts",function(t){var r,n,a=t.readUint32();if(this.sample_counts=[],this.sample_deltas=[],this.version===0)for(r=0;r<a;r++)this.sample_counts.push(t.readUint32()),(n=t.readInt32())<0&&(T.warn("BoxParser","File uses negative stts sample delta, using value 1 instead, sync may be lost!"),n=1),this.sample_deltas.push(n)}),h.createFullBoxCtor("stvi",function(t){var n=t.readUint32();this.single_view_allowed=3&n,this.stereo_scheme=t.readUint32();var r,n=t.readUint32();for(this.stereo_indication_type=t.readString(n),this.boxes=[];t.getPosition()<this.start+this.size;){if((r=h.parseOneBox(t,!1,this.size-(t.getPosition()-this.start))).code!==h.OK)return;r=r.box,this.boxes.push(r),this[r.type]=r}}),h.createBoxCtor("styp",function(t){h.ftypBox.prototype.parse.call(this,t)}),h.createFullBoxCtor("stz2",function(t){var r,n;if(this.sample_sizes=[],this.version===0)if(this.reserved=t.readUint24(),this.field_size=t.readUint8(),n=t.readUint32(),this.field_size===4)for(r=0;r<n;r+=2){var a=t.readUint8();this.sample_sizes[r]=a>>4&15,this.sample_sizes[r+1]=15&a}else if(this.field_size===8)for(r=0;r<n;r++)this.sample_sizes[r]=t.readUint8();else if(this.field_size===16)for(r=0;r<n;r++)this.sample_sizes[r]=t.readUint16();else T.error("BoxParser","Error in length field in stz2 box")}),h.createFullBoxCtor("subs",function(t){var r,n,a,d=t.readUint32();for(this.entries=[],r=0;r<d;r++){var p={};if((this.entries[r]=p).sample_delta=t.readUint32(),p.subsamples=[],0<(a=t.readUint16()))for(n=0;n<a;n++){var m={};p.subsamples.push(m),this.version==1?m.size=t.readUint32():m.size=t.readUint16(),m.priority=t.readUint8(),m.discardable=t.readUint8(),m.codec_specific_parameters=t.readUint32()}}}),h.createFullBoxCtor("tenc",function(t){var r;t.readUint8(),this.version===0?t.readUint8():(r=t.readUint8(),this.default_crypt_byte_block=r>>4&15,this.default_skip_byte_block=15&r),this.default_isProtected=t.readUint8(),this.default_Per_Sample_IV_Size=t.readUint8(),this.default_KID=h.parseHex16(t),this.default_isProtected===1&&this.default_Per_Sample_IV_Size===0&&(this.default_constant_IV_size=t.readUint8(),this.default_constant_IV=t.readUint8Array(this.default_constant_IV_size))}),h.createFullBoxCtor("tfdt",function(t){this.version==1?this.baseMediaDecodeTime=t.readUint64():this.baseMediaDecodeTime=t.readUint32()}),h.createFullBoxCtor("tfhd",function(t){var r=0;this.track_id=t.readUint32(),this.size-this.hdr_size>r&&this.flags&h.TFHD_FLAG_BASE_DATA_OFFSET?(this.base_data_offset=t.readUint64(),r+=8):this.base_data_offset=0,this.size-this.hdr_size>r&&this.flags&h.TFHD_FLAG_SAMPLE_DESC?(this.default_sample_description_index=t.readUint32(),r+=4):this.default_sample_description_index=0,this.size-this.hdr_size>r&&this.flags&h.TFHD_FLAG_SAMPLE_DUR?(this.default_sample_duration=t.readUint32(),r+=4):this.default_sample_duration=0,this.size-this.hdr_size>r&&this.flags&h.TFHD_FLAG_SAMPLE_SIZE?(this.default_sample_size=t.readUint32(),r+=4):this.default_sample_size=0,this.size-this.hdr_size>r&&this.flags&h.TFHD_FLAG_SAMPLE_FLAGS?this.default_sample_flags=t.readUint32():this.default_sample_flags=0}),h.createFullBoxCtor("tfra",function(t){this.track_ID=t.readUint32(),t.readUint24();var r=t.readUint8();this.length_size_of_traf_num=r>>4&3,this.length_size_of_trun_num=r>>2&3,this.length_size_of_sample_num=3&r,this.entries=[];for(var n=t.readUint32(),a=0;a<n;a++)this.version===1?(this.time=t.readUint64(),this.moof_offset=t.readUint64()):(this.time=t.readUint32(),this.moof_offset=t.readUint32()),this.traf_number=t["readUint"+8*(this.length_size_of_traf_num+1)](),this.trun_number=t["readUint"+8*(this.length_size_of_trun_num+1)](),this.sample_number=t["readUint"+8*(this.length_size_of_sample_num+1)]()}),h.createFullBoxCtor("tkhd",function(t){this.version==1?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.track_id=t.readUint32(),t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.track_id=t.readUint32(),t.readUint32(),this.duration=t.readUint32()),t.readUint32Array(2),this.layer=t.readInt16(),this.alternate_group=t.readInt16(),this.volume=t.readInt16()>>8,t.readUint16(),this.matrix=t.readInt32Array(9),this.width=t.readUint32(),this.height=t.readUint32()}),h.createBoxCtor("tmax",function(t){this.time=t.readUint32()}),h.createBoxCtor("tmin",function(t){this.time=t.readUint32()}),h.createBoxCtor("totl",function(t){this.bytessent=t.readUint32()}),h.createBoxCtor("tpay",function(t){this.bytessent=t.readUint32()}),h.createBoxCtor("tpyl",function(t){this.bytessent=t.readUint64()}),h.TrackGroupTypeBox.prototype.parse=function(t){this.parseFullHeader(t),this.track_group_id=t.readUint32()},h.createTrackGroupCtor("msrc"),h.TrackReferenceTypeBox=function(t,r,n,a){h.Box.call(this,t,r),this.hdr_size=n,this.start=a},h.TrackReferenceTypeBox.prototype=new h.Box,h.TrackReferenceTypeBox.prototype.parse=function(t){this.track_ids=t.readUint32Array((this.size-this.hdr_size)/4)},h.trefBox.prototype.parse=function(t){for(var r;t.getPosition()<this.start+this.size;){if((r=h.parseOneBox(t,!0,this.size-(t.getPosition()-this.start))).code!==h.OK)return;(r=new h.TrackReferenceTypeBox(r.type,r.size,r.hdr_size,r.start)).write===h.Box.prototype.write&&r.type!=="mdat"&&(T.info("BoxParser","TrackReference "+r.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),r.parseDataAndRewind(t)),r.parse(t),this.boxes.push(r)}},h.createFullBoxCtor("trep",function(t){for(this.track_ID=t.readUint32(),this.boxes=[];t.getPosition()<this.start+this.size;){if((ret=h.parseOneBox(t,!1,this.size-(t.getPosition()-this.start))).code!==h.OK)return;box=ret.box,this.boxes.push(box)}}),h.createFullBoxCtor("trex",function(t){this.track_id=t.readUint32(),this.default_sample_description_index=t.readUint32(),this.default_sample_duration=t.readUint32(),this.default_sample_size=t.readUint32(),this.default_sample_flags=t.readUint32()}),h.createBoxCtor("trpy",function(t){this.bytessent=t.readUint64()}),h.createFullBoxCtor("trun",function(t){var r=0;if(this.sample_count=t.readUint32(),this.size-this.hdr_size>(r+=4)&&this.flags&h.TRUN_FLAGS_DATA_OFFSET?(this.data_offset=t.readInt32(),r+=4):this.data_offset=0,this.size-this.hdr_size>r&&this.flags&h.TRUN_FLAGS_FIRST_FLAG?(this.first_sample_flags=t.readUint32(),r+=4):this.first_sample_flags=0,this.sample_duration=[],this.sample_size=[],this.sample_flags=[],this.sample_composition_time_offset=[],this.size-this.hdr_size>r)for(var n=0;n<this.sample_count;n++)this.flags&h.TRUN_FLAGS_DURATION&&(this.sample_duration[n]=t.readUint32()),this.flags&h.TRUN_FLAGS_SIZE&&(this.sample_size[n]=t.readUint32()),this.flags&h.TRUN_FLAGS_FLAGS&&(this.sample_flags[n]=t.readUint32()),this.flags&h.TRUN_FLAGS_CTS_OFFSET&&(this.version===0?this.sample_composition_time_offset[n]=t.readUint32():this.sample_composition_time_offset[n]=t.readInt32())}),h.createFullBoxCtor("tsel",function(t){this.switch_group=t.readUint32();var r=(this.size-this.hdr_size-4)/4;this.attribute_list=[];for(var n=0;n<r;n++)this.attribute_list[n]=t.readUint32()}),h.createFullBoxCtor("txtC",function(t){this.config=t.readCString()}),h.createFullBoxCtor("url ",function(t){this.flags!==1&&(this.location=t.readCString())}),h.createFullBoxCtor("urn ",function(t){this.name=t.readCString(),0<this.size-this.hdr_size-this.name.length-1&&(this.location=t.readCString())}),h.createUUIDBox("a5d40b30e81411ddba2f0800200c9a66",!0,!1,function(t){this.LiveServerManifest=t.readString(this.size-this.hdr_size).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}),h.createUUIDBox("d08a4f1810f34a82b6c832d8aba183d3",!0,!1,function(t){this.system_id=h.parseHex16(t);var r=t.readUint32();0<r&&(this.data=t.readUint8Array(r))}),h.createUUIDBox("a2394f525a9b4f14a2446c427c648df4",!0,!1),h.createUUIDBox("8974dbce7be74c5184f97148f9882554",!0,!1,function(t){this.default_AlgorithmID=t.readUint24(),this.default_IV_size=t.readUint8(),this.default_KID=h.parseHex16(t)}),h.createUUIDBox("d4807ef2ca3946958e5426cb9e46a79f",!0,!1,function(t){this.fragment_count=t.readUint8(),this.entries=[];for(var r=0;r<this.fragment_count;r++){var n={},a=0,d=0,d=this.version===1?(a=t.readUint64(),t.readUint64()):(a=t.readUint32(),t.readUint32());n.absolute_time=a,n.absolute_duration=d,this.entries.push(n)}}),h.createUUIDBox("6d1d9b0542d544e680e2141daff757b2",!0,!1,function(t){this.version===1?(this.absolute_time=t.readUint64(),this.duration=t.readUint64()):(this.absolute_time=t.readUint32(),this.duration=t.readUint32())}),h.createFullBoxCtor("vmhd",function(t){this.graphicsmode=t.readUint16(),this.opcolor=t.readUint16Array(3)}),h.createFullBoxCtor("vpcC",function(t){var r;this.version===1?(this.profile=t.readUint8(),this.level=t.readUint8(),r=t.readUint8(),this.bitDepth=r>>4,this.chromaSubsampling=r>>1&7,this.videoFullRangeFlag=1&r,this.colourPrimaries=t.readUint8(),this.transferCharacteristics=t.readUint8(),this.matrixCoefficients=t.readUint8()):(this.profile=t.readUint8(),this.level=t.readUint8(),r=t.readUint8(),this.bitDepth=r>>4&15,this.colorSpace=15&r,r=t.readUint8(),this.chromaSubsampling=r>>4&15,this.transferFunction=r>>1&7,this.videoFullRangeFlag=1&r),this.codecIntializationDataSize=t.readUint16(),this.codecIntializationData=t.readUint8Array(this.codecIntializationDataSize)}),h.createBoxCtor("vttC",function(t){this.text=t.readString(this.size-this.hdr_size)}),h.createFullBoxCtor("vvcC",function(t){var r,n={held_bits:void 0,num_held_bits:0,stream_read_1_bytes:function(y){this.held_bits=y.readUint8(),this.num_held_bits=8},stream_read_2_bytes:function(y){this.held_bits=y.readUint16(),this.num_held_bits=16},extract_bits:function(y){var S=this.held_bits>>this.num_held_bits-y&(1<<y)-1;return this.num_held_bits-=y,S}};if(n.stream_read_1_bytes(t),n.extract_bits(5),this.lengthSizeMinusOne=n.extract_bits(2),this.ptl_present_flag=n.extract_bits(1),this.ptl_present_flag){if(n.stream_read_2_bytes(t),this.ols_idx=n.extract_bits(9),this.num_sublayers=n.extract_bits(3),this.constant_frame_rate=n.extract_bits(2),this.chroma_format_idc=n.extract_bits(2),n.stream_read_1_bytes(t),this.bit_depth_minus8=n.extract_bits(3),n.extract_bits(5),n.stream_read_2_bytes(t),n.extract_bits(2),this.num_bytes_constraint_info=n.extract_bits(6),this.general_profile_idc=n.extract_bits(7),this.general_tier_flag=n.extract_bits(1),this.general_level_idc=t.readUint8(),n.stream_read_1_bytes(t),this.ptl_frame_only_constraint_flag=n.extract_bits(1),this.ptl_multilayer_enabled_flag=n.extract_bits(1),this.general_constraint_info=new Uint8Array(this.num_bytes_constraint_info),this.num_bytes_constraint_info){for(x=0;x<this.num_bytes_constraint_info-1;x++){var a=n.extract_bits(6),d=(n.stream_read_1_bytes(t),n.extract_bits(2));this.general_constraint_info[x]=a<<2|d}this.general_constraint_info[this.num_bytes_constraint_info-1]=n.extract_bits(6)}else n.extract_bits(6);for(n.stream_read_1_bytes(t),this.ptl_sublayer_present_mask=0,r=this.num_sublayers-2;0<=r;--r){var p=n.extract_bits(1);this.ptl_sublayer_present_mask|=p<<r}for(r=this.num_sublayers;r<=8&&1<this.num_sublayers;++r)n.extract_bits(1);for(r=this.num_sublayers-2;0<=r;--r)this.ptl_sublayer_present_mask&1<<r&&(this.sublayer_level_idc[r]=t.readUint8());if(this.ptl_num_sub_profiles=t.readUint8(),this.general_sub_profile_idc=[],this.ptl_num_sub_profiles)for(x=0;x<this.ptl_num_sub_profiles;x++)this.general_sub_profile_idc.push(t.readUint32());this.max_picture_width=t.readUint16(),this.max_picture_height=t.readUint16(),this.avg_frame_rate=t.readUint16()}this.nalu_arrays=[];for(var m=t.readUint8(),x=0;x<m;x++){var b=[],C=(this.nalu_arrays.push(b),n.stream_read_1_bytes(t),b.completeness=n.extract_bits(1),n.extract_bits(2),b.nalu_type=n.extract_bits(5),1);for(b.nalu_type!=13&&b.nalu_type!=12&&(C=t.readUint16()),r=0;r<C;r++){var v=t.readUint16();b.push({data:t.readUint8Array(v),length:v})}}}),h.createFullBoxCtor("vvnC",function(t){var r=strm.readUint8();this.lengthSizeMinusOne=3&r}),h.SampleEntry.prototype.isVideo=function(){return!1},h.SampleEntry.prototype.isAudio=function(){return!1},h.SampleEntry.prototype.isSubtitle=function(){return!1},h.SampleEntry.prototype.isMetadata=function(){return!1},h.SampleEntry.prototype.isHint=function(){return!1},h.SampleEntry.prototype.getCodec=function(){return this.type.replace(".","")},h.SampleEntry.prototype.getWidth=function(){return""},h.SampleEntry.prototype.getHeight=function(){return""},h.SampleEntry.prototype.getChannelCount=function(){return""},h.SampleEntry.prototype.getSampleRate=function(){return""},h.SampleEntry.prototype.getSampleSize=function(){return""},h.VisualSampleEntry.prototype.isVideo=function(){return!0},h.VisualSampleEntry.prototype.getWidth=function(){return this.width},h.VisualSampleEntry.prototype.getHeight=function(){return this.height},h.AudioSampleEntry.prototype.isAudio=function(){return!0},h.AudioSampleEntry.prototype.getChannelCount=function(){return this.channel_count},h.AudioSampleEntry.prototype.getSampleRate=function(){return this.samplerate},h.AudioSampleEntry.prototype.getSampleSize=function(){return this.samplesize},h.SubtitleSampleEntry.prototype.isSubtitle=function(){return!0},h.MetadataSampleEntry.prototype.isMetadata=function(){return!0},h.decimalToHex=function(t,r){var n=Number(t).toString(16);for(r=r??2;n.length<r;)n="0"+n;return n},h.avc1SampleEntry.prototype.getCodec=h.avc2SampleEntry.prototype.getCodec=h.avc3SampleEntry.prototype.getCodec=h.avc4SampleEntry.prototype.getCodec=function(){var t=h.SampleEntry.prototype.getCodec.call(this);return this.avcC?t+"."+h.decimalToHex(this.avcC.AVCProfileIndication)+h.decimalToHex(this.avcC.profile_compatibility)+h.decimalToHex(this.avcC.AVCLevelIndication):t},h.hev1SampleEntry.prototype.getCodec=h.hvc1SampleEntry.prototype.getCodec=function(){var t=h.SampleEntry.prototype.getCodec.call(this);if(this.hvcC){switch(t+=".",this.hvcC.general_profile_space){case 0:t+="";break;case 1:t+="A";break;case 2:t+="B";break;case 3:t+="C"}for(var t=t+this.hvcC.general_profile_idc+".",r=this.hvcC.general_profile_compatibility,n=0,a=0;a<32&&(n|=1&r,a!=31);a++)n<<=1,r>>=1;t=t+h.decimalToHex(n,0)+".",this.hvcC.general_tier_flag===0?t+="L":t+="H",t+=this.hvcC.general_level_idc;var d=!1,p="";for(a=5;0<=a;a--)(this.hvcC.general_constraint_indicator[a]||d)&&(p="."+h.decimalToHex(this.hvcC.general_constraint_indicator[a],0)+p,d=!0);t+=p}return t},h.vvc1SampleEntry.prototype.getCodec=h.vvi1SampleEntry.prototype.getCodec=function(){var t=h.SampleEntry.prototype.getCodec.call(this);if(this.vvcC){t+="."+this.vvcC.general_profile_idc,this.vvcC.general_tier_flag?t+=".H":t+=".L",t+=this.vvcC.general_level_idc;var r="";if(this.vvcC.general_constraint_info){var n,a=[],d=0,d=(d|=this.vvcC.ptl_frame_only_constraint<<7)|this.vvcC.ptl_multilayer_enabled<<6;for(b=0;b<this.vvcC.general_constraint_info.length;++b)d|=this.vvcC.general_constraint_info[b]>>2&63,a.push(d),d&&(n=b),d=this.vvcC.general_constraint_info[b]>>2&3;if(n===void 0)r=".CA";else{for(var r=".C",p="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",m=0,x=0,b=0;b<=n;++b)for(m=m<<8|a[b],x+=8;5<=x;)r+=p[m>>x-5&31],m&=(1<<(x-=5))-1;x&&(r+=p[31&(m<<=5-x)])}}t+=r}return t},h.mp4aSampleEntry.prototype.getCodec=function(){var t,r,n=h.SampleEntry.prototype.getCodec.call(this);return this.esds&&this.esds.esd?(t=this.esds.esd.getOTI(),r=this.esds.esd.getAudioConfig(),n+"."+h.decimalToHex(t)+(r?"."+r:"")):n},h.stxtSampleEntry.prototype.getCodec=function(){var t=h.SampleEntry.prototype.getCodec.call(this);return this.mime_format?t+"."+this.mime_format:t},h.vp08SampleEntry.prototype.getCodec=h.vp09SampleEntry.prototype.getCodec=function(){var t=h.SampleEntry.prototype.getCodec.call(this),r=this.vpcC.level,n=this.vpcC.bitDepth;return t+".0"+this.vpcC.profile+"."+(r=r==0?"00":r)+"."+(n=n==8?"08":n)},h.av01SampleEntry.prototype.getCodec=function(){var t,r=h.SampleEntry.prototype.getCodec.call(this),n=this.av1C.seq_level_idx_0;return this.av1C.seq_profile===2&&this.av1C.high_bitdepth===1?t=this.av1C.twelve_bit===1?"12":"10":this.av1C.seq_profile<=2&&(t=this.av1C.high_bitdepth===1?"10":"08"),r+"."+this.av1C.seq_profile+"."+(n=n<10?"0"+n:n)+(this.av1C.seq_tier_0?"H":"M")+"."+t},h.Box.prototype.writeHeader=function(t,r){this.size+=8,this.size>E&&(this.size+=8),this.type==="uuid"&&(this.size+=16),T.debug("BoxWriter","Writing box "+this.type+" of size: "+this.size+" at position "+t.getPosition()+(r||"")),this.size>E?t.writeUint32(1):(this.sizePosition=t.getPosition(),t.writeUint32(this.size)),t.writeString(this.type,null,4),this.type==="uuid"&&t.writeUint8Array(this.uuid),this.size>E&&t.writeUint64(this.size)},h.FullBox.prototype.writeHeader=function(t){this.size+=4,h.Box.prototype.writeHeader.call(this,t," v="+this.version+" f="+this.flags),t.writeUint8(this.version),t.writeUint24(this.flags)},h.Box.prototype.write=function(t){this.type==="mdat"?this.data&&(this.size=this.data.length,this.writeHeader(t),t.writeUint8Array(this.data)):(this.size=this.data?this.data.length:0,this.writeHeader(t),this.data&&t.writeUint8Array(this.data))},h.ContainerBox.prototype.write=function(t){this.size=0,this.writeHeader(t);for(var r=0;r<this.boxes.length;r++)this.boxes[r]&&(this.boxes[r].write(t),this.size+=this.boxes[r].size);T.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},h.TrackReferenceTypeBox.prototype.write=function(t){this.size=4*this.track_ids.length,this.writeHeader(t),t.writeUint32Array(this.track_ids)},h.avcCBox.prototype.write=function(t){var r;for(this.size=7,r=0;r<this.SPS.length;r++)this.size+=2+this.SPS[r].length;for(r=0;r<this.PPS.length;r++)this.size+=2+this.PPS[r].length;for(this.ext&&(this.size+=this.ext.length),this.writeHeader(t),t.writeUint8(this.configurationVersion),t.writeUint8(this.AVCProfileIndication),t.writeUint8(this.profile_compatibility),t.writeUint8(this.AVCLevelIndication),t.writeUint8(this.lengthSizeMinusOne+252),t.writeUint8(this.SPS.length+224),r=0;r<this.SPS.length;r++)t.writeUint16(this.SPS[r].length),t.writeUint8Array(this.SPS[r].nalu);for(t.writeUint8(this.PPS.length),r=0;r<this.PPS.length;r++)t.writeUint16(this.PPS[r].length),t.writeUint8Array(this.PPS[r].nalu);this.ext&&t.writeUint8Array(this.ext)},h.co64Box.prototype.write=function(t){var r;for(this.version=0,this.flags=0,this.size=4+8*this.chunk_offsets.length,this.writeHeader(t),t.writeUint32(this.chunk_offsets.length),r=0;r<this.chunk_offsets.length;r++)t.writeUint64(this.chunk_offsets[r])},h.cslgBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=20,this.writeHeader(t),t.writeInt32(this.compositionToDTSShift),t.writeInt32(this.leastDecodeToDisplayDelta),t.writeInt32(this.greatestDecodeToDisplayDelta),t.writeInt32(this.compositionStartTime),t.writeInt32(this.compositionEndTime)},h.cttsBox.prototype.write=function(t){var r;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(t),t.writeUint32(this.sample_counts.length),r=0;r<this.sample_counts.length;r++)t.writeUint32(this.sample_counts[r]),this.version===1?t.writeInt32(this.sample_offsets[r]):t.writeUint32(this.sample_offsets[r])},h.drefBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.entries.length);for(var r=0;r<this.entries.length;r++)this.entries[r].write(t),this.size+=this.entries[r].size;T.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},h.elngBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=this.extended_language.length,this.writeHeader(t),t.writeString(this.extended_language)},h.elstBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+12*this.entries.length,this.writeHeader(t),t.writeUint32(this.entries.length);for(var r=0;r<this.entries.length;r++){var n=this.entries[r];t.writeUint32(n.segment_duration),t.writeInt32(n.media_time),t.writeInt16(n.media_rate_integer),t.writeInt16(n.media_rate_fraction)}},h.emsgBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=16+this.message_data.length+(this.scheme_id_uri.length+1)+(this.value.length+1),this.writeHeader(t),t.writeCString(this.scheme_id_uri),t.writeCString(this.value),t.writeUint32(this.timescale),t.writeUint32(this.presentation_time_delta),t.writeUint32(this.event_duration),t.writeUint32(this.id),t.writeUint8Array(this.message_data)},h.ftypBox.prototype.write=function(t){this.size=8+4*this.compatible_brands.length,this.writeHeader(t),t.writeString(this.major_brand,null,4),t.writeUint32(this.minor_version);for(var r=0;r<this.compatible_brands.length;r++)t.writeString(this.compatible_brands[r],null,4)},h.hdlrBox.prototype.write=function(t){this.size=20+this.name.length+1,this.version=0,this.flags=0,this.writeHeader(t),t.writeUint32(0),t.writeString(this.handler,null,4),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeCString(this.name)},h.kindBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=this.schemeURI.length+1+(this.value.length+1),this.writeHeader(t),t.writeCString(this.schemeURI),t.writeCString(this.value)},h.mdhdBox.prototype.write=function(t){this.size=20,this.flags=0,this.version=0,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.timescale),t.writeUint32(this.duration),t.writeUint16(this.language),t.writeUint16(0)},h.mehdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.fragment_duration)},h.mfhdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.sequence_number)},h.mvhdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=96,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.timescale),t.writeUint32(this.duration),t.writeUint32(this.rate),t.writeUint16(this.volume<<8),t.writeUint16(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32Array(this.matrix),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(this.next_track_id)},h.SampleEntry.prototype.writeHeader=function(t){this.size=8,h.Box.prototype.writeHeader.call(this,t),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint16(this.data_reference_index)},h.SampleEntry.prototype.writeFooter=function(t){for(var r=0;r<this.boxes.length;r++)this.boxes[r].write(t),this.size+=this.boxes[r].size;T.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},h.SampleEntry.prototype.write=function(t){this.writeHeader(t),t.writeUint8Array(this.data),this.size+=this.data.length,T.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},h.VisualSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=70,t.writeUint16(0),t.writeUint16(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint16(this.width),t.writeUint16(this.height),t.writeUint32(this.horizresolution),t.writeUint32(this.vertresolution),t.writeUint32(0),t.writeUint16(this.frame_count),t.writeUint8(Math.min(31,this.compressorname.length)),t.writeString(this.compressorname,null,31),t.writeUint16(this.depth),t.writeInt16(-1),this.writeFooter(t)},h.AudioSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=20,t.writeUint32(0),t.writeUint32(0),t.writeUint16(this.channel_count),t.writeUint16(this.samplesize),t.writeUint16(0),t.writeUint16(0),t.writeUint32(this.samplerate<<16),this.writeFooter(t)},h.stppSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=this.namespace.length+1+this.schema_location.length+1+this.auxiliary_mime_types.length+1,t.writeCString(this.namespace),t.writeCString(this.schema_location),t.writeCString(this.auxiliary_mime_types),this.writeFooter(t)},h.SampleGroupEntry.prototype.write=function(t){t.writeUint8Array(this.data)},h.sbgpBox.prototype.write=function(t){this.version=1,this.flags=0,this.size=12+8*this.entries.length,this.writeHeader(t),t.writeString(this.grouping_type,null,4),t.writeUint32(this.grouping_type_parameter),t.writeUint32(this.entries.length);for(var r=0;r<this.entries.length;r++){var n=this.entries[r];t.writeInt32(n.sample_count),t.writeInt32(n.group_description_index)}},h.sgpdBox.prototype.write=function(t){var r,n;for(this.flags=0,this.size=12,r=0;r<this.entries.length;r++)n=this.entries[r],this.version===1&&(this.default_length===0&&(this.size+=4),this.size+=n.data.length);for(this.writeHeader(t),t.writeString(this.grouping_type,null,4),this.version===1&&t.writeUint32(this.default_length),2<=this.version&&t.writeUint32(this.default_sample_description_index),t.writeUint32(this.entries.length),r=0;r<this.entries.length;r++)n=this.entries[r],this.version===1&&this.default_length===0&&t.writeUint32(n.description_length),n.write(t)},h.sidxBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=20+12*this.references.length,this.writeHeader(t),t.writeUint32(this.reference_ID),t.writeUint32(this.timescale),t.writeUint32(this.earliest_presentation_time),t.writeUint32(this.first_offset),t.writeUint16(0),t.writeUint16(this.references.length);for(var r=0;r<this.references.length;r++){var n=this.references[r];t.writeUint32(n.reference_type<<31|n.referenced_size),t.writeUint32(n.subsegment_duration),t.writeUint32(n.starts_with_SAP<<31|n.SAP_type<<28|n.SAP_delta_time)}},h.smhdBox.prototype.write=function(t){this.version=0,this.flags=1,this.size=4,this.writeHeader(t),t.writeUint16(this.balance),t.writeUint16(0)},h.stcoBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+4*this.chunk_offsets.length,this.writeHeader(t),t.writeUint32(this.chunk_offsets.length),t.writeUint32Array(this.chunk_offsets)},h.stscBox.prototype.write=function(t){var r;for(this.version=0,this.flags=0,this.size=4+12*this.first_chunk.length,this.writeHeader(t),t.writeUint32(this.first_chunk.length),r=0;r<this.first_chunk.length;r++)t.writeUint32(this.first_chunk[r]),t.writeUint32(this.samples_per_chunk[r]),t.writeUint32(this.sample_description_index[r])},h.stsdBox.prototype.write=function(t){var r;for(this.version=0,this.flags=0,this.size=0,this.writeHeader(t),t.writeUint32(this.entries.length),this.size+=4,r=0;r<this.entries.length;r++)this.entries[r].write(t),this.size+=this.entries[r].size;T.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},h.stshBox.prototype.write=function(t){var r;for(this.version=0,this.flags=0,this.size=4+8*this.shadowed_sample_numbers.length,this.writeHeader(t),t.writeUint32(this.shadowed_sample_numbers.length),r=0;r<this.shadowed_sample_numbers.length;r++)t.writeUint32(this.shadowed_sample_numbers[r]),t.writeUint32(this.sync_sample_numbers[r])},h.stssBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+4*this.sample_numbers.length,this.writeHeader(t),t.writeUint32(this.sample_numbers.length),t.writeUint32Array(this.sample_numbers)},h.stszBox.prototype.write=function(t){var r,n=!0;if(this.version=0,(this.flags=0)<this.sample_sizes.length)for(r=0;r+1<this.sample_sizes.length;){if(this.sample_sizes[r+1]!==this.sample_sizes[0]){n=!1;break}r++}else n=!1;this.size=8,n||(this.size+=4*this.sample_sizes.length),this.writeHeader(t),n?t.writeUint32(this.sample_sizes[0]):t.writeUint32(0),t.writeUint32(this.sample_sizes.length),n||t.writeUint32Array(this.sample_sizes)},h.sttsBox.prototype.write=function(t){var r;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(t),t.writeUint32(this.sample_counts.length),r=0;r<this.sample_counts.length;r++)t.writeUint32(this.sample_counts[r]),t.writeUint32(this.sample_deltas[r])},h.tfdtBox.prototype.write=function(t){var r=Math.pow(2,32)-1;this.version=this.baseMediaDecodeTime>r?1:0,this.flags=0,this.size=4,this.version===1&&(this.size+=4),this.writeHeader(t),this.version===1?t.writeUint64(this.baseMediaDecodeTime):t.writeUint32(this.baseMediaDecodeTime)},h.tfhdBox.prototype.write=function(t){this.version=0,this.size=4,this.flags&h.TFHD_FLAG_BASE_DATA_OFFSET&&(this.size+=8),this.flags&h.TFHD_FLAG_SAMPLE_DESC&&(this.size+=4),this.flags&h.TFHD_FLAG_SAMPLE_DUR&&(this.size+=4),this.flags&h.TFHD_FLAG_SAMPLE_SIZE&&(this.size+=4),this.flags&h.TFHD_FLAG_SAMPLE_FLAGS&&(this.size+=4),this.writeHeader(t),t.writeUint32(this.track_id),this.flags&h.TFHD_FLAG_BASE_DATA_OFFSET&&t.writeUint64(this.base_data_offset),this.flags&h.TFHD_FLAG_SAMPLE_DESC&&t.writeUint32(this.default_sample_description_index),this.flags&h.TFHD_FLAG_SAMPLE_DUR&&t.writeUint32(this.default_sample_duration),this.flags&h.TFHD_FLAG_SAMPLE_SIZE&&t.writeUint32(this.default_sample_size),this.flags&h.TFHD_FLAG_SAMPLE_FLAGS&&t.writeUint32(this.default_sample_flags)},h.tkhdBox.prototype.write=function(t){this.version=0,this.size=80,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.track_id),t.writeUint32(0),t.writeUint32(this.duration),t.writeUint32(0),t.writeUint32(0),t.writeInt16(this.layer),t.writeInt16(this.alternate_group),t.writeInt16(this.volume<<8),t.writeUint16(0),t.writeInt32Array(this.matrix),t.writeUint32(this.width),t.writeUint32(this.height)},h.trexBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=20,this.writeHeader(t),t.writeUint32(this.track_id),t.writeUint32(this.default_sample_description_index),t.writeUint32(this.default_sample_duration),t.writeUint32(this.default_sample_size),t.writeUint32(this.default_sample_flags)},h.trunBox.prototype.write=function(t){this.version=0,this.size=4,this.flags&h.TRUN_FLAGS_DATA_OFFSET&&(this.size+=4),this.flags&h.TRUN_FLAGS_FIRST_FLAG&&(this.size+=4),this.flags&h.TRUN_FLAGS_DURATION&&(this.size+=4*this.sample_duration.length),this.flags&h.TRUN_FLAGS_SIZE&&(this.size+=4*this.sample_size.length),this.flags&h.TRUN_FLAGS_FLAGS&&(this.size+=4*this.sample_flags.length),this.flags&h.TRUN_FLAGS_CTS_OFFSET&&(this.size+=4*this.sample_composition_time_offset.length),this.writeHeader(t),t.writeUint32(this.sample_count),this.flags&h.TRUN_FLAGS_DATA_OFFSET&&(this.data_offset_position=t.getPosition(),t.writeInt32(this.data_offset)),this.flags&h.TRUN_FLAGS_FIRST_FLAG&&t.writeUint32(this.first_sample_flags);for(var r=0;r<this.sample_count;r++)this.flags&h.TRUN_FLAGS_DURATION&&t.writeUint32(this.sample_duration[r]),this.flags&h.TRUN_FLAGS_SIZE&&t.writeUint32(this.sample_size[r]),this.flags&h.TRUN_FLAGS_FLAGS&&t.writeUint32(this.sample_flags[r]),this.flags&h.TRUN_FLAGS_CTS_OFFSET&&(this.version===0?t.writeUint32(this.sample_composition_time_offset[r]):t.writeInt32(this.sample_composition_time_offset[r]))},h["url Box"].prototype.write=function(t){this.version=0,this.location?(this.flags=0,this.size=this.location.length+1):(this.flags=1,this.size=0),this.writeHeader(t),this.location&&t.writeCString(this.location)},h["urn Box"].prototype.write=function(t){this.version=0,this.flags=0,this.size=this.name.length+1+(this.location?this.location.length+1:0),this.writeHeader(t),t.writeCString(this.name),this.location&&t.writeCString(this.location)},h.vmhdBox.prototype.write=function(t){this.version=0,this.flags=1,this.size=8,this.writeHeader(t),t.writeUint16(this.graphicsmode),t.writeUint16Array(this.opcolor)},h.cttsBox.prototype.unpack=function(t){for(var r,n=0,a=0;a<this.sample_counts.length;a++)for(r=0;r<this.sample_counts[a];r++)t[n].pts=t[n].dts+this.sample_offsets[a],n++},h.sttsBox.prototype.unpack=function(t){for(var r,n=0,a=0;a<this.sample_counts.length;a++)for(r=0;r<this.sample_counts[a];r++)t[n].dts=n===0?0:t[n-1].dts+this.sample_deltas[a],n++},h.stcoBox.prototype.unpack=function(t){for(var r=0;r<this.chunk_offsets.length;r++)t[r].offset=this.chunk_offsets[r]},h.stscBox.prototype.unpack=function(t){for(var r,n,a=0,d=0,p=0;p<this.first_chunk.length;p++)for(r=0;r<(p+1<this.first_chunk.length?this.first_chunk[p+1]:1/0);r++)for(d++,n=0;n<this.samples_per_chunk[p];n++){if(!t[a])return;t[a].description_index=this.sample_description_index[p],t[a].chunk_index=d,a++}},h.stszBox.prototype.unpack=function(t){for(var r=0;r<this.sample_sizes.length;r++)t[r].size=this.sample_sizes[r]},h.DIFF_BOXES_PROP_NAMES=["boxes","entries","references","subsamples","items","item_infos","extents","associations","subsegments","ranges","seekLists","seekPoints","esd","levels"],h.DIFF_PRIMITIVE_ARRAY_PROP_NAMES=["compatible_brands","matrix","opcolor","sample_counts","sample_counts","sample_deltas","first_chunk","samples_per_chunk","sample_sizes","chunk_offsets","sample_offsets","sample_description_index","sample_duration"],h.boxEqualFields=function(t,r){if(t&&!r)return!1;for(var n in t)if(!(-1<h.DIFF_BOXES_PROP_NAMES.indexOf(n)||t[n]instanceof h.Box||r[n]instanceof h.Box||t[n]===void 0||r[n]===void 0||typeof t[n]=="function"||typeof r[n]=="function"||t.subBoxNames&&-1<t.subBoxNames.indexOf(n.slice(0,4))||r.subBoxNames&&-1<r.subBoxNames.indexOf(n.slice(0,4))||n==="data"||n==="start"||n==="size"||n==="creation_time"||n==="modification_time"||-1<h.DIFF_PRIMITIVE_ARRAY_PROP_NAMES.indexOf(n)||t[n]===r[n]))return!1;return!0},h.boxEqual=function(t,r){if(!h.boxEqualFields(t,r))return!1;for(var n=0;n<h.DIFF_BOXES_PROP_NAMES.length;n++){var a=h.DIFF_BOXES_PROP_NAMES[n];if(t[a]&&r[a]&&!h.boxEqual(t[a],r[a]))return!1}return!0},l.prototype.parseSample=function(t){var r,n={resources:[]},a=new i(t.data.buffer);if(t.subsamples&&t.subsamples.length!==0){if(n.documentString=a.readString(t.subsamples[0].size),1<t.subsamples.length)for(r=1;r<t.subsamples.length;r++)n.resources[r]=a.readUint8Array(t.subsamples[r].size)}else n.documentString=a.readString(t.data.length);return typeof DOMParser<"u"&&(n.document=new DOMParser().parseFromString(n.documentString,"application/xml")),n},o.prototype.parseSample=function(t){return new i(t.data.buffer).readString(t.data.length)},o.prototype.parseConfig=function(t){return t=new i(t.buffer),t.readUint32(),t.readCString()},e.XMLSubtitlein4Parser=l,e.Textin4Parser=o,f.prototype.setSegmentOptions=function(t,r,n){var a,d=this.getTrackById(t);d&&(this.fragmentedTracks.push(a={}),a.id=t,a.user=r,(a.trak=d).nextSample=0,a.segmentStream=null,a.nb_samples=1e3,a.rapAlignement=!0,n)&&(n.nbSamples&&(a.nb_samples=n.nbSamples),n.rapAlignement)&&(a.rapAlignement=n.rapAlignement)},f.prototype.unsetSegmentOptions=function(t){for(var r=-1,n=0;n<this.fragmentedTracks.length;n++)this.fragmentedTracks[n].id==t&&(r=n);-1<r&&this.fragmentedTracks.splice(r,1)},f.prototype.setExtractionOptions=function(t,r,n){var a,d=this.getTrackById(t);d&&(this.extractedTracks.push(a={}),a.id=t,a.user=r,(a.trak=d).nextSample=0,a.nb_samples=1e3,a.samples=[],n)&&n.nbSamples&&(a.nb_samples=n.nbSamples)},f.prototype.unsetExtractionOptions=function(t){for(var r=-1,n=0;n<this.extractedTracks.length;n++)this.extractedTracks[n].id==t&&(r=n);-1<r&&this.extractedTracks.splice(r,1)},f.prototype.parse=function(){var t,r;if(!this.restoreParsePosition||this.restoreParsePosition())for(;;){if(this.hasIncompleteMdat&&this.hasIncompleteMdat()){if(this.processIncompleteMdat())continue;return}if(this.saveParsePosition&&this.saveParsePosition(),(t=h.parseOneBox(this.stream,!1)).code===h.ERR_NOT_ENOUGH_DATA){if(this.processIncompleteBox){if(this.processIncompleteBox(t))continue;return}return}var n=(r=t.box).type!=="uuid"?r.type:r.uuid;switch(this.boxes.push(r),n){case"mdat":this.mdats.push(r);break;case"moof":this.moofs.push(r);break;case"moov":this.moovStartFound=!0,this.mdats.length===0&&(this.isProgressive=!0);default:this[n]!==void 0&&T.warn("ISOFile","Duplicate Box of type: "+n+", overriding previous occurrence"),this[n]=r}this.updateUsedBytes&&this.updateUsedBytes(r,t)}},f.prototype.checkBuffer=function(t){if(t==null)throw"Buffer must be defined and non empty";if(t.fileStart===void 0)throw"Buffer must have a fileStart property";return t.byteLength===0?(T.warn("ISOFile","Ignoring empty buffer (fileStart: "+t.fileStart+")"),this.stream.logBufferLevel(),!1):(T.info("ISOFile","Processing buffer (fileStart: "+t.fileStart+")"),t.usedBytes=0,this.stream.insertBuffer(t),this.stream.logBufferLevel(),!!this.stream.initialized()||(T.warn("ISOFile","Not ready to start parsing"),!1))},f.prototype.appendBuffer=function(t,r){var n;if(this.checkBuffer(t))return this.parse(),this.moovStartFound&&!this.moovStartSent&&(this.moovStartSent=!0,this.onMoovStart)&&this.onMoovStart(),this.moov?(this.sampleListBuilt||(this.buildSampleLists(),this.sampleListBuilt=!0),this.updateSampleLists(),this.onReady&&!this.readySent&&(this.readySent=!0,this.onReady(this.getInfo())),this.processSamples(r),this.nextSeekPosition?(n=this.nextSeekPosition,this.nextSeekPosition=void 0):n=this.nextParsePosition,this.stream.getEndFilePositionAfter&&(n=this.stream.getEndFilePositionAfter(n))):n=this.nextParsePosition||0,this.sidx&&this.onSidx&&!this.sidxSent&&(this.onSidx(this.sidx),this.sidxSent=!0),this.meta&&(this.flattenItemInfo&&!this.itemListBuilt&&(this.flattenItemInfo(),this.itemListBuilt=!0),this.processItems)&&this.processItems(this.onItem),this.stream.cleanBuffers&&(T.info("ISOFile","Done processing buffer (fileStart: "+t.fileStart+") - next buffer to fetch should have a fileStart position of "+n),this.stream.logBufferLevel(),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0),T.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize())),n},f.prototype.getInfo=function(){var t,r,n,a,d,p,m={},x=new Date("1904-01-01T00:00:00Z").getTime();if(this.moov)for(m.hasMoov=!0,m.duration=this.moov.mvhd.duration,m.timescale=this.moov.mvhd.timescale,m.isFragmented=this.moov.mvex!=null,m.isFragmented&&this.moov.mvex.mehd&&(m.fragment_duration=this.moov.mvex.mehd.fragment_duration),m.isProgressive=this.isProgressive,m.hasIOD=this.moov.iods!=null,m.brands=[],m.brands.push(this.ftyp.major_brand),m.brands=m.brands.concat(this.ftyp.compatible_brands),m.created=new Date(x+1e3*this.moov.mvhd.creation_time),m.modified=new Date(x+1e3*this.moov.mvhd.modification_time),m.tracks=[],m.audioTracks=[],m.videoTracks=[],m.subtitleTracks=[],m.metadataTracks=[],m.hintTracks=[],m.otherTracks=[],t=0;t<this.moov.traks.length;t++){if(p=(n=this.moov.traks[t]).mdia.minf.stbl.stsd.entries[0],m.tracks.push(a={}),a.id=n.tkhd.track_id,a.name=n.mdia.hdlr.name,a.references=[],n.tref)for(r=0;r<n.tref.boxes.length;r++)a.references.push(d={}),d.type=n.tref.boxes[r].type,d.track_ids=n.tref.boxes[r].track_ids;n.edts&&(a.edits=n.edts.elst.entries),a.created=new Date(x+1e3*n.tkhd.creation_time),a.modified=new Date(x+1e3*n.tkhd.modification_time),a.movie_duration=n.tkhd.duration,a.movie_timescale=m.timescale,a.layer=n.tkhd.layer,a.alternate_group=n.tkhd.alternate_group,a.volume=n.tkhd.volume,a.matrix=n.tkhd.matrix,a.track_width=n.tkhd.width/65536,a.track_height=n.tkhd.height/65536,a.timescale=n.mdia.mdhd.timescale,a.cts_shift=n.mdia.minf.stbl.cslg,a.duration=n.mdia.mdhd.duration,a.samples_duration=n.samples_duration,a.codec=p.getCodec(),a.kind=n.udta&&n.udta.kinds.length?n.udta.kinds[0]:{schemeURI:"",value:""},a.language=n.mdia.elng?n.mdia.elng.extended_language:n.mdia.mdhd.languageString,a.nb_samples=n.samples.length,a.size=n.samples_size,a.bitrate=8*a.size*a.timescale/a.samples_duration,p.isAudio()?(a.type="audio",m.audioTracks.push(a),a.audio={},a.audio.sample_rate=p.getSampleRate(),a.audio.channel_count=p.getChannelCount(),a.audio.sample_size=p.getSampleSize()):p.isVideo()?(a.type="video",m.videoTracks.push(a),a.video={},a.video.width=p.getWidth(),a.video.height=p.getHeight()):(p.isSubtitle()?(a.type="subtitles",m.subtitleTracks):p.isHint()?(a.type="metadata",m.hintTracks):p.isMetadata()?(a.type="metadata",m.metadataTracks):(a.type="metadata",m.otherTracks)).push(a)}else m.hasMoov=!1;if(m.mime="",m.hasMoov&&m.tracks){for(m.videoTracks&&0<m.videoTracks.length?m.mime+='video/mp4; codecs="':m.audioTracks&&0<m.audioTracks.length?m.mime+='audio/mp4; codecs="':m.mime+='application/mp4; codecs="',t=0;t<m.tracks.length;t++)t!==0&&(m.mime+=","),m.mime+=m.tracks[t].codec;m.mime+='"; profiles="',m.mime+=this.ftyp.compatible_brands.join(),m.mime+='"'}return m},f.prototype.processSamples=function(t){var r;if(this.sampleProcessingStarted){if(this.isFragmentationInitialized&&this.onSegment!==null)for(r=0;r<this.fragmentedTracks.length;r++)for(var n=this.fragmentedTracks[r],a=n.trak;a.nextSample<a.samples.length&&this.sampleProcessingStarted;){T.debug("ISOFile","Creating media fragment on track #"+n.id+" for sample "+a.nextSample);var d=this.createFragment(n.id,a.nextSample,n.segmentStream);if(!d||(n.segmentStream=d,a.nextSample++,(a.nextSample%n.nb_samples==0||t||a.nextSample>=a.samples.length)&&(T.info("ISOFile","Sending fragmented data on track #"+n.id+" for samples ["+Math.max(0,a.nextSample-n.nb_samples)+","+(a.nextSample-1)+"]"),T.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize()),this.onSegment&&this.onSegment(n.id,n.user,n.segmentStream.buffer,a.nextSample,t||a.nextSample>=a.samples.length),n.segmentStream=null,n!==this.fragmentedTracks[r])))break}if(this.onSamples!==null)for(r=0;r<this.extractedTracks.length;r++){var p=this.extractedTracks[r];for(a=p.trak;a.nextSample<a.samples.length&&this.sampleProcessingStarted;){T.debug("ISOFile","Exporting on track #"+p.id+" sample #"+a.nextSample);var m=this.getSample(a,a.nextSample);if(!m||(a.nextSample++,p.samples.push(m),(a.nextSample%p.nb_samples==0||a.nextSample>=a.samples.length)&&(T.debug("ISOFile","Sending samples on track #"+p.id+" for sample "+a.nextSample),this.onSamples&&this.onSamples(p.id,p.user,p.samples),p.samples=[],p!==this.extractedTracks[r])))break}}}},f.prototype.getBox=function(t){return t=this.getBoxes(t,!0),t.length?t[0]:null},f.prototype.getBoxes=function(t,r){var n=[];return f._sweep.call(this,t,n,r),n},f._sweep=function(t,r,n){for(var a in this.type&&this.type==t&&r.push(this),this.boxes){if(r.length&&n)return;f._sweep.call(this.boxes[a],t,r,n)}},f.prototype.getTrackSamplesInfo=function(t){return t=this.getTrackById(t),t?t.samples:void 0},f.prototype.getTrackSample=function(t,r){return t=this.getTrackById(t),this.getSample(t,r)},f.prototype.releaseUsedSamples=function(t,r){var n=0,a=this.getTrackById(t);a.lastValidSample||(a.lastValidSample=0);for(var d=a.lastValidSample;d<r;d++)n+=this.releaseSample(a,d);T.info("ISOFile","Track #"+t+" released samples up to "+r+" (released size: "+n+", remaining: "+this.samplesDataSize+")"),a.lastValidSample=r},f.prototype.start=function(){this.sampleProcessingStarted=!0,this.processSamples(!1)},f.prototype.stop=function(){this.sampleProcessingStarted=!1},f.prototype.flush=function(){T.info("ISOFile","Flushing remaining samples"),this.updateSampleLists(),this.processSamples(!0),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0)},f.prototype.seekTrack=function(t,r,n){var a,d,p,m,x=0,b=0;if(n.samples.length===0)return T.info("ISOFile","No sample in track, cannot seek! Using time "+T.getDurationString(0,1)+" and offset: 0"),{offset:0,time:0};for(a=0;a<n.samples.length;a++){if(d=n.samples[a],a===0)b=0,m=d.timescale;else if(d.cts>t*d.timescale){b=a-1;break}r&&d.is_sync&&(x=a)}for(r&&(b=x),t=n.samples[b].cts,n.nextSample=b;n.samples[b].alreadyRead===n.samples[b].size&&n.samples[b+1];)b++;return p=n.samples[b].offset+n.samples[b].alreadyRead,T.info("ISOFile","Seeking to "+(r?"RAP":"")+" sample #"+n.nextSample+" on track "+n.tkhd.track_id+", time "+T.getDurationString(t,m)+" and offset: "+p),{offset:p,time:t/m}},f.prototype.seek=function(t,r){var n,a,d=this.moov,p={offset:1/0,time:1/0};if(this.moov){for(a=0;a<d.traks.length;a++)n=d.traks[a],(n=this.seekTrack(t,r,n)).offset<p.offset&&(p.offset=n.offset),n.time<p.time&&(p.time=n.time);return T.info("ISOFile","Seeking at time "+T.getDurationString(p.time,1)+" needs a buffer with a fileStart position of "+p.offset),p.offset===1/0?p={offset:this.nextParsePosition,time:0}:p.offset=this.stream.getEndFilePositionAfter(p.offset),T.info("ISOFile","Adjusted seek position (after checking data already in buffer): "+p.offset),p}throw"Cannot seek: moov not received!"},f.prototype.equal=function(t){for(var r=0;r<this.boxes.length&&r<t.boxes.length;){var n=this.boxes[r],a=t.boxes[r];if(!h.boxEqual(n,a))return!1;r++}return!0},(e.ISOFile=f).prototype.lastBoxStartPosition=0,f.prototype.parsingMdat=null,f.prototype.nextParsePosition=0,f.prototype.discardMdatData=!1,f.prototype.processIncompleteBox=function(t){var r;return t.type==="mdat"?(r=new h[t.type+"Box"](t.size),this.parsingMdat=r,this.boxes.push(r),this.mdats.push(r),r.start=t.start,r.hdr_size=t.hdr_size,this.stream.addUsedBytes(r.hdr_size),this.lastBoxStartPosition=r.start+r.size,this.stream.seek(r.start+r.size,!1,this.discardMdatData)?!(this.parsingMdat=null):(this.moovStartFound?this.nextParsePosition=this.stream.findEndContiguousBuf():this.nextParsePosition=r.start+r.size,!1)):(t.type==="moov"&&(this.moovStartFound=!0,this.mdats.length===0)&&(this.isProgressive=!0),this.stream.mergeNextBuffer&&this.stream.mergeNextBuffer()?(this.nextParsePosition=this.stream.getEndPosition(),!0):(!t.type||this.moovStartFound?this.nextParsePosition=this.stream.getEndPosition():this.nextParsePosition=this.stream.getPosition()+t.size,!1))},f.prototype.hasIncompleteMdat=function(){return this.parsingMdat!==null},f.prototype.processIncompleteMdat=function(){var t=this.parsingMdat;return this.stream.seek(t.start+t.size,!1,this.discardMdatData)?(T.debug("ISOFile","Found 'mdat' end in buffered data"),!(this.parsingMdat=null)):(this.nextParsePosition=this.stream.findEndContiguousBuf(),!1)},f.prototype.restoreParsePosition=function(){return this.stream.seek(this.lastBoxStartPosition,!0,this.discardMdatData)},f.prototype.saveParsePosition=function(){this.lastBoxStartPosition=this.stream.getPosition()},f.prototype.updateUsedBytes=function(t,r){this.stream.addUsedBytes&&(t.type==="mdat"?(this.stream.addUsedBytes(t.hdr_size),this.discardMdatData&&this.stream.addUsedBytes(t.size-t.hdr_size)):this.stream.addUsedBytes(t.size))},f.prototype.add=h.Box.prototype.add,f.prototype.addBox=h.Box.prototype.addBox,f.prototype.init=function(r){var r=r||{},n=(this.add("ftyp").set("major_brand",r.brands&&r.brands[0]||"iso4").set("minor_version",0).set("compatible_brands",r.brands||["iso4"]),this.add("moov"));return n.add("mvhd").set("timescale",r.timescale||600).set("rate",r.rate||65536).set("creation_time",0).set("modification_time",0).set("duration",r.duration||0).set("volume",r.width?0:256).set("matrix",[65536,0,0,0,65536,0,0,0,1073741824]).set("next_track_id",1),n.add("mvex"),this},f.prototype.addTrack=function(n){this.moov||this.init(n);var r=n||{},n=(r.width=r.width||320,r.height=r.height||320,r.id=r.id||this.moov.mvhd.next_track_id,r.type=r.type||"avc1",this.moov.add("trak")),a=(this.moov.mvhd.next_track_id=r.id+1,n.add("tkhd").set("flags",h.TKHD_FLAG_ENABLED|h.TKHD_FLAG_IN_MOVIE|h.TKHD_FLAG_IN_PREVIEW).set("creation_time",0).set("modification_time",0).set("track_id",r.id).set("duration",r.duration||0).set("layer",r.layer||0).set("alternate_group",0).set("volume",1).set("matrix",[0,0,0,0,0,0,0,0,0]).set("width",r.width<<16).set("height",r.height<<16),n.add("mdia")),d=(a.add("mdhd").set("creation_time",0).set("modification_time",0).set("timescale",r.timescale||1).set("duration",r.media_duration||0).set("language",r.language||"und"),a.add("hdlr").set("handler",r.hdlr||"vide").set("name",r.name||"Track created with MP4Box.js"),a.add("elng").set("extended_language",r.language||"fr-FR"),a.add("minf"));if(h[r.type+"SampleEntry"]!==void 0){var p,m,x,b=new h[r.type+"SampleEntry"],C=(b.data_reference_index=1,"");for(p in h.sampleEntryCodes)for(var v=h.sampleEntryCodes[p],y=0;y<v.length;y++)if(-1<v.indexOf(r.type)){C=p;break}switch(C){case"Visual":d.add("vmhd").set("graphicsmode",0).set("opcolor",[0,0,0]),b.set("width",r.width).set("height",r.height).set("horizresolution",72<<16).set("vertresolution",72<<16).set("frame_count",1).set("compressorname",r.type+" Compressor").set("depth",24),r.avcDecoderConfigRecord&&(m=new h.avcCBox,x=new i(r.avcDecoderConfigRecord),m.parse(x),b.addBox(m));break;case"Audio":d.add("smhd").set("balance",r.balance||0),b.set("channel_count",r.channel_count||2).set("samplesize",r.samplesize||16).set("samplerate",r.samplerate||65536);break;case"Hint":d.add("hmhd");break;case"Subtitle":d.add("sthd"),r.type==="stpp"&&b.set("namespace",r.namespace||"nonamespace").set("schema_location",r.schema_location||"").set("auxiliary_mime_types",r.auxiliary_mime_types||"");break;default:d.add("nmhd")}return r.description&&b.addBox(r.description),r.description_boxes&&r.description_boxes.forEach(function(S){b.addBox(S)}),d.add("dinf").add("dref").addEntry(new h["url Box"]().set("flags",1)),a=d.add("stbl"),a.add("stsd").addEntry(b),a.add("stts").set("sample_counts",[]).set("sample_deltas",[]),a.add("stsc").set("first_chunk",[]).set("samples_per_chunk",[]).set("sample_description_index",[]),a.add("stco").set("chunk_offsets",[]),a.add("stsz").set("sample_sizes",[]),this.moov.mvex.add("trex").set("track_id",r.id).set("default_sample_description_index",r.default_sample_description_index||1).set("default_sample_duration",r.default_sample_duration||0).set("default_sample_size",r.default_sample_size||0).set("default_sample_flags",r.default_sample_flags||0),this.buildTrakSampleLists(n),r.id}},h.Box.prototype.computeSize=function(t){t=t||new s,t.endianness=s.BIG_ENDIAN,this.write(t)},f.prototype.addSample=function(p,r,a){var a=a||{},d={},p=this.getTrackById(p);if(p!==null)return d.number=p.samples.length,d.track_id=p.tkhd.track_id,d.timescale=p.mdia.mdhd.timescale,d.description_index=a.sample_description_index?a.sample_description_index-1:0,d.description=p.mdia.minf.stbl.stsd.entries[d.description_index],d.data=r,d.size=r.byteLength,d.alreadyRead=d.size,d.duration=a.duration||1,d.cts=a.cts||0,d.dts=a.dts||0,d.is_sync=a.is_sync||!1,d.is_leading=a.is_leading||0,d.depends_on=a.depends_on||0,d.is_depended_on=a.is_depended_on||0,d.has_redundancy=a.has_redundancy||0,d.degradation_priority=a.degradation_priority||0,d.offset=0,d.subsamples=a.subsamples,p.samples.push(d),p.samples_size+=d.size,p.samples_duration+=d.duration,p.first_dts||(p.first_dts=a.dts),this.processSamples(),p=this.createSingleSampleMoof(d),this.addBox(p),p.computeSize(),p.trafs[0].truns[0].data_offset=p.size+8,this.add("mdat").data=new Uint8Array(r),d},f.prototype.createSingleSampleMoof=function(t){var r=t.is_sync?33554432:65536,n=new h.moofBox,a=(n.add("mfhd").set("sequence_number",this.nextMoofNumber),this.nextMoofNumber++,n.add("traf")),d=this.getTrackById(t.track_id);return a.add("tfhd").set("track_id",t.track_id).set("flags",h.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),a.add("tfdt").set("baseMediaDecodeTime",t.dts-(d.first_dts||0)),a.add("trun").set("flags",h.TRUN_FLAGS_DATA_OFFSET|h.TRUN_FLAGS_DURATION|h.TRUN_FLAGS_SIZE|h.TRUN_FLAGS_FLAGS|h.TRUN_FLAGS_CTS_OFFSET).set("data_offset",0).set("first_sample_flags",0).set("sample_count",1).set("sample_duration",[t.duration]).set("sample_size",[t.size]).set("sample_flags",[r]).set("sample_composition_time_offset",[t.cts-t.dts]),n},f.prototype.lastMoofIndex=0,f.prototype.samplesDataSize=0,f.prototype.resetTables=function(){var t,r;for(this.initial_duration=this.moov.mvhd.duration,t=this.moov.mvhd.duration=0;t<this.moov.traks.length;t++){(r=this.moov.traks[t]).tkhd.duration=0,r.mdia.mdhd.duration=0,(r.mdia.minf.stbl.stco||r.mdia.minf.stbl.co64).chunk_offsets=[],(n=r.mdia.minf.stbl.stsc).first_chunk=[],n.samples_per_chunk=[],n.sample_description_index=[],(r.mdia.minf.stbl.stsz||r.mdia.minf.stbl.stz2).sample_sizes=[],(n=r.mdia.minf.stbl.stts).sample_counts=[],n.sample_deltas=[],(n=r.mdia.minf.stbl.ctts)&&(n.sample_counts=[],n.sample_offsets=[]);var n=r.mdia.minf.stbl.stss,n=r.mdia.minf.stbl.boxes.indexOf(n);n!=-1&&(r.mdia.minf.stbl.boxes[n]=null)}},f.initSampleGroups=function(t,r,n,a,d){var p,m,x,b;function C(v,y,S){this.grouping_type=v,this.grouping_type_parameter=y,this.sbgp=S,this.last_sample_in_run=-1,this.entry_index=-1}for(r&&(r.sample_groups_info=[]),t.sample_groups_info||(t.sample_groups_info=[]),m=0;m<n.length;m++){for(b=n[m].grouping_type+"/"+n[m].grouping_type_parameter,x=new C(n[m].grouping_type,n[m].grouping_type_parameter,n[m]),r&&(r.sample_groups_info[b]=x),t.sample_groups_info[b]||(t.sample_groups_info[b]=x),p=0;p<a.length;p++)a[p].grouping_type===n[m].grouping_type&&(x.description=a[p],x.description.used=!0);if(d)for(p=0;p<d.length;p++)d[p].grouping_type===n[m].grouping_type&&(x.fragment_description=d[p],x.fragment_description.used=!0,x.is_fragment=!0)}if(r){if(d)for(m=0;m<d.length;m++)!d[m].used&&2<=d[m].version&&(b=d[m].grouping_type+"/0",(x=new C(d[m].grouping_type,0)).is_fragment=!0,r.sample_groups_info[b]||(r.sample_groups_info[b]=x))}else for(m=0;m<a.length;m++)!a[m].used&&2<=a[m].version&&(b=a[m].grouping_type+"/0",x=new C(a[m].grouping_type,0),t.sample_groups_info[b]||(t.sample_groups_info[b]=x))},f.setSampleGroupProperties=function(t,r,n,a){var d,p,m;for(d in r.sample_groups=[],a)r.sample_groups[d]={},r.sample_groups[d].grouping_type=a[d].grouping_type,r.sample_groups[d].grouping_type_parameter=a[d].grouping_type_parameter,n>=a[d].last_sample_in_run&&(a[d].last_sample_in_run<0&&(a[d].last_sample_in_run=0),a[d].entry_index++,a[d].entry_index<=a[d].sbgp.entries.length-1)&&(a[d].last_sample_in_run+=a[d].sbgp.entries[a[d].entry_index].sample_count),a[d].entry_index<=a[d].sbgp.entries.length-1?r.sample_groups[d].group_description_index=a[d].sbgp.entries[a[d].entry_index].group_description_index:r.sample_groups[d].group_description_index=-1,r.sample_groups[d].group_description_index!==0&&(m=a[d].fragment_description||a[d].description,0<r.sample_groups[d].group_description_index?(p=65535<r.sample_groups[d].group_description_index?(r.sample_groups[d].group_description_index>>16)-1:r.sample_groups[d].group_description_index-1,m&&0<=p&&(r.sample_groups[d].description=m.entries[p])):m&&2<=m.version&&0<m.default_group_description_index&&(r.sample_groups[d].description=m.entries[m.default_group_description_index-1]))},f.process_sdtp=function(t,r,n){r&&(t?(r.is_leading=t.is_leading[n],r.depends_on=t.sample_depends_on[n],r.is_depended_on=t.sample_is_depended_on[n],r.has_redundancy=t.sample_has_redundancy[n]):(r.is_leading=0,r.depends_on=0,r.is_depended_on=0,r.has_redundancy=0))},f.prototype.buildSampleLists=function(){for(var t,r=0;r<this.moov.traks.length;r++)t=this.moov.traks[r],this.buildTrakSampleLists(t)},f.prototype.buildTrakSampleLists=function(t){var r,n,a,d,p,m,x,b,C,v,y,S,L,B,A,I,U,P,F,M,w,R,O,j;if(t.samples=[],t.samples_duration=0,t.samples_size=0,n=t.mdia.minf.stbl.stco||t.mdia.minf.stbl.co64,a=t.mdia.minf.stbl.stsc,d=t.mdia.minf.stbl.stsz||t.mdia.minf.stbl.stz2,p=t.mdia.minf.stbl.stts,m=t.mdia.minf.stbl.ctts,x=t.mdia.minf.stbl.stss,b=t.mdia.minf.stbl.stsd,C=t.mdia.minf.stbl.subs,S=t.mdia.minf.stbl.stdp,v=t.mdia.minf.stbl.sbgps,y=t.mdia.minf.stbl.sgpds,w=M=F=P=-1,j=O=R=0,f.initSampleGroups(t,null,v,y),d!==void 0){for(r=0;r<d.sample_sizes.length;r++){var z={};z.number=r,z.track_id=t.tkhd.track_id,z.timescale=t.mdia.mdhd.timescale,z.alreadyRead=0,(t.samples[r]=z).size=d.sample_sizes[r],t.samples_size+=z.size,r===0?(L=0,z.chunk_index=B=1,z.chunk_run_index=L,U=a.samples_per_chunk[L],I=0,A=L+1<a.first_chunk.length?a.first_chunk[L+1]-1:1/0):r<U?(z.chunk_index=B,z.chunk_run_index=L):(I=0,(z.chunk_index=++B)<=A||(A=++L+1<a.first_chunk.length?a.first_chunk[L+1]-1:1/0),z.chunk_run_index=L,U+=a.samples_per_chunk[L]),z.description_index=a.sample_description_index[z.chunk_run_index]-1,z.description=b.entries[z.description_index],z.offset=n.chunk_offsets[z.chunk_index-1]+I,I+=z.size,P<r&&(F++,P<0&&(P=0),P+=p.sample_counts[F]),0<r?(t.samples[r-1].duration=p.sample_deltas[F],t.samples_duration+=t.samples[r-1].duration,z.dts=t.samples[r-1].dts+t.samples[r-1].duration):z.dts=0,m?(M<=r&&(w++,M<0&&(M=0),M+=m.sample_counts[w]),z.cts=t.samples[r].dts+m.sample_offsets[w]):z.cts=z.dts,x?(r==x.sample_numbers[R]-1?(z.is_sync=!0,R++):(z.is_sync=!1,z.degradation_priority=0),C&&C.entries[O].sample_delta+j==r+1&&(z.subsamples=C.entries[O].subsamples,j+=C.entries[O].sample_delta,O++)):z.is_sync=!0,f.process_sdtp(t.mdia.minf.stbl.sdtp,z,z.number),z.degradation_priority=S?S.priority[r]:0,C&&C.entries[O].sample_delta+j==r&&(z.subsamples=C.entries[O].subsamples,j+=C.entries[O].sample_delta),(0<v.length||0<y.length)&&f.setSampleGroupProperties(t,z,r,t.sample_groups_info)}0<r&&(t.samples[r-1].duration=Math.max(t.mdia.mdhd.duration-t.samples[r-1].dts,0),t.samples_duration+=t.samples[r-1].duration)}},f.prototype.updateSampleLists=function(){var t,r,n,a,d,p,m,x,b,C,v,y;if(this.moov!==void 0){for(;this.lastMoofIndex<this.moofs.length;)if(m=this.moofs[this.lastMoofIndex],this.lastMoofIndex++,m.type=="moof")for(x=m,t=0;t<x.trafs.length;t++){for(b=x.trafs[t],C=this.getTrackById(b.tfhd.track_id),v=this.getTrexById(b.tfhd.track_id),r=b.tfhd.flags&h.TFHD_FLAG_SAMPLE_DESC?b.tfhd.default_sample_description_index:v?v.default_sample_description_index:1,n=b.tfhd.flags&h.TFHD_FLAG_SAMPLE_DUR?b.tfhd.default_sample_duration:v?v.default_sample_duration:0,a=b.tfhd.flags&h.TFHD_FLAG_SAMPLE_SIZE?b.tfhd.default_sample_size:v?v.default_sample_size:0,d=b.tfhd.flags&h.TFHD_FLAG_SAMPLE_FLAGS?b.tfhd.default_sample_flags:v?v.default_sample_flags:0,(b.sample_number=0)<b.sbgps.length&&f.initSampleGroups(C,b,b.sbgps,C.mdia.minf.stbl.sgpds,b.sgpds),P=0;P<b.truns.length;P++)for(var S=b.truns[P],L=0;L<S.sample_count;L++){(y={}).moof_number=this.lastMoofIndex,y.number_in_traf=b.sample_number,b.sample_number++,y.number=C.samples.length,b.first_sample_index=C.samples.length,C.samples.push(y),y.track_id=C.tkhd.track_id,y.timescale=C.mdia.mdhd.timescale,y.description_index=r-1,y.description=C.mdia.minf.stbl.stsd.entries[y.description_index],y.size=a,S.flags&h.TRUN_FLAGS_SIZE&&(y.size=S.sample_size[L]),C.samples_size+=y.size,y.duration=n,S.flags&h.TRUN_FLAGS_DURATION&&(y.duration=S.sample_duration[L]),C.samples_duration+=y.duration,C.first_traf_merged||0<L?y.dts=C.samples[C.samples.length-2].dts+C.samples[C.samples.length-2].duration:(b.tfdt?y.dts=b.tfdt.baseMediaDecodeTime:y.dts=0,C.first_traf_merged=!0),y.cts=y.dts,S.flags&h.TRUN_FLAGS_CTS_OFFSET&&(y.cts=y.dts+S.sample_composition_time_offset[L]),I=d,S.flags&h.TRUN_FLAGS_FLAGS?I=S.sample_flags[L]:L===0&&S.flags&h.TRUN_FLAGS_FIRST_FLAG&&(I=S.first_sample_flags),y.is_sync=!(I>>16&1),y.is_leading=I>>26&3,y.depends_on=I>>24&3,y.is_depended_on=I>>22&3,y.has_redundancy=I>>20&3,y.degradation_priority=65535&I;var I=!!(b.tfhd.flags&h.TFHD_FLAG_BASE_DATA_OFFSET),B=!!(b.tfhd.flags&h.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),A=!!(S.flags&h.TRUN_FLAGS_DATA_OFFSET),I=I?b.tfhd.base_data_offset:B||P===0?x.start:p;y.offset=P===0&&L===0?A?I+S.data_offset:I:p,p=y.offset+y.size,(0<b.sbgps.length||0<b.sgpds.length||0<C.mdia.minf.stbl.sbgps.length||0<C.mdia.minf.stbl.sgpds.length)&&f.setSampleGroupProperties(C,y,y.number_in_traf,b.sample_groups_info)}if(b.subs){C.has_fragment_subsamples=!0;for(var U=b.first_sample_index,P=0;P<b.subs.entries.length;P++)U+=b.subs.entries[P].sample_delta,(y=C.samples[U-1]).subsamples=b.subs.entries[P].subsamples}}}},f.prototype.getSample=function(t,r){var n=t.samples[r];if(!this.moov)return null;if(n.data){if(n.alreadyRead==n.size)return n}else n.data=new Uint8Array(n.size),n.alreadyRead=0,this.samplesDataSize+=n.size,T.debug("ISOFile","Allocating sample #"+r+" on track #"+t.tkhd.track_id+" of size "+n.size+" (total: "+this.samplesDataSize+")");for(;;){var a=this.stream.findPosition(!0,n.offset+n.alreadyRead,!1);if(!(-1<a))return null;var d=(a=this.stream.buffers[a]).byteLength-(n.offset+n.alreadyRead-a.fileStart);if(n.size-n.alreadyRead<=d)return T.debug("ISOFile","Getting sample #"+r+" data (alreadyRead: "+n.alreadyRead+" offset: "+(n.offset+n.alreadyRead-a.fileStart)+" read size: "+(n.size-n.alreadyRead)+" full size: "+n.size+")"),s.memcpy(n.data.buffer,n.alreadyRead,a,n.offset+n.alreadyRead-a.fileStart,n.size-n.alreadyRead),a.usedBytes+=n.size-n.alreadyRead,this.stream.logBufferLevel(),n.alreadyRead=n.size,n;if(d==0)return null;T.debug("ISOFile","Getting sample #"+r+" partial data (alreadyRead: "+n.alreadyRead+" offset: "+(n.offset+n.alreadyRead-a.fileStart)+" read size: "+d+" full size: "+n.size+")"),s.memcpy(n.data.buffer,n.alreadyRead,a,n.offset+n.alreadyRead-a.fileStart,d),n.alreadyRead+=d,a.usedBytes+=d,this.stream.logBufferLevel()}},f.prototype.releaseSample=function(t,r){return t=t.samples[r],t.data?(this.samplesDataSize-=t.size,t.data=null,t.alreadyRead=0,t.size):0},f.prototype.getAllocatedSampleDataSize=function(){return this.samplesDataSize},f.prototype.getCodecs=function(){for(var t="",r=0;r<this.moov.traks.length;r++)0<r&&(t+=","),t+=this.moov.traks[r].mdia.minf.stbl.stsd.entries[0].getCodec();return t},f.prototype.getTrexById=function(t){var r;if(this.moov&&this.moov.mvex)for(r=0;r<this.moov.mvex.trexs.length;r++){var n=this.moov.mvex.trexs[r];if(n.track_id==t)return n}return null},f.prototype.getTrackById=function(t){if(this.moov!==void 0)for(var r=0;r<this.moov.traks.length;r++){var n=this.moov.traks[r];if(n.tkhd.track_id==t)return n}return null},f.prototype.items=[],f.prototype.itemsDataSize=0,f.prototype.flattenItemInfo=function(){var t=this.items,r=this.meta;if(r!=null&&r.hdlr!==void 0&&r.iinf!==void 0){for(b=0;b<r.iinf.item_infos.length;b++)(a={}).id=r.iinf.item_infos[b].item_ID,(t[a.id]=a).ref_to=[],a.name=r.iinf.item_infos[b].item_name,0<r.iinf.item_infos[b].protection_index&&(a.protection=r.ipro.protections[r.iinf.item_infos[b].protection_index-1]),r.iinf.item_infos[b].item_type?a.type=r.iinf.item_infos[b].item_type:a.type="mime",a.content_type=r.iinf.item_infos[b].content_type,a.content_encoding=r.iinf.item_infos[b].content_encoding;if(r.iloc)for(b=0;b<r.iloc.items.length;b++){var n=r.iloc.items[b],a=t[n.item_ID];switch(n.data_reference_index!==0&&(T.warn("Item storage with reference to other files: not supported"),a.source=r.dinf.boxes[n.data_reference_index-1]),n.construction_method){case 0:break;case 1:case 2:T.warn("Item storage with construction_method : not supported")}for(a.extents=[],p=a.size=0;p<n.extents.length;p++)a.extents[p]={},a.extents[p].offset=n.extents[p].extent_offset+n.base_offset,a.extents[p].length=n.extents[p].extent_length,a.extents[p].alreadyRead=0,a.size+=a.extents[p].length}if(r.pitm&&(t[r.pitm.item_id].primary=!0),r.iref)for(b=0;b<r.iref.references.length;b++)for(var d=r.iref.references[b],p=0;p<d.references.length;p++)t[d.from_item_ID].ref_to.push({type:d.type,id:d.references[p]});if(r.iprp)for(var m=0;m<r.iprp.ipmas.length;m++)for(var x=r.iprp.ipmas[m],b=0;b<x.associations.length;b++){var C=x.associations[b];for((a=t[C.id]).properties===void 0&&(a.properties={},a.properties.boxes=[]),p=0;p<C.props.length;p++){var v=C.props[p];0<v.property_index&&v.property_index-1<r.iprp.ipco.boxes.length&&(v=r.iprp.ipco.boxes[v.property_index-1],a.properties[v.type]=v,a.properties.boxes.push(v))}}}},f.prototype.getItem=function(t){var r;if(!this.meta)return null;if(!(r=this.items[t]).data&&r.size)r.data=new Uint8Array(r.size),r.alreadyRead=0,this.itemsDataSize+=r.size,T.debug("ISOFile","Allocating item #"+t+" of size "+r.size+" (total: "+this.itemsDataSize+")");else if(r.alreadyRead===r.size)return r;for(var n=0;n<r.extents.length;n++){var a=r.extents[n];if(a.alreadyRead!==a.length){var d=this.stream.findPosition(!0,a.offset+a.alreadyRead,!1);if(!(-1<d))return null;var p=(d=this.stream.buffers[d]).byteLength-(a.offset+a.alreadyRead-d.fileStart);if(!(a.length-a.alreadyRead<=p))return T.debug("ISOFile","Getting item #"+t+" extent #"+n+" partial data (alreadyRead: "+a.alreadyRead+" offset: "+(a.offset+a.alreadyRead-d.fileStart)+" read size: "+p+" full extent size: "+a.length+" full item size: "+r.size+")"),s.memcpy(r.data.buffer,r.alreadyRead,d,a.offset+a.alreadyRead-d.fileStart,p),a.alreadyRead+=p,r.alreadyRead+=p,d.usedBytes+=p,this.stream.logBufferLevel(),null;T.debug("ISOFile","Getting item #"+t+" extent #"+n+" data (alreadyRead: "+a.alreadyRead+" offset: "+(a.offset+a.alreadyRead-d.fileStart)+" read size: "+(a.length-a.alreadyRead)+" full extent size: "+a.length+" full item size: "+r.size+")"),s.memcpy(r.data.buffer,r.alreadyRead,d,a.offset+a.alreadyRead-d.fileStart,a.length-a.alreadyRead),d.usedBytes+=a.length-a.alreadyRead,this.stream.logBufferLevel(),r.alreadyRead+=a.length-a.alreadyRead,a.alreadyRead=a.length}}return r.alreadyRead===r.size?r:null},f.prototype.releaseItem=function(t){var r=this.items[t];if(r.data){this.itemsDataSize-=r.size,r.data=null;for(var n=r.alreadyRead=0;n<r.extents.length;n++)r.extents[n].alreadyRead=0;return r.size}return 0},f.prototype.processItems=function(t){for(var r in this.items)r=this.items[r],this.getItem(r.id),t&&!r.sent&&(t(r),r.sent=!0,r.data=null)},f.prototype.hasItem=function(t){for(var r in this.items)if(r=this.items[r],r.name===t)return r.id;return-1},f.prototype.getMetaHandler=function(){return this.meta?this.meta.hdlr.handler:null},f.prototype.getPrimaryItem=function(){return this.meta&&this.meta.pitm?this.getItem(this.meta.pitm.item_id):null},f.prototype.itemToFragmentedTrackFile=function(a){var r,n,a=a||{};return(a=a.itemId?this.getItem(a.itemId):this.getPrimaryItem())!=null&&((r=new f).discardMdatData=!1,n={type:a.type,description_boxes:a.properties.boxes},a.properties.ispe&&(n.width=a.properties.ispe.image_width,n.height=a.properties.ispe.image_height),n=r.addTrack(n))?(r.addSample(n,a.data),r):null},f.prototype.write=function(t){for(var r=0;r<this.boxes.length;r++)this.boxes[r].write(t)},f.prototype.createFragment=function(a,r,n){var a=this.getTrackById(a),d=this.getSample(a,r);return d==null?(d=a.samples[r],this.nextSeekPosition?this.nextSeekPosition=Math.min(d.offset+d.alreadyRead,this.nextSeekPosition):this.nextSeekPosition=a.samples[r].offset+d.alreadyRead,null):((a=n||new s).endianness=s.BIG_ENDIAN,(r=this.createSingleSampleMoof(d)).write(a),r.trafs[0].truns[0].data_offset=r.size+8,T.debug("MP4Box","Adjusting data_offset with new value "+r.trafs[0].truns[0].data_offset),a.adjustUint32(r.trafs[0].truns[0].data_offset_position,r.trafs[0].truns[0].data_offset),(n=new h.mdatBox).data=d.data,n.write(a),a)},f.writeInitializationSegment=function(t,r,n,a){T.debug("ISOFile","Generating initialization segment");var d,p=new s,m=(p.endianness=s.BIG_ENDIAN,t.write(p),r.add("mvex"));for(n&&m.add("mehd").set("fragment_duration",n),d=0;d<r.traks.length;d++)m.add("trex").set("track_id",r.traks[d].tkhd.track_id).set("default_sample_description_index",1).set("default_sample_duration",a).set("default_sample_size",0).set("default_sample_flags",65536);return r.write(p),p.buffer},f.prototype.save=function(t){var r=new s;r.endianness=s.BIG_ENDIAN,this.write(r),r.save(t)},f.prototype.getBuffer=function(){var t=new s;return t.endianness=s.BIG_ENDIAN,this.write(t),t.buffer},f.prototype.initializeSegmentation=function(){var t,r,n,a;for(this.onSegment===null&&T.warn("MP4Box","No segmentation callback set!"),this.isFragmentationInitialized||(this.isFragmentationInitialized=!0,this.nextMoofNumber=0,this.resetTables()),r=[],t=0;t<this.fragmentedTracks.length;t++){var d=new h.moovBox;d.mvhd=this.moov.mvhd,d.boxes.push(d.mvhd),n=this.getTrackById(this.fragmentedTracks[t].id),d.boxes.push(n),d.traks.push(n),(a={}).id=n.tkhd.track_id,a.user=this.fragmentedTracks[t].user,a.buffer=f.writeInitializationSegment(this.ftyp,d,this.moov.mvex&&this.moov.mvex.mehd?this.moov.mvex.mehd.fragment_duration:void 0,0<this.moov.traks[t].samples.length?this.moov.traks[t].samples[0].duration:0),r.push(a)}return r},h.Box.prototype.printHeader=function(t){this.size+=8,this.size>E&&(this.size+=8),this.type==="uuid"&&(this.size+=16),t.log(t.indent+"size:"+this.size),t.log(t.indent+"type:"+this.type)},h.FullBox.prototype.printHeader=function(t){this.size+=4,h.Box.prototype.printHeader.call(this,t),t.log(t.indent+"version:"+this.version),t.log(t.indent+"flags:"+this.flags)},h.Box.prototype.print=function(t){this.printHeader(t)},h.ContainerBox.prototype.print=function(t){this.printHeader(t);for(var r,n=0;n<this.boxes.length;n++)this.boxes[n]&&(r=t.indent,t.indent+=" ",this.boxes[n].print(t),t.indent=r)},f.prototype.print=function(t){t.indent="";for(var r=0;r<this.boxes.length;r++)this.boxes[r]&&this.boxes[r].print(t)},h.mvhdBox.prototype.print=function(t){h.FullBox.prototype.printHeader.call(this,t),t.log(t.indent+"creation_time: "+this.creation_time),t.log(t.indent+"modification_time: "+this.modification_time),t.log(t.indent+"timescale: "+this.timescale),t.log(t.indent+"duration: "+this.duration),t.log(t.indent+"rate: "+this.rate),t.log(t.indent+"volume: "+(this.volume>>8)),t.log(t.indent+"matrix: "+this.matrix.join(", ")),t.log(t.indent+"next_track_id: "+this.next_track_id)},h.tkhdBox.prototype.print=function(t){h.FullBox.prototype.printHeader.call(this,t),t.log(t.indent+"creation_time: "+this.creation_time),t.log(t.indent+"modification_time: "+this.modification_time),t.log(t.indent+"track_id: "+this.track_id),t.log(t.indent+"duration: "+this.duration),t.log(t.indent+"volume: "+(this.volume>>8)),t.log(t.indent+"matrix: "+this.matrix.join(", ")),t.log(t.indent+"layer: "+this.layer),t.log(t.indent+"alternate_group: "+this.alternate_group),t.log(t.indent+"width: "+this.width),t.log(t.indent+"height: "+this.height)};var k=function(t,r){return t=t===void 0||t,r=new f(r),r.discardMdatData=!t,r};e.createFile=k});function Qa(D){return D.reduce((e,i)=>256*e+i)}function Xa(D){const e=[101,103,119,99],i=D.length-28,s=D.slice(i,i+e.length);return e.every((u,c)=>u===s[c])}ct.Log,ct.MP4BoxStream,ct.DataStream,ct.MultiBufferStream,ct.MPEG4DescriptorParser,ct.BoxParser,ct.XMLSubtitlein4Parser,ct.Textin4Parser,ct.ISOFile,ct.createFile;class xo{constructor(){this.s=null,this.a=null,this.l=0,this.c=0,this.u=1/0,this.A=!1,this.d=!1,this.r=4194304,this.n=new Uint8Array([30,158,90,33,244,57,83,165,2,70,35,87,215,231,226,108]),this.t=this.n.slice().reverse()}destroy(){this.s=null,this.a=null,this.l=0,this.c=0,this.u=1/0,this.A=!1,this.d=!1,this.r=4194304,this.n=null,this.t=null}transport(e){if((this.s||!(50<this.l))&&(this.l++,!this.d)){var i=new Uint8Array(e);if(this.A){if(!(this.c<this.u))return this.a&&this.s?(this.a.set(i,this.r),this.s.parse(null,this.r,i.byteLength),this.a.slice(this.r,this.r+i.byteLength)):(console.error("video_error_2"),this.d=!0,e);Xa(i)&&this.c++}else{var s=(function(c,l){var o=(function(f,_){for(let g=0;g<f.byteLength-_.length;g++)for(let T=0;T<_.length&&f[g+T]===_[T];T++)if(T===_.length-1)return g;return null})(c,l);if(o){const f=Qa(c.slice(o+16,o+16+8));return[f,Qa(c.slice(o+24,o+24+8)),c.slice(o+32,o+32+f).map(_=>~_)]}return null})(i,this.t);if(!s)return e;var u=(function(c){try{if(typeof WebAssembly!="object"||typeof WebAssembly.instantiate!="function")throw null;{const o=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(!(o instanceof WebAssembly.Module&&new WebAssembly.Instance(o)instanceof WebAssembly.Instance))throw null}}catch{return new Error("video_error_4")}let l;try{l={env:{__handle_stack_overflow:()=>c(new Error("video_error_1")),memory:new WebAssembly.Memory({initial:256,maximum:256})}}}catch{return new Error("video_error_5")}return l})(e);if(u instanceof Error)return console.error(u.message),this.d=!0,e;this.A=!0,this.u=s[1],Xa(i)&&this.c++,WebAssembly.instantiate(s[2],u).then(c=>{var l;typeof(l=c.instance.exports).parse!="function"||typeof l.memory!="object"?(this.d=!0,console.error("video_error_3")):(this.s=c.instance.exports,this.a=new Uint8Array(this.s.memory.buffer))}).catch(c=>{this.d=!0,console.error("video_error_6")})}}return e}}class Za extends Qt{TAG_NAME="Fmp4Loader";constructor(e){super(e),this.player=e,this.mp4Box=ct.createFile(),this.tempFmp4List=[],this.offset=0,this.videoTrackId=null,this.audioTrackId=null,this.isHevc=!1,this.transportDescarmber=null,this.player._opt.isFmp4Private&&(this.transportDescarmber=new xo),this._listenMp4Box(),e.debug.log(this.TAG_NAME,"init")}destroy(){this.mp4Box&&(this.mp4Box.flush(),this.mp4Box=null),this.transportDescarmber&&(this.transportDescarmber.destroy(),this.transportDescarmber=null),this.tempFmp4List=[],this.offset=0,this.videoTrackId=null,this.audioTrackId=null,this.isHevc=!1,this.player.debug.log(this.TAG_NAME,"destroy")}_listenMp4Box(){this.mp4Box.onReady=this.onReady.bind(this),this.mp4Box.onError=this.onError.bind(this),this.mp4Box.onSamples=this.onSamples.bind(this)}onReady(e){this.player.debug.log(this.TAG_NAME,"onReady",e);const i=e.videoTracks[0],s=e.audioTracks[0];if(i){this.videoTrackId=i.id;const l=this.getSeqHeader(i);l&&(this.player.debug.log(this.TAG_NAME,"seqHeader",l),this._doDecodeByFmp4(l,2,0,!0,0)),this.mp4Box.setExtractionOptions(i.id)}if(s){this.audioTrackId=s.id;const l=s.audio||{},o=Fn.indexOf(l.sample_rate),f=s.codec.replace("mp4a.40.","");this.mp4Box.setExtractionOptions(s.id);var u={profile:parseInt(f,10),sampleRate:o,channel:l.channel_count},c=Ks(u);this.player.debug.log(this.TAG_NAME,"aacADTSHeader",c,"config",u),this._doDecodeByFmp4(c,1,0,!1,0)}this.mp4Box.start()}onError(e){this.player.debug.error(this.TAG_NAME,"mp4Box onError",e)}onSamples(e,i,s){if(e===this.videoTrackId)for(const l of s){const o=l.data,f=l.is_sync,_=1e3*l.cts/l.timescale;l.duration,l.timescale,this.player.updateStats({vbps:o.byteLength,dts:_}),f&&this.calcIframeIntervalTimestamp(_);var u=(this.isHevc?Ma:Yr)(o,f);this._doDecodeByFmp4(u,2,_,f,0)}else if(e===this.audioTrackId)for(const l of s){const o=l.data,f=(this.player.updateStats({abps:o.byteLength}),1e3*l.cts/l.timescale);l.duration,l.timescale;var c=new Uint8Array(o.byteLength+2);c.set([175,1],0),c.set(o,2),this._doDecodeByFmp4(c,1,f,!1,0)}else this.player.debug.warn(this.TAG_NAME,"onSamples() trackId error",e)}getSeqHeader(e){const i=this.mp4Box.getTrackById(e.id);for(const c of i.mdia.minf.stbl.stsd.entries)if(c.avcC||c.hvcC){const l=new ct.DataStream(void 0,0,ct.DataStream.BIG_ENDIAN);let o=[];o=c.avcC?(c.avcC.write(l),[23,0,0,0,0]):(this.isHevc=!0,c.hvcC.write(l),[28,0,0,0,0]);var s=new Uint8Array(l.buffer,8),u=new Uint8Array(o.length+s.length);return u.set(o,0),u.set(s,o.length),u}return null}dispatch(e){let i=new Uint8Array(e);typeof e!="string"?typeof e=="object"?((i=this.transportDescarmber?this.transportDescarmber.transport(i):i).buffer.fileStart=this.offset,this.offset+=i.byteLength,this.mp4Box.appendBuffer(i.buffer)):this.player.debug.warn(this.TAG_NAME,"dispatch()","data is not object",e):this.player.debug.warn(this.TAG_NAME,"dispatch()","data is string",e)}downloadFmp4File(){var e=new Blob(this.tempFmp4List,{type:'video/mp4; codecs="avc1.640028,mp4a.40.2"'}),e=URL.createObjectURL(e),i=document.createElement("a");i.href=e,i.download=be()+".fmp4",i.click(),URL.revokeObjectURL(e)}}class Co extends Qt{LOG_NAME="Mpeg4Loader";constructor(e){super(e),this.player=e,this.player.debug.log(this.LOG_NAME,"init")}destroy(){super.destroy(),this.player.debug.log(this.LOG_NAME,"destroy")}}class ms{constructor(e){return new(ms.getLoaderFactory(e._opt.demuxType))(e)}static getLoaderFactory(e){return e==="m7s"?So:e===wt?Ja:e===Pt?Eo:e===St?To:e===Ht?Za:e===Et?Co:ko}}class en extends Ae{constructor(e){super(),this.player=e,this.hasInit=!1,this.isDecodeFirstIIframe=!1,this.isInitInfo=!1,this.prevTimestamp=null,this.decodeDiffTimestamp=null,this.prevDts=null,this.decoder=null,this.isWidthOrHeightChanged=!1,this.initDecoder(),e.debug.log("Webcodecs","init")}destroy(){this.decoder&&(this.decoder.state!=="closed"&&this.decoder.close(),this.decoder=null),this.prevTimestamp=null,this.decodeDiffTimestamp=null,this.prevDts=null,this.hasInit=!1,this.isInitInfo=!1,this.isDecodeFirstIIframe=!1,this.isWidthOrHeightChanged=!1,this.off(),this.player.debug.log("Webcodecs","destroy")}initDecoder(){const e=this;this.decoder=new VideoDecoder({output(i){e.handleDecode(i)},error(i){e.handleError(i)}})}handleDecode(e){this.isInitInfo||(this.player.video.updateVideoInfo({width:e.codedWidth,height:e.codedHeight}),this.player.video.initCanvasViewSize(),this.isInitInfo=!0),this.player._times.videoStart||(this.player._times.videoStart=be(),this.player.handlePlayToRenderTimes()),this.player.video.render({videoFrame:e,ts:e.timestamp}),this.player.handleRender(),this.player.updateStats({dfps:!0,buf:this.player.demux&&this.player.demux.delay||0})}handleError(e){this.player.debug.error("Webcodecs","VideoDecoder handleError：",e.code,e),e=e.toString(),e.indexOf("Unsupported configuration")!==-1&&this.player.emitError(H.webcodecsUnsupportedConfigurationError,e)}decodeVideo(e,i,s,u){if(this.hasInit)if(this.isDecodeFirstIIframe||s||this.player.debug.warn("Webcodecs","VideoDecoder isDecodeFirstIIframe false and isIframe is false"),!this.isDecodeFirstIIframe&&s&&(this.isDecodeFirstIIframe=!0),this.isDecodeFirstIIframe){if(s&&e[1]===0){const o=15&e[0];let f={};o==7?f=gr(e.slice(5)):o==12&&(f=yr(e));const _=this.player.video.videoInfo;_&&_.width&&_.height&&f&&f.codecWidth&&f.codecHeight&&(f.codecWidth!==_.width||f.codecHeight!==_.height)&&(this.player.debug.warn("Webcodecs",`decodeVideo: video width or height is changed, old width is ${videoWidth}, old height is ${videoHeight}, new width is ${f.codecWidth}, new height is ${f.codecHeight}, and emit change event`),this.isWidthOrHeightChanged=!0,this.player.emitError(H.wcsWidthOrHeightChange))}if(this.isWidthOrHeightChanged)this.player.debug.warn("Webcodecs","decodeVideo: video width or height is changed, and return");else if(ya(e))this.player.debug.warn("Webcodecs","decodeVideo and payload is video sequence header so drop this frame");else if(e.byteLength<12)this.player.debug.warn("Webcodecs","decodeVideo and payload is too small , payload length is "+e.byteLength);else{let o=!1,f=new Date().getTime();this.prevTimestamp||(this.prevTimestamp=f,o=!0);var c=f-this.prevTimestamp,c=(((this.decodeDiffTimestamp=c)<5||500<c)&&!o&&this.player.debug.warn("Webcodecs","decodeVideo diff time is ",c),e.slice(5)),l=new EncodedVideoChunk({data:c,timestamp:i,type:s?"key":"delta"});this.player.emit(N.timeUpdate,i),this.player.recorder&&this.player.recorder.isRecording&&this.player._opt.recordType===Ze&&this.player.recorder.handleAddNaluTrack(c,s,i,u);try{if(this.isDecodeStateClosed())return void this.player.debug.warn("Webcodecs","VideoDecoder isDecodeStateClosed true");this.decoder.decode(l)}catch(_){this.player.debug.error("Webcodecs","VideoDecoder",_);const g=_.toString();g.indexOf("A key frame is required after configure() or flush()")===-1&&g.indexOf("Cannot call 'decode' on a closed codec")===-1||this.player.emit(H.webcodecsDecodeError)}this.prevTimestamp=new Date().getTime()}}else this.player.debug.warn("Webcodecs","VideoDecoder isDecodeFirstIIframe false");else if(s&&e[1]===Zi){const o=15&e[0];if(this.player.video.updateVideoInfo({encTypeCode:o}),o!=12||ra()){this.player._times.decodeStart||(this.player._times.decodeStart=be());let f=null;const _=e.slice(5);o==7?f=(function(g){let T=g.subarray(1,4),E="avc1.";for(let h=0;h<3;h++){let k=T[h].toString(16);k.length<2&&(k="0"+k),E+=k}return{codec:E,description:g}})(_):o==12&&((c=_).subarray(1,4),f={codec:"hev1.1.6.L120.90",description:c}),this.player.recorder&&this.player._opt.recordType===Ze&&this.player.recorder.initMetaData(e,o),this.player.debug.log("Webcodecs","decodeVideo and webcodecs configure");try{this.decoder.configure(f),this.hasInit=!0}catch(g){this.player.debug.log("Webcodecs","configure error",g.code,g)}}else{const f=Ur();this.player.debug.warn("Webcodecs","WebcodecsDecoder not support hevc decode",f.type,f.version),this.emit(H.webcodecsH265NotSupport)}}}getDecodeDiffTimes(){return this.decodeDiffTimestamp}isDecodeStateClosed(){return this.decoder.state==="closed"}}const gs={play:"播放",pause:"暂停",audio:"",mute:"",screenshot:"截图",loading:"加载",fullscreen:"全屏",fullscreenExit:"退出全屏",record:"录制",recordStop:"停止录制",narrow:"缩小",expand:"放大",ptz:"操作盘",ptzActive:"操作盘激活",zoom:"电子放大",zoomStop:"关闭电子放大",close:"关闭",performance:"性能面板",performanceActive:"性能面板激活",face:"人脸识别",faceActive:"人脸识别激活"};var Fe=Object.keys(gs).reduce((D,e)=>(D[e]=`
    <i class="jessibuca-icon jessibuca-icon-${e}"></i>
    ${gs[e]?`<span class="icon-title-tips"><span class="icon-title">${gs[e]}</span></span>`:""}
`,D),{});function Pi(D,e){let i=!1;return D.forEach(s=>{i||s.startTimestamp<=e&&s.endTimestamp>e&&(i=!0)}),i}function wr(D,e,i){let s=0<arguments.length&&D!==void 0?D:[],u=1<arguments.length&&e!==void 0?e:[],c=2<arguments.length?i:void 0;const l=s.length,o=u.length,f=Math.max(l,o),_=2e3,g=Math.ceil(f/_);let T=0,E=0;(function h(){let k="",t="";for(let r=0;r<_;r++){const n=s[E],a=(n&&(k+=`
                     <div class="jessibuca-playback-time-minute-one${n.hasRecord?" active":""}${n.isStart?" start":""}" data-has-record="${n.hasRecord}"
                     data-time="${n.timestamp}" data-type="${n.dataType}">
                        <span class="jessibuca-playback-time-title-tips ${E>l-60?"jessibuca-playback-time-title-tips-left":""}"><span class="jessibuca-playback-time-title">${n.title}</span></span>
                    </div>
                `),u[E]);a&&(t+=`
                  <div class="jessibuca-playback-time-hour" data-hour="${a.hour}" data-min="${a.min}" data-second="${a.second}"><span class="jessibuca-playback-time-hour-text">${a.title}</span></div>
                `),E+=1}k&&c.$playbackTimeListOne.insertAdjacentHTML("beforeend",k),t&&c.$playbackTimeListSecond.insertAdjacentHTML("beforeend",t),(T+=1)<g&&(c.rafId=window.requestAnimationFrame(h))})()}function Lo(D,e){wr((function(i){var s,u,c,l=0<arguments.length&&i!==void 0?i:[],o=[],f=(l[0]||{}).startTimestamp;for(let g=0;g<1440;g++){var _=g%60==0;let T=!1;f&&(T=Pi(l,(s=f,u=g,c=void 0,c=Math.floor(u/60)%60,u=Math.floor(u%60),new Date(s).setHours(c,u,0,0)))),o.push({title:(function(E,h){let k="";var t;return-1<E&&(t=Math.floor(E/60)%60,E=E%60,E=Math.round(E),k=t<10?"0"+t+":":t+":",E<10&&(k+="0"),k+=E,wi(h)||(k+=":"+h)),k})(g),timestamp:g,dataType:"min",hasRecord:T,isStart:_})}return o})(D),(function(){var i=[];for(let s=0;s<24;s++){let u=s+":00";s<10&&(u="0"+u),i.push({title:u,hour:s,min:0,second:0})}return i})(),e)}var Do=(D,e)=>{const i=D.events.proxy,s=document.createElement("object");s.setAttribute("aria-hidden","true"),s.setAttribute("tabindex",-1),s.type="text/html",s.data="about:blank",ue(s,{display:"block",position:"absolute",top:"0",left:"0",height:"100%",width:"100%",overflow:"hidden",pointerEvents:"none",zIndex:"-1"});let u=D.width,c=D.height;const l=ta(()=>{D.width===u&&D.height===c||(u=D.width,c=D.height,D.emit(N.resize),g())},500),o=(i(s,"load",()=>{i(s.contentDocument.defaultView,"resize",()=>{l()})}),D.$container.appendChild(s),D.on(N.destroy,()=>{D.$container.removeChild(s)}),D.on(N.volumechange,()=>{var k,t,r;(k=D.volume)===0?(ue(e.$volumeOn,"display","none"),ue(e.$volumeOff,"display","flex"),ue(e.$volumeHandle,"top","48px")):e.$volumeHandle&&e.$volumePanel&&(t=Xs(e.$volumePanel,"height")||60,r=Xs(e.$volumeHandle,"height"),ue(e.$volumeHandle,"top",t-(t-r)*k-r+"px"),ue(e.$volumeOn,"display","flex"),ue(e.$volumeOff,"display","none")),e.$volumePanelText&&(e.$volumePanelText.innerHTML=parseInt(100*k))}),D.on(N.loading,k=>{ue(e.$loading,"display",k?"flex":"none"),(_e(D._opt.backgroundLoadingShow)&&We(k)||_e(k))&&ue(e.$poster,"display","none"),k&&ue(e.$playBig,"display","none"),dt()||k||(e.$loadingBgImage.width=0,e.$loadingBgImage.height=0,e.$loadingBgImage.src="",ue(e.$loadingBg,"display","none"))}),k=>{D.fullscreen&&Mt(k)!==D.$container||f()}),f=k=>{k=sa(k)?k:D.fullscreen,ue(e.$fullscreenExit,"display",k?"flex":"none"),ue(e.$fullscreen,"display",k?"none":"flex")},_=()=>D._opt.playType===pe&&D._opt.playbackConfig.showControl,g=k=>{dt()&&e.$controls&&D._opt.useWebFullScreen&&setTimeout(()=>{if(D.fullscreen){const n=_()?48:38;var t=D.height/2-D.width+n/2,r=D.height/2-n/2;e.$controls.style.transform=`translateX(${-t}px) translateY(-${r}px) rotate(-90deg)`}else e.$controls.style.transform="translateX(0) translateY(0) rotate(0)";k&&k()},10)};try{at.on("change",o),D.events.destroys.push(()=>{at.off("change",o)})}catch{}D.on(N.webFullscreen,k=>{dt()&&(f(k),g(()=>{E()}))}),D.on(N.recording,()=>{D.playing&&(ue(e.$record,"display",D.recording?"none":"flex"),ue(e.$recordStop,"display",D.recording?"flex":"none"),D._opt.hasControl||D._opt.isShowRecordingUI)&&ue(e.$recording,"display",D.recording?"flex":"none")}),D.on(N.recordingTimestamp,k=>{e.$recordingTime&&(e.$recordingTime.innerHTML=Or(k))}),D.on(N.zooming,()=>{D.playing&&(ue(e.$zoom,"display",D.zooming?"none":"flex"),ue(e.$zoomStop,"display",D.zooming?"flex":"none"),D._opt.hasControl||D._opt.isShowZoomingUI)&&ue(e.$zoomControls,"display",D.zooming?"flex":"none")}),D.on(N.playing,k=>{T(k)});const T=k=>{ue(e.$play,"display",k?"none":"flex"),ue(e.$playBig,"display",k?"none":"block"),ue(e.$pause,"display",k?"flex":"none"),ue(e.$screenshot,"display",k?"flex":"none"),ue(e.$record,"display",k?"flex":"none"),ue(e.$qualityMenu,"display",k?"flex":"none"),ue(e.$volume,"display",k?"flex":"none"),ue(e.$ptz,"display",k?"flex":"none"),ue(e.$zoom,"display",k?"flex":"none"),ue(e.$scaleMenu,"display",k?"flex":"none"),ue(e.$faceDetect,"display",k?"flex":"none"),ue(e.$controlHtml,"display",k?"flex":"none"),D.isPlayback()&&ue(e.$speedMenu,"display",k?"flex":"none"),f(),e.extendBtnList.forEach(t=>{t.$iconWrap&&ue(t.$iconWrap,"display",k?"flex":"none"),t.$activeIconWrap&&ue(t.$activeIconWrap,"display","none")}),D._opt.showPerformance?ue(e.$performanceActive,"display",k?"flex":"none"):ue(e.$performance,"display",k?"flex":"none"),ue(e.$poster,"display","none"),ue(e.$ptzActive,"display","none"),ue(e.$recordStop,"display","none"),ue(e.$zoomStop,"display","none"),ue(e.$faceDetectActive,"display","none"),k||(e.$speed&&(e.$speed.innerHTML="0 KB/s"),ue(e.$zoomControls,"display","none"),ue(e.$recording,"display","none"),e.$ptzControl&&e.$ptzControl.classList.remove("jessibuca-ptz-controls-show")),E()},E=(D.on(N.playbackPause,k=>{T(!k)}),D.on(N.kBps,k=>{k=(function(n){if(n==null||n===""||parseFloat(n)===0||n==="NaN")return"0 KB/s";var r=["KB/s","MB/s","GB/s","TB/s","PB/s","EB/s","ZB/s","YB/s"],n=parseFloat(n),a=Math.floor(Math.log(n)/Math.log(1024));let d=n/Math.pow(1024,a);return(d=d.toFixed(2))+(r[a]||r[0])})(k),e.kbpsShow=k,D._opt.showBandwidth&&(e.$speed&&(e.$speed.innerHTML=k),E())}),()=>{if(_()){let k=e.controlsInnerRect.width-e.controlsLeftRect.width-e.controlsRightRect.width-e.controlsPlaybackBtnsRect.width;dt()&&D.webFullscreen&&(k=e.controlsInnerRect.height-e.controlsLeftRect.height-e.controlsRightRect.height-e.controlsPlaybackBtnsRect.height),e.$playbackTimeInner.style.width=k+"px"}});if(_()){const k=()=>{if(_()){let p=0;var n,a,d=D.playback&&D.playback.playingTimestamp;d&&(n=(d=new Date(d)).getHours(),a=d.getMinutes(),d=d.getSeconds(),D.playback.is60Min?p=60*n+a:D.playback.is30Min?p=2*(60*n+a)+parseInt(d/30,10):D.playback.is10Min?p=6*(60*n+a)+parseInt(d/10,10):D.playback.is5Min?p=12*(60*n+a)+parseInt(d/5,10):D.playback.is1Min&&(p=60*(60*n+a)+parseInt(d,10)),e.$playbackCurrentTime.style.left=p+"px")}},t=n=>{e.$playbackNarrow.classList.remove("disabled"),e.$playbackExpand.classList.remove("disabled"),n===Yi&&e.$playbackNarrow.classList.add("disabled"),n===Ji&&e.$playbackExpand.classList.add("disabled")},r=()=>{var a=e.$playbackCurrentTime.style.left,a=parseInt(a,10),n=e.controlsPlaybackTimeInner.width,a=0<a-n/2?parseInt(a-n/2,10):0;e.$playbackTimeInner.scrollLeft=a};D._opt.showBandwidth&&(e.$controlsLeft.style.width="90px"),D.on(N.playbackTime,n=>{e.$playbackCurrentTimeText&&(e.$playbackCurrentTimeText.innerText=Fr(n,"{h}:{i}:{s}")),k()}),D.on(N.playbackPrecision,(n,a)=>{e.$playbackTimeScroll.classList.remove(gi.oneHour,gi.halfHour,gi.fiveMin,gi.tenMin),e.$playbackTimeScroll.classList.add(gi[n]),e.rafId&&(window.cancelAnimationFrame(e.rafId),e.rafId=null),e.changePercisitionInterval&&(clearTimeout(e.changePercisitionInterval),e.changePercisitionInterval=null),e.$playbackTimeListOne.innerHTML="",e.$playbackTimeListSecond.innerHTML="",e.changePercisitionInterval=setTimeout(()=>{switch(e.$playbackTimeListOne.innerHTML="",e.$playbackTimeListSecond.innerHTML="",n){case Yi:Lo(a,e);break;case Ds:p=e,wr((function(m){var x=0<arguments.length&&m!==void 0?m:[],b=[],C=(x[0]||{}).startTimestamp;for(let y=0;y<1440;y++){let S=60*y,L=S%1800==0,B=!1;C&&(B=Pi(x,or(C,S))),b.push({title:nr(S),timestamp:S,dataType:"second",hasRecord:B,isStart:L});var v=60*y+30;L=v%1800==0,C&&(B=Pi(x,or(C,v))),b.push({title:nr(v),timestamp:v,dataType:"second",hasRecord:B,isStart:L})}return b})(a),(function(){var m=[];for(let x=0;x<24;x++){let b=x+":00",C=x+":30";x<10&&(b="0"+b,C="0"+C),m.push({title:b,hour:x,min:0,second:0}),m.push({title:C,hour:x,min:30,second:0})}return m})(),p);break;case Rs:p=e,wr((function(m){var x=0<arguments.length&&m!==void 0?m:[],b=[],C=(x[0]||{}).startTimestamp;for(let v=0;v<144;v++)for(let y=0;y<60;y++){let S=10*y+600*v,L=S%600==0,B=!1;C&&(B=Pi(x,or(C,S))),b.push({title:nr(S),timestamp:S,dataType:"second",isStart:L,hasRecord:B})}return b})(a),(function(){var m=[];for(let b=0;b<24;b++){let C=b+":00";b<10&&(C="0"+C),m.push({title:C,hour:b,min:0,second:0});for(let v=1;v<6;v++){var x=v+"0";m.push({title:C.replace(":00",":"+x),hour:b,min:10*v,second:0})}}return m})(),p);break;case Ji:d=e,wr((function(m){var x=0<arguments.length&&m!==void 0?m:[],b=[],C=(x[0]||{}).startTimestamp;for(let v=0;v<288;v++)for(let y=0;y<60;y++){let S=5*y+300*v,L=S%300==0,B=!1;C&&(B=Pi(x,or(C,S))),b.push({title:nr(S),timestamp:S,dataType:"second",isStart:L,hasRecord:B})}return b})(a),(function(){var m=[];for(let C=0;C<24;C++){let v=C+":00";C<10&&(v="0"+v),m.push({title:v,hour:C,min:0,second:0}),m.push({title:v.replace(":00",":05"),hour:C,min:5,second:0});for(let y=1;y<6;y++){var x=y+"0",b=y+"5";m.push({title:v.replace(":00",":"+x),hour:C,min:10*y,second:0}),m.push({title:v.replace(":00",":"+b),hour:C,min:10*y+5,second:0})}}return m})(),d)}var d,p;k(),t(n),r()},16)}),D.on(N.resize,()=>{E()}),E()}if(D._opt.operateBtns.quality&&0<D._opt.qualityConfig.length){D.on(N.streamQualityChange,t=>{k(t)});const k=t=>{e.$qualityText.innerText=t,e.$qualityMenuItems.forEach(r=>{var n=r.dataset.quality;r.classList.remove("jessibuca-quality-menu-item-active"),n===t&&r.classList.add("jessibuca-quality-menu-item-active")})};{const t=D._opt.qualityConfig||[];let r="";t.forEach(n=>{r+=`
                    <div class="jessibuca-quality-menu-item" data-quality="${n}">${n}</div>
                `}),r&&(e.$qualityMenuList.insertAdjacentHTML("beforeend",r),Object.defineProperty(e,"$qualityMenuItems",{value:D.$container.querySelectorAll(".jessibuca-quality-menu-item")}),setTimeout(()=>{var n=t[0];D.streamQuality=n},0))}D.streamQuality&&k(D.streamQuality)}if(D._opt.operateBtns.scale&&0<D._opt.scaleConfig.length){D.on(N.viewResizeChange,t=>{k(t)});const k=t=>{var r=D._opt.scaleConfig[t];e.$scaleText.innerText=r,e.$scaleMenuItems.forEach(n=>{var a=n.dataset.scale;n.classList.remove("jessibuca-scale-menu-item-active"),Ut(a)===Ut(t)&&n.classList.add("jessibuca-scale-menu-item-active")})};{var h=D._opt.scaleConfig||[];let t="";h.forEach((r,n)=>{t+=`
                    <div class="jessibuca-scale-menu-item" data-scale="${n}">${r}</div>
                `}),t&&(e.$scaleMenuList.insertAdjacentHTML("beforeend",t),Object.defineProperty(e,"$scaleMenuItems",{value:D.$container.querySelectorAll(".jessibuca-scale-menu-item")}))}k(D.scaleType)}if(D.isPlayback()&&D._opt.playbackConfig.showRateBtn&&0<D._opt.playbackConfig.rateConfig.length){D.on(N.playbackRateChange,r=>{k(r)});const k=r=>{var n=D._opt.playbackConfig.rateConfig.find(a=>Ut(a.value)===Ut(r));n&&(e.$speedText.innerText=n.label,e.$speedMenuItems.forEach(a=>{var d=a.dataset.speed;a.classList.remove("jessibuca-speed-menu-item-active"),Ut(d)===Ut(r)&&a.classList.add("jessibuca-speed-menu-item-active")}))};{h=D._opt.playbackConfig.rateConfig;let r="";h.forEach((n,a)=>{r+=`
                    <div class="jessibuca-speed-menu-item" data-speed="${n.value}">${n.label}</div>
                `}),r&&(e.$speedMenuList.insertAdjacentHTML("beforeend",r),Object.defineProperty(e,"$speedMenuItems",{value:D.$container.querySelectorAll(".jessibuca-speed-menu-item")}))}const t=D.playback?D.playback.playbackRate:1;k(t)}D.on(N.stats,function(){var k,t,r,n,a,d,p,m,x,b,C,v,y,S,L,B,A,I,U,P=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};D._opt.showPerformance?(ue(e.$performancePanel,"display","block"),e.$performancePanel.innerHTML="",U=On,k=window.performance&&window.performance.memory?window.performance.memory:null,t=D.video&&D.video.videoInfo||{},r=D.audio&&D.audio.audioInfo||{},n=D._times||{},a=D.getRenderType(),d=D.getCanvasRenderType(),p=D.getDecodeType(),m=D.getDemuxType(),x=D.getStreamType(),b=D.getAudioEngineType(),y=D.getRecordingDuration(),S=D.getRecordingByteLength(),C=D.isAudioPlaybackRateSpeed(),v=D.videoIframeIntervalTs,y=Or(y),S=ar(S),L=D.isPlayback()?"录播":"直播",B=P.isDropping,A=D.control?D.control.kbpsShow:"0 KB/s",I=D.getVideoPlaybackQuality(),U=`
                <div class="jessibuca-performance-item">
                    <span>版本 ${U}</span>
                </div>
                ${k?`
                    <div class="jessibuca-performance-item">
                        <span>内存大小限制 ${ar(k.jsHeapSizeLimit)}</span>
                    </div>
                    <div class="jessibuca-performance-item">
                        <span>可使用的内存 ${ar(k.totalJSHeapSize)}</span>
                    </div>
                    <div class="jessibuca-performance-item">
                        <span>已使用的内存 ${ar(k.usedJSHeapSize)}</span>
                    </div>
                    `:""}
                ${k&&k.usedJSHeapSize>k.totalJSHeapSize?`
                    <div class="jessibuca-performance-item">
                        <span>可能内存泄漏 是}</span>
                    </div>
                    `:""}
                <div class="jessibuca-performance-item">
                    <span>播放模式 ${L}</span>
                </div>
                ${D.isPlayback()?`
                        <div class="jessibuca-performance-item">
                            <span>播放倍率 ${D.playback.rate}倍</span>
                        </div>
                        <div class="jessibuca-performance-item">
                            <span>播放模式 ${D.playback.isUseFpsRender?"固定FPS":"动态FPS"}</span>
                        </div>
                        ${D.playback.isUseFpsRender?`
                             <div class="jessibuca-performance-item">
                                <span>固定FPS ${D.video.getStreamFps()}</span>
                            </div>
                            `:""}
                    `:""}
                <div class="jessibuca-performance-item">
                    <span>解封装模式 ${st[m]}</span>
                </div>
                <div class="jessibuca-performance-item">
                    <span>解码模式 ${p}</span>
                </div>
                <div class="jessibuca-performance-item">
                    <span>渲染组件 ${a}</span>
                </div>
                ${a===Tt?`
                    <div class="jessibuca-performance-item">
                        <span>渲染引擎 ${d}</span>
                    </div>
                    `:""}
                 <div class="jessibuca-performance-item">
                    <span>网络请求组件 ${x}</span>
                </div>
                <div class="jessibuca-performance-item">
                    <span>视频格式 ${t.encType||"-"}</span>
                </div>
                <div class="jessibuca-performance-item">
                    <span>视频(宽x高) ${t.width||"-"}x${t.height||"-"}</span>
                </div>
                ${D.isPlayer()?`
                    <div class="jessibuca-performance-item">
                        <span>视频GOP(ms) ${v||"-"}</span>
                    </div>
                 `:""}
                <div class="jessibuca-performance-item">
                    <span>音频格式 ${Hi[r.encType]||"-"}</span>
                </div>
                <div class="jessibuca-performance-item">
                    <span>音频引擎 ${b||"-"}</span>
                </div>
                <div class="jessibuca-performance-item">
                    <span>音频通道 ${r.channels||"-"}</span>
                </div>
                <div class="jessibuca-performance-item">
                    <span>音频采样率 ${r.sampleRate||"-"}</span>
                </div>
                ${D.isPlayer()?`
                    <div class="jessibuca-performance-item">
                        <span>播放器初始化(ms) ${n.playTimestamp}</span>
                    </div>
                    <div class="jessibuca-performance-item">
                        <span>开始请求地址(ms) ${n.streamTimestamp}</span>
                    </div>
                    <div class="jessibuca-performance-item">
                        <span>请求响应(ms) ${n.streamResponseTimestamp}</span>
                    </div>
                    <div class="jessibuca-performance-item">
                        <span>解封装(ms) ${n.demuxTimestamp}</span>
                    </div>
                    <div class="jessibuca-performance-item">
                        <span>解码(ms) ${n.decodeTimestamp}</span>
                    </div>
                    <div class="jessibuca-performance-item">
                        <span>页面开始渲染(ms) ${n.videoTimestamp}</span>
                    </div>
                    <div class="jessibuca-performance-item">
                        <span>初始化到页面渲染(ms) ${n.allTimestamp}</span>
                    </div>
                    ${D.recording?`
                        <div class="jessibuca-performance-item">
                            <span>视频录制时间 ${y}</span>
                        </div>
                        <div class="jessibuca-performance-item">
                            <span>视频录制大小 ${S}</span>
                        </div>
                    `:""}
                `:""}
                <div class="jessibuca-performance-item">
                    <span>音频码率(bit) ${P.abps}</span>
                </div>
                <div class="jessibuca-performance-item">
                    <span>视频码率(bit) ${P.vbps}</span>
                </div>
                <div class="jessibuca-performance-item">
                    <span>视频帧率(fps) ${P.fps}</span>
                </div>
                <div class="jessibuca-performance-item">
                    <span>视频峰值帧率(fps) ${P.maxFps}</span>
                </div>
                <div class="jessibuca-performance-item">
                    <span>解码帧率(fps) ${P.dfps}</span>
                </div>
                <div class="jessibuca-performance-item">
                    <span>音频缓冲帧 ${P.audioBuffer}</span>
                </div>
                <div class="jessibuca-performance-item">
                    <span>音频缓冲时长(ms) ${P.audioBufferDelayTs}</span>
                </div>
                ${D.isPlayer()?`
                        <div class="jessibuca-performance-item">
                            <span>视频待解码帧 ${P.demuxBuffer}</span>
                        </div>
                    `:`
                         <div class="jessibuca-performance-item">
                            <span>缓存时长(ms) ${P.playbackCacheDataDuration}</span>
                         </div>
                         <div class="jessibuca-performance-item">
                            <span>视频待渲染帧 ${P.playbackVideoBuffer}</span>
                        </div>
                        <div class="jessibuca-performance-item">
                            <span>视频待解码帧 ${P.demuxBuffer}</span>
                        </div>
                        <div class="jessibuca-performance-item">
                            <span>音频待解码帧 ${P.audioDemuxBuffer}</span>
                        </div>
                    `}
                <div class="jessibuca-performance-item">
                    <span>待解封装数据(byte) ${P.flvBuffer}</span>
                </div>
                ${D._opt.useMSE?`
                    <div class="jessibuca-performance-item">
                        <span>MSE缓冲时长(ms) ${P.mseDelay}</span>
                    </div>
                    <div class="jessibuca-performance-item">
                        <span>MSE解码间隔(ms) ${P.mseDecodeDiffTimes}</span>
                    </div>
                    <div class="jessibuca-performance-item">
                        <span>MSE解码时间(ms) ${P.mseTs}</span>
                    </div>
                    <div class="jessibuca-performance-item">
                        <span>MSE播放模式 ${1<P.mseDecodePlaybackRate?"加速":"正常"}</span>
                    </div>
                    `:""}
                ${D._opt.useWCS?`
                    <div class="jessibuca-performance-item">
                        <span>WCS解码间隔(ms) ${P.wcsDecodeDiffTimes}</span>
                    </div>
                    `:""}
                ${D.isOldHls()?`<div class="jessibuca-performance-item">
                        <span>HLS缓冲时长(ms) ${P.hlsDelay}</span>
                     </div>
                     <div class="jessibuca-performance-item">
                        <span>HLS播放模式 ${1<P.hlsDecodePlaybackRate?"加速":"正常"}</span>
                     </div>
                     `:""}
                ${D.isUseHls265()?`<div class="jessibuca-performance-item">
                        <span>HLS缓冲时长(ms) ${P.hlsDelay}</span>
                     </div>
                     <div class="jessibuca-performance-item">
                        <span>HLS待解码帧 ${P.hlsDemuxLength}</span>
                     </div>
                     <div class="jessibuca-performance-item">
                        <span>HLS待解码视频帧 ${P.hlsDemuxVideoLength}</span>
                     </div>
                     <div class="jessibuca-performance-item">
                        <span>HLS待解码音频帧 ${P.hlsDemuxAudioLength}</span>
                     </div>
                     `:""}
                ${D.isPlayer()&&I?`
                    <div class="jessibuca-performance-item">
                        <span>已渲染帧 ${I.renderedVideoFrames}</span>
                    </div>
                     <div class="jessibuca-performance-item">
                        <span>已丢弃帧 ${I.droppedVideoFrames}</span>
                     </div>
                `:""}
                ${D.isPlayer()?`
                    <div class="jessibuca-performance-item">
                        <span>网络延迟(ms) ${P.netBuf}</span>
                    </div>
                    <div class="jessibuca-performance-item">
                        <span>缓冲时长(ms) ${P.buf}</span>
                    </div>
                    <div class="jessibuca-performance-item">
                        <span>最新缓冲时长(ms) ${P.pushLatestDelay}</span>
                    </div>
                `:""}
                <div class="jessibuca-performance-item">
                    <span>视频显示时间(ms) ${P.ts}</span>
                </div>
                ${D._opt.hasAudio&&D.isAudioNotMute()?`
                        <div class="jessibuca-performance-item">
                            <span>音频显示时间(ms) ${P.audioTs}</span>
                        </div>
                        ${D._opt.hasVideo?`
                            <div class="jessibuca-performance-item">
                                <span>音视频同步时间戳(ms) ${P.ts-P.audioTs}</span>
                            </div>
                            `:""}
                        <div class="jessibuca-performance-item">
                            <span>音频播放模式 ${C?"加速":"正常"}</span>
                        </div>
                        `:""}
                <div class="jessibuca-performance-item">
                    <span>视频解码时间(ms) ${P.dts}</span>
                </div>
                ${D.isPlayer()?`
                    <div class="jessibuca-performance-item">
                        <span>解码前-解码后延迟(ms) ${P.delayTs}</span>
                    </div>
                    <div class="jessibuca-performance-item">
                        <span>总延迟(网络+解码)(ms) ${P.totalDelayTs}</span>
                    </div>
                `:""}
                ${D.isPlayer()&&P.isStreamTsMoreThanLocal?`<div class="jessibuca-performance-item">
                        <span>是否超过一倍率推流 是</span>
                    </div>
                   `:""}
                ${D.isPlayer()?`
                    <div class="jessibuca-performance-item">
                        <span>是否在丢帧 ${B}</span>
                    </div>
                    `:""}
                <div class="jessibuca-performance-item">
                    <span>网速 ${A}</span>
                </div>
                <div class="jessibuca-performance-item">
                    <span>播放时长(s) ${Or(P.pTs)}</span>
                </div>
                <div class="jessibuca-performance-item-block"></div>
            `,e.$performancePanel.insertAdjacentHTML("beforeend",U)):(e.$performancePanel.innerHTML="",ue(e.$performancePanel,"display","none"))}),D.on(N.togglePerformancePanel,k=>{ue(e.$performance,"display",k?"none":"flex"),ue(e.$performanceActive,"display",k?"flex":"none")}),D.on(N.faceDetectActive,k=>{ue(e.$faceDetect,"display",k?"none":"flex"),ue(e.$faceDetectActive,"display",k?"flex":"none")})};function tn(D,u){var i,s,u=(u=u===void 0?{}:u).insertAt;D&&typeof document<"u"&&(i=document.head||document.getElementsByTagName("head")[0],(s=document.createElement("style")).type="text/css",u==="top"&&i.firstChild?i.insertBefore(s,i.firstChild):i.appendChild(s),s.styleSheet?s.styleSheet.cssText=D:s.appendChild(document.createTextNode(D)))}function rn(D,e){e instanceof Element?D.appendChild(e):D.insertAdjacentHTML("beforeend",String(e)),D.lastElementChild||D.lastChild}function Ge(D,e,i){D.style[e]=i}function sn(D,e){return D.composedPath&&-1<D.composedPath().indexOf(e)}function Lt(D){let e=!1;return D&&D.parentNode&&(D.parentNode.removeChild(D),e=!0),e}tn('@keyframes rotation{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes magentaPulse{0%{background-color:#630030;-webkit-box-shadow:0 0 9px #333}50%{background-color:#a9014b;-webkit-box-shadow:0 0 18px #a9014b}to{background-color:#630030;-webkit-box-shadow:0 0 9px #333}}.jessibuca-container .jessibuca-icon{cursor:pointer;width:16px;height:16px;display:inline-block}.jessibuca-container .jessibuca-ptz-controls{position:absolute;width:156px;height:156px;visibility:hidden;opacity:0;border-radius:78px;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAATgAAAE4BAMAAAA9UfJZAAAAMFBMVEUAAABHcEy0tLRZWVmysrKoqKi1tbWvr6+2traBgYG1tbWWlpa1tbW1tbVUVFS1tbVGCHqkAAAAD3RSTlMzAO9U3LSWySp3aZcVRDUDw823AAAJYUlEQVR42u3d32sbVxYH8EPHxgg/lBsa7SBkukmpSbwLI2KbEPpgZ5MQtwmM0wRMmgdhP6RgEuwlSVnYlmGMYaEvMU1KKX4QNq0pocVmm7CYfRBaQguFpbgPKRSC/4V2LGliO+bulWKrkvVrftyZ+WbxeTRG+nDnnnNmRjP3EpMR6tMH18du/0Xj1tGz5+9cf/DUlPKx5PsTkr8s3eZ1cX7ym1zkuI/f1wTFunNt9fP+FIno7/98/tFY+Y8ffBUlLrmkl2Cr96guTv27BMxP5iLCqUvi68+tpqhJKPNXBH3SjACnfimm/7Wmsl3fI/FP75lh457oPH+1Da3M+1T8481QcT0T7UetevR618LDPdH4hTlyHLGH3LoZEk6d4PlvyVW8pfNeMwzcDwa/kCKXoTzk9tfB455o1mXyEIOa+0PrFvcFt+fIU8QM/k6guOQifzNFHkN5l/flgsOJVHibfMR9l2nhBqem+VXyFZ/xghkMTp3il8lnDPKiGQROhs2lzjEuKcVW1uWk4ybk2Eq63pxk3CK/RZLiJO+Ti/vZXw3ZX1E+kon7jv+JJMY/+Q15uIRWIKmRthZk4VTDTsnFKYZtSsItWiskObq1Pjm4f8gqIrUF5W8ycAl+nAKIT/iCf1zSKFAgkW4/7drifrLmgsHF2k87alvhblFAcbJttWuDU/VtCiyyedMXbjGfCg6n6H1+cHE+TQFGFx/3jksa2xRoZO2cZ9xsUJn6e8aOeMX1aGco4Biw1jzilm0KPNJb3nBxvhI8rrtVTlCLK5ptCiEyBS+474POhr2c+NA9Lqm/QaHEiXzONW42yN5Q2ydG3OLU4MvI7+XEdImbCWvgSkN3zB1O1YYptOhoNnRNcDM2hRjGMTc4VZsOE9fVZOioyYyjUKPJrKPGNW44XFxX41rXEPc4vFTdS9iLTnFJ4wyFHAO2U1zcSoWNU7RLDnFTb1DocaLoDJfgc+HjYo3uTjTArW9TBJHdcYJTtdEocJ0NCnE97nGBIon0RQc4YzgaXIfdHhdBHdmrJuNtceubFFFkdtrhVG0lKlx3XUrsxz22KbIwLrbBTQ1Hhxsotsb18FR0OIWvtcT9Z5sijOyfW+KM6ShxXXYrXMJKRYlTtIUWuLubFGlknrXAGaPR4jrt5riERRFH7XGtwc1sRo3LHGuKi/qo7j+uhJOr9flKMBW4QR2uxk1NR4/rKjbGRdpXG/bXKtxrAEdVHNfTDXHLf0TAvbLVCJfU5hBwMSvXABfPE0To4w1wP25i4DLPG+CmRjFwncV6nIpQSF4UE7MOd7hAIJG+VIe7u4GCG3pWh0uPouA6C/txMFOuetIR3JSrmnQEN+WqJh2BVbmaSreLS+JMudKky9Xg4jYBRXq8BndoEwmXOVKDWx5GwnVs1eD0OSRcLF+N67EIKrS1Klx8GwuXHa/C/biBhRt6XoVbnsbCdW1V4bDyoZIRZZwKlg8iI8wKLl5Aw73oEWXcoQ003NCRCm59GA3XsVPBTa2g4bqLFZyWQsMp1h6uJ09woa/t4tCaV6WBEWSy7qYrQSbrbroS2MVNzUUOAXbWSnel0sU+AUbpsl/gEjYizlgo4w5vI+Kyl8o4xEryopYI3N1hRFzHszJueRQR17lVxqXnEHGxQhmHd06yd15CgBcQlcsIYokCJi69IHDxbUycOGki9toGJm7otMC9/ism7tXfBA6zBperMIHW4HIVJsDrwsrVIYE2CNEibIHDbBDlFkFJ0AYhWkSOemxUnLFGqN2r1L8ItXuV+hfFN1FxmXH6wwYqbuivdAgXd4RQ+36p8xNq3y91flqfRsV17dD6KCquc4eWcXFbtLyCiusu0hQ0bg4VFytSGhdXICOFilNs0nFx+QOcZ5xGsGEd4DzjOC6OH+A847QD3P9jtuJ2CGjcQeP3gYM+2YQ+TYe+wMG+NETGQd+OgL6RA30LDPrm4eu/ouJe/Q37hjX0rX7oH0mgf16C/mEO+idN6B+DoX9Gx34AAfrRDeiHXqAfF0Lt/OUHrVAfUcucRn+4D/qxSOgHSqEfxcV+iBn68W/EV3AqD85Dv3IA/bIG9GsumC8IaSb+q1XYL6VBv84H/SIk9Cuk0C/fQr+2jP3CN/Sr8tCLDEAvzwC9sAX0kiDYi6lAL0MDvYAP9NJH0ItGYS+3Bb1QGVaP2LfEG/TieNDLCmIvyAi9lCX0IqDQy6diLzwLvWQv9GLH0MtER76rRqWxPgdemtwYf9kWdYdeDh97IwHoLRigN6/A3vYDesMU6K1msDfpgd7eiOmjSEf1ZdpSC3ozMuht3LA3wIPeOjDSTRdfKb7M21VCb/QJvUUq9uay0NvyYm9oHFFKdDvaChp6E23s7cehN25nh5G3vE8aZ8LGDdjMIY49zoc9dPpFx7ikHnIh7sjnHOPYTMj36oxjzDlO1UI9Xe9oUICb49iMDTBwzXCqFuKsG2gycM1wYtaFlrCK3mTgmuJU7UzkA9cUx2bDGjpFH2FucUk9pA57onGNa4lj31uhnJzEtA+ZexxLh3KpkykwL7g4D+GUuJuPe8Kx5RCuJtJbzBuuJ/hyMmCtecSx2aBzIqaNMK+4pBHwtU7WznnGiZwI9Oykq1U2tMWxxSD7hKL3MT84VQ/wwGbzpi8c+47fCsp2kt9g/nDsp6AyNqb1Mb+4pBFQKU7bpm8cS/DjQdg+aXT/wTWOzfLL8m2DfITJwLFFS/oZQHf7CecQpxq25GqnGO0nnEMcS2iSq13WWmCycKLaHZebDDeYPBz7mb8tz3aff8Rk4tiivJQd5H1MLo5NyNIN8t6cbJw6ZV2WYys6tTnHCZ2MsRM2k8nHSdG5srnBMTXNr/qzfcYLLmyucEyd8FdR7vNeNzZ3OJZc5G967mTKu7wvx4LDMfYFtz2efMYM/o7LL3OLY080byVlULNusqBx7AeDX3B9aJWH3P6aBY8rpUX+W3e2t3SXqeAZVzq0/JyLmRe7wt0fUs849t8Jzv/u8Ngq/+K8d42FhxODp/P8VQc85VPxjzc9folXHFO/1Lh1rc3BjT0S//SeycLGCd6Sxvm51abDp8xf4dyaNL1/gw+caBhLuvj6O6v36mWn5scEPe+H5hMn4uP3hUEAr63e6y+PYX//qflHY+U/fvCVzw/3ixPD98vSbV4X5ye/yfn+aP+4MvDpg+tjZ4+K8bKOnr1z/cFTU8rH/g92biFxn2S73AAAAABJRU5ErkJggg==") no-repeat 50%;background-size:100% 100%;transition:visibility .3s,opacity .3s;right:43px;bottom:135px}.jessibuca-container .jessibuca-ptz-controls.jessibuca-ptz-controls-show{visibility:visible;opacity:1}.jessibuca-container .jessibuca-ptz-bg-active{visibility:hidden;opacity:0;width:156px;height:156px;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAATgAAAE4CAMAAAD4oR9YAAAAM1BMVEX///////////////////////////9HcEz///////////////////////////////////85yRS0AAAAEXRSTlO5DCgVgZBxAK2fQDRkBR5XTPLKM/gAABnnSURBVHja7F0Jkqs6DGQPO9z/tD8Jq6WWbCCvIjKfzAGmulrW3ooedr6ui+M4TdP++SXPr1l/SdL3aRrHhv7ZyA5qb9xe0L3Am+DrkzeCL/BeX908MezTuPsfOArdgl3KsZuhq99fk/Tx3waum+ByAHua5QbYilkzY1aP728YhrH5InrfBa57OLAtVjpRbYaumex04dq4APeC7vnVSfo/45bXLe33jGscMx3f0A1vyg3t69e2dRL/NeA6wrgdcCvjyPM2U25mXDt9xVD3f/qN0yi3Mm6P20S54vlXtGPS/R3GPSbYOsC4ZAvmJtiaGiL3Zlzx/Ht+Y/KXTJXbqmaqe9za1VYn3N7YpX/OVGev2qduOLIiB7xqOzGuWCiXFVmWtU3368A5lkqeOJI21I5XXaORxVRnxmUTdNnY/4U3riNvHMJts9XRtdXVUttipdzrK/4x7UyY6sK4Gbo+nU21T1zKcd9AGJetlMvyLKvj3zXVfeqQElMljINx3MK4xVQ3xj2Ry7N/6CiMOIfYyVUXWxUyBx7HuZRbcHt9bf/Lb9zsHlzKzabauJaK47iVcC7jJujS33/joKkmxDnM4QiJ4xDjZuT+DXQW3jgxV012qcPuiePhCGfchlv1/P0D6Czmqmuq2gPGkbIS8Q4ZsNU3dGP3Y2+cW1RyKpkrbAnwqhi3iXHFHrU3bFVV5c3vBsCsOALjkXErAW85F3rjFvBm5Kos+TngCOXYG7fA1ojFER7GPUHbmer0tfGPANeROM6pjvDMQSkrsWQ1d564Fbr61964TvSqDa6O0ELmAtvGuc2rrpQrn/aa/qCpYq+6mSpOVhnjWBy38u2JXFl9yL8acg6CV3Ur5yxVZfW4AsRxG+XKssz6n3njVMYR4Eg8sj1yi3tgtroxrpyhG38gc+h8PYddPQ551dVQW5jju2/cG7kXdB946Uy9cbDnQOpxuCCHcq5dHDcht8D2/K67VxPNGtLJd7qDTcgb1zLGbXEcY9z0Fd39GReTzIH1B/2lcxrGTYxjXnXyqxNyef8zpipVlfDsyCCmDkuumhGvWq6W+vyisqxvDJwwOxJQO6fNmjaQcRt0ZdR2dwWOFZViuculNWtgBZjk+DNq1cq45y+Lf5NxE25B3oEyLueFJWqtT+Ciqr8r48jsCAyAG+2Na53MAdQxX16VhHEL4Z7Ilc2dGad28pskaULiEdDlyijjdqa6gBeNtwSu63AnP3V6NUnAG9cu1RHOuL2hVi5qr6+9Za4qV0dCGcfCEfDIufWRFbsZvKy7KeNgW7XHvRqxWfOGLhO6XCrjoiiPb/rGdZ75uGRfj9u3B1sWAEtdLuxVF/Cq9HaMe4A4TptkZYwLqI44rmGDbUe5E8hZcg54zquRbHXu5NN6HKuO7N84YqwbdGV/Q8YF5arUN7CJTNLkgplD5T5xG+OOI2ehAhxv00ocOlpWwhHwljns5uNg6bxCb9wbueSupip6VTnj2jGudSvnOeqrVo6h7vl2nHM2K8AkV1WyfDYDvHUcWF+1VBl3EDlLKdc2dQ6aNbhXw2eAt14Nf+MqFse5rDuS8tucHUmhqaJppYF6B8440h7E8cjhqMTiLtcaAL+ga9jWZb35hpbHceyNI9WRSmHcE7n4jqbqTp2D2nnzgm154mB1hJQy1cwBIpd3twCOrjnEoDsoTZ2jepybb2VKrhpx3zB92Z29Khpl1ZN8MHWzJV1CdYQHJEeqTMbqcfEMW+obLBwES83w7AgvY0YlMNT3N96GcXEHGQdxG2t3CQ5kDkoFeO8esHd4fc193jinAtxvXhUN3Ywz5VAFGM3cENfgVM4x5YICYRumqu5yIVMdJuhaLXMAFWBKOIhbWFBiO44Dg4Usxx/cCrDyxqESMIYuu4lX1fYcGnVaaVmtKXZxHOzW5Bvfqtk3iLAFuVaLew4HluDUzIH1VYMZF+AgLMZxcAYY1uNYBTgrwPDIaqxOQ1p540IchBFTJW9c2ofNAO99Q+sYaugbJ35Vd4sKsPbGqVM33KsWmdpXLeXqufsVNwhH8FyhOh8n74foKb5WVDr0zFky1Rgt+iaJZyJTWErKMynpqsqgVy4q0xv0VTvZq0pJPq5jzn41zzzVET0aCYjmTO05OLaaBEwWqhvSenUkKtVw5P0N96mOpNr2YCPuh4AJCGEAoioDver7628Sx8WAcU2i1eM259AWhZBzuQEJieN07JR6sCHgXoSLnepI7yo9NqgCLE5A6K4hjHGKsVqK49JYEGyBg4XIq2b7FREUx5Xu2LkXOtmz2pJBW5sOqdjJF3sOjHG5fz7OT7n8DtURwjjPtBKtx7VLOa6Q4zh5Wkn8xhvU4xbG9al/s2bAbxwYkJO7XCGME43VIuMc56Dnqi7hpPE4cVopBLnibozTp5X4DHAQ49iwfsCX3IhxYFoJB8C0y7Xr1iwBSZXDulIUjF11G6+qr5aPALlCmTrfyWfQzCEK49xoPMnnjFMaq3QlX9tzQPuq0QFbLeNbMU6cHRn3Sb60HwJ6NXAhKQi61nzpPAbtQaY8jUUgQnRHSodxZSjjoig161W7HePIRGZDJzJHQXiEzE4DpRtSjotCHzkUkhj2qqJi4V54T1S6cWwVp/nhjAP1JQuDhbs4TtFW0spKTgW4UHJVFv4GQpcZA64jkt1xDNS8lDEv9Y3z5KpRGY4biIINMC7e2lxKNFJDqUfQquGZA2yrHoINUM7G6ZX1iVM2RKDUI08dssVUfduDRyI5QDkbFWCnscrWVWV1/RZ2uaRc9UyKL1LO0r7q1qwBm761WsmEUjdge9ApAB9iHHWslq4kMalHTbHQieO0zXKljHmIc4XdOE695yCpsg7eOE7t5B/4Uqv1uDSGKhDYq0r6yQWYj5NnRw5BNxjOHJAKRJB+nJqr4jcuOki4qOzs5qrgulSDJzJHUcyrCNMdOc44ty5nel815KDZ4HTypeoILAEfZJxbCjYkSpVKgZx/IpOfXgnarDkKXWIrHAm7kiTqxw1er+oQzg2Bj32FTcYJ2kpCIx9PK2XMq1ZCz+EM46LYZK4qaCsdmo+TqiOV5FWPITdYLZ2jOqYa/6LN8kJSZT1dxkSTJEYKmZ2/OuI5aIYYh+UzKn3TN9A9mLjL1cl6LexKkqof575xVJWVx3HRefdgUbGQNGs2U2Ul4HYQ60o+HeBzjCtt9VXVqXMpc3DEzh2NzEJSnr7OuG35wUTpPGjqXN3lQgdE0AWRA2sOHls1eO2yh/uqWM1LbUgvQzeatOhR5NZM39QIBNyQbviBVajYItbOYa56knCbrRrUj0vxTn5QVQlOnUtdrjKKztuqpbMEJ27WtCG3BzX9uMPfYqsmlW7SPnRfFeSqwTrAp9641VZtXi1PlX1VN44THzlvPe4k45aZLys9h+7cvuqsAqEpBAm6I9HJN24pZ9oIRzp5XzVUsVCZOnd0Ry4zbu52GdMBDn7j+NVyYXaEneW6+sbNrQcjtwdJCTh4WmlrSLcF3axRZ4AvMC6zxjj9annty1X9M8BoefBMQGKudB5UjnMnMltQV1JuD5JK5jnGTUU52zeke+4cfMJ7ygxwSZuDJ6EbzDEuZF+VNLnczCETlPdkdf3Tj5yhAHhNVdV9VXgJGV9JyqWjjRdS1fWRs6vmRctK1KuiLD/b22q2KyvlWJT1HOPeo3IWqyNwlwtrxJNrlwW69ZNr0qKnoBsfNrWVcH+w9gzIFXxDeisr5cxSrzCusFVWkpVukH7coF/0zQRt0a2QGZ1HLrfAuIfDOL/uiLOTz9UMMiTmtXMOVXmxW/P+OqM6wPBKEmLcbuiGMw4lq9cmIPbewa5iIb3LdYxxKHMouYDcSeRqcxd9+dS5VFWCGZd3e9DtR5+21dbYRd/1EAaagUC6IzDLV7YHj4pSKbmDkZRLnmRNcHeQ3azZdvLJ9qCUOVyhXGVmQUSpx9GWAzNW6Y0DmYMzrbTeHjzxxTeI41zktugXtQezAsRxon7caUt9VZZMMQ7pAPMnjnTyB5lxJHPgU+enGTeajONUHWB46wfW41jmAE79nHerNiYyFeXpBu/keycyM8983CWv+sxWLe2rsgpwH7qRxPuqb7pl6IKe61RPYpcbvefQy3e58LSSbwY4B071CuNKk31VtswlTyuJ+6oZuss1h3HVCTEDluZb7Ks6prqrjijlOLTLxRlXUhng85RLo+77por7qp5c1fUN8I1Tbw9eqce9ArkvA6eqxOOr5UQGgrdVC1l5GszHnYSuNsC4OKgeF6au73S5Mt983IU3bvwqcN3jAe9y9VgkvvHPskp7DuI9h7PfYOGNw3EcH7rx91XRPbNPT2TOEbCNNw7uJOGhG+naD8+5PG/cJcI9gYu/CxuYVuqd+6reHbgBWqrvavlV5LLvAqfdc6AFYElcyW1IS0eScqg7ch65/MvABXW5ElWvZXDiOL2Tz3VHzn7Vt4F7iNuDobMjwp7DUh3hfKs+EQCbAs43O9KgG9KDrK6vMe5qIPdd4NS7XFLi4NxzADf0eEPa8aqX1lV35REjb5zac1geuYVwtfjGbTmXsJH0qf7g14Hz9xzE9iD0qigewTv5F71qaeKNwz0HXI+jb5zLODABQWaAP+MbXA2SbxdH9KlzMjw9jvAUMr72o6363hQ4VyQ+lU+vkH70ALVFM2cnP8f1uOojhLPgVZnWI7y9Enjtcr+TT/qDJdj0LW9tqlgFQtUdYQfNQupxnHE3dw5aripmDgOcOt90gHOpOvKRF85EOCJKPSrVEa/y9D9QLDQEXKco3UiqVPtdrjZIIxNuSEeX+qomc9U+3S/WUIUgvD2o7nJ9UnfECnAPWQUiSOu8HYKERz6oO2IDuE7THcHOATIO9xzQhnT1IcblVhjnagRp8QjZVw1gHOFb9ZnSuY1OvutVe3/86w4Be7XOc6GvetsuF47jAq5dElFWn9a5oJF5YUDOBHCdds9BzRw2xrWy1jl946qrC6tfb0i7uWoKZ0eaoJs1e8LR+6pQPy66GMiNhqaV4ljbc/DqjrTC1fL8n/RVa0ummiI1r0a/yyUPT2dcXBR08s9Cl9gVpdKvEvgO00LB7qta585g4eP7jIuDxEXdaSV87TID91WdiUx67uf011lkHBTea/R6HN1XhTdr0AmROw9Pd1h5euurJvxKEh2e9uyrfnYn38q4vnp7cLchXXuVbtxdLoFx1UVtpWnv0uLNGudquTCROXj2HHI6riRK791zJakjIxDKRGatMI5fu8z81y4vzU5bE2yJmYLyFsc1jaythPcc+CW4j2grGVi71GTQgnLV1tFrQduDUj3uWvwb27p2Sefjel/PAXXy+QywoFh4IZKrTF67lC6I1H6NTHEGOBeWB88LoVm6dimoGaxO1a+RiafOpX3V8r7yGayOuZfPgGsOQhy3V4Fgew7wSlJ5hXG1aY1Msj2IK8B0BAK8cYIIxBXG9bZuD6ZUlCqk5zC0x/Yczh9YtSVK9ZA3pAN6Dqq6vnAo9ANx3Ndl0LazXPK0kq/n4J06F+45XMkc7Ajv0Sy/VzZrpAsiLUnyhZ38fQX4vOqIOXX9o9cutRlgfZfrSuZgTVxU9KrKPQdQOgd3CZB7OO9VzcnZ4pYDHddnkoVSrprlAXe5ynN5gxF1/Vi7ocenp7XdcueJyxSt8wtjhRYku2EcB3Hb1LxqHMb9192VJTmuw7DxSsfxdv/Tvn7TSceiAEpylqYnH/lWsWBRXABMVLHQ8B4cjvWUfN1xTYU6wJEqqy7y1ynBEIGt8ycqBxe2BGh3JEt3hO3HtXjm0KFJ/kHIOTDCmEUM2RFMH9ygn8N+WoNmDpcLZEgfFuz2pQPMKof7eHBME0RsxAVX3OFS1Y/Zj77jtGQ34nLRWjVeHtFF/pOIc2EvRdf1m/2UKy11s+8qtXzmAKQMhiNNTDefqiWtFIlkQqEbNJFuO7g6oqr84p8PC710IxN0R0bK5VIFV2svTx9CnCPTxspm1iiGiBKeptmh26tAYOXpp+y3HSGuqUwnONzIZN7bRAdYp4bDZpee5qq5OsAKcdTQISjykUjmM/aq3lRZK3rH6a5SOMmPZw5BQ47yQ05rvm3NVVXhkLCs0YqF2EN60A4iw8Ev1dtcNXvmsGK+qukh/QIRtEHE06cK1fXtKRfLqoTLRadcw8Ev1ZkTXBXzVdkdt5k1PvtQo/24I604520lvq0EFAvxXLXlytPHpjUXcRU4tTuiJvkx4EbugxHojrRJTn4p5jY3gcspucLQKW0lVnNhFQhF5ir+VhsvgZsN/Tji9cOcVybD6wcOuQ5MuXpxirhyt0tTea9NTPKLEVf7CdzMaZdZbpd0Pw6LZ1wiN7PhWGpwk1Uz/BzQDsSEnOB6vXT+cLscntoB3sQZ4qiaV/qOixjSJYgrBNwwu0OcSYKzzbe1ExwYrF6InFdpVp3EG+IIJSlsnWv9uEQ/DrMH497IcOgt4hNxC9vXv2b5ElhU32fuuF78IQ4r3XyreV3NST5V86K16uG6YRF3iIt1gJscxRbgE9oG88E2oa5fdMu14h9x5pZX2I9DuaGn+nGXmOdw6PHrvh+X9OWagGdNbzCkI5uk7NhpwHliSDf2sIY4wQHl6ZysWvoaqcUz4hLyGUrsfF85QIZIvASsh1zZsYsA54qTDyuHSAViM7wH+x6NarDWeRHiFpHT3HE1g5zldsk6wEDOdiiwJejFJeKYvaqtWEhFqShfFSkWHikaPHZH0qJUxEOvnK9a4CE9ibvACVQsbMLKwWTWGP6qMeKOAW6o3AWOXHHZ/TiD55BGXHZW3UScfqqPVdbGMjSLa1VVcRG+KmRI53fOOxGnn2piedpgSK9GB5h0MssBVzsM3AwdfXPuuFh3ZGLaonBUk3/J9eIfcXDmcC1RLEwotgTvuDzIDY3LwM1z0kMam/1gjcyWjQePq7VscjrE2YuFxNHMLFWB1vlwKDO4rlX1tj7ROidZNc1XzZJPZh/q73O5BPBVo90R5PaTyKqYPVhcdK3iGXHxJB8RRLT14KZYl1FW7RJa5zkf6uw2cJJ8x5kbmcDsx+yO6NglQreInO+Oy9oBNry348qh2M5hFTkH4sysihA3WXNVvAIciQSVtH2d745kdZUYQ9pa1o8QNxzLqO4m+eFcNRk6BLmWiHZ3gK+a+FZH8Y444q9qbuuTmcMLlad7Ee+Iq9gOcNJ7cFqZDjCXOs98AV9m8Y84OFitI7fLK0VcwHPoqZ+Dks+wPtRhEf+IS4kZ1ElqOZrW3CBH+ar2O24U34GT8rmqntWsif24jjFrrCtuEjkD4qC2kpqrjrQ9cpDLZXlIt+I+cEl/VernsB7Zj9PTQZIYKjkX4iCz5go7mYpZY2qdI77qH+M9MtRyGsQZXC5rrzBWnt77OQCNzKB2YIi7ipwDcZXJ5YJS54p32UM/h84WAmZZdZMTBE435LLt3sm2foajbyqtTnKCwCkVCFMlHnKSpkhev4UdYHDHke5IK2cIXKACYbuWm7UqVp7uzDsOI66bzxE4ogKBZg5ZtWqCIR2+4wDiLtl2s84m+VW8ra+YNXZ3BHaA4VwVvn8vjcipEJezr8/UDOgOMDeYYv24ZGXvtzuS0Y9jO8AT3QHmnPzhz9G4OZs5QKIvFgJW40FYqraAWRP4OQSRK4qbM55Dxpeqd4B/uiNTmj1oVg5ZhZbvKZdi1mBHMyIuanPydXdk97GW4U28GZqFSjdL8h2nkgN+x7E7bo+40rj50AHOkTq3NYIQ4tpolRXKi36/Q0rj5m2uWkV81ZS6/hRvK/XRyIHRHIby95v/d1y9WEk1lmW1uVx4XekWua4SOSHiKuZnZu3HYXV9yh6EPIc74NojBuQe9uMqUz+ujp4jI+2dt6w7Qp3ghuw+krNaNctBrwYqaNB7MHgAdyk/h5K+pdfx4GzusoafKujHRR3gDu/HhfpxfxF3lTMGbrZtCdB+XIi4KDegmQPagbh1zsufIY4QV2ltJcVXDTn5EeKKuFyqcmgrOWng9g05pZG5RFvnd8SNtDuiPKRbw9H3/ztumkVOjrg5ra2kEIe7IxBx4e7IA3DjMwf3eMfhh9xovH/73dZ5n9cBHrpFzhs4hbhgB5iqeaH5IGDWtCazZuhnOXHg5jmdVX9mDte0u9TjAQz9HB6Iu4zPHt2v7kgNe+cb3FbqeVa9qBfw39C1jZw9cMBDmr7jwqHDylzL+5Sfw2V9wcn9Iy5qZFoTaZRV9b7+k1nB55Sr2gEOaysFiFO+tCSrhqsj2yzyjyAu3lYCHnojyap85gAdfV9wu3l+x2V0R36INSvWAUbvuMvzydRprWogTmfVO+AI4uB+XF/JvxK4UHekMZRucHdkQhsQvdqPuwGurV95cl+LhUR3hPfjTN5lkFa78bUH97StdEdcOJC277h0bvgO24ty6RkQV5OtG5Pn0GIy19S8/OCeKofojlu47gjVT+4/EjZvdu9grnq1uVxAB1il1beEzRtBJJQICv1VMeKU93a0OzItbzq5k90RgLhl+XGCqy3ERdYrO0fftXnb2T3VqjfE5aigMbf3YANirN54co93XMjJT20rhWteP5Hrr/NbT+7xjoPMctOzJkqq6/Luk3u84+7vuGUBSzeBweoE3yPTm8Hm444LiA5gyMXuuJU56G3NR07uAXHVwwo5fgBTf1Xo2rjVnzq7r6yK1LwSr5HHHTdt9fy5k5/R7XLcJdX7FbeOy2dP7trPweQ57FRZx7r6+Mndq3ldEzrAY938ysl9uiQ1cJNVa2SO16X6tZP/dj8uDqJW2VfM/O/ftf7FmPkK3OMZ3MAu8G3T6ytiTTU7OK8jxMlfuN1idg/X91/9VUZ81WOVo8P+Bw+0DogP6NDPAAAAAElFTkSuQmCC") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-ptz-bg-active.jessibuca-ptz-bg-active-up{transform:rotate(-90deg)}.jessibuca-container .jessibuca-ptz-bg-active.jessibuca-ptz-bg-active-left{transform:rotate(180deg)}.jessibuca-container .jessibuca-ptz-bg-active.jessibuca-ptz-bg-active-down{transform:rotate(90deg)}.jessibuca-container .jessibuca-ptz-bg-active.jessibuca-ptz-bg-active-left-up{transform:rotate(-135deg)}.jessibuca-container .jessibuca-ptz-bg-active.jessibuca-ptz-bg-active-right-up{transform:rotate(-45deg)}.jessibuca-container .jessibuca-ptz-bg-active.jessibuca-ptz-bg-active-left-down{transform:rotate(135deg)}.jessibuca-container .jessibuca-ptz-bg-active.jessibuca-ptz-bg-active-right-down{transform:rotate(45deg)}.jessibuca-container .jessibuca-ptz-bg-active.jessibuca-ptz-bg-active-show{visibility:visible;opacity:1}.jessibuca-container .jessibuca-ptz-control{position:absolute;left:53px;top:53px;width:50px;height:50px;background:#fff;border-radius:50%;transition:left .3s,top .3s}.jessibuca-container .jessibuca-ptz-control.jessibuca-ptz-control-left{left:33px}.jessibuca-container .jessibuca-ptz-control.jessibuca-ptz-control-up{top:33px}.jessibuca-container .jessibuca-ptz-control.jessibuca-ptz-control-right{left:73px}.jessibuca-container .jessibuca-ptz-control.jessibuca-ptz-control-down{top:73px}.jessibuca-container .jessibuca-ptz-control.jessibuca-ptz-control-left-up{top:39px;left:39px}.jessibuca-container .jessibuca-ptz-control.jessibuca-ptz-control-left-down{left:39px;top:67px}.jessibuca-container .jessibuca-ptz-control.jessibuca-ptz-control-right-up{top:39px;left:67px}.jessibuca-container .jessibuca-ptz-control.jessibuca-ptz-control-right-down{top:67px;left:67px}.jessibuca-container .jessibuca-ptz-icon{position:relative}.jessibuca-container .jessibuca-ptz-icon:hover .icon-title-tips{visibility:visible;opacity:1}.jessibuca-container .jessibuca-ptz-btns{display:block;position:absolute;left:0;top:156px;width:156px;box-sizing:border-box;padding:0 30px}.jessibuca-container .jessibuca-ptz-btns .jessibuca-ptz-btn{display:flex;justify-content:space-between}.jessibuca-container .jessibuca-ptz-expand .jessibuca-ptz-expand-icon{display:inline-block;width:28px;height:28px;cursor:pointer;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAMAAABF0y+mAAAANlBMVEVfX19fX19fX19fX19fX19fX19fX19HcExfX19fX19fX1/////Pz8+oqKjCwsKhoaHn5+eWlpaOqTaDAAAAC3RSTlP/3CaKxwJiAELtp4ri/s4AAACuSURBVCjPfZPREoUgCERXBdPRyv7/Z6/Z1aQp9oWJMyYLiKUrOIpAJBdGCldgbzBkPM/QEoTI3jBEPBRDhwEvChe08Q1Ge0ImvIq4Qj8ljrLdH77CyQPWlCdHC0Q1e9rmmuC+oQN9Q4LwcQg40L6eyqm0uEpXSUqe3fKpkkqL+Y/o+07SrahNEO0T0LBsvOitf4xsLqiNTB32wtqaVKosGLO2mhUrS93+PZ4D99wPqzMJVcbEyA8AAAAASUVORK5CYII=") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-ptz-expand:hover .jessibuca-ptz-expand-icon{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAMAAABF0y+mAAAAM1BMVEVHcEyZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZn////i4uLZ2dnIyMjExMS8vLy+iXNeAAAACnRSTlMAYomLxwEm9+NCLo6DKwAAALNJREFUKM99k9kWgyAMRIMmEMLm/39tKaVKFJkXl3sYJ4sAXeQ3ZOcYd0+gRYblFBuFLYoS2ot5lpvYn8zJQ65TO2GVNmdCmQq/qczw4gjpejD14BgmhziEIvCjVRlPioftHW6A7xBB1a8CCUMvsuSqEkPM7eZX6h8GrQ67bYpNIbRL6rb4/k2EfVXKsgmqfQrW9qnGq96a28jGQG1ky2HXpVysyYyeDIhWq7le6ua9P36HD6+2GRi8iBZBAAAAAElFTkSuQmCC") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-ptz-narrow .jessibuca-ptz-narrow-icon{display:inline-block;width:28px;height:28px;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAMAAABF0y+mAAAAM1BMVEVHcExfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX1/9/f2/v7/y8vLUObqxAAAADXRSTlMA3IrE6SZi9wI+y0gNXAn3CgAAAI5JREFUKM+Fk1kOwyAMBQ04bJHT3P+0JVUMNMWv8zvSk1cipfjAKXHwhR7k6KTjYp7dVuWLug1XWB5wz96T/JD2O3Phmv0k5ypL6lVVFIPYpLOka5WKSSFvS0/BloHYlkza5HkMzrvVLo8ZlRr7mtFYWBBsBQ4BjC//GTxcGVw2PpOVHQ6fJj7qS4936OoN2K4e5yE6N1UAAAAASUVORK5CYII=") no-repeat 50%;background-size:100% 100%;cursor:pointer}.jessibuca-container .jessibuca-ptz-narrow:hover .jessibuca-ptz-narrow-icon{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcBAMAAACAI8KnAAAAJ1BMVEVHcEyZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZn+/v7X19ckk9ihAAAACnRSTlMA9+NCAsuKJsRiPv/2GwAAAJlJREFUGNNjYAAC5gxFoTYDBijw1FoFBIumQHjsUavAYGkBmGu0CgqUwRqlYNyFIO2Fq+BAnIGBJQrBXerAwLkKCUxgYELmKjBYIXMXM2Qhc5cxdCFzVzBoIXMXMYAcsRsMdgEdgs4FKT4DBqdAitGMQrMIzRkojlRB9wKaB9G8z+CMGjgshjCuMCjoWNxRAxYt2KGRYgJiAQAnZcjElaB/xwAAAABJRU5ErkJggg==") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-ptz-aperture-far .jessibuca-ptz-aperture-icon{display:inline-block;width:28px;height:28px;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAMAAABF0y+mAAAASFBMVEVHcExfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX1////9fX1+kpKRzc3ODg4PFxcW1tbXW1tbk5OT29vaVlZVmZmZ8vCMFAAAADHRSTlMAxGJ5Mssm9+NCiYtiH91SAAABAklEQVQoz41T7Q6DIAyEJQooUL55/zddhVazzZjdHyqXXo8DhWCYTWqltNyN+MZLuxP69UGti/vAsl6c0e4L+tQ2yv1AEbvecMhO5cXdYhk+6aO3WGrNAMwentlMz/ZAKIlNoRsqY2wtFWu9t8wasc0iYVN0LkQfrG1zbxNyrIBcntOQrH1Ukkb60QcxYF1xMA2dh8zWj6ZDsLCsIrL4Ds5Hm9FMbCEROWUB0COaLXEIZJKV7CKybGO7UuxjxY2C/TkMbxboKBQCxgMN6MCJQ6Ch/QjOZg/B13LGx8FDTe3IFvl+Bc9XBi3UWoex68qeL/vxmdyxyvz3NJ8f9dDef36HN7koIK2LjxB0AAAAAElFTkSuQmCC") no-repeat 50%;background-size:100% 100%;cursor:pointer}.jessibuca-container .jessibuca-ptz-aperture-far:hover .jessibuca-ptz-aperture-icon{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAMAAABF0y+mAAAAOVBMVEVHcEyZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZn+/v6cnJzr6+u/v7+xsbGlpaXNzc3b29vqh7uRAAAAC3RSTlMAyRjKA59J/3PzPhe1wxwAAAD2SURBVCjPjZPrssMgCIR1mkYtisD7P+zBCyZpM5mzv5hs0M8VnZvaok9BlXzc3FXbO5z0vtifFC5Kn8OL4UfxwVvuHm61d5Z0b6ZGZZwZpQAUosWsjVZntVS1sH3ZFo1IRVYfGXgx+VGwNkkIVbhq9/jm3cAhaNv1Uk3IA8mNn7D3kbQeWK3TLH2jCthrDFcTMwUWaKiClc9mJtJWhS3SF5BpJqMQW1b3xwnkDahMoHYomkeJRgSENA/MFsKML7fgoCBVbGvM+Cx4JcKWbWHKK/h1ZYS1Jy/nK3u8bB3KhzG5deMxtfv3aO7/Heq+9ms8h9fxHP4AHzAWU9zlWNgAAAAASUVORK5CYII=") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-ptz-aperture-near .jessibuca-ptz-aperture-icon{display:inline-block;width:28px;height:28px;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAMAAABF0y+mAAAAQlBMVEVHcExfX19fX19fX19fX19fX19fX19fX19fX19fX19fX1////9fX1+FhYWbm5vz8/Nzc3OwsLDi4uLDw8PW1tZmZmYgm6a+AAAAC3RSTlMAYmOLx4kn9+NCIVJiPGAAAAD+SURBVCjPjVPttoMgDMOJAqOU8uH7v+qKFN2c597lF5LTJg1VqQG3aGuM1bNTV0wWDtjpg3pq+IB+npyzcIE9ejsDXzDCrjccs+tOariF3n2OLyw5xko0vh9MDjNb9Q0hp2GK3cixlIApe4/JD9appR8SFxWAUFLg6n63iB1irnY1Jv0mlrok7nUdcZRa1YeshxBA9iijChlxI6iZEaBgSEL2tkRcymPGGJpqlbZ6uDg0WR/F0DwuMpxDkYwiIXA8hO2uMJdGCCK6teB8RQoY8xGfevQjxYQt25qoRwDT25MRBjZ7GtP/P/afa3LHmrflXa+ruf661Hvv+et3eAF6Fh3v+sSUGgAAAABJRU5ErkJggg==") no-repeat 50%;background-size:100% 100%;cursor:pointer}.jessibuca-container .jessibuca-ptz-aperture-near:hover .jessibuca-ptz-aperture-icon{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAMAAABF0y+mAAAAM1BMVEWZmZmZmZmZmZmZmZmZmZmZmZmZmZlHcEyZmZmZmZn///+qqqq9vb3z8/PMzMzo6Oja2tpXGg+mAAAACnRSTlP/JomLxwJiAONCr+rW2wAAAOtJREFUKM99U9sWhCAInEpLBS///7WLEWy7p9O8qEzCMBIOQ15DAlLYsoegS9yFMKQ93skl4Adh+ZI54Q8pG5nxgKzkgkcsk4zhmQxRyN1OPHqtncjOu5AuppcJ6s1EHTA1YzC3Wgq3YmzGqpsmlwZAo7F8oLEVKoeE6+TbSxK0JJ/3FLOwFnUxzXuoltYDDMLoAlmYXLAWIrkqbdZKs+q4KBfkNV1uwGaBim9TdLWS3R7iGRvCNTPB7JvGlc5EXK8cKbrxooint73RzXh7Msl6Oj/uT/b62O9j8sj6gMXX0Xwf6jP3Zr9DtNAHTYMMXrXSK0YAAAAASUVORK5CYII=") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-ptz-focus-far .jessibuca-ptz-focus-icon{display:inline-block;width:28px;height:28px;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAMAAABF0y+mAAAAPFBMVEVHcExfX19fX19fX19fX19fX19fX19fX19fX19fX19fX1////92dnbs7OyFhYWjo6Pe3t7Ly8uxsbG8vLyG+Q0EAAAAC3RSTlMAiWJjx9wm/0Lti7mfpe0AAADaSURBVCjPfVMJDoQgDERFC/bg8P9/XUSO6CqTqA0TptNDpSrMpC2A1btRT8wrNKzzjdo03KC3zhkLD9imbeAFhd3sG2kvZQ2v0NknfGBJZKkhBM9MxOxDKBV1N4iHi0TRHYjN01Qi7/kK2PtyNDU7DAEJgDAAN0u1jsQEFEkcVVmrqjeXrkWRmC67eqbgG7bJyvkQSQkvUvec7szpek6t9ubWJSK/uJVSm+APzHKCh++DWWuH4plQKNYOpfappcjy2VvJn9744cjGwx6uyXjBxqs5Xuqsvf/9Dj8rLhRg+bQ5VAAAAABJRU5ErkJggg==") no-repeat 50%;background-size:100% 100%;cursor:pointer}.jessibuca-container .jessibuca-ptz-focus-far:hover .jessibuca-ptz-focus-icon{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAMAAABF0y+mAAAAOVBMVEWZmZmZmZmZmZmZmZmZmZmZmZmZmZlHcEyZmZmZmZmZmZn///+xsbGoqKjt7e309PTExMTQ0NDe3t774OlGAAAAC3RSTlP/itxixwImAELtp8B2gZgAAADmSURBVCjPjZMLjsUgCEVpq60G8Lf/xQ62gvNeOmZuUiWeKHC1cKnC5iJAdFuwJXgmf+xg2g//G54OPuTOCUOEL8WgMMCLwgPP+Abj2aF38CrnBR7whw6Bo4fWUk7MMrQ2OrpAq0GspTLLgKg1wTailNITZA0EaTkZGjIAY5NwlATah5CGRMJYj50tFtlWiapsLvAPRdtL/WOmET7QzZyl5ywzp7NWsjBJ1odsragJqeJ9HGFNZoLaJw71hMTm0O7NeDE1Z6YsU5rGL69sedmXXz0ToW8PzA/oV09T8OJR32fb7+B17Qe3WwtC9PVbHAAAAABJRU5ErkJggg==") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-ptz-focus-near .jessibuca-ptz-focus-icon{display:inline-block;width:28px;height:28px;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAMAAABF0y+mAAAARVBMVEVHcExfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX1/////t7e2dnZ3W1tbGxsa3t7eDg4Oqqqri4uKTk5NImu/5AAAADXRSTlMAYieJ3MvE/0Lti4oh87zNagAAAOtJREFUKM+NU1sOwyAMY30FtoWS8Lj/UZe2gWpVh2aJH1wcO0mNqbDj4gDc8rLmiscEDdPji3rP8IX5fXLWwQWuaVu4gbKDuyPdsJMz3GLefcIPbJ6PDCEAFDlUAJiORM3NigQFAXAFlqOeRhWJyFFIHxNGvRrN0mp470U++3axGM2RAmXcXqKnkDSN0a9WIk5Sa01MpDXBQAdVtrA8lBhFnnKpsmoo5VBrhszV0KuJ5N2tP92O50iQjpzcctravoihdoi0Q1NrfN56m0VWzFBoje+OrD/s7pr0F0yUr6s5/LvUu/bz+B2ep+IHdMIV2SUZfCsAAAAASUVORK5CYII=") no-repeat 50%;background-size:100% 100%;cursor:pointer}.jessibuca-container .jessibuca-ptz-focus-near:hover .jessibuca-ptz-focus-icon{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAMAAABF0y+mAAAAQlBMVEVHcEyZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZn////c3Nz09PTp6enR0dHFxcW7u7uwsLAUKT0cAAAADXRSTlMA3IrE6WIm9wI+y0gNQZpqdwAAAOdJREFUKM99U9GShCAMQ8BF3Cmlpfz/r15dAe88l8zwQiQkoRrTEa3zIXhno7lhWxcYWNbtN/fa4Q/218VFDzf4of0O8A/h3TQfOGU/ytsOj9gPVyt8warkmYEQQAgABYDxTKROz88koS6AVIB1fRCNbSI1cVUy15Jq27LGjTtyzipPeWw40/IXQkrHyZSRmqw3LaQgctFNKYzYyGACfEXossLMojFEj7J0WfdwJ3dD9uY2X25tL0Hj45mTR87Y66u9IQFsDS1bL57o7JbUDNIofvpk08eej8kTe3Hz0ZwP9UFfv8OgfgBUByCEUZhYtAAAAABJRU5ErkJggg==") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-ptz-arrow{cursor:pointer;position:absolute;width:0;height:0}.jessibuca-container .jessibuca-ptz-arrow-up{left:71px;top:15px;border:7px solid transparent;border-bottom:10px solid #fff}.jessibuca-container .jessibuca-ptz-arrow-right{top:71px;right:15px;border:7px solid transparent;border-left:10px solid #fff}.jessibuca-container .jessibuca-ptz-arrow-left{left:15px;top:71px;border:7px solid transparent;border-right:10px solid #fff}.jessibuca-container .jessibuca-ptz-arrow-down{left:71px;bottom:15px;border:7px solid transparent;border-top:10px solid #fff}.jessibuca-container .jessibuca-ptz-arrow-left-up{transform:rotate(45deg);left:32px;top:33px;border:7px solid transparent;border-right:10px solid #fff}.jessibuca-container .jessibuca-ptz-arrow-right-up{transform:rotate(-45deg);right:32px;top:33px;border:7px solid transparent;border-left:10px solid #fff}.jessibuca-container .jessibuca-ptz-arrow-left-down{transform:rotate(45deg);left:32px;bottom:33px;border:7px solid transparent;border-top:10px solid #fff}.jessibuca-container .jessibuca-ptz-arrow-right-down{transform:rotate(-45deg);right:32px;bottom:33px;border:7px solid transparent;border-top:10px solid #fff}.jessibuca-container .jessibuca-loading-bg{display:none;position:absolute;z-index:10;left:0;top:0;right:0;bottom:0;height:100%;width:100%;background-position:50%;background-repeat:no-repeat;background-size:contain;pointer-events:none}.jessibuca-container .jessibuca-loading-bg img{width:100%;height:100%}.jessibuca-container .jessibuca-poster{position:absolute;z-index:10;left:0;top:0;right:0;bottom:0;height:100%;width:100%;background-position:50%;background-repeat:no-repeat;background-size:contain;pointer-events:none}.jessibuca-container .jessibuca-play-big{position:absolute;display:none;height:100%;width:100%;background:rgba(0,0,0,.4)}.jessibuca-container .jessibuca-play-big:after{cursor:pointer;content:"";position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);display:block;width:48px;height:48px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAIVBMVEVHcEzMzMzMzMzNzc3MzMzPz8/Nzc3MzMzMzMzMzMzMzMzLVn6fAAAACnRSTlMA+duduRUwSGSD8toSsAAAAI9JREFUOMvV07ENgzAQhWG3lLSp6MwCViYIRSpG8AiM4FWMaPymDBKESMF/cQ0S136F353vnLuo3gp1kOYEoCXW4LFKIZAnqAXYICeASoAdzgG+cApwgF4EfwF+oDkCqIwA6gnyAKA8AaizQhsBAjzuqUHofInGIQbjRxXjMrTJuHDestR4Bng4eGrN0929PqNfzC6h06weAAAAAElFTkSuQmCC");background-repeat:no-repeat;background-position:50%}.jessibuca-container .jessibuca-play-big:hover:after{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAJFBMVEVHcEz///////////////////////////////////////////8Uel1nAAAAC3RSTlMA+rbVFUecgC7rYhEEz+4AAACbSURBVDjL1dMhDsJAEIXhdeiGpKYWQVKDWc8ReojFc4ReAlPFFQazad7lIGkb0jK/WEPSsZ+YN5mZEP5UrZIP0vgE0Kv3oPlIJlAk8AJM4ASYwAkww2+ABfQg0ImgugPYsfNBVl99kA0AsjOArAPQpRTGHiBB8whxM0y+3skXNltsvMYriIWrpWPA80mFJ5qL3gAfB1/tcAt7rzdiV+HEgs1oBgAAAABJRU5ErkJggg==")}.jessibuca-container .jessibuca-recording{display:none;position:absolute;left:50%;top:0;padding:0 3px;transform:translateX(-50%);justify-content:space-around;align-items:center;width:95px;height:20px;background:#000;opacity:1;border-radius:0 0 8px 8px;z-index:1}.jessibuca-container .jessibuca-recording .jessibuca-recording-red-point{width:8px;height:8px;background:#ff1f1f;border-radius:50%;animation:magentaPulse 1s linear infinite}.jessibuca-container .jessibuca-recording .jessibuca-recording-time{font-size:14px;font-weight:500;color:#ddd}.jessibuca-container .jessibuca-recording .jessibuca-icon-recordStop{width:16px;height:16px;cursor:pointer}.jessibuca-container .jessibuca-zoom-controls{display:none;position:absolute;left:50%;top:0;padding:0 3px;transform:translateX(-50%);justify-content:space-around;align-items:center;width:150px;height:30px;background:#000;opacity:1;border-radius:0 0 8px 8px;z-index:1}.jessibuca-container .jessibuca-zoom-controls .jessibuca-zoom-narrow{width:16px;height:16px;cursor:pointer}.jessibuca-container .jessibuca-zoom-controls .jessibuca-zoom-tips{font-size:14px;font-weight:500;color:#ddd}.jessibuca-container .jessibuca-zoom-controls .jessibuca-zoom-expand,.jessibuca-container .jessibuca-zoom-controls .jessibuca-zoom-stop2{width:16px;height:16px;cursor:pointer}.jessibuca-container .jessibuca-loading{display:none;flex-direction:column;justify-content:center;align-items:center;position:absolute;z-index:20;left:0;top:0;right:0;bottom:0;width:100%;height:100%;pointer-events:none}.jessibuca-container .jessibuca-loading-text{line-height:20px;font-size:13px;color:#fff;margin-top:10px}.jessibuca-container .jessibuca-controls{background-color:#161616;box-sizing:border-box;display:flex;flex-direction:column;justify-content:flex-end;position:absolute;z-index:40;left:0;right:0;bottom:0;height:38px;width:100%;padding-left:13px;padding-right:13px;font-size:14px;color:#fff;opacity:0;visibility:hidden;transition:all .2s ease-in-out;-webkit-user-select:none;user-select:none;transition:width .5s ease-in}.jessibuca-container .jessibuca-controls .jessibuca-controls-item{position:relative;display:flex;justify-content:center;padding:0 8px}.jessibuca-container .jessibuca-controls .jessibuca-controls-item:hover .icon-title-tips{visibility:visible;opacity:1}.jessibuca-container .jessibuca-controls .jessibuca-controls-item.jessibuca-face,.jessibuca-container .jessibuca-controls .jessibuca-controls-item.jessibuca-face-active,.jessibuca-container .jessibuca-controls .jessibuca-controls-item.jessibuca-fullscreen,.jessibuca-container .jessibuca-controls .jessibuca-controls-item.jessibuca-fullscreen-exit,.jessibuca-container .jessibuca-controls .jessibuca-controls-item.jessibuca-icon-audio,.jessibuca-container .jessibuca-controls .jessibuca-controls-item.jessibuca-microphone-close,.jessibuca-container .jessibuca-controls .jessibuca-controls-item.jessibuca-pause,.jessibuca-container .jessibuca-controls .jessibuca-controls-item.jessibuca-performance,.jessibuca-container .jessibuca-controls .jessibuca-controls-item.jessibuca-performance-active,.jessibuca-container .jessibuca-controls .jessibuca-controls-item.jessibuca-play,.jessibuca-container .jessibuca-controls .jessibuca-controls-item.jessibuca-ptz,.jessibuca-container .jessibuca-controls .jessibuca-controls-item.jessibuca-ptz-active,.jessibuca-container .jessibuca-controls .jessibuca-controls-item.jessibuca-quality-menu,.jessibuca-container .jessibuca-controls .jessibuca-controls-item.jessibuca-record,.jessibuca-container .jessibuca-controls .jessibuca-controls-item.jessibuca-record-stop,.jessibuca-container .jessibuca-controls .jessibuca-controls-item.jessibuca-scale-menu,.jessibuca-container .jessibuca-controls .jessibuca-controls-item.jessibuca-screenshot,.jessibuca-container .jessibuca-controls .jessibuca-controls-item.jessibuca-speed-menu,.jessibuca-container .jessibuca-controls .jessibuca-controls-item.jessibuca-template-menu,.jessibuca-container .jessibuca-controls .jessibuca-controls-item.jessibuca-volume,.jessibuca-container .jessibuca-controls .jessibuca-controls-item.jessibuca-zoom,.jessibuca-container .jessibuca-controls .jessibuca-controls-item.jessibuca-zoom-stop{display:none}.jessibuca-container .jessibuca-controls .jessibuca-controls-item-html{position:relative;display:none;justify-content:center}.jessibuca-container .jessibuca-controls .jessibuca-icon-audio,.jessibuca-container .jessibuca-controls .jessibuca-icon-mute{z-index:1}.jessibuca-container .jessibuca-controls .jessibuca-controls-bottom{display:flex;justify-content:space-between;height:100%}.jessibuca-container .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-left,.jessibuca-container .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-right{display:flex;align-items:center}.jessibuca-container.jessibuca-controls-show .jessibuca-controls{opacity:1;visibility:visible}.jessibuca-container.jessibuca-controls-show-auto-hide .jessibuca-controls{opacity:.8;visibility:visible;display:none}.jessibuca-container.jessibuca-hide-cursor *{cursor:none!important}.jessibuca-container .jessibuca-icon-loading{width:50px;height:50px;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8BAMAAADI0sRBAAAAIVBMVEVHcEx4eHh4eHh4eHh4eHh3d3d4eHh4eHh4eHh4eHh4eHiqaCaRAAAACnRSTlMAikwX3CxpwZ7zIGi5xgAAAZ9JREFUOMt9lb9Lw0AUx2Njqm4iGEqmEnBxslKUdhJctFMVcW5wKZ0CLpJJQRw6iVqQbg3FtPdX+l5+XHJ3796bQj557773fe8ujtOI+6jz5p84dHjTkYD4+RhT9CIRZWRPJr1bChnbY532GhT4oUpbI6HEuqvgIH9544dh9J4/rpr0Ms8oV3zMNT7X1MXSmaznzfHjM4n72moe5n8ryYrW9rKRvgf0S93JA7yKa9lbzUg3keJb8OVCtwkrFmoO4MnsAuj5rGqnZg+GZXUXkl9NjEui9n3YA9XgpMgakLXz6ujMTIgrCkPVv0Jil8KgKQN/wRN69hLcb1vrbR2nQkxwiZTGQ5Teb7TO8PUaS8Q03sE+zkjP8qbjzgJtEhRbV4gnlkOFeM7hDYNdxPbiYFvKSHN6L2NmY5WzMYPtplZdTxncRvn2sI+DHIoug22jWMaA12Y7BrXzrG8BX32XPMDKWVzw1bdMOnH1KNqNi8toqn7JGumZnStXLi0e4tcP6R3I635Nc/mzsMxl9aux9b78UVmn2pve8u6eR50j9c0/ywzyVl5+z84AAAAASUVORK5CYII=") no-repeat 50%;background-size:100% 100%;animation:rotation 1s linear infinite}.jessibuca-container .jessibuca-icon-screenshot{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAJFBMVEVHcEzMzMzMzMzMzMzMzMzNzc3MzMzMzMzNzc3Nzc3MzMzMzMwv5ahDAAAAC3RSTlMAW+8S2UGVwyyZnOTRhEMAAAEfSURBVDjLzZKxbsJADIYdBQpsSCyVMlXAdEuQYGKpWFk6dWHJgsQ7sMDSpUv3PgITAQT0f7ly57ucQ45KXRAZot+/89k+X4ju9KzL4XOhlm3pR0enYrWViSRPXQIQSASkRSkIJEFRimYCuQAHSW89IOv6SH5TCsuAj68Ab1wDzqkAzqoC7AUAPtgsABgkBBgkCJiNHehGok//KRVsHqd+3Dj1/vukt3AH/Jj05s5/AmyZhFVWXDls44iVvfQWkCvgxU6g9ZdJfCLvjJbYaT3GvjOY4mQSG3SJGjhr/Y1Xohp+TGKqqzexZ/1GVGdNCitt6R8zVvb9d+JmKdl8o5sPWbtxT6zFuJcDQtk92MNmYiXHquYlZlVt1j4P6cd7fgHFW7Nhqu29TwAAAABJRU5ErkJggg==") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-screenshot:hover{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAALVBMVEVHcEz////////////////////////////////////////////////////////NXt0CAAAADnRSTlMAWe+X2TINXUYZvctoYyuS2NgAAAEVSURBVDjLzZKhDsJADIZLCAsEg8WgEGCWGSwCgZxB4MgEAonB8wQEXoBH4BEWXgPJgEBG0mdgR3u77raRYAgnlq+9+/t3TQF+dKbZcJXSYSnzlViT457lRScKmBqILSFA3GoO8S4E+Ex5JiSJ4CbVdyOQdZNomX9D4dl+ko3NC8vFFmhPy8FIsi0ZlwLBW/LY5BxYYreUSgoFAEmhB5Rc9OCbUoXmTmDadQKTn4y6A/XTaoSKdb6KyGU6RJ7eHgpb3ABinAoil303xB6vQnRahNhXvMdre+fzOgxVrokX4jHAnBh8PALU8Eq8BqgTg/vePF8tpuPy9/NFaalSc273RizarYqfkswjifNMQ/TyTGMv4v87L+ks5gqDbc9OAAAAAElFTkSuQmCC") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-play{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAIVBMVEVHcEzMzMzMzMzNzc3MzMzPz8/Nzc3MzMzMzMzMzMzMzMzLVn6fAAAACnRSTlMA+duduRUwSGSD8toSsAAAAI9JREFUOMvV07ENgzAQhWG3lLSp6MwCViYIRSpG8AiM4FWMaPymDBKESMF/cQ0S136F353vnLuo3gp1kOYEoCXW4LFKIZAnqAXYICeASoAdzgG+cApwgF4EfwF+oDkCqIwA6gnyAKA8AaizQhsBAjzuqUHofInGIQbjRxXjMrTJuHDestR4Bng4eGrN0929PqNfzC6h06weAAAAAElFTkSuQmCC") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-play:hover{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAJFBMVEVHcEz///////////////////////////////////////////8Uel1nAAAAC3RSTlMA+rbVFUecgC7rYhEEz+4AAACbSURBVDjL1dMhDsJAEIXhdeiGpKYWQVKDWc8ReojFc4ReAlPFFQazad7lIGkb0jK/WEPSsZ+YN5mZEP5UrZIP0vgE0Kv3oPlIJlAk8AJM4ASYwAkww2+ABfQg0ImgugPYsfNBVl99kA0AsjOArAPQpRTGHiBB8whxM0y+3skXNltsvMYriIWrpWPA80mFJ5qL3gAfB1/tcAt7rzdiV+HEgs1oBgAAAABJRU5ErkJggg==") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-pause{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAFVBMVEVHcEzMzMzHx8fMzMzMzMzOzs7MzMz4IlKVAAAABnRSTlMA6xIU1hVqIuOVAAAAMUlEQVQ4y2NgGFYgLS3RAEQziQFZoxKjEqMSaBJpEAkgIw1ZQlBQRAEs4QhkDeIMDgAWx1gMHyIL4wAAAABJRU5ErkJggg==") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-pause:hover{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAFVBMVEVHcEz///////////////////////+3ygHaAAAABnRSTlMA7OgSFBXMmAA4AAAAM0lEQVQ4y2NgGFYgLS3JAUQzi6WlJY5KjEqMSqBJpEEkgIw0ZAklJSUDsISikpLQIM7gAJjhWp6XcaOxAAAAAElFTkSuQmCC") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-record{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAHlBMVEVHcEzGxsbMzMzMzMzLy8vMzMzMzMzNzc3MzMzMzMxEZ/aQAAAACXRSTlMADPKKKeBxlV6neZ4mAAAArUlEQVQ4y2NgGDZgJhpowCURAJeYpIQENJEkCgWRgCeShAGyjfgl2EqwS7BFToZJiLg4ICTEImdOh0pwRM6cDJcIjpw5E6aDFeh8B5gECBCUYAkKCoMbNXNSOlyCgUEQ4apJJmxIEkjOVWFgxi4RgEsikGQJnEYp4pLA6VxUDyJLIAUJcRLIwY7qXKSIQvOHWCQODzKIleBPPjgTHM4kijNR48oGkajiYUMykwMAAfmZhUjBISQAAAAASUVORK5CYII=") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-record:hover{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAJ1BMVEVHcEz///////////////////////////////////////////////8NopmKAAAADHRSTlMA8gyMLeRw1x2DBpWGN2QDAAAAt0lEQVQ4y2NgGDbgDBpIwCVRAJc4KIgEZM4EwCU2KSEBHySJCcg29iBJGCBLgHUs24FdYlnNYZiESksDXKJALebMaagES8yZw3CJypgzZ2A6WIHOd4BJgABMgh2XBEtpaBjcqDMHs+ESDFyLEK46aMGGkEB2rgQDJ3aJAFwSUSRL4DQKp+VHcTkXxYMoEkhBQpwEcrCjSCBHFJo/1GIO408MOJMPzgSHM4niTNS4skENqnjYkMzkAEgzyFpeX6L3AAAAAElFTkSuQmCC") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-recordStop{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAAOVBMVEVHcEz///////////////////////////////////////////////////////////////////////99PJZNAAAAEnRSTlMAMPndsnZj1CSYPcmL6wsdoU80pOJLAAABu0lEQVRIx5VV26KEIAhMA++p9f8fezatFDPr8LSrjMxwiWlqzRuMYKW0ENH46c3WuGyVLXEduuO83UyK59fl1jX5EEUXD9DOaSh43XEP5zUIdZ4pAecTofVnWSt3ip4rx7N61vjnY1D30CpH4QQR8vsP+RA5Rs3KpjfMU/pMim/LgbvH7DF2F8sU0owqapKLqgnhuGWwImUagn2zhUX6WQQoYkXG9WxSAJd700/ygsCpAoliaDsPiG48GM1X5Ft/06sfp8DrDE+3DpekWjxM6366fgEcnklC+AIIWYQmPEeAaUmjFOnhCLDfxZRH+w1gU5b/DYjfNcyJ0p7dxX8B+FwxQVtvAGB5ig0d5gFA5KbzS91hI8CenvlHflfN/XvzJQnxbBEko1gbvVnPii+FadSVRUEaYylQfJtpLB+aRG4LY/80yKdUbCraM0lozGR4ewZ0Wtnj1iC7hjWKNnjYmR62W15cLlL3+2pyMR09jccyuyUrHKsvthc5xsY1iWJ0Xk3t+2XP7AnWwrAQmBH6asXubmL1Z5Lz6o992jWiu9lnMSiQsK27FS9NxhCumZgB2fTBPFsFolhZr5B/D3o9sJAI6skAAAAASUVORK5CYII=") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-recordStop:hover{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAMFBMVEVHcEwimP0imPwimP8imPwimP0imPsimP0imfsimPwimP0imPwimf8imPwimPwimPxLmg1rAAAAD3RSTlMA15sisGUvdz3szYwMT8H+hDJEAAABx0lEQVQ4y3WUO08CQRCADxBQchBiMDE24KswFlw0Wtig/oHzUWglJBZWio3GDjUxlhhrEzT+ABMrO2iptLLVRluDggI+xtmdXW73LkxxNzvfzuzszNwZhhDzdOxqaPGgYrgkOgFczh90ezAJQmpL2v6OHYnqk2aWxOTtAnu/O/Y5XNZXmTZjo3ot7aESwLdFeqAM0MoJkMf9ltwVQJ9PcQN0UFIJogvdJgLQVFMsAlxyBaPmVBDCE8W7qd+2SDsx0q4OwhSrCG134W54jDfKLjDNxaL8/9AAMM/solptRnoALBbwEPWYrOEzLnrZsTGoMW+fBHG2SiLPUNI6KMOH8QS/XsCMBYQekIEv7NGZF/Rht2yqmA4i3UG9O0iTqgMfhirDhRdU8XJZqqEO8tDAqje8IIt1r+I5HmBjfD9AxQ1MgJQRpc6GJRALHOAS1WRlhMs4VaSFzwIWzCUF3op71kdNsNs/FDCuA58YqCQl7IhN3WbDnlLtfjnuON515WM17c7w41QPOuBIzDT5wqi0T4ESGV3gjtTjkuPATwHoX9+cPRlmmvJ57YAir2qKy459QL/UhrS/uAu3xf8KiX3DI+b22t6jc9F/qfaum9E1pJ4AAAAASUVORK5CYII=") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-fullscreen{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAALVBMVEVHcEzMzMzOzs7Pz8/MzMzMzMzNzc3MzMzMzMzMzMzMzMzMzMzNzc3MzMzMzMxdHBitAAAADnRSTlMA8AwGYt0aUcg+til5kgmZywUAAAGWSURBVDjL1VM9SwNBEB12IcGkMagxNktQSZFCYimIJAqKpZ3Vco3YBYs0NkKQgBg4ECtLFSFVCGgQrERBsLayPE0Ip7n5De73BdKLTrE3ezPvze6+GYDfsAQKy/Rz0i/OZJjY9XREuohTKulS+ZFGiADfyZXU5uHktI44VH5apDx554aXwJqloiIwiEsStAjCAsRNF1jCmGqa4Vc+BvS4JkjwzyPE6xiwzsxxeTbZxqjkANSWZFkoIj5bQBl4aBDfkPDNpeRRialB+SRAFz8UU1sAaEUjSCDoJ7iukZJ1V+c01bFczM1pWaa+a0Rp7MHn4V8Z1R9vLLCv9WjKdVFfk77JP+bZdz35YAfKXx6KhKp93abUYVbrj49g9aAYSuFCLbPUwzdCsYEWTloXgw1oGwQbENeuKwxzXhxwAADRMFd+zzRc6AAASY6RH8VjUHaXTrlOpDgCUP3gelc01e2d+f16cWbnQ46BGCRNVsWAWQJVw2xGfUXVv2k1OsLfazXqblzS99u1FwKFvBJioXBY2+r82U75Ab7O0ypVV0wKAAAAAElFTkSuQmCC") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-fullscreen:hover{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAANlBMVEVHcEz///////////////////////////////////////////////////////////////////+GUsxbAAAAEXRSTlMA3clDHfdfDQbsVG00u4Cqkr04dRsAAAGaSURBVEjH7VXLdsQgCPUBAROdjP//s1UTDUxsz3TRTc+wC94bHsLVmP9hkE8LIdvgupt2tFhcpy2CMZyVxNePEoqDp4hwEGz5PTqWoZNzLrmD9riltBEYzzpZQ8bweXy56Qy6Tivsp5JQYtawuMH3eJlSxIJtdSSa4xer4lMB89pK23mKrwjZVpsRzLq35vEE3+r26h6w5EKppcp3fP2lIpTPWJvoXoobeNI1sM3haHvx56tu2sdElJ54GbnPQ7RZ1sCpl8qPEMXBNQ8vN82jNbzLCPzGSDOZj/2Bqd19R1rELIEbDFrUJfKYdlALbDuDMko/hz7t8DqtCfr8h1Vt4rn7eh/6Ph37ch20aW8McsfGCOXzcr+GOlQG1rJ2HSHUDO/4Mu01qVAqTCpCJfgZ3phTS2pKm5aZOMUbs7Q6nk6L8UzRh6W78jH+gD/VRxHokPuNgUGTaPPR+zDR1mrlvcGgwkAVacSbeoN4Z0rb5/6XLrW/2GTLk2NhXHRKzrqAt9cD4rr4ddvae0NAYgOICdZyvPj4UYRf2BdfbB8iWvnTUwAAAABJRU5ErkJggg==") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-fullscreenExit{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAG1BMVEVHcEzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMxi4XDRAAAACHRSTlMAf3WqJmy+7azWNnMAAADNSURBVDjLxZQ9E4IwDIaLfMzCOTDSOz07OjLir5CR0dmJFVHIzzZtnMzbOzcyZHnuaXpJWmO2ji4GhpAzzZeQzw8FKCj1pMHss9OgpwsGOS0YGOcVUMPsfBVkmJoVCBJW0FFB6SFIaMKAlRGDnEiDkuM00lP3SmL6H5QSh+iIr9ZWVWntUV9Z4qWbHAWrhcUYNLC4Wwm3xb1r2mOQYoVn2EKFAVb81KHiQQq6L3vSUoMBUmSzgCKbVeiL3eTp3Odf8H1sxRAZZNZt/Vt8AHcPQbiQQVF+AAAAAElFTkSuQmCC") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-fullscreenExit:hover{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAJ1BMVEVHcEz///////////////////////////////////////////////8NopmKAAAADHRSTlMAe4Fzh7MZbKPtN8gpX19xAAAA3klEQVQ4y8XUIQ7CQBAF0CWhKQHDGtQKQFcURUgqEARBED0Aoqp3IKnoATAEW8MNOACmhQYKcyi6uyjmr+aLqXj56bSbVoh/J3HBxcw0ZfA2c3FiQLGeQcWh1lOVDDJTAeCbCgAR6QqCDj0xCEU5Bl2BIALKMwhdKjGILRUYfCIOEynlvABANk64M5jabJxHfJY2I76yzYu/ZCc0s1WbNYAQ3jxqwMoGHoqWGHpUQajEgcYYcKWFtjLE4FGJQewoxODRDQOqKPPcHl9sfzSXa/0L349tEDsOsp/8+2/xAY+BZBY9KhM5AAAAAElFTkSuQmCC") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-audio{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAIVBMVEVHcEzKysrMzMzMzMzMzMzMzMzMzMzMzMzMzMzNzc3MzMz8gU00AAAACnRSTlMAL0jMZKt96hGJsSKv1QAAAJ9JREFUOMvN078KQFAYBfCbJEw2q6SUyWxTnsJT2JTJ6D38Gb6n5PpT6BwbuaNfTnz3fEp9fZwAP7czD0MsGCzBYJcEYsGwBEHQQRB0EII1CMAWdAOzyJUvJ4jyDVyZVHKGpj9guEI2IuhaDFadYnCkIm9I+kPgn8t+kI7kOsT72HcwQnJR9Gofy8DrwwtHK8pLzdeALg5fNb6cdJ1fOjOGYrl5CLFcggAAAABJRU5ErkJggg==") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-audio:hover{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAJ1BMVEVHcEz///////////////////////////////////////////////8NopmKAAAADHRSTlMAL0TQf2frEaZYt8E+idL4AAAAnUlEQVQ4y2NgoDdgUcAuzr4Hh4TaGQHsBp3BLsG+BoeE2hnsEkCDsEqADMIqATIImwTYICwSEIPQJFhnBjKInUGSUA2CSPCcOcIwB1ki5xRM4iiDDrKEzQlsEuUF2CVY0jbgkDhjMLQkEkj0IM4gQQ1EHMHOOXMiakRpTiQQtXgTA+7kgzvB4UyiuBM17myAM+Pgzmq4MyfO7EwjAAAEf+BAxqI/agAAAABJRU5ErkJggg==") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-mute{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAMFBMVEVHcEzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMztXryaAAAAD3RSTlMAHd4P7ztyiy1OnKhdx7uY2gyAAAAB8ElEQVQ4y72Uu0vDQBzHE45C3SJFaSGjUEiRpJRCBifXokkpSv0DfOBrEKxUUSoFH9ClFAUfU7c4OARRCs5WjThIsJuDlLo4ldvPe8SYxGyCt1zgw+dev+8vHPcvYybvfCR2OgUv2CoLdI62bUn3gq5UJxOomZofXPUNrIChJRklfcDSiKK2bYQ6PiCaREk0EQoYPFYa3F73F+DGsBJLmAjBAMBKakG15KAxqIhd2KuK5reRccBDNbqGJhfSlnNc/kBh4OY+vaoR5QrRC0afKgxMrKdXNKI8yxRENpyd+i0VA6wMm5IOBmORCwfAFjGwolofevbuPrvpGhRgpVaqiJflrLuUQQFRToS9l894EMDe7q6yL7/G5wMATc5mQCiAvQo3HAbwLtyYHQZgTxhohgGUa/CP12EA16W2/Ou4ZEj1dNG9oPMkZGiwJWQ8j+huPoJy9Z/XHTfUFSbAURveCtE5px5vs7hQDKS25FSDn2KR5Up1/lRmIHne7BvKd82LMRJbSjr5M40lmaYZ5/PRpiCpizjJyk+CwOGOzACLpSdz02QxkiuRhd8dNOwkV7zl2YX1mcySKJrQiPkXY9klSt6rkJPRwIlmzrcWSGyzHuTb11V/N0y/S6SdwdCR4m/47OIN7XOQCfwJwHGp8IcfyRdBLEZK4Uxp6wAAAABJRU5ErkJggg==") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-mute:hover{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAAP1BMVEVHcEz///////////////////////////////////////////////////////////////////////////////9KjZoYAAAAFHRSTlMAbk2o8o0P5TsGnVojFi/XHcV9urLaq0oAAAIQSURBVEjH3ZZZkqswDEXxLM8T+1/rkw0BuwM0f131+IvDyZVk6SrL8p88QCHp8UAnWmoWoG8AwQRN4/vOiqwUuwWqiob646MMhEW+KnMLMIXffgiZoODBusb7kCzjByF7OOszkOyp4amJ7fWVPwCN6BpyWRypvANPCvi7u4aTXe13YI+KkYA5bMRTSMlLnSyGwisSH40B0FJOrKVB6iAw2U7sGgPgQ/DTPQjitCOZT4Q6gWCtGwGFbSM34ENUNSpAKTACmC31rnRgJwjDdkFAJpfkAsZcAJvCSVQB2FaWWKdB/ATMAHwIUYL21lRBZRDiC5AnsBHBUqxEyaraFMoz0AnvHNa6xDWS34FGgNf6PYAEZoCt+BroUWFVbeb5HbCqSvB2cToyca+Adjlycdawt0C/HeyScl1W/w3gsU3aAd7JF8AuAN6isr7NAogXAFeq59Ec7ifAm49hF8wCMWfVNXAeCAkjEGuBr6R5ZGJzBrl4gGniBME+w8aMMyCsNZtfaemnmYaAQ6I3Rz0fnDhHJxc93Vrr7sHWjP3XRtTba2L3EkdFVaPC6YmXxKI9DGF1YPLdiwfD2r37cL5nDVw+uKzU5K27hsXCXPtyC2uyyl0D0p2TY7VaIvFYWU0Dm8TdOXmrVp52HG4lU4K/N38PpS/Kw70dbmb/sC0WCcQwNNzzjrzUj7veUyIIyL/4m/EP8V829O8zh5EAAAAASUVORK5CYII=") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-ptz{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAAM1BMVEVHcEzMzMzMzMzMzMzMzMzMzMzNzc3MzMzNzc3MzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMxDm1AzAAAAEXRSTlMAHqw+E8It/gjxc03jhGDTlgAjE2kAAAI6SURBVEjHpVbZkoQgDBwg3Of/f+12gtfMbK1Yy4NampCju4Ov1y8ruNyyo9fyCibVlNW6vUu29GpWQwTVdPTernqwffHex0WP4Nro3k+PrMKCvew/PcZ95aoNsY9yua+cGxTZsnf2K7ch4CAdGnWwYx/5LgKZCgxGdrhH3BeqNmnwviFXPZbQJmcM25HJ5n7/Pczr2QqksMJfO7BJOHLKLWFdMiL1QXYRwFagMklb4GB1zS7s8Le3fqH7Q28tVLkKdIzeaOJB2OKtY8KfTQCUa4++dNsLbrqpTR7xguHGt8hfg8P+seuaEkNdBjahzOD7g1cHP21SL2LtMNBKMdTRJjffTX1wVgrsEb1ITJU6QknwYJAcQky2cE02NbzPp70KyKggtpu9xM7Ik+CBIqY+8FrYyRUkrs+MEm1TG6tG9LZxNDNFGDue63TYGgIHqUUcuNhvhyZtn5LnlDq3Juxa4noCuX0scErOpNMDCrVcHPCS5rFGuQR9KZpxnB6CQ0ZO+AIBcTPk3UdbTx1L7jLEEHsMW7ZYm8NlIFyxn8+xdL7MURYEhzd5k2N2TabxIAORwC2r00QQfNSgrnqTJfh7cDmDu9ggtV0EZFr7kGu4KAxtNDln406TLwF9iZCIwn9EfjPuncRHYm5x3NfK3cFAS5kWxljSnTFlPHBAUFg5HsCCVOd9cdwXq+027un2QJlMjqISJutCDceRtTTuT4+1Q3HWHR8cu0fh9sGvADTYH9iLah/9nPz5+/MDJnQfoIVoAnQAAAAASUVORK5CYII=") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-ptz:hover{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAAQlBMVEVHcEz////////////////////////////////////////////////////////////////////////////////////1bZCPAAAAFXRSTlMAeVoYDS1pBiPv4/g6lkzO2qSxvoixscijAAACi0lEQVRIx51W2ZLcIAwcLnPf+P9/NS2wp5xkq0ziF3ZRC3R0i/l8fvi04oxx89n+RBi1sqB38TKw7lw7lNzDa3U0e57bHhJ4d567HlqGC08eLAj9Gv8XD4/OwtsdhlfCW2s9LfWtuNrMhG1uLWP17Xh14LF4m8dx1OJ9jkm85YCYch5JzDVy81on3MFYkpTNYGmHHloYI+aqlNhlh5ZSvmH1AyBUwPcMX+u/clW3XYvA2YgRGXyZIZX6PXv0l3GlV9Jp9FKcK7mytJIg8xEeBdaBtV4P8tAixexnp73tY7ZBkrk9WEL8t7ZUDqtIA3jXa8sODSeUVqw5aztT+g4QeNAgM0PGTA0+EmfVeUvU0CEW4hX+lt/zseE7jJKDSmi0EUKBhr7EAMKPvNjOA9Fz4Yk/CFgcGRSdkYOHCLRxQfzKRN5SB/b5Ot8SzzQiKqcb6ipFdCfi1JI84OBdxzarhJ8RkpxHOQszl7bpn0GpmnXq6R4OfTkwwlyUWzeQg7rSLNhNUzEUEqJF3DMHeeXgqRIaYwHimLKipK8hMZOYVfJ5oKtIFSgXk5z4KcNx3GOIPGYfPigh9YGHBNQKVKbZhxMnqq+OHfWBHARZfWm1dnfSXfJuXInplse8wy39zkisdQ5kuLY+Bpc5hwGiH8Mx1rE24DFaLqXkfrNVkjk+8JPTPF0bUw+R9MCVuA8ks/xDyF/9orMqpBQeiob5RbIbmv7/TxvoX1Oqa914TsYg7QUWx8Y7R89JQY8mY6Dat1G5GARuMOgYHY9cbL1vNvc++fk67olLk4nrQSl7457OPqdeKn+vEwm4LPzW87DyXvqIyei9znHS+cZz9SxV+Qf8nNbjn37NkDx4+PmCXzHOLUMtjgmUAAAAAElFTkSuQmCC") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-ptzActive{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAANlBMVEVHcEwgmv8imPwimPwhmP8imP8imPwimPwmmf8imPwimPwhmP0imPwimPwimPwimPsimP0imPoLqfILAAAAEnRSTlMADprCJBnU/gXwh3LiUKxAXjJ/ELXKAAACbklEQVRIx5VW2bbjIAwLa1jM9v8/O7Iht+09MwPlpS2VwLZkJ9f1lxVG1joPdZ0u1ZIxurhv8DH6dMpQI5t439GAEc7xYPgTRnAtV7plReRhd5kDP8+fd+wzt70yPhIJzWT7/6DCJCAYLReZPMIuJC4pClSktHqbNpJO1aTmmAme3cvtWs9NSfq52CPhnJNjlbVHwgmWSWGHeQHcKFjj7fygwidf2fa4mbVOuladcnsoDn9/CKKAWf6HEtpANiJvUp9Fgr0SvocPP/sqjOCK9ktpyCAo4Kt/d4n4/6baseNKAt5XrauPN1A4ZLAd30RUI4kNfELVx+yd3lrXYIg1Bp/B/dGs5N8mPsJoVyiwkofQSlm+K9aiwmoQMDoI4wefoK/rhkESrSuV+BR2i6HZH9juLzxCtBmn6rFmB66gNJQwBOSxncT/N3FAlxAoLQfJDy2+6rMLI3aznl9fhOcGSdZzoNhex2K3TXJEVe3M4Zb6QhHuJc5BWakYIqqietcPw6FK+EHofUHRqtLEQ5X8dKVENXXgEpLOpcjwkFI30YFVHE8fyx2ShZJ/ydTKlZwZ4BCOv/af9uMi0DILe4kieynScgPbhai+DRDckTT6N6zJpI3HMghM3BMg+q9pHmwrbR0Q0D5wc0JHPy0E5Ur7Nf3Rk68LnR0NHfO28/T5P4cNr+uLFR7eEdiNxvMRbd5Onlqsis4iIVdme4di3akWOz+3T0aUnFWHa8QZrO51NO69MeLPafrNuBenxel/3d21j8k/jyxf+75OQabFxOtuT94G3Lpjzb0zBn2Dl0ep/waPidQ/p/XB60Dp7e8F/QO7WSJg4zEzdwAAAABJRU5ErkJggg==") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-ptzActive:hover{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAANlBMVEVHcExru/9ru/9qu/9ru/9ru/9ru/9ru/9svP9ruv9ru/9ru/9ru/9ru/9ru/9ru/9ru/9ru/+3uxEqAAAAEnRSTlMA5q0cR/PC/ggSKtN5OIhaa5izIOiAAAACV0lEQVRIx5VW2ZLjMAiMToNu/f/PboNsJ5PaKWv8kKRkWkDTQF6v/zyUfO+JX9sP1dKKd/v2acQcm992kbo1R4il7iHIif0BRNtCUOozH4cikAdt2YfjRLTnzN15/8I85wFCI2xDzlnyMLO7R0aFoTzbFGB+jIkYLkyePvmW8d2fs2ZfZuv8It9s6zvV5uSr2LmKb9oVh37QvpjYOcf8fcO3Cb1jGqOU0SvTTd6X2KUBLgKdLzaiDtE2n+isTh8/+AX7E6/Vh/NNSyfVm10RXIe1nxXRapmsDQB7SMnkmE0IxgqvUn0jteEf1T2CHXgr0gjZllGk1HoJL7lD7fRpD20CgJcwQ6EdSh3lLK0zVfuqz2WvPlPJh7HqnCQ4MysxoAYQE0vHub/toRuqzRy5pEUvbg62MzlJQn1MHBe1x7WSAddpNDSN1c9wRMhKfi2jrICwAIsQvHkD7Al41bOrBNC1Y7QdmSg15LDokGETJB/imxYJKfmFMDqI3FjUkDS3NSEDjBaxknRYSb+4nj4kC43W2OKrkqGB8jV2Fq03YiWbhHQTpUV1mMHXWYf8HlNX7ZUQRC6iwBAIK0r0ILr1UxqKsPattAkhwSIiMl76bT/Ft/TbTy2jHQoM7Cz9isHVMb6GILl0H4DGivbw7xNc8rAtiJn3O/qvD6JT/wgs7Y370ZSdWmbZWEKiG1lXImldW7Q1jGMbZW9tUVKZmGjjGvf+EXAqzWiX5OfFSHVp/zjbfGPc3whdcbTF67V2N1e79qYMru2/AnzVYFsdWFt/+nOypv8vQvoHou4gOtSrG5EAAAAASUVORK5CYII=") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-performance{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAnUExURUdwTM7OzszMzM3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3NzW8hQDoAAAAMdFJOUwC/gO8ra6tUQNmVEKtAA1gAAAE4SURBVDjLzZMhT8RAEIWnpS3tXcWdQ6wgOJIKfFdUICv6AyruB5w4EuSJCwRXgUBWkGArLsEi6JVuaZkfxawguSWz/p7azLdtdt97C3ASagp+PpeXPDjHVx7McMWDCBc8qPCZB4m44YFIeOBh+ckCf9z+sCCYqi8WvA/5Nwu26cfA+JRBs4h7WmX/tr9AXcQHAPdgzEPZh5idTQBOZ3zyiModISKQGxZ7dd85E0SKfMGjM7vXeI/5AE5LvrwpcK9IOrQYB5BlCsFIvjzgrkaSjsBZbmC9XsGsAxfn8gKXpL9sSlnQFBwFTTuaKWXgI5Ar+sfHTrW6DUDO+2jEEtCNQ9wL6gNujMvvdFS3eugxGT51fBXxTvF1wLLngbT0BGphKalAy0MQ3Z4Ha2V7UoMFJKkFVAWcvH4B0OJfd9YsTl0AAAAASUVORK5CYII=") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-performance:hover{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAzUExURUdwTP///////////////////////////////////////////////////////////////8/RimEAAAAQdFJOUwD2qdfrViyAwW2XORBGtSCsD6SyAAABN0lEQVRIx+2VzQ7DIAyDYfxToH7/p10CbQ+T2s33Rb1MijM3/qDG/EurolD9zSNRggBU0hFelMABmenfADhGkJDhGUFGgiX6I1AAQlDgZK/td8ELtQORiTmIq42I2bYdCD8NjzPmYQxO+rbn2S5qzEUF6YjkgcJude56X3s0SoL7LRAeylyaVPiFq0Jyx230mpeXmXVOHssRbhackhCq25Sny++xcBW1n6Snqw6BTgrqRP6kzfDcgmRLGonDWSf2OecwB491dOrEVZpNsxiyiHzWJ0Z+BbBwzaoWVb49HrqVfSkxHen7WNznLhzl8xpQlT3E9oHUtYaufB+7NY9g9ctbjFfj/h1DwXUrzDltMn1Ql9M814EQWPLmEBg4R7JSzpFQxTmSBMkLvJKOhFHfKEEnv3L/+qw3DuMPzAFH9pIAAAAASUVORK5CYII=") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-performanceActive{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAtUExURUdwTBGW2xKV2hKW3BKW2xGW3BKW2xGW3BGW2xKW2xKV3RGW2xGW2xGW3BKW2+P2IvgAAAAOdFJOUwC/gCvzq1RAleURc9VmrA9rXAAAAT9JREFUOMvNkzFLw1AUhU+SxtTahnZyC+IsIeAenDuE/oJQcS/FTYTi6hKcHYpDZ/EXBME95BeURpM0Me39Db4Mgk/u23umcL8kvHfOucBBKEr5eW95xoMjeuBBlyY86NOQBwt654HrPPHAca/YuUHrDQsG9eybBWa1+GLBqvS3LJiNX0vGJw/R0N6LJ+/f6x9I3uwG0D+luRU0FnmdCtBy6ZM7KvQdjgXwJYuNZVNrFfqF8IX+nFm/oBvyS2iZ8OWxgH4u1IZmU4kgfoa5E77c0jwhoTYCbTRFGE7QrXFCveCURkK/2cRBCp2gFYiyWk7Jw4AgXOmQZMAqa9uAeCP+JsViihtb9OKIPtBUuvy8jeqyHRpMhvc5X0W6Lvg60HrPg0DREySOoqQJKRbByRWbExaqlSoVwB0rwCLFwesHquttxhcsa64AAAAASUVORK5CYII=") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-performanceActive:hover{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAnUExURUdwTH3G63zE6n3G7H3F633G7H3F633G633F7H3F7HvG7H3G7H3F6xOzy+EAAAAMdFJOUwC/hKbvK0BT2XURZct0z00AAAE3SURBVDjLzZMhU8NAEIX3LiSUNqI1qBMMChFRgYxAd07E4CI6HQwzEUXgKjC4CH5ABAKJyA+oaHqBJO3+KPaYYSZh9nyfyuyXu7l77x3ASSgu+flYX/HgHOc8kC4wwikPMnzhQaTueKAiHvi43bFg0m4OLPBM9sWCjyb9ZsHm8NkwPiUQT8MjfSX/fn+F/C3syJf9YB7oLsDkjIaiHix5QCNbGBmAFPve+3lXi/0viLB3ZnmDz5g2ICry5daAvCbZhSE2oIsFeC35ssJljiQbgZitIY7nIGu4wLG+xBnpL5tClxQhCANR1Q5TSmCCQK7YjftOVbYNUOxot0EsHl0uwHdFfcD14PJLG9W9HfpMho81X0V8MnwdcHvkgS4cBcqVo6QKHQ9B1a6XY1zAcSiIFg6QlXDy+gEd714RcAqEowAAAABJRU5ErkJggg==") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-face{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAeUExURUdwTL+/v76+vsDAwL+/v7+/v7+/v8DAwL+/v7+/v96T4QgAAAAJdFJOUwBAgSCbs9hZap+hQJoAAADvSURBVDjLY2AYRkAJCAygbEZBQUEBKJtpJhDAOJpA9kSYxESgKphuIaBuhASqyYzESjC2hDRilQBZ64BFgm2qMLPYNCwSkQpAwlMBWYIRzJsKYrKCxZSRncKSDFYzBSNY2MD2MqRhSFgqgClPAwwJBxwSbAk4jGKZDCKZp2JIsEOcOx0ztjQDYL5ENwsYJKrTsMSvGSgepzVg2pE5qSikPRPT8sopBuDod0ATZ54JsbZyBrJgAVAp1Ax2oPXMykjxYQaLA2CMoERUZQDMrgBUCc8CKIdzAvHJhyQJpLQLSu0TCaV2lPwBSu0KQy+LAwBuJj5UbruNggAAAABJRU5ErkJggg==") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-face:hover{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAnUExURUdwTP///////////////////////////////////////////////w2imYoAAAAMdFJOUwBAgBvfrFmcw4wrbtGliFoAAAD2SURBVDjLY2AYRkAJCAygbEZBQUEBKJvpDBDAODpA9kGYxEGgKphuIaBuhASqyYzESjBu79yIVWIP0NoCLBIsR4WZJY5gkYiZACRqFJAlGMG8EyAmK1hMGdkp7M4gkus4RrCwBIApFwwJmwlgqsYAQ6IAIrEAwygHHEaxngJbfhRDgg0sxHoMM7Z0AmC+RAPsJ4S5NE5gid8VoHg8sgHTDh/PzM60HkzLc44bgKMf3RKuMwoQ+dNIgswJDAycUDPYjhgwMCsjxYcJLA6AMYISUTkBMLsaUCVqEqAcngPEJx+SJJDSLii1HySU2lHyByi1Kwy9LA4AqflRBKNSA88AAAAASUVORK5CYII=") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-faceActive{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAhUExURUdwTBCT2xKV2hGY2hKW2xGW2xGW2xGW2xKX3BGX3BKW23povfoAAAAKdFJOUwBAgRybs9hZLG6hrV9tAAAA80lEQVQ4y2NgGEZACQgMoGxGQUFBASibaRUQwDhaQPZCmMRCoCqYbiGgboQEqsmMxEowTgmZiFViFtBaBywSbEuFmcWWYZGIUgASXgrIEoxg3lIQkxUspozsFJZkEMmxBCNY2MD2MqRhSFgpgCkvAwwJBxwSbAk4jGJZAbZ8KYYEO8S5yzFjSysA5kt0s5YKc6guwxK/baB4XDYB045Vi4pCyrMwLa9aYgCOfgc0cY5VEGurViIJMhcAlULNYF9mwMCsjBQfZrA4AMYISkRVBcDsCkCV8CqAcrgWEJ98SJJASrug1L6QUGpHyR+g1K4w9LI4ALk0RHtSETFcAAAAAElFTkSuQmCC") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-faceActive:hover{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAhUExURUdwTHzD63zE6n7H7H3F7H3F633G63zF7H3G7H3F7H3F68TinBIAAAAKdFJOUwBAgR+Z31ipwW4yAjb9AAAA+UlEQVQ4y2NgGEZACQgMoGxGQUFBASibaRUQwDhaQPZCmMRCoCqYbiGgboQEqsmMxEowTmmZiFViFtBaBywSrMuFmSWWYpGoUgASXgrIEowgHtsKEJMDLKaM7BSWYLCaJRjBwloAploxJKwUwJSXAYYE2KUMVRgSrAFgKhTDKPbFIJJ5OYYEG1iIfRlmbGkVwHyJBlhWCDNrrMASvxageFw6AdOOqKCklrQuTMuzlhiAo98BTZx5FcTarJXIgglApVBr2ZYaMDArI8WHKSwOgDGCElFZBTC7GlAlvBKgHK4FxCcfkiSQ0i4otS8klNpR8gcotSsMvSwOAIs+RIlIrewIAAAAAElFTkSuQmCC") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-zoom{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAkUExURUdwTMDAwL+/v7+/v7+/v76+vr+/v7+/v7+/v7+/v7+/v7+/vxtcv/AAAAALdFJOUwBVdZCpGdZE7C3B0wnY6AAAAV9JREFUOMt1lDtPwzAQx20ghGwVsHVJhQRDlsywWKqEULsw8FhRJ2iWiglGGJvFCw8xIVVCSEwkKU25L4ftpOHs2Cclsu7v370smxCLecRh+xOH8Ja5kGEs/6dtYf1XONcWZurbwwRCQjYZ9l7uHAPAOBHpI1QC/QSY9g84ldmnAn7Z3htwsfZnvSe54eJd5hlcC7gccxTwSETZEr5+714vLRdfkFraVNtetXLpR7ha+mkHCV1Y/q8ZOW8AgDkecsIaAEIcGbIGyLUq4KcBYl0o7QAB4FZACBMrQKpaJOCZQqyAIhgayYEpgD1DZghXCvBTNJFKmCvgzmhcCEsBwMjSRx6BslYftRX0JLYKrAsLqzDC54EFMwvy58QhMM8hFNq0UpwET+sLC9/4BmEBTytyRCIbDoAEiR1Qp1dbRxfoyv9g3ogaKVuXhVZZbtqX6Ez6H23PxG4CM259QDwt/h8ABfK8nDqSAAAAAABJRU5ErkJggg==") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-zoom:hover{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAzUExURUdwTP///////////////////////////////////////////////////////////////8/RimEAAAAQdFJOUwCCyreU7KZVRCDaZnETLwj6WaYVAAABUUlEQVRIx5WV2Q6EIAxFoVBWxf7/184AOnGUsvTBqDmXrqRCzNou1kwGtyZIQNuiD0P6evWTURFUMtIoPO+iVoGIZPkMqkdKA0jZgoJ6suQc2EoiGBldOoQ9HSDk5+GTs1Fqo9IlcEpvNv3qv0MBhSalIFSv3+MCJCY8fUaCxasycrMu9dp5VTUhubXZ6CqsAvn66ZAsx+e8fON37oT3bZ4aiRU0kDlavGSrQI95HPBZACt8FuCL16IruBVkzBeBW+CLYHvyfiDQd96IpHpOMqP++fAq9VMQ7rwrM5+6gjwG/3y/D/m8ylPYpvpAeqO7DfvwMPO9D6jnBabG56YFZx77fEjD+9AyLdYEhp8nxoNh5wmJtfY8AS+wzIZZrJNcC4h3wV8IH1p87Iyfnc6XVaAd7ICHAsebw97zgDSxZ/yvViiPuYUfTe650knM2+7Ywz9yOCklzohLOwAAAABJRU5ErkJggg==") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-zoomStop{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAzUExURUdwTP///////////////////////////////////////////////////////////////8/RimEAAAAQdFJOUwDjmTC6Y0KBVakX8s8iC3JYR1wyAAABVUlEQVRIx62V2baFIAiGcwJRS97/aU/Zbtht0VzrcJOuvl/AAabpXy1RF0F/m2h2PX5mzucEuO9gMon1MY7KlG8w4LImC1XFQmxDGVkm1DYpXi0qS1gXTEGzKoqNS1ajAxPqJDikFLcFS+aukYJffRfXnAj9kYUXFVi86wzzPjuCFRXBwS3KaC/Pt02Ww7uf1jz3BVYtX/OsyDQFDn7yswPXb+Ovs39eJJWwxrOXV4thgC+//QBf/uMAXwAa4AuRBvgdWR58CB2B+eaRG5e8QO7Jn2sIAvzhbdsDnXzev8q0BengGXv8EciH3y1CY5++yI/BRNx82g/La7lc7b0Am/tUC6n3HoZ4SbDyy5BgzSNivV6wbPXeIPOpHlOU+CjkTQKvQOpXdRdJvn+5xttWQa4EZUOzluonT6+q72X6Zb0+T/lNhQd7hg9vm8LWUhW5gT4iN7c/0ZUo8Q3AttYAAAAASUVORK5CYII=") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-zoomStop:hover{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAqUExURUdwTBKV2hGW2xKW2xKW2xKW2xGV3BGW2xGW3BGX2xKW3BKW2xCX2xKW2yDN61kAAAANdFJOUwCAVKxm3T/DmhrxKw97YQBGAAABaklEQVQ4y2NgIA6wGqCLMCqAqV4HdIm9F0Ek22UMM9hiG4AkVzQDA+cmx+YyJJnDlw8wMNQaNpfevbu0QgxJgrN3JQPD3VvhjU57kESnOZqvvXuJgcEXxVFMEkDt1w11gZYwoVgue3d5SzaQSgCydZG1TMkBU8vBuq9guBcqNBNDgj0GQrMEb0CVYEmA2ViANRQZ795tQPZduADciXcVUNSthGu4hGrAJawagBIXsWoAClzGqgEocRWrBqDIrQNQDTPRXZ8A0cB41wBNQgGiQfbubTQJAagGDB0GIA0OsnevbkCTCADiu4J374ahW34JqAEIbiXMRJOAgkvMKJYgJBx6717AKiF4F4eOu+jxgQCXGHBIKPDgkBC8JYCURJDtQHYWN4oEcvpZiyR+C9lZtkgSKKG1CyGOGrxItleixjrcLFBWRAYcMIkG9NQMiY67N7AlcxAQwMwA6SBxM2xZQ3jtVRPsRQ83sg8ACMIUxzzE8wsAAAAASUVORK5CYII=") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-close{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAeUExURUdwTM3Nzc7Ozs7Ozs3Nzc3NzcrKys3Nzc3Nzc3NzePZJxkAAAAJdFJOUwCtKdPBGAmNTt3jdDcAAADfSURBVDjL1dOxDoIwEADQgwR07GTCZtI/IGHgAzBhM9EPkMTB0Y3V0ZXIcn/rtRR6pefgSKeSu3ellyvA9lZ/5F9p/3K7PZY8oPG5BD6MpPUSgIITzdIStifAshjRQV1PCFT8TxaicTzzwEwINOEdHVmDmcTAkRhMhMAp7iQRjcMtDhCp8SA1v0ARGIIK/gnkv0p1OBTS4QRUIpE7DiYYXTBrzcld3JIrAarXrps4AVNwRSZgExoJmIyAaAdsShUMn/JF2fh4YEkpAcgvnuwYCIb6EbbbP4PsDfLD2dD6Av1qTvAQlzUTAAAAAElFTkSuQmCC") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-close:hover{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAeUExURUdwTP///////////////////////////////////8kBMKEAAAAJdFJOUwCt0igUwJdJePGbgLgAAADcSURBVDjL1ZMxEoIwFESTCaOWFDapqeicnAALTiANnaWlnVewDTMW/7b+aCAb8jkAVIHN2/lsNkrt73lf8M08nnF1pAYFR/dFmAAx7SIoi4iDbRrWDMAuQFzmmxAGbjjJgjj6dCjMCAND/o8RWQMzUgIRKYE/wsC5TJIRR74rBUZaqqXwLZEXT0WTDGwLW1aavJWQir9qadw++NgykWoMNtcykh8Q5EECgr5C+jjpGjHjPGhPU5eVzyfPJitfnUyhPg6ywMKZ7BygcYcsPCj1Kc8uXYPqpeSLs6PnC4w8S+8OJ9MLAAAAAElFTkSuQmCC") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-narrow{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAzUExURUdwTP///////////////////////////////////////////////////////////////8/RimEAAAAQdFJOUwAyqXf5Hu1TZxDRmrxFjN7ZJa7NAAABXElEQVRIx92VS5KFIAxFgfALoLL/1XaVKPBCQteb9KAzM3Ik3FyiUv8rQqo0MsrL0VQmfJDWa1/5OPn1x1hxFWNMsv3ZsN/vJZy6ZVzoJWam/rcemA+pXwQWoLQXSZN8fAiaDy1dxKMlkvZsdiaIuC3pWPmgKccAIDToYk5x6ykahpF209B3i2sBtAic6wlHRRhHQJhrOghQOAeWyTaRAM1h9ELcq9AuInYVqMXzMBqwO2QC3IU7y5X0+MLYKa44nSFQlR5foxvxYVlN+3CIfbhvhUcKGHE42NX6G7O+do0rYHYbVGTuAz+BCjcHMn9zh/M8stsySp3CoAn8PHFFHJjPl2qa3jiYrBXY7tzIGRwi6mg+nbgQs++8t+tQDnyDNrEQev2fVJt3hIoE8dl1AYXWHrkzvkScJRdHizsiAASNtEk7S/NtXUbs70RSXxKgviPKFz99bVIB9SfxA8uZLAsxki39AAAAAElFTkSuQmCC") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-narrow:hover{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAnUExURUdwTMzMzMzMzM3NzczMzM7Ozs3NzczMzMzMzMzMzMzMzMzMzMzMzH6OaiEAAAAMdFJOUwBv7U2hEB4zt9NZixFhg1cAAAF+SURBVDjLY2CgF+CacwYKXFHEWXtg4mcOLUCWKDqDAKeRxJnBIhounWDaASFRAzJiO5CR5QNkHUHYoAPkioKZ7CAZAZgEB5AzHcpmBLKPwyRszpw5gWzsSRgbaNIEFIfAXAxkJiBcsgeh7MyZg0hu50RYcuaMAqqnTsMlNiAHgw7c9jNnCpAl9sCtPHMISEQJgoAwxPUGUAmgL9h1IEHYAPYJ1L2g0OGEhi3QfTHwQAFJMCECPQhFggUqAfRCDkIC5DwnSPwJoNhxKICBgS0NBEDuXAN3Ptx5EOADVgiRcEBOGIhIOHPmGJIEIyJMkeMJ7I2jiPhASkw9CJN9kKKZgfsM3G6QZoS79iClH+YzCPsyQL5EVnVmMpgVDQ7kwzAJcEDNNgsNXwINfAOEZ0FASQeWsA8jeQoVwLVUwoVUULUwrISJJ6xB1cJgDcpshxoDGLhgEQYDbIaCUqUMkPhAziRIGRUkcRJbFl6DS4LrDGoyR9HSgFWC3bORnFIEAI39IME59Pz6AAAAAElFTkSuQmCC") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-expand{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAtUExURUdwTM3NzczMzMzMzMzMzMzMzMvLy8vLy8zMzMzMzMzMzMzMzMzMzMzMzMzMzAmiiJAAAAAOdFJOUwAqre7XQBoOxWGeiHNRIXj5WAAAAcNJREFUOMu1VLtKQ0EQ3Ygx5FEIPhpFVLAIaNAUPkACWliGYGEpMWKjIKktJGBjIWIhiAgSRGwESWkhwcpGEAUtRJCYmBjFzDc4szv7uCpYOcXd2T07u2fOzF4h/jLf01H/xdzP9a4koFWi2W/rs8A26UXWwNiEu+5PWADyDnDorMOrPSwo7x186DjYJm/GAM84q+9JzkUKMRnQtkv2Y+j3MtCM/pTeFcHJO/s3nguJCM/QG7MMKaRggBSN99NyJ97ypoEPmSVAjsZ1gE8NyB0hgBcaw4Ywq9AEUKUxgEenGUi5EXTJjgIqdGlnBqCxkFb0FS2o42cXSOFEHPfM69yhzLKQIbEepieIbVgDNSEWXSDiAKsGwKNadA0L7lGUz/LmBia2uaXKk+c80p48iro6nE+IMxdY31sGcq4kPlMQK16NN5S1iJQ6EZNKIKmGKZS8bCUqp9jEw0J7VVtaPInFJdGU8NLObGMhT11MITJua9DT6ONuJWlGNdBGIg0R9271fFp1j0oFx0+vj1nJER3SDl4zIYGYs1h0Q4JJA5z43RCLDKi8cvYZntNy/Er1KpSch7j0uH+X1VKUfv1J+I1a/2xf3OKDpNnEfRYAAAAASUVORK5CYII=") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-icon-expand:hover{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAA5UExURUdwTP///////////////////////////////////////////////////////////////////////308lk0AAAASdFJOUwBFnl8nDsur9hnq2jeLum17VecmAZgAAAGgSURBVEjH1VbZdsUgCIz7boz//7Fto3FBzLk9fSpvUUdgGDDH8WfjV6JKqZC8+eR0kLmZVky8H/cxA7PpBSJoRsyy3XliM24UP8/y1iQW1tljUIl479mQvlv5utptAzE8NMTC5kPkCdZV3VAA4OpFfHGdKoJhCTixJ0NPe7pki9eo3hbGtbLkOwXSqY6ueQgI6PXxN11dASWAEwL6DRQ4LIlLABgEUGIg3UWJycyAvl89DBRHyOxIG+emeLgMNxNRYQLUCJnLWj9lzzqKzsJY7fbloVDjoJw4AUrOYZH2HZXRgKYGSJ8DSkgGdl3YhlThhkoZC8pFGWt1CWzVH0rMsa10jTTNhWMvAAlKf4CUoDT40hFACgF8K5jzAdR4cxVmtX9LZWmgLngTFIMNb5EZQNAWVcgUIHmPoOhkesbPCY+bOs+XAeEedfp5xjxSsXBY8qcJsiKtlZIbHhe+RWQbaUqBylmGK8Lld1sQQuEHbdAbxHFhTqhprK8IccLAFRnrJLGXLkjdnqLTgMrir53xF2OMcLFq4Rf/B0RjQvin9gVLNDmYNA/hrAAAAABJRU5ErkJggg==") no-repeat 50%;background-size:100% 100%}.jessibuca-container .jessibuca-menu-icon-text,.jessibuca-container .jessibuca-quality-icon-text,.jessibuca-container .jessibuca-scale-icon-text,.jessibuca-container .jessibuca-speed-icon-text{font-size:14px;min-width:30px;height:20px;line-height:20px;cursor:pointer;text-align:center}.jessibuca-container .jessibuca-speed{font-size:14px;color:#fff}.jessibuca-container .jessibuca-menu-list,.jessibuca-container .jessibuca-quality-menu-list,.jessibuca-container .jessibuca-scale-menu-list,.jessibuca-container .jessibuca-speed-menu-list{position:absolute;left:50%;bottom:100%;visibility:hidden;opacity:0;transform:translateX(-50%);transition:visibility .3s,opacity .3s;background-color:rgba(0,0,0,.5);border-radius:4px;overflow:hidden;width:max-content}.jessibuca-container .jessibuca-menu-list.jessibuca-menu-shown,.jessibuca-container .jessibuca-menu-list.jessibuca-quality-menu-shown,.jessibuca-container .jessibuca-menu-list.jessibuca-scale-menu-shown,.jessibuca-container .jessibuca-menu-list.jessibuca-speed-menu-shown,.jessibuca-container .jessibuca-quality-menu-list.jessibuca-menu-shown,.jessibuca-container .jessibuca-quality-menu-list.jessibuca-quality-menu-shown,.jessibuca-container .jessibuca-quality-menu-list.jessibuca-scale-menu-shown,.jessibuca-container .jessibuca-quality-menu-list.jessibuca-speed-menu-shown,.jessibuca-container .jessibuca-scale-menu-list.jessibuca-menu-shown,.jessibuca-container .jessibuca-scale-menu-list.jessibuca-quality-menu-shown,.jessibuca-container .jessibuca-scale-menu-list.jessibuca-scale-menu-shown,.jessibuca-container .jessibuca-scale-menu-list.jessibuca-speed-menu-shown,.jessibuca-container .jessibuca-speed-menu-list.jessibuca-menu-shown,.jessibuca-container .jessibuca-speed-menu-list.jessibuca-quality-menu-shown,.jessibuca-container .jessibuca-speed-menu-list.jessibuca-scale-menu-shown,.jessibuca-container .jessibuca-speed-menu-list.jessibuca-speed-menu-shown{visibility:visible;opacity:1}.jessibuca-container .icon-title-tips{pointer-events:none;position:absolute;left:50%;bottom:100%;visibility:hidden;opacity:0;transform:translateX(-50%);transition:visibility .3s ease 0s,opacity .3s ease 0s;background-color:rgba(0,0,0,.5);border-radius:4px}.jessibuca-container .icon-title{display:inline-block;padding:5px 10px;font-size:12px;white-space:nowrap;color:#fff}.jessibuca-container .jessibuca-quality-menu{padding:8px 0}.jessibuca-container .jessibuca-menu-item,.jessibuca-container .jessibuca-quality-menu-item,.jessibuca-container .jessibuca-scale-menu-item,.jessibuca-container .jessibuca-speed-menu-item{display:block;height:25px;line-height:25px;margin:0;padding:0 10px;cursor:pointer;font-size:14px;text-align:center;width:50px;color:hsla(0,0%,100%,.5);transition:color .3s,background-color .3s}.jessibuca-container .jessibuca-menu-item:hover,.jessibuca-container .jessibuca-quality-menu-item:hover,.jessibuca-container .jessibuca-scale-menu-item:hover,.jessibuca-container .jessibuca-speed-menu-item:hover{background-color:hsla(0,0%,100%,.2)}.jessibuca-container .jessibuca-menu-item:focus,.jessibuca-container .jessibuca-quality-menu-item:focus,.jessibuca-container .jessibuca-scale-menu-item:focus,.jessibuca-container .jessibuca-speed-menu-item:focus{outline:none}.jessibuca-container .jessibuca-menu-item.jessibuca-menu-item-active,.jessibuca-container .jessibuca-menu-item.jessibuca-quality-menu-item-active,.jessibuca-container .jessibuca-menu-item.jessibuca-scale-menu-item-active,.jessibuca-container .jessibuca-menu-item.jessibuca-speed-menu-item-active,.jessibuca-container .jessibuca-quality-menu-item.jessibuca-menu-item-active,.jessibuca-container .jessibuca-quality-menu-item.jessibuca-quality-menu-item-active,.jessibuca-container .jessibuca-quality-menu-item.jessibuca-scale-menu-item-active,.jessibuca-container .jessibuca-quality-menu-item.jessibuca-speed-menu-item-active,.jessibuca-container .jessibuca-scale-menu-item.jessibuca-menu-item-active,.jessibuca-container .jessibuca-scale-menu-item.jessibuca-quality-menu-item-active,.jessibuca-container .jessibuca-scale-menu-item.jessibuca-scale-menu-item-active,.jessibuca-container .jessibuca-scale-menu-item.jessibuca-speed-menu-item-active,.jessibuca-container .jessibuca-speed-menu-item.jessibuca-menu-item-active,.jessibuca-container .jessibuca-speed-menu-item.jessibuca-quality-menu-item-active,.jessibuca-container .jessibuca-speed-menu-item.jessibuca-scale-menu-item-active,.jessibuca-container .jessibuca-speed-menu-item.jessibuca-speed-menu-item-active{color:#2298fc}.jessibuca-container .jessibuca-volume-panel-wrap{position:absolute;left:50%;bottom:100%;visibility:hidden;opacity:0;transform:translateX(-50%) translateY(22%);transition:visibility .3s,opacity .3s;background-color:rgba(0,0,0,.5);border-radius:4px;height:120px;width:50px;overflow:hidden}.jessibuca-container .jessibuca-volume-panel-wrap.jessibuca-volume-panel-wrap-show{visibility:visible;opacity:1}.jessibuca-container .jessibuca-volume-panel{cursor:pointer;position:absolute;top:21px;height:60px;width:50px;overflow:hidden}.jessibuca-container .jessibuca-volume-panel-text{position:absolute;left:0;top:0;width:50px;height:20px;line-height:20px;text-align:center;color:#fff;font-size:12px}.jessibuca-container .jessibuca-volume-panel-handle{position:absolute;top:48px;left:50%;width:12px;height:12px;border-radius:12px;margin-left:-6px;background:#fff}.jessibuca-container .jessibuca-volume-panel-handle:before{bottom:-54px;background:#fff}.jessibuca-container .jessibuca-volume-panel-handle:after{bottom:6px;background:hsla(0,0%,100%,.2)}.jessibuca-container .jessibuca-volume-panel-handle:after,.jessibuca-container .jessibuca-volume-panel-handle:before{content:"";position:absolute;display:block;left:50%;width:3px;margin-left:-1px;height:60px}.jessibuca-container.jessibuca-fullscreen-web .jessibuca-controls{width:100vh}.jessibuca-container.jessibuca-fullscreen-web .jessibuca-play-big:after{transform:translate(-50%,-50%) rotate(270deg)}.jessibuca-container.jessibuca-fullscreen-web .jessibuca-loading{flex-direction:row}.jessibuca-container.jessibuca-fullscreen-web .jessibuca-loading-text{transform:rotate(270deg)}.jessibuca-container .jessibuca-contextmenus{display:none;flex-direction:column;position:absolute;z-index:120;left:10px;top:10px;min-width:200px;padding:5px 0;background-color:rgba(0,0,0,.9);border-radius:3px}.jessibuca-container .jessibuca-contextmenus .jessibuca-contextmenu{cursor:pointer;font-size:12px;display:block;color:#fff;padding:10px 15px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 0 2px rgba(0,0,0,.5);border-bottom:1px solid hsla(0,0%,100%,.1)}.jessibuca-container .jessibuca-contextmenus .jessibuca-contextmenu a{color:#fff;text-decoration:none}.jessibuca-container .jessibuca-contextmenus .jessibuca-contextmenu span{display:inline-block;padding:0 7px}.jessibuca-container .jessibuca-contextmenus .jessibuca-contextmenu span.art-current,.jessibuca-container .jessibuca-contextmenus .jessibuca-contextmenu span:hover{color:var(--theme)}.jessibuca-container .jessibuca-contextmenus .jessibuca-contextmenu:hover{background-color:hsla(0,0%,100%,.1)}.jessibuca-container .jessibuca-contextmenus .jessibuca-contextmenu:last-child{border-bottom:none}.jessibuca-container.jessibuca-contextmenus-show .jessibuca-contextmenus{display:flex}.jessibuca-container-playback .jessibuca-controls{height:48px}.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center{flex:1;display:flex;box-sizing:border-box;justify-content:space-between;font-size:12px}.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-controls-playback-time{box-sizing:border-box;flex:1;position:relative;height:100%}.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-controls-playback-time-inner{width:300px;height:100%;overflow-y:hidden;overflow-x:auto}.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-controls-playback-current-time{position:absolute;left:0;top:0;height:15px;width:1px;background-color:red;text-align:center;z-index:1}.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-controls-playback-current-time-text{position:absolute;box-sizing:border-box;padding:0 5px;width:60px;left:-25px;top:15px;border:1px solid red;height:15px;line-height:15px;cursor:move;background-color:#fff;color:#000;-webkit-user-select:none;user-select:none}.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-controls-playback-time-scroll{position:relative;width:1440px;margin:0 auto}.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-controls-playback-time-scroll.one-hour{width:1440px}.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-controls-playback-time-scroll.half-hour{width:2880px}.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-controls-playback-time-scroll.ten-min{width:8640px}.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-controls-playback-time-scroll.five-min{width:17280px}.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-controls-playback-time-scroll.one-min{width:86400px}.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-controls-playback-time-list{position:relative;background-color:#ccc;height:48px}.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-playback-time-day{height:100%;overflow:hidden}.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-playback-time-one-wrap{height:8px;z-index:1}.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-playback-time-second-wrap{height:25px}.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-controls-playback-btns{display:flex;align-items:center}.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-playback-time-minute-one,.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-playback-time-second-one{float:left;width:1px;height:8px;margin:0;cursor:default;position:relative;z-index:1}.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-playback-time-minute-one.active,.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-playback-time-second-one.active{background-color:orange;cursor:pointer}.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-playback-time-minute-one.start,.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-playback-time-second-one.start{background-color:#999}.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-playback-time-minute-one:hover .jessibuca-playback-time-title-tips,.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-playback-time-second-one:hover .jessibuca-playback-time-title-tips{visibility:visible;opacity:1}.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-playback-time-title-tips{pointer-events:none;position:absolute;left:0;top:100%;visibility:hidden;opacity:0;transform:translateX(13%);transition:visibility .3s ease 0s,opacity .3s ease 0s;background-color:#000;border-radius:4px;z-index:1}.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-playback-time-title-tips.jessibuca-playback-time-title-tips-left{transform:translateX(-100%)}.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-playback-time-title-tips .jessibuca-playback-time-title{display:inline-block;padding:2px 5px;font-size:12px;white-space:nowrap;color:#fff}.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-playback-time-hour,.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-playback-time-minute{float:left;position:relative;width:60px;box-sizing:border-box;border-top:1px solid #999;-webkit-user-select:none;user-select:none;text-align:left;height:25px;line-height:25px}.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-playback-time-hour:first-child,.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-playback-time-minute:first-child{border-left:0}.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-playback-time-hour:first-child .jessibuca-playback-time-hour-text,.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-playback-time-minute:first-child .jessibuca-playback-time-hour-text{left:0}.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-playback-time-hour:after,.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-playback-time-minute:after{content:"";position:absolute;left:0;top:-8px;width:1px;height:14px;background-color:#999}.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-playback-time-hour-text,.jessibuca-container-playback .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-center .jessibuca-playback-time-minute-text{position:absolute;left:-13px}.jessibuca-container-playback .jessibuca-playback-expand.disabled .jessibuca-icon-expand,.jessibuca-container-playback .jessibuca-playback-narrow.disabled .jessibuca-icon-narrow{cursor:no-drop}.jessibuca-container-playback.jessibuca-fullscreen-web .jessibuca-controls .jessibuca-controls-bottom .jessibuca-controls-playback-time-inner{overflow-y:auto}.jessibuca-zoom-control{cursor:grab}.jessibuca-performance-panel{position:absolute;box-sizing:border-box;z-index:10000;left:0;top:0;padding:5px;font-size:10px;background:rgba(0,0,0,.2);color:#fff;max-height:100%;overflow-y:auto;display:none}.jessibuca-performance-panel .jessibuca-performance-item{display:flex;align-items:center;margin-top:3px;color:#fff}.jessibuca-performance-panel .jessibuca-performance-item-block{height:10px}');class Ro{constructor(e){this.player=e,this.extendBtnList=[],f=this,(o=e)._opt.hasControl&&o._opt.controlAutoHide?o.$container.classList.add("jessibuca-controls-show-auto-hide"):o.$container.classList.add("jessibuca-controls-show"),_=o._opt,g=_.operateBtns,T=`
        <div class="jessibuca-controls-center">
            <div class="jessibuca-controls-playback-time">
                <div class="jessibuca-controls-playback-time-inner">
                    <div class="jessibuca-controls-playback-time-scroll">
                        <div class="jessibuca-controls-playback-time-list">
                            <div class="jessibuca-playback-time-day">
                                <div class="jessibuca-playback-time-one-wrap"></div>
                                <div class="jessibuca-playback-time-second-wrap"></div>
                            </div>
                        </div>
                        <div class="jessibuca-controls-playback-current-time">
                            <div class="jessibuca-controls-playback-current-time-text">00:00:00</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="jessibuca-controls-playback-btns">
                <div class="jessibuca-controls-item jessibuca-playback-narrow">${Fe.narrow}</div>
                <div class="jessibuca-controls-item jessibuca-playback-expand">${Fe.expand}</div>
            </div>
        </div>
    `,o.$container.insertAdjacentHTML("beforeend",`
            ${_.background?`<div class="jessibuca-poster" style="background-image: url(${_.background})"></div>`:""}
            <div class="jessibuca-loading-bg">
                <img class="jessibuca-loading-bg-image" src="" alt="">
            </div>
            ${_.loadingIcon?`
            <div class="jessibuca-loading">
                ${Fe.loading}
                ${_.loadingText?`<div class="jessibuca-loading-text">${_.loadingText}</div>`:""}
            </div>
            `:""}
            ${_.hasControl&&g.play?'<div class="jessibuca-play-big"></div>':""}
            ${_.hasControl&&g.ptz?`
            <div class="jessibuca-ptz-controls">
                <div class="jessibuca-ptz-bg-active"></div>
                <div class="jessibuca-ptz-arrow jessibuca-ptz-arrow-up" data-arrow="up"></div>
                <div class="jessibuca-ptz-arrow jessibuca-ptz-arrow-right" data-arrow="right"></div>
                <div class="jessibuca-ptz-arrow jessibuca-ptz-arrow-down" data-arrow="down"></div>
                <div class="jessibuca-ptz-arrow jessibuca-ptz-arrow-left" data-arrow="left"></div>
                ${_.ptzMoreArrowShow?`
                    <div class="jessibuca-ptz-arrow jessibuca-ptz-arrow-left-up" data-arrow="left-up"></div>
                    <div class="jessibuca-ptz-arrow jessibuca-ptz-arrow-right-up" data-arrow="right-up"></div>
                    <div class="jessibuca-ptz-arrow jessibuca-ptz-arrow-left-down" data-arrow="left-down"></div>
                    <div class="jessibuca-ptz-arrow jessibuca-ptz-arrow-right-down" data-arrow="right-down"></div>
                    `:""}
                <div class="jessibuca-ptz-control"></div>
                <div class="jessibuca-ptz-btns">
                    ${_.ptzZoomShow?`
                            <div class="jessibuca-ptz-btn">
                                <div class="jessibuca-ptz-expand jessibuca-ptz-icon">
                                    <i class="jessibuca-ptz-expand-icon"></i>
                                    <span class="icon-title-tips">
                                        <span class="icon-title">缩放+</span>
                                    </span>
                                </div>
                                <div class="jessibuca-ptz-narrow jessibuca-ptz-icon">
                                    <i class="jessibuca-ptz-narrow-icon"></i>
                                    <span class="icon-title-tips">
                                        <span class="icon-title">缩放-</span>
                                    </span>
                                </div>
                            </div>
                            `:""}
                    ${_.ptzApertureShow?`
                            <div class="jessibuca-ptz-btn">
                                <div class="jessibuca-ptz-aperture-far jessibuca-ptz-icon">
                                    <i class="jessibuca-ptz-aperture-icon"></i>
                                    <span class="icon-title-tips">
                                        <span class="icon-title">光圈+</span>
                                    </span>
                                </div>
                                <div class="jessibuca-ptz-aperture-near jessibuca-ptz-icon">
                                    <i class="jessibuca-ptz-aperture-icon"></i>
                                    <span class="icon-title-tips">
                                        <span class="icon-title">光圈-</span>
                                    </span>
                                </div>
                            </div>
                            `:""}
                    ${_.ptzFocusShow?`
                            <div class="jessibuca-ptz-btn">
                                <div class="jessibuca-ptz-focus-far jessibuca-ptz-icon">
                                    <i class="jessibuca-ptz-focus-icon"></i>
                                    <span class="icon-title-tips">
                                        <span class="icon-title">聚焦+</span>
                                    </span>
                                </div>
                                <div class="jessibuca-ptz-focus-near jessibuca-ptz-icon">
                                    <i class="jessibuca-ptz-focus-icon"></i>
                                    <span class="icon-title-tips">
                                        <span class="icon-title">聚焦-</span>
                                    </span>
                                </div>
                            </div>
                            `:""}
                </div>

            </div>
            `:""}
           ${_.hasVideo?`
            <div class="jessibuca-zoom-controls">
                <div class="jessibuca-zoom-narrow">${Fe.narrow}</div>
                <div class="jessibuca-zoom-tips">电子放大</div>
                <div class="jessibuca-zoom-expand">${Fe.expand}</div>
                <div class="jessibuca-zoom-stop2">${Fe.zoomStop}</div>
            </div>
            <div class="jessibuca-recording">
                <div class="jessibuca-recording-red-point"></div>
                <div class="jessibuca-recording-time">00:00:00</div>
                <div class="jessibuca-icon-recordStop jessibuca-recording-stop">${Fe.recordStop}</div>
            </div>
           `:""}

            ${_.hasControl?`
                <div class="jessibuca-controls">
                    <div class="jessibuca-controls-bottom">
                        <div class="jessibuca-controls-left">
                            ${_.showBandwidth?'<div class="jessibuca-controls-item jessibuca-speed"></div>':""}
                            <div class="jessibuca-controls-item-html">${_.controlHtml}</div>
                        </div>
                        ${_.playType===pe&&_.playbackConfig.showControl?T:""}

                        <div class="jessibuca-controls-right">
                            ${_.playType===pe&&_.playbackConfig.showRateBtn?`
                                 <div class="jessibuca-controls-item-wrap">
                                    <div class="jessibuca-controls-item jessibuca-speed-menu">
                                        <div class="jessibuca-speed-icon-text"></div>
                                        <div class="jessibuca-speed-menu-list"></div>
                                    </div>
                                 </div>
                             `:""}
                             ${g.close?`<div class="jessibuca-controls-item-wrap"><div class="jessibuca-controls-item jessibuca-close">${Fe.close}</div></div>`:""}
                             ${g.performance?`<div class="jessibuca-controls-item-wrap"><div class="jessibuca-controls-item jessibuca-performance">${Fe.performance}</div><div class="jessibuca-controls-item jessibuca-performance-active">${Fe.performanceActive}</div></div>`:""}
                             ${g.aiFace?`<div class="jessibuca-controls-item-wrap"><div class="jessibuca-controls-item jessibuca-face">${Fe.face}</div><div class="jessibuca-controls-item jessibuca-face-active">${Fe.faceActive}</div></div>`:""}
                             ${g.quality?`
                                 <div class="jessibuca-controls-item-wrap">
                                    <div class="jessibuca-controls-item jessibuca-quality-menu">
                                        <div class="jessibuca-quality-icon-text"></div>
                                        <div class="jessibuca-quality-menu-list"></div>
                                    </div>
                                 </div>
                             `:""}
                             ${g.scale?`
                                 <div class="jessibuca-controls-item-wrap">
                                    <div class="jessibuca-controls-item jessibuca-scale-menu">
                                        <div class="jessibuca-scale-icon-text"></div>
                                        <div class="jessibuca-scale-menu-list"></div>
                                     </div>
                                 </div>
                             `:""}
                             ${g.audio?`
                                <div class="jessibuca-controls-item-wrap">
                                    <div class="jessibuca-controls-item jessibuca-volume">
                                         ${Fe.audio}
                                         ${Fe.mute}
                                         <div class="jessibuca-volume-panel-wrap">
                                              <div class="jessibuca-volume-panel">
                                                     <div class="jessibuca-volume-panel-handle"></div>
                                              </div>
                                              <div class="jessibuca-volume-panel-text"></div>
                                         </div>
                                     </div>
                                </div>
                             `:""}
                             ${g.play?`<div class="jessibuca-controls-item-wrap"><div class="jessibuca-controls-item jessibuca-play">${Fe.play}</div><div class="jessibuca-controls-item jessibuca-pause">${Fe.pause}</div></div>`:""}
                             ${g.screenshot?`<div class="jessibuca-controls-item-wrap"><div class="jessibuca-controls-item jessibuca-screenshot">${Fe.screenshot}</div></div>`:""}
                             ${g.record?` <div class="jessibuca-controls-item-wrap"><div class="jessibuca-controls-item jessibuca-record">${Fe.record}</div><div class="jessibuca-controls-item jessibuca-record-stop">${Fe.recordStop}</div></div>`:""}
                             ${g.ptz?` <div class="jessibuca-controls-item-wrap"><div class="jessibuca-controls-item jessibuca-ptz">${Fe.ptz}</div><div class="jessibuca-controls-item jessibuca-ptz-active">${Fe.ptzActive}</div></div>`:""}
                             ${g.zoom?` <div class="jessibuca-controls-item-wrap"><div class="jessibuca-controls-item jessibuca-zoom">${Fe.zoom}</div><div class="jessibuca-controls-item jessibuca-zoom-stop">${Fe.zoomStop}</div></div>`:""}
                             ${g.fullscreen?`<div class="jessibuca-controls-item-wrap"><div class="jessibuca-controls-item jessibuca-fullscreen">${Fe.fullscreen}</div><div class="jessibuca-controls-item jessibuca-fullscreen-exit">${Fe.fullscreenExit}</div></div>`:""}
                        </div>
                    </div>
                </div>
            `:""}
             <div class="jessibuca-performance-panel"></div>
             <div class="jessibuca-contextmenus"></div>
        `),Object.defineProperty(f,"$poster",{value:o.$container.querySelector(".jessibuca-poster")}),Object.defineProperty(f,"$loadingBg",{value:o.$container.querySelector(".jessibuca-loading-bg")}),Object.defineProperty(f,"$loadingBgImage",{value:o.$container.querySelector(".jessibuca-loading-bg-image")}),Object.defineProperty(f,"$loading",{value:o.$container.querySelector(".jessibuca-loading")}),Object.defineProperty(f,"$play",{value:o.$container.querySelector(".jessibuca-play")}),Object.defineProperty(f,"$playBig",{value:o.$container.querySelector(".jessibuca-play-big")}),Object.defineProperty(f,"$recording",{value:o.$container.querySelector(".jessibuca-recording")}),Object.defineProperty(f,"$recordingTime",{value:o.$container.querySelector(".jessibuca-recording-time")}),Object.defineProperty(f,"$recordingStop",{value:o.$container.querySelector(".jessibuca-recording-stop")}),Object.defineProperty(f,"$pause",{value:o.$container.querySelector(".jessibuca-pause")}),Object.defineProperty(f,"$controls",{value:o.$container.querySelector(".jessibuca-controls")}),Object.defineProperty(f,"$controlsInner",{value:o.$container.querySelector(".jessibuca-controls-bottom")}),Object.defineProperty(f,"$controlsLeft",{value:o.$container.querySelector(".jessibuca-controls-left")}),Object.defineProperty(f,"$controlsRight",{value:o.$container.querySelector(".jessibuca-controls-right")}),Object.defineProperty(f,"$volume",{value:o.$container.querySelector(".jessibuca-volume")}),Object.defineProperty(f,"$volumePanelWrap",{value:o.$container.querySelector(".jessibuca-volume-panel-wrap")}),Object.defineProperty(f,"$volumePanelText",{value:o.$container.querySelector(".jessibuca-volume-panel-text")}),Object.defineProperty(f,"$volumePanel",{value:o.$container.querySelector(".jessibuca-volume-panel")}),Object.defineProperty(f,"$volumeHandle",{value:o.$container.querySelector(".jessibuca-volume-panel-handle")}),Object.defineProperty(f,"$volumeOn",{value:o.$container.querySelector(".jessibuca-icon-audio")}),Object.defineProperty(f,"$volumeOff",{value:o.$container.querySelector(".jessibuca-icon-mute")}),Object.defineProperty(f,"$fullscreen",{value:o.$container.querySelector(".jessibuca-fullscreen")}),Object.defineProperty(f,"$fullscreenExit",{value:o.$container.querySelector(".jessibuca-fullscreen-exit")}),Object.defineProperty(f,"$record",{value:o.$container.querySelector(".jessibuca-record")}),Object.defineProperty(f,"$recordStop",{value:o.$container.querySelector(".jessibuca-record-stop")}),Object.defineProperty(f,"$screenshot",{value:o.$container.querySelector(".jessibuca-screenshot")}),Object.defineProperty(f,"$speed",{value:o.$container.querySelector(".jessibuca-speed")}),Object.defineProperty(f,"$controlHtml",{value:o.$container.querySelector(".jessibuca-controls-item-html")}),Object.defineProperty(f,"$playbackTime",{value:o.$container.querySelector(".jessibuca-controls-playback-time")}),Object.defineProperty(f,"$playbackTimeInner",{value:o.$container.querySelector(".jessibuca-controls-playback-time-inner")}),Object.defineProperty(f,"$playbackTimeScroll",{value:o.$container.querySelector(".jessibuca-controls-playback-time-scroll")}),Object.defineProperty(f,"$playbackTimeList",{value:o.$container.querySelector(".jessibuca-controls-playback-time-list")}),Object.defineProperty(f,"$playbackTimeListOne",{value:o.$container.querySelector(".jessibuca-playback-time-one-wrap")}),Object.defineProperty(f,"$playbackTimeListSecond",{value:o.$container.querySelector(".jessibuca-playback-time-second-wrap")}),Object.defineProperty(f,"$playbackCurrentTime",{value:o.$container.querySelector(".jessibuca-controls-playback-current-time")}),Object.defineProperty(f,"$playbackCurrentTimeText",{value:o.$container.querySelector(".jessibuca-controls-playback-current-time-text")}),Object.defineProperty(f,"$controlsPlaybackBtns",{value:o.$container.querySelector(".jessibuca-controls-playback-btns")}),Object.defineProperty(f,"$playbackNarrow",{value:o.$container.querySelector(".jessibuca-playback-narrow")}),Object.defineProperty(f,"$playbackExpand",{value:o.$container.querySelector(".jessibuca-playback-expand")}),Object.defineProperty(f,"$ptz",{value:o.$container.querySelector(".jessibuca-ptz")}),Object.defineProperty(f,"$ptzActive",{value:o.$container.querySelector(".jessibuca-ptz-active")}),Object.defineProperty(f,"$ptzControl",{value:o.$container.querySelector(".jessibuca-ptz-controls")}),Object.defineProperty(f,"$ptzBgActive",{value:o.$container.querySelector(".jessibuca-ptz-bg-active")}),Object.defineProperty(f,"$ptzControlCircular",{value:o.$container.querySelector(".jessibuca-ptz-control")}),Object.defineProperty(f,"$ptzArrows",{value:o.$container.querySelectorAll(".jessibuca-ptz-arrow")}),Object.defineProperty(f,"$ptzExpand",{value:o.$container.querySelector(".jessibuca-ptz-expand")}),Object.defineProperty(f,"$ptzNarrow",{value:o.$container.querySelector(".jessibuca-ptz-narrow")}),Object.defineProperty(f,"$ptzApertureFar",{value:o.$container.querySelector(".jessibuca-ptz-aperture-far")}),Object.defineProperty(f,"$ptzApertureNear",{value:o.$container.querySelector(".jessibuca-ptz-aperture-near")}),Object.defineProperty(f,"$ptzFocusFar",{value:o.$container.querySelector(".jessibuca-ptz-focus-far")}),Object.defineProperty(f,"$ptzFocusNear",{value:o.$container.querySelector(".jessibuca-ptz-focus-near")}),Object.defineProperty(f,"$qualityText",{value:o.$container.querySelector(".jessibuca-quality-icon-text")}),Object.defineProperty(f,"$qualityMenu",{value:o.$container.querySelector(".jessibuca-quality-menu")}),Object.defineProperty(f,"$qualityMenuList",{value:o.$container.querySelector(".jessibuca-quality-menu-list")}),Object.defineProperty(f,"$scaleText",{value:o.$container.querySelector(".jessibuca-scale-icon-text")}),Object.defineProperty(f,"$scaleMenu",{value:o.$container.querySelector(".jessibuca-scale-menu")}),Object.defineProperty(f,"$scaleMenuList",{value:o.$container.querySelector(".jessibuca-scale-menu-list")}),Object.defineProperty(f,"$zoom",{value:o.$container.querySelector(".jessibuca-zoom")}),Object.defineProperty(f,"$zoomStop",{value:o.$container.querySelector(".jessibuca-zoom-stop")}),Object.defineProperty(f,"$zoomNarrow",{value:o.$container.querySelector(".jessibuca-zoom-narrow")}),Object.defineProperty(f,"$zoomExpand",{value:o.$container.querySelector(".jessibuca-zoom-expand")}),Object.defineProperty(f,"$zoomStop2",{value:o.$container.querySelector(".jessibuca-zoom-stop2")}),Object.defineProperty(f,"$close",{value:o.$container.querySelector(".jessibuca-close")}),Object.defineProperty(f,"$zoomControls",{value:o.$container.querySelector(".jessibuca-zoom-controls")}),Object.defineProperty(f,"$performancePanel",{value:o.$container.querySelector(".jessibuca-performance-panel")}),Object.defineProperty(f,"$performance",{value:o.$container.querySelector(".jessibuca-performance")}),Object.defineProperty(f,"$performanceActive",{value:o.$container.querySelector(".jessibuca-performance-active")}),Object.defineProperty(f,"$faceDetect",{value:o.$container.querySelector(".jessibuca-face")}),Object.defineProperty(f,"$faceDetectActive",{value:o.$container.querySelector(".jessibuca-face-active")}),Object.defineProperty(f,"$contextmenus",{value:o.$container.querySelector(".jessibuca-contextmenus")}),Object.defineProperty(f,"$speedText",{value:o.$container.querySelector(".jessibuca-speed-icon-text")}),Object.defineProperty(f,"$speedMenu",{value:o.$container.querySelector(".jessibuca-speed-menu")}),Object.defineProperty(f,"$speedMenuList",{value:o.$container.querySelector(".jessibuca-speed-menu-list")}),0<e._opt.extendOperateBtns.length&&e._opt.extendOperateBtns.forEach(E=>{this.addExtendBtn(E)}),l=this,Object.defineProperty(l,"controlsRect",{get:()=>l.$controls.getBoundingClientRect()}),Object.defineProperty(l,"controlsInnerRect",{get:()=>l.$controlsInner.getBoundingClientRect()}),Object.defineProperty(l,"controlsLeftRect",{get:()=>l.$controlsLeft.getBoundingClientRect()}),Object.defineProperty(l,"controlsRightRect",{get:()=>l.$controlsRight.getBoundingClientRect()}),Object.defineProperty(l,"controlsPlaybackTimeInner",{get:()=>l.$playbackTimeInner&&l.$playbackTimeInner.getBoundingClientRect()||{}}),Object.defineProperty(l,"controlsPlaybackBtnsRect",{get:()=>l.$controlsPlaybackBtns&&l.$controlsPlaybackBtns.getBoundingClientRect()||{width:0}}),Do(e,this);{let t=function(r){var{bottom:n,height:a}=s.$volumePanel.getBoundingClientRect(),d=s.$volumeHandle.getBoundingClientRect().height;return ft(n-r.y-d/2,0,a-d/2)/(a-d)};var i=e,s=this;const E=i.events.proxy,h=i._opt,k=h.operateBtns;if(E(window,["click","contextmenu"],r=>{-1<r.composedPath().indexOf(i.$container)?s.isFocus=!0:s.isFocus=!1}),E(window,"orientationchange",()=>{setTimeout(()=>{i.resize()},300)}),E(s.$controls,"click",r=>{r.stopPropagation()}),k.play&&(E(s.$pause,"click",r=>{h.playType===pe&&h.playbackConfig.uiUsePlaybackPause?i.playbackPause=!0:mt(k.pauseFn)?k.pauseFn():i.pause()}),E(s.$play,"click",r=>{h.playType===pe&&i.playbackPause?i.playbackPause=!1:mt(k.playFn)?k.playFn():(i.play(),i.resumeAudioAfterPause())})),E(s.$playBig,"click",r=>{h.playType===pe&&i.playbackPause?i.playbackPause=!1:mt(k.playFn)?k.playFn():(i.play(),i.resumeAudioAfterPause())}),k.screenshot&&E(s.$screenshot,"click",r=>{r.stopPropagation(),mt(k.screenshotFn)?k.screenshotFn():i.video.screenshot()}),k.audio&&(E(s.$volume,"mouseover",()=>{s.$volumePanelWrap.classList.add("jessibuca-volume-panel-wrap-show")}),E(s.$volume,"mouseout",()=>{s.$volumePanelWrap.classList.remove("jessibuca-volume-panel-wrap-show")}),E(s.$volumeOn,"click",r=>{r.stopPropagation(),ue(s.$volumeOn,"display","none"),ue(s.$volumeOff,"display","block"),r=i.volume,i.volume=0,i._lastVolume=r}),E(s.$volumeOff,"click",r=>{r.stopPropagation(),ue(s.$volumeOn,"display","block"),ue(s.$volumeOff,"display","none"),i.volume=i.lastVolume||.5}),E(s.$volumePanel,"click",r=>{r.stopPropagation(),i.volume=t(r)}),E(s.$volumeHandle,"mousedown",()=>{s.isVolumeDroging=!0}),E(s.$volumeHandle,"mousemove",r=>{s.isVolumeDroging&&(i.volume=t(r))}),E(document,"mouseup",()=>{s.isVolumeDroging&&(s.isVolumeDroging=!1)})),k.record&&(E(s.$record,"click",r=>{r.stopPropagation(),mt(k.recordFn)?k.recordFn():i.recording=!0}),E(s.$recordStop,"click",r=>{r.stopPropagation(),mt(k.recordStopFn)?k.recordStopFn():i.recording=!1})),E(s.$recordingStop,"click",r=>{r.stopPropagation(),mt(k.recordStopFn)?k.recordStopFn():i.recording=!1}),k.fullscreen&&(E(s.$fullscreen,"click",r=>{r.stopPropagation(),mt(k.fullscreenFn)?k.fullscreenFn():i.fullscreen=!0}),E(s.$fullscreenExit,"click",r=>{r.stopPropagation(),mt(k.fullscreenExitFn)?k.fullscreenExitFn():i.fullscreen=!1})),k.ptz){if(E(s.$ptz,"click",r=>{r.stopPropagation(),ue(s.$ptzActive,"display","flex"),ue(s.$ptz,"display","none"),s.$ptzControl.classList.add("jessibuca-ptz-controls-show")}),E(s.$ptzActive,"click",r=>{r.stopPropagation(),ue(s.$ptz,"display","flex"),ue(s.$ptzActive,"display","none"),s.$ptzControl.classList.remove("jessibuca-ptz-controls-show")}),s.$ptzArrows.forEach(r=>{if(h.ptzClickType===xt)E(r,"click",n=>{n.stopPropagation(),n=n.currentTarget.dataset.arrow,s.$ptzBgActive.classList.add("jessibuca-ptz-bg-active-show"),s.$ptzBgActive.classList.add("jessibuca-ptz-bg-active-"+n),s.$ptzControlCircular.classList.add("jessibuca-ptz-control-"+n),i.emit(N.ptz,Aa(n)),setTimeout(()=>{s.$ptzBgActive.classList.remove("jessibuca-ptz-bg-active-show"),Is.forEach(a=>{s.$ptzBgActive.classList.remove("jessibuca-ptz-bg-active-"+a),s.$ptzControlCircular.classList.remove("jessibuca-ptz-control-"+a)}),i.emit(N.ptz,Ai)},1e3*h.ptzStopEmitDelay)});else if(h.ptzClickType===Vt){let n=!1;E(r,"mousedown",d=>{d.stopPropagation(),n=!0,d=d.currentTarget.dataset.arrow,s.$ptzBgActive.classList.add("jessibuca-ptz-bg-active-show"),s.$ptzBgActive.classList.add("jessibuca-ptz-bg-active-"+d),s.$ptzControlCircular.classList.add("jessibuca-ptz-control-"+d),i.emit(N.ptz,Aa(d))});const a=()=>{n=!1,s.$ptzBgActive.classList.remove("jessibuca-ptz-bg-active-show"),Is.forEach(d=>{s.$ptzBgActive.classList.remove("jessibuca-ptz-bg-active-"+d),s.$ptzControlCircular.classList.remove("jessibuca-ptz-control-"+d)}),i.emit(N.ptz,Ai)};E(r,"mouseup",d=>{d.stopPropagation(),n&&a()}),E(window,"mouseup",d=>{d.stopPropagation(),n&&a()})}}),h.ptzZoomShow){if(h.ptzClickType===xt)E(s.$ptzExpand,"click",r=>{r.stopPropagation(),i.emit(N.ptz,Ps),setTimeout(()=>{i.emit(N.ptz,Ai)},1e3*h.ptzStopEmitDelay)}),E(s.$ptzNarrow,"click",r=>{r.stopPropagation(),i.emit(N.ptz,Bs),setTimeout(()=>{i.emit(N.ptz,Ai)},1e3*h.ptzStopEmitDelay)});else if(h.ptzClickType===Vt){let r=!1,n=!1;E(s.$ptzExpand,"mousedown",d=>{d.stopPropagation(),r=!0,i.emit(N.ptz,Ps)}),E(s.$ptzNarrow,"mousedown",d=>{d.stopPropagation(),n=!0,i.emit(N.ptz,Bs)});const a=()=>{r=!1,n=!1,i.emit(N.ptz,Ai)};E(s.$ptzExpand,"mouseup",d=>{d.stopPropagation(),r&&a()}),E(s.$ptzNarrow,"mouseup",d=>{d.stopPropagation(),n&&a()}),E(window,"mouseup",d=>{d.stopPropagation(),(r||n)&&a()})}}if(h.ptzApertureShow){if(h.ptzClickType===xt)E(s.$ptzApertureFar,"click",r=>{r.stopPropagation(),i.emit(N.ptz,Us),setTimeout(()=>{i.emit(N.ptz,ti)},1e3*h.ptzStopEmitDelay)}),E(s.$ptzApertureNear,"click",r=>{r.stopPropagation(),i.emit(N.ptz,Ms),setTimeout(()=>{i.emit(N.ptz,ti)},1e3*h.ptzStopEmitDelay)});else if(h.ptzClickType===Vt){let r=!1,n=!1;E(s.$ptzApertureFar,"mousedown",d=>{d.stopPropagation(),r=!0,i.emit(N.ptz,Us)}),E(s.$ptzApertureNear,"mousedown",d=>{d.stopPropagation(),n=!0,i.emit(N.ptz,Ms)});const a=()=>{r=!1,n=!1,i.emit(N.ptz,ti)};E(s.$ptzApertureFar,"mouseup",d=>{d.stopPropagation(),r&&a()}),E(s.$ptzApertureNear,"mouseup",d=>{d.stopPropagation(),n&&a()}),E(window,"mouseup",d=>{d.stopPropagation(),(r||n)&&a()})}}if(h.ptzFocusShow){if(h.ptzClickType===xt)E(s.$ptzFocusFar,"click",r=>{r.stopPropagation(),i.emit(N.ptz,Fs),setTimeout(()=>{i.emit(N.ptz,ti)},1e3*h.ptzStopEmitDelay)}),E(s.$ptzFocusNear,"click",r=>{r.stopPropagation(),i.emit(N.ptz,Os),setTimeout(()=>{i.emit(N.ptz,ti)},1e3*h.ptzStopEmitDelay)});else if(h.ptzClickType===Vt){let r=!1,n=!1;E(s.$ptzFocusFar,"mousedown",d=>{d.stopPropagation(),r=!0,i.emit(N.ptz,Fs)}),E(s.$ptzFocusNear,"mousedown",d=>{d.stopPropagation(),n=!0,i.emit(N.ptz,Os)});const a=()=>{r=!1,n=!1,i.emit(N.ptz,ti)};E(s.$ptzFocusFar,"mouseup",d=>{d.stopPropagation(),r&&a()}),E(s.$ptzFocusNear,"mouseup",d=>{d.stopPropagation(),n&&a()}),E(window,"mouseup",d=>{d.stopPropagation(),(r||n)&&a()})}}}if(k.performance&&(E(s.$performance,"click",r=>{r.stopPropagation(),i.togglePerformancePanel(!0)}),E(s.$performanceActive,"click",r=>{r.stopPropagation(),i.togglePerformancePanel(!1)})),k.aiFace&&(E(s.$faceDetect,"click",r=>{r.stopPropagation(),i.faceDetect(!0)}),E(s.$faceDetectActive,"click",r=>{r.stopPropagation(),i.faceDetect(!1)})),i._opt.hasControl&&i._opt.controlAutoHide){E(i.$container,"mouseover",()=>{i.fullscreen||(ue(s.$controls,"display","block"),n())}),E(i.$container,"mousemove",()=>{i.$container&&s.$controls&&(i.fullscreen,s.$controls.style.display==="none")&&(ue(s.$controls,"display","block"),n())}),E(i.$container,"mouseout",()=>{a(),ue(s.$controls,"display","none")});let r=null;const n=()=>{a(),r=setTimeout(()=>{ue(s.$controls,"display","none")},5e3)},a=()=>{r&&(clearTimeout(r),r=null)}}i._opt.playType===pe&&(E(s.$playbackNarrow,"click",r=>{r.stopPropagation(),i.playback&&i.playback.narrowPrecision()}),E(s.$playbackExpand,"click",r=>{r.stopPropagation(),i.playback&&i.playback.expandPrecision()}),E(s.$playbackTimeList,"click",r=>{r=Mt(r),r.matches("div.jessibuca-playback-time-minute-one")&&i.playback&&i.playback.seek(r.dataset)}),i._opt.playbackConfig.showRateBtn&&(E(s.$speedMenu,"mouseover",()=>{s.$speedMenuList.classList.add("jessibuca-speed-menu-shown")}),E(s.$speedMenu,"mouseout",()=>{s.$speedMenuList.classList.remove("jessibuca-speed-menu-shown")}),E(s.$speedMenuList,"click",r=>{var n=Mt(r);if(n.matches("div.jessibuca-speed-menu-item")){const a=n.dataset;i.emit(N.playbackPreRateChange,a.speed)}})),i._opt.playbackConfig.supportWheel)&&E(s.$playbackTimeInner,"wheel",r=>{r.preventDefault(),0<(r.wheelDelta?r.wheelDelta/120:-(r.detail||0)/3)?i.playback&&i.playback.expandPrecision():i.playback&&i.playback.narrowPrecision()}),k.quality&&(E(s.$qualityMenu,"mouseover",()=>{s.$qualityMenuList.classList.add("jessibuca-quality-menu-shown")}),E(s.$qualityMenu,"mouseout",()=>{s.$qualityMenuList.classList.remove("jessibuca-quality-menu-shown")}),E(s.$qualityMenuList,"click",r=>{var n=Mt(r);if(n.matches("div.jessibuca-quality-menu-item")){const a=n.dataset;i.streamQuality=a.quality}})),k.scale&&(E(s.$scaleMenu,"mouseover",()=>{s.$scaleMenuList.classList.add("jessibuca-scale-menu-shown")}),E(s.$scaleMenu,"mouseout",()=>{s.$scaleMenuList.classList.remove("jessibuca-scale-menu-shown")}),E(s.$scaleMenuList,"click",r=>{var n=Mt(r);if(n.matches("div.jessibuca-scale-menu-item")){const a=n.dataset;i.setScaleMode(a.scale)}})),k.zoom&&(E(s.$zoom,"click",r=>{r.stopPropagation(),i.zooming=!0}),E(s.$zoomStop,"click",r=>{r.stopPropagation(),i.zooming=!1})),E(s.$zoomExpand,"click",r=>{r.stopPropagation(),i.zoom&&i.zoom.expandPrecision()}),E(s.$zoomNarrow,"click",r=>{r.stopPropagation(),i.zoom&&i.zoom.narrowPrecision()}),E(s.$zoomStop2,"click",r=>{r.stopPropagation(),i.zooming=!1}),k.close&&E(s.$close,"click",r=>{r.stopPropagation(),i.doDestroy()})}if(e._opt.hotKey){let k=function(t,r){h[t]?h[t].push(r):h[t]=[r]};var u=e,c=this;const E=u.events.proxy,h={};k(27,()=>{u.fullscreen&&(u.fullscreen=!1)}),k(38,()=>{u.volume+=.05}),k(40,()=>{u.volume-=.05}),E(window,"keydown",t=>{if(c.isFocus){const r=document.activeElement.tagName.toUpperCase(),n=document.activeElement.getAttribute("contenteditable");if(r!=="INPUT"&&r!=="TEXTAREA"&&n!==""&&n!=="true"){const a=h[t.keyCode];a&&(t.preventDefault(),a.forEach(d=>d()))}}})}var l,o,f,_,g,T;this.btnIndex=0,this.kbpsShow="0 KB/s",this.initLoadingBackground(),this.player.debug.log("Control","init")}destroy(){var e;this.$performancePanel&&(this.$performancePanel.innerHTML="",Lt(this.$performancePanel)||(e=this.player.$container.querySelector(".jessibuca-performance-panel"))&&this.player.$container&&this.player.$container.removeChild(e)),this.$poster&&!Lt(this.$poster)&&(e=this.player.$container.querySelector(".jessibuca-poster"))&&this.player.$container&&this.player.$container.removeChild(e),this.$loading&&!Lt(this.$loading)&&(e=this.player.$container.querySelector(".jessibuca-loading"))&&this.player.$container&&this.player.$container.removeChild(e),this.$loadingBg&&!Lt(this.$loadingBg)&&(e=this.player.$container.querySelector(".jessibuca-loading-bg"))&&this.player.$container&&this.player.$container.removeChild(e),this.$controls&&!Lt(this.$controls)&&(e=this.player.$container.querySelector(".jessibuca-controls"))&&this.player.$container&&this.player.$container.removeChild(e),this.$playBig&&!Lt(this.$playBig)&&(e=this.player.$container.querySelector(".jessibuca-play-big"))&&this.player.$container&&this.player.$container.removeChild(e),this.$recording&&!Lt(this.$recording)&&(e=this.player.$container.querySelector(".jessibuca-recording"))&&this.player.$container&&this.player.$container.removeChild(e),this.$ptzControl&&!Lt(this.$ptzControl)&&(e=this.player.$container.querySelector(".jessibuca-ptz-controls"))&&this.player.$container&&this.player.$container.removeChild(e),this.$zoomControls&&!Lt(this.$zoomControls)&&(e=this.player.$container.querySelector(".jessibuca-zoom-controls"))&&this.player.$container&&this.player.$container.removeChild(e),this.$contextmenus&&(this.$contextmenus.innerHTML="",Lt(this.$contextmenus)||(e=this.player.$container.querySelector(".jessibuca-contextmenus"))&&this.player.$container&&this.player.$container.removeChild(e)),this.btnIndex=0,this.extendBtnList=[],this.kbpsShow="0 KB/s",this.player.$container&&(this.player.$container.classList.remove("jessibuca-controls-show-auto-hide"),this.player.$container.classList.remove("jessibuca-controls-show")),this.player.debug.log("control","destroy")}getBtnIndex(){return this.btnIndex++}autoSize(){var e=this.player;e.$container.style.padding="0 0";const i=e.width,s=e.height,u=i/s,c=e.video.$videoElement.width/e.video.$videoElement.height;if(u>c){const l=(i-s*c)/2;e.$container.style.padding=`0 ${l}px`}else{const l=(s-i/c)/2;e.$container.style.padding=l+"px 0"}}initLoadingBackground(){var e=this.player;if(e._opt.loadingBackground&&e._opt.heartTimeoutReplayUseLastFrameShow){let u=e.height;var i=e._opt,s=(i.hasControl&&!i.controlAutoHide&&(u-=i.playType===pe?48:38),this.$loadingBgImage.width=e.width,this.$loadingBgImage.height=u,i.rotate);s!==270&&s!==90||(control.$loadingBgImage.width=u,control.$loadingBgImage.height=e.width),this.$loadingBgImage.src=e._opt.loadingBackground;let c="contain",l=(i.isResize||(c="fill"),i.isFullResize&&(c="none"),"");i.mirrorRotate==="none"&&s&&(l+=" rotate("+s+"deg)"),i.mirrorRotate==="level"?l+=" rotateY(180deg)":i.mirrorRotate==="vertical"&&(l+=" rotateX(180deg)"),this.$loadingBgImage.style.transform=l,this.$loadingBgImage.style.objectFit=c,Ge(this.$loadingBg,"display","block")}}_validateExtendBtn(e){let i=!0;return e.name||(this.player.debug.warn("Control","extend button name is required"),i=!1),i&&this.extendBtnList.findIndex(s=>s.name===e.name)!==-1&&(this.player.debug.warn("Control",`extend button name: ${e.name} is already exist`),i=!1),i&&!e.icon&&(this.player.debug.warn("Control","extend button icon is required"),i=!1),i}addExtendBtn(){let e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};var i=li(Bn);if(e=Object.assign({},i,e),this._validateExtendBtn(e)){const s=e.name||"",u=this.$controlsRight,c=e.activeIcon&&e.activeClick,l=`
            <div class="jessibuca-controls-item-wrap">
               ${e.icon?`<div class="jessibuca-controls-item jessibuca-control-extend-${s}">
                                <i class="jessibuca-icon jessibuca-icon-extend-${s}"></i>
                                ${e.iconTitle?`
                                            <span class="icon-title-tips"><span class="icon-title">${e.iconTitle}</span></span>
                                            `:""}
                                </div>`:""}
               ${e.activeIcon?`<div class="jessibuca-controls-item jessibuca-control-extend-${s}-active">
                                <i class="jessibuca-icon jessibuca-icon-extend-${s}-active"></i>
                                ${e.activeIconTitle?`
                                            <span class="icon-title-tips"><span class="icon-title">${e.activeIconTitle}</span></span>
                                            `:""}
                            </div>`:""}
               </div>
            `,o=Array.from(u.children)[e.index],f=(o?o.insertAdjacentHTML("beforebegin",l):rn(u,l),e.icon?u.querySelector(".jessibuca-icon-extend-"+s):null),_=e.icon?u.querySelector(".jessibuca-control-extend-"+s):null,g=e.activeIcon?u.querySelector(`.jessibuca-icon-extend-${s}-active`):null,T=e.activeIcon?u.querySelector(`.jessibuca-control-extend-${s}-active`):null,{proxy:E}=this.player.events;e.icon&&(Ge(f,"background",`url(${e.icon}) no-repeat center`),Ge(f,"background-size","100% 100%"),Ge(_,"display","none"),e.iconHover)&&(E(f,"mouseover",()=>{Ge(f,"background",`url(${e.iconHover}) no-repeat center`),Ge(f,"background-size","100% 100%")}),E(f,"mouseout",()=>{Ge(f,"background",`url(${e.icon}) no-repeat center`),Ge(f,"background-size","100% 100%")})),e.activeIcon&&(Ge(g,"background",`url(${e.activeIcon}) no-repeat center`),Ge(g,"background-size","100% 100%"),Ge(T,"display","none"),e.activeIconHover)&&(E(g,"mouseover",()=>{Ge(g,"background",`url(${e.activeIconHover}) no-repeat center`),Ge(g,"background-size","100% 100%")}),E(g,"mouseout",()=>{Ge(g,"background",`url(${e.activeIcon}) no-repeat center`),Ge(g,"background-size","100% 100%")})),e.click&&f&&E(f,"click",h=>{h.preventDefault(),c&&(Ge(_,"display","none"),Ge(T,"display","flex")),e.click.call(this.player,this,h)}),e.activeClick&&g&&E(g,"click",h=>{h.preventDefault(),Ge(_,"display","flex"),Ge(T,"display","none"),e.activeClick.call(this.player,this,h)}),this.extendBtnList.push({name:s,$iconWrap:_,$activeIconWrap:T})}}}tn(".jessibuca-container{position:relative;width:100%;height:100%;overflow:hidden}.jessibuca-container.jessibuca-fullscreen-web{position:fixed;z-index:9999;left:0;top:0;right:0;bottom:0;width:100vw!important;height:100vh!important;background:#000}");class te{static init(){for(var e in te.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},te.types)te.types.hasOwnProperty(e)&&(te.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var i=te.constants={};i.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),i.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),i.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),i.STSC=i.STCO=i.STTS,i.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),i.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),i.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),i.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}static box(e){let i=8,s=null,u=Array.prototype.slice.call(arguments,1),c=u.length;for(let o=0;o<c;o++)i+=u[o].byteLength;(s=new Uint8Array(i))[0]=i>>>24&255,s[1]=i>>>16&255,s[2]=i>>>8&255,s[3]=255&i,s.set(e,4);let l=8;for(let o=0;o<c;o++)s.set(u[o],l),l+=u[o].byteLength;return s}static generateInitSegment(s){var i=te.box(te.types.ftyp,te.constants.FTYP),s=te.moov(s),u=new Uint8Array(i.byteLength+s.byteLength);return u.set(i,0),u.set(s,i.byteLength),u}static moov(u){var i=te.mvhd(u.timescale,u.duration),s=te.trak(u),u=te.mvex(u);return te.box(te.types.moov,i,s,u)}static mvhd(e,i){return te.box(te.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))}static trak(e){return te.box(te.types.trak,te.tkhd(e),te.mdia(e))}static tkhd(c){var i=c.id,s=c.duration,u=c.presentWidth,c=c.presentHeight;return te.box(te.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,255&s,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,u>>>8&255,255&u,0,0,c>>>8&255,255&c,0,0]))}static mdia(e){return te.box(te.types.mdia,te.mdhd(e),te.hdlr(e),te.minf(e))}static mdhd(s){var i=s.timescale,s=s.duration;return te.box(te.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,s>>>24&255,s>>>16&255,s>>>8&255,255&s,85,196,0,0]))}static hdlr(e){return e=e.type==="audio"?te.constants.HDLR_AUDIO:te.constants.HDLR_VIDEO,te.box(te.types.hdlr,e)}static minf(e){var i=e.type==="audio"?te.box(te.types.smhd,te.constants.SMHD):te.box(te.types.vmhd,te.constants.VMHD);return te.box(te.types.minf,i,te.dinf(),te.stbl(e))}static dinf(){return te.box(te.types.dinf,te.box(te.types.dref,te.constants.DREF))}static stbl(e){return te.box(te.types.stbl,te.stsd(e),te.box(te.types.stts,te.constants.STTS),te.box(te.types.stsc,te.constants.STSC),te.box(te.types.stsz,te.constants.STSZ),te.box(te.types.stco,te.constants.STCO))}static stsd(e){return e.type==="audio"?te.box(te.types.stsd,te.constants.STSD_PREFIX,te.mp4a(e)):e.videoType==="avc"?te.box(te.types.stsd,te.constants.STSD_PREFIX,te.avc1(e)):te.box(te.types.stsd,te.constants.STSD_PREFIX,te.hvc1(e))}static mp4a(e){var s=e.channelCount,i=e.audioSampleRate,s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,s,0,16,0,0,0,0,i>>>8&255,255&i,0,0]);return te.box(te.types.mp4a,s,te.esds(e))}static esds(i){var i=i.config||[],s=i.length,s=new Uint8Array([0,0,0,0,3,23+s,0,1,0,4,15+s,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([s]).concat(i).concat([6,1,2]));return te.box(te.types.esds,s)}static avc1(s){var i=s.avcc,u=s.codecWidth,s=s.codecHeight,u=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>>8&255,255&u,s>>>8&255,255&s,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return te.box(te.types.avc1,u,te.box(te.types.avcC,i))}static hvc1(s){var i=s.avcc,u=s.codecWidth,s=s.codecHeight,u=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>>8&255,255&u,s>>>8&255,255&s,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return te.box(te.types.hvc1,u,te.box(te.types.hvcC,i))}static mvex(e){return te.box(te.types.mvex,te.trex(e))}static trex(e){return e=e.id,e=new Uint8Array([0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]),te.box(te.types.trex,e)}static moof(e,i){return te.box(te.types.moof,te.mfhd(e.sequenceNumber),te.traf(e,i))}static mfhd(e){return e=new Uint8Array([0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e]),te.box(te.types.mfhd,e)}static traf(l,u){var s=l.id,s=te.box(te.types.tfhd,new Uint8Array([0,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,255&s])),u=te.box(te.types.tfdt,new Uint8Array([0,0,0,0,u>>>24&255,u>>>16&255,u>>>8&255,255&u])),c=te.sdtp(l),l=te.trun(l,c.byteLength+16+16+8+16+8+8);return te.box(te.types.traf,s,u,l,c)}static sdtp(s){var i=new Uint8Array(5),s=s.flags;return i[4]=s.isLeading<<6|s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy,te.box(te.types.sdtp,i)}static trun(o,u){var s=new Uint8Array(28),u=(s.set([0,0,15,1,0,0,0,1,(u+=36)>>>24&255,u>>>16&255,u>>>8&255,255&u],0),o.duration),c=o.size,l=o.flags,o=o.cts;return s.set([u>>>24&255,u>>>16&255,u>>>8&255,255&u,c>>>24&255,c>>>16&255,c>>>8&255,255&c,l.isLeading<<2|l.dependsOn,l.isDependedOn<<6|l.hasRedundancy<<4|l.isNonSync,0,0,o>>>24&255,o>>>16&255,o>>>8&255,255&o],12),te.box(te.types.trun,s)}static mdat(e){return te.box(te.types.mdat,e)}}te.init();class an extends Ae{constructor(e){super(),this.player=e,this.isAvc=!0,this.mediaSource=new window.MediaSource,this.sourceBuffer=null,this.hasInit=!1,this.isInitInfo=!1,this.cacheTrack={},this.timeInit=!1,this.sequenceNumber=0,this.dropping=!1,this.firstRenderTime=null,this.$videoElement=null,this.mediaSourceAppendBufferFull=!1,this.mediaSourceAppendBufferError=!1,this.isDecodeFirstIIframe=!1,this.prevTimestamp=null,this.decodeDiffTimestamp=null,this.prevDts=null,this.prevPayloadBufferSize=0,this.isWidthOrHeightChanged=!1,this.prevTs=null,this.mediaSourceObjectURL=window.URL.createObjectURL(this.mediaSource),this.eventListenList=[],e._opt.mseUseCanvasRender?(this.$videoElement=document.createElement("video"),this.$videoElement.src=this.mediaSourceObjectURL,this.initVideoEvents()):(this.player.video.$videoElement.src=this.mediaSourceObjectURL,this.$videoElement=this.player.video.$videoElement);const{proxy:i}=e.events,s=i(this.mediaSource,"sourceopen",()=>{this.player&&this.player.emit(N.mseSourceOpen)}),u=i(this.mediaSource,"sourceclose",()=>{this.player&&this.player.emit(N.mseSourceClose)}),c=i(this.mediaSource,"sourceended",()=>{this.player&&this.player.emit(N.mseSourceended)});if(this.eventListenList.push(s,u,c),this.player.isPlayer){const l=i(this.$videoElement,Xi,f=>{if(this._handleUpdatePlaybackRate(),e._opt.mseUseCanvasRender)if(this.player.checkIsInRender())this.player.handleRender();else{const _=parseInt(f.timeStamp,10);this.player.debug.warn("MediaSource",`mseUseCanvasRender is true and $videoElement ts is ${_}, but not in render`)}else this.player.handleRender()}),o=i(this.$videoElement,zs,()=>{e.debug.log("MediaSource","video playback Rate change",this.$videoElement&&this.$videoElement.playbackRate)});this.eventListenList.push(l,o)}e.debug.log("MediaSource","init")}destroy(){this.stop(),this.eventListenList.length&&(this.eventListenList.forEach(e=>e()),this.eventListenList=[]),this.mediaSource=null,this.sourceBuffer=null,this.hasInit=!1,this.isInitInfo=!1,this.sequenceNumber=0,this.cacheTrack={},this.timeInit=!1,this.mediaSourceAppendBufferFull=!1,this.mediaSourceAppendBufferError=!1,this.isDecodeFirstIIframe=!1,this.prevTimestamp=null,this.prevDts=null,this.prevPayloadBufferSize=0,this.prevTs=null,this.firstRenderTime=null,this.isWidthOrHeightChanged=!1,this.dropping=!1,this.$videoElement&&(this.player._opt.mseUseCanvasRender&&this.$videoElement.src&&(this.$videoElement.src="",this.$videoElement.removeAttribute("src")),this.$videoElement=null),this.mediaSourceObjectURL&&(window.URL.revokeObjectURL(this.mediaSourceObjectURL),this.mediaSourceObjectURL=null),this.off(),this.player.debug.log("MediaSource","destroy")}get state(){return this.mediaSource&&this.mediaSource.readyState}get isStateOpen(){return this.state==="open"}get isStateClosed(){return this.state==="closed"}get isStateEnded(){return this.state==="ended"}get duration(){return this.mediaSource&&this.mediaSource.duration||-1}set duration(e){this.mediaSource.duration=e}initVideoEvents(){var s=this.player.events.proxy,e=s(this.$videoElement,Ns,()=>{this.player.debug.log("MediaSource","video canplay"),this.$videoElement.play().then(()=>{this.player.debug.log("MediaSource","video play")}).catch(u=>{this.player.debug.error("MediaSource","video play error ",u),this.player.emitError(H.mediaSourceUseCanvasRenderPlayFailed,u)})}),i=s(this.$videoElement,js,()=>{this.player.debug.log("MediaSource","video waiting")}),s=s(this.$videoElement,Xi,u=>{u=parseInt(u.timeStamp,10),this.player.emit(N.videoTimeUpdate,u),this.$videoElement.paused&&(this.player.debug.warn("MediaSource","video is paused and next try to replay"),this.$videoElement.play().then(()=>{this.player.debug.log("MediaSource","video is paused and replay success")}).catch(c=>{this.player.debug.warn("MediaSource","video is paused and replay error ",c)}))});this.eventListenList.push(e,i,s)}decodeVideo(e,i,s,u){var c=this.player;if(c)if(this.player.isDestroyed())this.player.debug.warn("MediaSource","decodeVideo() player is destroyed");else if(this.hasInit)if(!this.isDecodeFirstIIframe&&s&&(this.isDecodeFirstIIframe=!0),this.isDecodeFirstIIframe){if(s&&e[1]===0){const l=15&e[0];let o={};l==7?o=gr(e.slice(5)):l==12&&(o=yr(e));const f=this.player.video.videoInfo;f&&f.width&&f.height&&o&&o.codecWidth&&o.codecHeight&&(o.codecWidth!==f.width||o.codecHeight!==f.height)&&(this.player.debug.warn("MediaSource",`
                        decodeVideo: video width or height is changed,
                        old width is ${f.width}, old height is ${f.height},
                        new width is ${o.codecWidth}, new height is ${o.codecHeight},
                        and emit change event`),this.isWidthOrHeightChanged=!0,this.player.emitError(H.mseWidthOrHeightChange))}if(this.isWidthOrHeightChanged)this.player.debug.warn("MediaSource","decodeVideo: video width or height is changed, and return");else if(ya(e))this.player.debug.warn("MediaSource","decodeVideo and payload is video sequence header so drop this frame");else if(e.byteLength<12)this.player.debug.warn("MediaSource","decodeVideo and payload is too small , payload length is "+e.byteLength);else{this.firstRenderTime===null&&(this.firstRenderTime=i);let l=i-this.firstRenderTime;if(l<0&&(this.player.debug.warn("MediaSource",`decodeVideo
                     local dts is < 0 , ts is ${i} and prevTs is ${this.prevTs},
                     firstRenderTime is ${this.firstRenderTime} and mseCorrectTimeDuration is `+this.player._opt.mseCorrectTimeDuration),l=this.prevDts===null?0:this.prevDts+this.player._opt.mseCorrectTimeDuration,this._checkTsIsMaxDiff(i)))this.player.debug.warn("MediaSource",`decodeVideo is max diff , ts is ${i} and prevTs is ${this.prevTs}, diff is `+(this.prevTs-i)),this.emit(H.mediaSourceTsIsMaxDiff);else{if(this.prevDts!==null&&l<=this.prevDts){if(this.player.debug.warn("MediaSource",`
                    decodeVideo dts is less than(or equal) prev dts ,
                    dts is ${l} and prev dts is ${this.prevDts} ，
                    and now ts is ${i} and prev ts is ${this.prevTs} ，
                    and diff is ${i-this.prevTs} and firstRenderTime is ${this.firstRenderTime}，
                    and mseCorrectTimeDuration is ${this.player._opt.mseCorrectTimeDuration},
                    and prevPayloadBufferSize is ${this.prevPayloadBufferSize} and payload size is `+e.byteLength),l===this.prevDts&&this.prevPayloadBufferSize===e.byteLength)return void this.player.debug.warn("MediaSource","decodeVideo dts is equal to prev dts and payload size is equal to prev payload size so drop this frame");if(l=this.prevDts+this.player._opt.mseCorrectTimeDuration,this._checkTsIsMaxDiff(i))return this.player.debug.warn("MediaSource",`decodeVideo is max diff , ts is ${i} and prevTs is ${this.prevTs}, diff is ${this.prevTs-i} and emit replay`),void this.emit(H.mediaSourceTsIsMaxDiff)}this._decodeVideo(e,l,s,u,i),this.prevDts=l,this.prevPayloadBufferSize=e.byteLength,this.prevTs=i,this.player.getRenderType()===vt&&this.player.video&&this.player.video.doAddContentToWatermark()}}}else this.player.debug.warn("MediaSource","decodeVideo isDecodeFirstIIframe false");else if(s&&e[1]===Zi){const l=15&e[0];c.video.updateVideoInfo({encTypeCode:l}),l!=12||ia()?(c._times.decodeStart||(c._times.decodeStart=be()),this.hasInit=this._decodeConfigurationRecord(e,i,s,l)):this.emit(H.mediaSourceH265NotSupport)}else this.player.debug.warn("MediaSource",`decodeVideo has not init , isIframe is ${s} , payload is `+e[1])}_checkTsIsMaxDiff(e){return 0<this.prevTs&&e<this.prevTs&&36e5<this.prevTs-e}_decodeConfigurationRecord(e,i,s,u){let c=e.slice(5),l={};return u===7?l=gr(c):u===12&&(l=yr(e)),this.player.recorder&&this.player._opt.recordType===Ze&&this.player.recorder.initMetaData(e,u),l.codecWidth===0&&l.codecHeight===0?(this.player.debug.warn("MediaSource","_decodeConfigurationRecord",l),this.emit(H.mediaSourceDecoderConfigurationError),!1):(e={id:1,type:"video",timescale:1e3,duration:0,avcc:c,codecWidth:l.codecWidth,codecHeight:l.codecHeight,videoType:l.videoType},e=te.generateInitSegment(e),this.isAvc=u===7,this.appendBuffer(e.buffer),this.sequenceNumber=0,this.cacheTrack={},!(this.timeInit=!1))}_decodeVideo(h,i,s,u,c){var l=this.player;let o=h.slice(5),f=o.byteLength,_=new Date().getTime(),g=!1;this.prevTimestamp||(this.prevTimestamp=_,g=!0);var T,E,h=_-this.prevTimestamp,h=(((this.decodeDiffTimestamp=h)<5||500<h)&&!g&&l.debug.warn("MediaSource",`_decodeVideo now time is ${_} and prev time is ${this.prevTimestamp}, diff time is ${h} ms`),this.$videoElement),k=l._opt.videoBufferDelay+l._opt.videoBuffer;1<h.buffered.length&&(this.removeBuffer(h.buffered.start(0),h.buffered.end(0)),this.timeInit=!1),this.dropping&&this.cacheTrack.id&&i-this.cacheTrack.dts>k?(l.debug.warn("MediaSource","dropping time is ",i-this.cacheTrack.dts),this.dropping=!1,this.cacheTrack={}):this.cacheTrack.id&&i>=this.cacheTrack.dts?(k=8+this.cacheTrack.size,(T=new Uint8Array(k))[0]=k>>>24&255,T[1]=k>>>16&255,T[2]=k>>>8&255,T[3]=255&k,T.set(te.types.mdat,4),T.set(this.cacheTrack.data,8),this.cacheTrack.duration=i-this.cacheTrack.dts,this.player.recorder&&this.player.recorder.isRecording&&this.player._opt.recordType===Ze&&this.player.recorder.handleAddFmp4Track(this.cacheTrack),k=te.moof(this.cacheTrack,this.cacheTrack.dts),(E=new Uint8Array(k.byteLength+T.byteLength)).set(k,0),E.set(T,k.byteLength),this.appendBuffer(E.buffer),l.emit(N.timeUpdate,c),l.videoTimestamp=c,l.updateStats({fps:!0,ts:c,mseTs:i,buf:l.demux&&l.demux.delay||0}),l._times.videoStart||(l._times.videoStart=be(),l.handlePlayToRenderTimes())):(l.debug.log("MediaSource",`timeInit set false , cacheTrack = {} now dts is ${i}, and ts is ${c} cacheTrack dts is `+(this.cacheTrack&&this.cacheTrack.dts)),this.timeInit=!1,this.cacheTrack={}),this.cacheTrack||(this.cacheTrack={}),this.cacheTrack.id=1,this.cacheTrack.sequenceNumber=++this.sequenceNumber,this.cacheTrack.size=f,this.cacheTrack.dts=i,this.cacheTrack.cts=u,this.cacheTrack.isKeyframe=s,this.cacheTrack.data=o,this.cacheTrack.flags={isLeading:0,dependsOn:s?2:1,isDependedOn:s?1:0,hasRedundancy:0,isNonSync:s?0:1},this.timeInit||h.buffered.length!==1||(l.debug.log("MediaSource","timeInit set true"),this.timeInit=!0,h.currentTime=h.buffered.end(0)),!this.isInitInfo&&0<h.videoWidth&&0<h.videoHeight&&(l.debug.log("MediaSource",`updateVideoInfo: ${h.videoWidth},`+h.videoHeight),l.video.updateVideoInfo({width:h.videoWidth,height:h.videoHeight}),l.video.initCanvasViewSize(),this.isInitInfo=!0),l._opt.mseUseCanvasRender&&l.video.render({$video:h,ts:i}),this.prevTimestamp=new Date().getTime()}appendBuffer(e){const{debug:i,events:{proxy:s}}=this.player;if(this.sourceBuffer===null){var u=this.isAvc?Cs:Ls;try{this.sourceBuffer=this.mediaSource.addSourceBuffer(u)}catch(c){return i.warn("MediaSource","this.mediaSource.addSourceBuffer()",c.code,c),void this.player.emitError(H.mseAddSourceBufferError,c)}if(this.sourceBuffer){const c=s(this.sourceBuffer,"error",o=>{this.player.emitError(H.mseSourceBufferError,o)}),l=s(this.sourceBuffer,"updateend",()=>{});this.eventListenList.push(c,l)}}if(this.mediaSourceAppendBufferFull)i.warn("MediaSource","this.mediaSourceAppendBufferFull is true");else if(this.mediaSourceAppendBufferError)i.warn("MediaSource","this.mediaSourceAppendBufferError is true");else if(this.sourceBuffer.updating===!1&&this.isStateOpen)try{this.sourceBuffer.appendBuffer(e)}catch(c){i.warn("MediaSource","this.sourceBuffer.appendBuffer()",c.code,c),c.code===22?(this.stop(),this.mediaSourceAppendBufferFull=!0,this.emit(H.mediaSourceFull)):c.code===11?(this.stop(),this.mediaSourceAppendBufferError=!0,this.emit(H.mediaSourceAppendBufferError)):(i.error("MediaSource","appendBuffer error",c),this.player.emitError(N.mseSourceBufferError,c))}else this.isStateClosed?this.player.emitError(H.mseSourceBufferError,"mediaSource is not attached to video or mediaSource is closed"):this.isStateEnded?this.player.emitError(H.mseSourceBufferError,"mediaSource is end"):We(this.sourceBuffer.updating)&&(i.warn("MediaSource","mseSourceBufferBusy"),this.player.emit(N.mseSourceBufferBusy))}getSourceBufferUpdating(){return this.sourceBuffer&&this.sourceBuffer.updating}stop(){this.abortSourceBuffer(),this.endOfStream(),this.removeSourceBuffer()}dropSourceBuffer(e){var i=this.$videoElement;this.dropping=e,0<i.buffered.length&&1<i.buffered.end(0)-i.currentTime&&(this.player.debug.warn("MediaSource","dropSourceBuffer",`$video.buffered.end(0) is ${i.buffered.end(0)} - $video.currentTime `+i.currentTime),i.currentTime=i.buffered.end(0))}checkSourceBufferDelay(){var e=this.$videoElement;let i=0;return(i=0<e.buffered.length?e.buffered.end(e.buffered.length-1)-e.currentTime:i)<0&&(this.player.debug.warn("MediaSource",`checkSourceBufferDelay end(0) is ${e.buffered.end(0)} - currentTime is ${e.currentTime} and  result < 0 and result is `+i),i=0),i}getDecodeDiffTimes(){return this.decodeDiffTimestamp}removeBuffer(e,i){if(this.isStateOpen&&this.sourceBuffer.updating===!1)try{this.sourceBuffer.remove(e,i)}catch(s){this.player.debug.warn("MediaSource","removeBuffer() error",s)}else this.player.debug.warn("MediaSource","removeBuffer() this.isStateOpen is",this.isStateOpen,"this.sourceBuffer.updating",this.sourceBuffer.updating)}endOfStream(){if(this.isStateOpen&&this.$videoElement&&1<=this.$videoElement.readyState)try{this.mediaSource.endOfStream()}catch(e){this.player.debug.warn("MediaSource","endOfStream() error",e)}}abortSourceBuffer(){this.isStateOpen&&this.sourceBuffer&&(this.sourceBuffer.abort(),this.sourceBuffer=null)}removeSourceBuffer(){if(!this.isStateClosed&&this.mediaSource&&this.sourceBuffer)try{this.mediaSource.removeSourceBuffer(this.sourceBuffer)}catch(e){this.player.debug.warn("MediaSource","removeSourceBuffer() error",e)}}_handleUpdatePlaybackRate(){if(this.$videoElement){var e=this.$videoElement,u=(this.player._opt.videoBuffer+this.player._opt.videoBufferDelay)/1e3,i=e.buffered,i=(i.length&&i.start(0),i.length?i.end(i.length-1):0);let c=e.currentTime;var s=i-c,u=Math.max(5,3+u),u=(u<s?(this.player.debug.warn("MediaSource",`handleUpdatePlaybackRate and buffered is ${i} and current is ${c} , delay buffer is more than ${u} is ${s} and new time is `+i),e.currentTime=i,c=e.currentTime):s<0&&(this.player.debug.warn("MediaSource",`handleUpdatePlaybackRate and delay buffer is ${i} - current is ${c} = ${s} < 0 and check video is paused : ${e.paused} `),e.paused)&&e.play(),this._getPlaybackRate(i-c));e.playbackRate!==u&&(this.player.debug.warn("MediaSource",`handleUpdatePlaybackRate and buffered is ${i} and current time is ${c} and delay is ${i-c}  set playbackRate is ${u} `),e.playbackRate=u)}}getDecodePlaybackRate(){let e=0;var i=this.$videoElement;return e=i?i.playbackRate:e}_getPlaybackRate(e){var i=this.$videoElement,s=this.player._opt.videoBuffer,u=s+this.player._opt.videoBufferDelay;return e*=1e3,i.playbackRate===1?u<e?1.2:1:e<=s?1:i.playbackRate}}const ys=()=>"wakeLock"in navigator&&window.navigator.userAgent.indexOf("Samsung")===-1&&_e(oi());class Io{constructor(e){this.player=e,this.enabled=!1,ys()?(this.player.debug.log("NoSleep","Native Wake Lock API supported."),this._wakeLock=null,this.handleVisibilityChange=()=>{this._wakeLock!==null&&document.visibilityState==="visible"&&this.enable()},document.addEventListener("visibilitychange",this.handleVisibilityChange),document.addEventListener("fullscreenchange",this.handleVisibilityChange)):(this.player.debug.log("NoSleep","Native Wake Lock API not supported. so use video element."),this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("title","No Sleep"),this.noSleepVideo.setAttribute("playsinline",""),this._addSourceToVideo(this.noSleepVideo,"webm","data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQRChYECGFOAZwEAAAAAABLfEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHYTbuMU6uEElTDZ1OsggGXTbuMU6uEHFO7a1OsghLJ7AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmsirXsYMPQkBNgI1MYXZmNTguNDUuMTAwV0GNTGF2ZjU4LjQ1LjEwMESJiECzmgAAAAAAFlSua0C5rgEAAAAAAABO14EBc8WI9UhIq9EDJPCcgQAitZyDdW5khoVWX1ZQOIOBASPjg4QF9eEA4AEAAAAAAAAbsIIBQLqB8FSwggElVLqB8FWwiFW3gQFVuIECrgEAAAAAAABZ14ECc8WIUEWPA9J/iJ6cgQAitZyDdW5khoZBX09QVVNWqoNjLqBWu4QExLQAg4EC4ZGfgQG1iEDncAAAAAAAYmSBIGOik09wdXNIZWFkAQE4AYC7AAAAAAASVMNnQcJzcwEAAAAAAACXY8CAZ8gBAAAAAAAAFUWji01BSk9SX0JSQU5ERIeEaXNvbWfIAQAAAAAAABZFo41NSU5PUl9WRVJTSU9ORIeDNTEyZ8gBAAAAAAAAJ0WjkUNPTVBBVElCTEVfQlJBTkRTRIeQaXNvbWlzbzJhdmMxbXA0MWfIAQAAAAAAABpFo4dFTkNPREVSRIeNTGF2ZjU4LjQ1LjEwMHNzAQAAAAAAAIZjwItjxYj1SEir0QMk8GfIAQAAAAAAAB5Fo4xIQU5ETEVSX05BTUVEh4xWaWRlb0hhbmRsZXJnyAEAAAAAAAAhRaOHRU5DT0RFUkSHlExhdmM1OC45MS4xMDAgbGlidnB4Z8iiRaOIRFVSQVRJT05Eh5QwMDowMDowNS4wMDcwMDAwMDAAAHNzAQAAAAAAAIdjwItjxYhQRY8D0n+InmfIAQAAAAAAAB5Fo4xIQU5ETEVSX05BTUVEh4xTb3VuZEhhbmRsZXJnyAEAAAAAAAAiRaOHRU5DT0RFUkSHlUxhdmM1OC45MS4xMDAgbGlib3B1c2fIokWjiERVUkFUSU9ORIeUMDA6MDA6MDUuMDE4MDAwMDAwAAAfQ7Z1T2TngQCjh4IAAID4//6jQKSBAAeAMBIAnQEqQAHwAABHCIWFiIWEiAICAAYWBPcGgWSfa9ubJzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh7Jzh69AD+/6tQgKOHggAVgPj//qOHggApgPj//qOHggA9gPj//qOHggBRgPj//qOHggBlgPj//qOegQBrANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCAHmA+P/+o4eCAI2A+P/+o4eCAKGA+P/+o4eCALWA+P/+o4eCAMmA+P/+o56BAM8A0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IA3YD4//6jh4IA8YD4//6jh4IBBYD4//6jh4IBGYD4//6jh4IBLYD4//6jnoEBMwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHggFBgPj//qOHggFVgPj//qOHggFpgPj//qOHggF9gPj//qOHggGRgPj//qOegQGXANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCAaWA+P/+o4eCAbmA+P/+o4eCAc2A+P/+o4eCAeGA+P/+o4eCAfWA+P/+o56BAfsA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4ICCYD4//6jh4ICHYD4//6jh4ICMYD4//6jh4ICRYD4//6jh4ICWYD4//6jnoECXwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHggJtgPj//qOHggKBgPj//qOHggKVgPj//qOHggKpgPj//qOHggK9gPj//qOegQLDANECAAUQEBRgAGFgv9AAIgAQzX61yT5xzAAAo4eCAtGA+P/+o4eCAuWA+P/+o4eCAvmA+P/+o4eCAw2A+P/+o4eCAyGA+P/+o56BAycA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IDNYD4//6jh4IDSYD4//6jh4IDXYD4//6jh4IDcYD4//6jh4IDhYD4//6jnoEDiwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHggOZgPj//qOHggOtgPj//qOHggPBgPj//qOHggPVgPj//qOHggPpgPj//qOegQPvANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCA/2A+P/+o4eCBBGA+P/+o4eCBCWA+P/+o4eCBDmA+P/+o4eCBE2A+P/+o56BBFMA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IEiID4//6jh4IEnID4//6jh4IEsID4//6jnoEEtwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHggTEgPj//qOHggTYgPj//qOHggTsgPj//qOHggUAgPj//qOHggUUgPj//qOegQUbANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCBSiA+P/+o4eCBTyA+P/+o4eCBVCA+P/+o4eCBWSA+P/+o4eCBXiA+P/+o56BBX8A0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IFjID4//6jh4IFoID4//6jh4IFtID4//6jh4IFyID4//6jh4IF3ID4//6jnoEF4wDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHggXwgPj//qOHggYEgPj//qOHggYYgPj//qOHggYsgPj//qOHggZAgPj//qOegQZHANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCBlSA+P/+o4eCBmiA+P/+o4eCBnyA+P/+o4eCBpCA+P/+o4eCBqSA+P/+o56BBqsA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IGuID4//6jh4IGzID4//6jh4IG4ID4//6jh4IG9ID4//6jh4IHCID4//6jnoEHDwDRAgAFEBAUYABhYL/QACIAEM1+tck+ccwAAKOHggccgPj//qOHggcwgPj//qOHggdEgPj//qOHggdYgPj//qOHggdsgPj//qOegQdzANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCB4CA+P/+o4eCB5SA+P/+o4eCB6iA+P/+o4eCB7yA+P/+o4eCB9CA+P/+o56BB9cA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IH5ID4//6jh4IH+ID4//6jh4IIDID4//6jh4IIIID4//6jh4IINID4//6jnoEIOwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHgghIgPj//qOHgghcgPj//qOHgghwgPj//qOHggiEgPj//qOegQifANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCCMCA+P/+o4eCCNSA+P/+o4eCCOiA+P/+o4eCCPyA+P/+o56BCQMA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IJEID4//6jh4IJJID4//6jh4IJOID4//6jh4IJTID4//6jh4IJYID4//6jnoEJZwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHggl0gPj//qOHggmIgPj//qOHggmcgPj//qOHggmwgPj//qOHggnEgPj//qOegQnLANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCCdiA+P/+o4eCCeyA+P/+o4eCCgCA+P/+o4eCChSA+P/+o4eCCiiA+P/+o56BCi8A0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IKPID4//6jh4IKUID4//6jh4IKZID4//6jh4IKeID4//6jh4IKjID4//6jnoEKkwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHggqggPj//qOHggq0gPj//qOHggrIgPj//qOHggrcgPj//qOHggrwgPj//qOegQr3ANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCCwSA+P/+o4eCCxiA+P/+o4eCCyyA+P/+o4eCC0CA+P/+o4eCC1SA+P/+o56BC1sA0QIABRAQFGAAYWC/0AAiABDNfrXJPnHMAACjh4ILaID4//6jh4ILfID4//6jh4ILkID4//6jh4ILpID4//6jh4ILuID4//6jnoELvwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHggvMgPj//qOHggvggPj//qOHggv0gPj//qOHggwIgPj//qOHggwcgPj//qOegQwjANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCDDCA+P/+o4eCDESA+P/+o4eCDFiA+P/+o4eCDGyA+P/+o4eCDICA+P/+o56BDIcA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IMlID4//6jh4IMqID4//6jh4IMvID4//6jh4IM0ID4//6jnoEM6wDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHgg0MgPj//qOHgg0ggPj//qOHgg00gPj//qOHgg1IgPj//qOegQ1PANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCDVyA+P/+o4eCDXCA+P/+o4eCDYSA+P/+o4eCDZiA+P/+o4eCDayA+P/+o56BDbMA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4INwID4//6jh4IN1ID4//6jh4IN6ID4//6jh4IN/ID4//6jh4IOEID4//6jnoEOFwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHgg4kgPj//qOHgg44gPj//qOHgg5MgPj//qOHgg5ggPj//qOHgg50gPj//qOegQ57ANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCDoiA+P/+o4eCDpyA+P/+o4eCDrCA+P/+o4eCDsSA+P/+o4eCDtiA+P/+o56BDt8A0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IO7ID4//6jh4IPAID4//6jh4IPFID4//6jh4IPKID4//6jh4IPPID4//6jnoEPQwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHgg9QgPj//qOHgg9kgPj//qOHgg94gPj//qOHgg+MgPj//qOHgg+ggPj//qOegQ+nANECAAUQEBRgAGFgv9AAIgAQzX61yT5xzAAAo4eCD7SA+P/+o4eCD8iA+P/+o4eCD9yA+P/+o4eCD/CA+P/+o4eCEASA+P/+o56BEAsA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IQGID4//6jh4IQLID4//6jh4IQQID4//6jh4IQVID4//6jh4IQaID4//6jnoEQbwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHghB8gPj//qOHghCQgPj//qOHghCkgPj//qOHghC4gPj//qOHghDMgPj//qOegRDTANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCEOCA+P/+o4eCEPSA+P/+o4eCEQiA+P/+o56BETcA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4IRQ4D4//6jh4IRV4D4//6jh4IRa4D4//6jh4IRf4D4//6jh4IRk4D4//6jnoERmwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHghGngPj//qOHghG7gPj//qOHghHPgPj//qOHghHjgPj//qOHghH3gPj//qOegRH/ANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCEguA+P/+o4eCEh+A+P/+o4eCEjOA+P/+o4eCEkeA+P/+o4eCEluA+P/+o56BEmMA0QIABRCsABgAGFgv9AAIgAQzX61yT5xzAACjh4ISb4D4//6jh4ISg4D4//6jh4ISl4D4//6jh4ISq4D4//6jh4ISv4D4//6jnoESxwDRAgAFEKwAGAAYWC/0AAiABDNfrXJPnHMAAKOHghLTgPj//qOHghLngPj//qOHghL7gPj//qOHghMPgPj//qOHghMjgPj//qOegRMrANECAAUQrAAYABhYL/QACIAEM1+tck+ccwAAo4eCEzeA+P/+o4eCE0uA+P/+o4eCE1+A+P/+o4eCE3OA+P/+oAEAAAAAAAAPoYeCE4cA+P/+daKDB/KBHFO7a5G7j7OBB7eK94EB8YIDX/CBDA=="),this._addSourceToVideo(this.noSleepVideo,"mp4","data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACORtZGF03gIATGF2YzU4LjM1LjEwMAACMEAOAAACcQYF//9t3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE2MSByMzAyNyA0MTIxMjc3IC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAyMCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTAgcmVmPTMgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9NyBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0xIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MSA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0tMiB0aHJlYWRzPTcgbG9va2FoZWFkX3RocmVhZHM9MSBzbGljZWRfdGhyZWFkcz0wIG5yPTAgZGVjaW1hdGU9MSBpbnRlcmxhY2VkPTAgYmx1cmF5X2NvbXBhdD0wIGNvbnN0cmFpbmVkX2ludHJhPTAgYmZyYW1lcz0wIHdlaWdodHA9MCBrZXlpbnQ9MjUwIGtleWludF9taW49MTAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD00MCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIzLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IGlwX3JhdGlvPTEuNDAgYXE9MToxLjAwAIAAAADvZYiED/JigADD7JycnJycnJycnJycnJycnJycnJ11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111114BGCAHARggBwEYIAcBGCAHARggBwAAAAdBmjgf4BLYARggBwEYIAcBGCAHARggBwAAAAdBmlQH+AS2ARggBwEYIAcBGCAHARggBwAAAAdBmmA/wCWwARggBwEYIAcBGCAHARggBwEYIAcAAAAHQZqAP8AlsAEYIAcBGCAHARggBwEYIAcAAAAHQZqgP8AlsAEYIAcBGCAHARggBwEYIAcAAAAHQZrAP8AlsAEYIAcBGCAHARggBwEYIAcBGCAHAAAAB0Ga4D/AJbABGCAHARggBwEYIAcBGCAHAAAAB0GbAD/AJbABGCAHARggBwEYIAcBGCAHAAAAB0GbID/AJbABGCAHARggBwEYIAcBGCAHARggBwAAAAdBm0A/wCWwARggBwEYIAcBGCAHAAAAB0GbYD/AJbABGCAHARggBwEYIAcAAAAHQZuAP8AlsAEYIAcBGCAHARggBwEYIAcBGCAHAAAAB0GboD/AJbABGCAHARggBwEYIAcBGCAHAAAAB0GbwD/AJbABGCAHARggBwEYIAcBGCAHAAAAB0Gb4D/AJbABGCAHARggBwEYIAcBGCAHARggBwAAAAdBmgA/wCWwARggBwEYIAcBGCAHARggBwAAAAdBmiA/wCWwARggBwEYIAcBGCAHARggBwAAAAdBmkA/wCWwARggBwEYIAcBGCAHARggBwEYIAcAAAAHQZpgP8AlsAEYIAcBGCAHARggBwEYIAcAAAAHQZqAP8AlsAEYIAcBGCAHARggBwEYIAcAAAAHQZqgP8AlsAEYIAcBGCAHARggBwAAAAdBmsA/wCWwARggBwEYIAcBGCAHARggBwAAAAdBmuA/wCWwARggBwEYIAcBGCAHARggBwAAAAdBmwA/wCWwARggBwEYIAcBGCAHARggBwEYIAcAAAAHQZsgP8AlsAEYIAcBGCAHARggBwEYIAcAAAAHQZtAP8AlsAEYIAcBGCAHARggBwEYIAcAAAAHQZtgP8AlsAEYIAcBGCAHARggBwEYIAcBGCAHAAAAB0GbgD/AJbABGCAHARggBwEYIAcBGCAHAAAAB0GboD/AJbABGCAHARggBwEYIAcBGCAHAAAAB0GbwD/AJbABGCAHARggBwEYIAcBGCAHARggBwAAAAdBm+A/wCWwARggBwEYIAcBGCAHARggBwAAAAdBmgA/wCWwARggBwEYIAcAAAAHQZogP8AlsAEYIAcBGCAHARggBwEYIAcBGCAHAAAAB0GaQD/AJbABGCAHARggBwEYIAcBGCAHAAAAB0GaYD/AJbABGCAHARggBwEYIAcBGCAHAAAAB0GagD/AJbABGCAHARggBwEYIAcBGCAHARggBwAAAAdBmqA/wCWwARggBwEYIAcBGCAHARggBwAAAAdBmsA/wCWwARggBwEYIAcBGCAHARggBwAAAAdBmuA/wCWwARggBwEYIAcBGCAHARggBwEYIAcAAAAHQZsAP8AlsAEYIAcBGCAHARggBwEYIAcAAAAHQZsgP8AlsAEYIAcBGCAHARggBwEYIAcAAAAHQZtAP8AlsAEYIAcBGCAHARggBwEYIAcBGCAHAAAAB0GbYD/AJbABGCAHARggBwAAAAdBm4A/wCWwARggBwEYIAcBGCAHARggBwAAAAdBm6A/wCWwARggBwEYIAcBGCAHARggBwEYIAcAAAAHQZvAP8AlsAEYIAcBGCAHARggBwEYIAcAAAAHQZvgP8AlsAEYIAcBGCAHARggBwEYIAcAAAAHQZoAO8AlsAEYIAcBGCAHARggBwEYIAcBGCAHAAAAB0GaIDfAJbABGCAHARggBwEYIAcBGCAHAAAMxm1vb3YAAABsbXZoZAAAAAAAAAAAAAAAAAAAA+gAABOgAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAPLdHJhawAAAFx0a2hkAAAAAwAAAAAAAAAAAAAAAQAAAAAAABOIAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAElVVUA8AAAAAAAJGVkdHMAAAAcZWxzdAAAAAAAAAABAAATiAAAAAAAAQAAAAADQ21kaWEAAAAgbWRoZAAAAAAAAAAAAAAAAAAAKAAAAMgAVcQAAAAAAC1oZGxyAAAAAAAAAAB2aWRlAAAAAAAAAAAAAAAAVmlkZW9IYW5kbGVyAAAAAu5taW5mAAAAFHZtaGQAAAABAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAAKuc3RibAAAAKpzdHNkAAAAAAAAAAEAAACaYXZjMQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAFAAPAASAAAAEgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAADRhdmNDAULAC//hABxnQsAL2QFB+/8ACwAMEAAAAwAQAAADAUDxQqSAAQAFaMuDyyAAAAAQcGFzcAAAAAsAAAAMAAAAGHN0dHMAAAAAAAAAAQAAADIAAAQAAAAAFHN0c3MAAAAAAAAAAQAAAAEAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAA3HN0c3oAAAAAAAAAAAAAADIAAANoAAAACwAAAAsAAAALAAAACwAAAAsAAAALAAAACwAAAAsAAAALAAAACwAAAAsAAAALAAAACwAAAAsAAAALAAAACwAAAAsAAAALAAAACwAAAAsAAAALAAAACwAAAAsAAAALAAAACwAAAAsAAAALAAAACwAAAAsAAAALAAAACwAAAAsAAAALAAAACwAAAAsAAAALAAAACwAAAAsAAAALAAAACwAAAAsAAAALAAAACwAAAAsAAAALAAAACwAAAAsAAAALAAAACwAAANhzdGNvAAAAAAAAADIAAABFAAADwQAAA9wAAAP3AAAEFgAABDEAAARMAAAEawAABIYAAAShAAAEwAAABNcAAATuAAAFDQAABSgAAAVDAAAFYgAABX0AAAWYAAAFtwAABdIAAAXtAAAGBAAABh8AAAY6AAAGWQAABnQAAAaPAAAGrgAABskAAAbkAAAHAwAABx4AAAcxAAAHUAAAB2sAAAeGAAAHpQAAB8AAAAfbAAAH+gAACBUAAAgwAAAITwAACGIAAAh9AAAInAAACLcAAAjSAAAI8QAACCV0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAAE6AAAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAABOIAAAEAAABAAAAAAedbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAACsRAADYVRVxAAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAAHSG1pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAHDHN0YmwAAABqc3RzZAAAAAAAAAABAAAAWm1wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAACsRAAAAAAANmVzZHMAAAAAA4CAgCUAAgAEgICAF0AVAAAAAAENiAAABVQFgICABRIIVuUABoCAgAECAAAAYHN0dHMAAAAAAAAACgAAAC8AAAQAAAAAAQAACtUAAAAsAAAEAAAAAAEAAArWAAAALAAABAAAAAABAAAK1QAAACwAAAQAAAAAAQAACtUAAAAaAAAEAAAAAAEAAAH/AAABzHN0c2MAAAAAAAAAJQAAAAEAAAABAAAAAQAAAAIAAAAFAAAAAQAAAAMAAAAEAAAAAQAAAAUAAAAFAAAAAQAAAAYAAAAEAAAAAQAAAAgAAAAFAAAAAQAAAAkAAAAEAAAAAQAAAAsAAAAFAAAAAQAAAAwAAAADAAAAAQAAAA4AAAAFAAAAAQAAAA8AAAAEAAAAAQAAABEAAAAFAAAAAQAAABIAAAAEAAAAAQAAABQAAAAFAAAAAQAAABUAAAAEAAAAAQAAABcAAAADAAAAAQAAABgAAAAEAAAAAQAAABoAAAAFAAAAAQAAABsAAAAEAAAAAQAAAB0AAAAFAAAAAQAAAB4AAAAEAAAAAQAAACAAAAAFAAAAAQAAACEAAAAEAAAAAQAAACIAAAACAAAAAQAAACMAAAAFAAAAAQAAACQAAAAEAAAAAQAAACYAAAAFAAAAAQAAACcAAAAEAAAAAQAAACkAAAAFAAAAAQAAACoAAAAEAAAAAQAAACwAAAAFAAAAAQAAAC0AAAACAAAAAQAAAC4AAAAEAAAAAQAAAC8AAAAFAAAAAQAAADAAAAAEAAAAAQAAADIAAAAFAAAAAQAAADMAAAAEAAAAAQAAA1xzdHN6AAAAAAAAAAAAAADSAAAAFQAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAA3HN0Y28AAAAAAAAAMwAAADAAAAOtAAADzAAAA+cAAAQCAAAEIQAABDwAAARXAAAEdgAABJEAAASsAAAEywAABOIAAAT5AAAFGAAABTMAAAVOAAAFbQAABYgAAAWjAAAFwgAABd0AAAX4AAAGDwAABioAAAZFAAAGZAAABn8AAAaaAAAGuQAABtQAAAbvAAAHDgAABykAAAc8AAAHWwAAB3YAAAeRAAAHsAAAB8sAAAfmAAAIBQAACCAAAAg7AAAIWgAACG0AAAiIAAAIpwAACMIAAAjdAAAI/AAAABpzZ3BkAQAAAHJvbGwAAAACAAAAAf//AAAAHHNiZ3AAAAAAcm9sbAAAAAEAAADSAAAAAQAAAGJ1ZHRhAAAAWm1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRhAAAAAQAAAABMYXZmNTguMjAuMTAw"),Object.assign(this.noSleepVideo.style,{position:"absolute",left:"-100%",top:"-100%"}),document.querySelector("body").append(this.noSleepVideo),this.handleNoSleepVideoTimeUpdate=()=>{this.noSleepVideo&&4<this.noSleepVideo.currentTime&&(this.noSleepVideo.currentTime=1)},this.noSleepVideo.addEventListener("timeupdate",this.handleNoSleepVideoTimeUpdate))}destroy(){if(this._wakeLock&&(this._wakeLock.release(),this._wakeLock=null),this.noSleepVideo){this.handleNoSleepVideoTimeUpdate&&this.noSleepVideo.removeEventListener("timeupdate",this.handleNoSleepVideoTimeUpdate);try{this.noSleepVideo.parentNode&&this.noSleepVideo.parentNode.removeChild(this.noSleepVideo)}catch{this.player.debug.warn("NoSleep","Failed to remove noSleepVideo element.")}this.noSleepVideo=null}this.handleVisibilityChange&&(document.removeEventListener("visibilitychange",this.handleVisibilityChange),document.removeEventListener("fullscreenchange",this.handleVisibilityChange))}_addSourceToVideo(e,i,s){var u=document.createElement("source");u.src=s,u.type="video/"+i,e.appendChild(u)}get isEnabled(){return this.enabled}enable(){const e=this.player.debug;return ys()?navigator.wakeLock.request("screen").then(i=>{this._wakeLock=i,this.enabled=!0,e.log("wakeLock","Wake Lock active."),this._wakeLock.addEventListener("release",()=>{e.log("wakeLock","Wake Lock released.")})}).catch(i=>{throw this.enabled=!1,e.warn("wakeLock",i.name+", "+i.message),i}):this.noSleepVideo.play().then(i=>(e.log("wakeLock","noSleepVideo Wake Lock active."),this.enabled=!0,i)).catch(i=>{throw e.warn("wakeLock",`noSleepVideo ${i.name}, `+i.message),this.enabled=!1,i})}disable(){ys()?(this._wakeLock&&this._wakeLock.release(),this._wakeLock=null):this.noSleepVideo&&this.noSleepVideo.pause(),this.enabled=!1,this.player.debug.log("wakeLock","Disabling wake lock.")}}var Ce=(Ri=ir(function(D,e){typeof window<"u"&&(D.exports=(()=>{return s={"./src/config.ts":(c,f,o)=>{o.r(f),o.d(f,{enableStreamingMode:()=>function(L){var B=L.loader;B!==p.default&&B!==d.default?(b.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),L.progressive=!1):(0,p.fetchSupported)()&&(L.loader=p.default,L.progressive=!0,L.enableSoftwareAES=!0,b.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))},hlsDefaultConfig:()=>S,mergeConfig:()=>function(L,B){if((B.liveSyncDurationCount||B.liveMaxLatencyDurationCount)&&(B.liveSyncDuration||B.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(B.liveMaxLatencyDurationCount!==void 0&&(B.liveSyncDurationCount===void 0||B.liveMaxLatencyDurationCount<=B.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(B.liveMaxLatencyDuration!==void 0&&(B.liveSyncDuration===void 0||B.liveMaxLatencyDuration<=B.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return C({},L,B)}});var f=o("./src/controller/abr-controller.ts"),_=o("./src/controller/audio-stream-controller.ts"),g=o("./src/controller/audio-track-controller.ts"),T=o("./src/controller/subtitle-stream-controller.ts"),E=o("./src/controller/subtitle-track-controller.ts"),h=o("./src/controller/buffer-controller.ts"),k=o("./src/controller/timeline-controller.ts"),t=o("./src/controller/cap-level-controller.ts"),r=o("./src/controller/fps-controller.ts"),n=o("./src/controller/eme-controller.ts"),a=o("./src/controller/cmcd-controller.ts"),d=o("./src/utils/xhr-loader.ts"),p=o("./src/utils/fetch-loader.ts"),m=o("./src/utils/cues.ts"),x=o("./src/utils/mediakeys-helper.ts"),b=o("./src/utils/logger.ts");function C(){return(C=Object.assign?Object.assign.bind():function(L){for(var B=1;B<arguments.length;B++){var A,I=arguments[B];for(A in I)Object.prototype.hasOwnProperty.call(I,A)&&(L[A]=I[A])}return L}).apply(this,arguments)}function v(L,B){var A,I=Object.keys(L);return Object.getOwnPropertySymbols&&(A=Object.getOwnPropertySymbols(L),B&&(A=A.filter(function(U){return Object.getOwnPropertyDescriptor(L,U).enumerable})),I.push.apply(I,A)),I}function y(L){for(var B=1;B<arguments.length;B++){var A=arguments[B]!=null?arguments[B]:{};B%2?v(Object(A),!0).forEach(function(I){var U,P;U=L,I=A[P=I],(P=(function(){var F=(function(M){if(typeof M!="object"||M===null)return M;var w=M[Symbol.toPrimitive];if(w===void 0)return String(M);if(w=w.call(M,"string"),typeof w!="object")return w;throw new TypeError("@@toPrimitive must return a primitive value.")})(P);return typeof F=="symbol"?F:String(F)})())in U?Object.defineProperty(U,P,{value:I,enumerable:!0,configurable:!0,writable:!0}):U[P]=I}):Object.getOwnPropertyDescriptors?Object.defineProperties(L,Object.getOwnPropertyDescriptors(A)):v(Object(A)).forEach(function(I){Object.defineProperty(L,I,Object.getOwnPropertyDescriptor(A,I))})}return L}var S=y(y({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:d.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:f.default,bufferController:h.default,capLevelController:t.default,fpsController:r.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:x.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},{cueHandler:m.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:T.SubtitleStreamController,subtitleTrackController:E.default,timelineController:k.TimelineController,audioStreamController:_.default,audioTrackController:g.default,emeController:n.default,cmcdController:a.default})},"./src/controller/abr-controller.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>r});var f=o("./src/polyfills/number.ts"),_=o("./src/utils/ewma-bandwidth-estimator.ts"),g=o("./src/events.ts"),T=o("./src/errors.ts"),E=o("./src/types/loader.ts"),h=o("./src/utils/logger.ts");function k(n,a){for(var d,p=0;p<a.length;p++){var m=a[p];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(n,typeof(d=(function(x){if(typeof x!="object"||x===null)return x;var b=x[Symbol.toPrimitive];if(b===void 0)return String(x);if(b=b.call(x,"string"),typeof b!="object")return b;throw new TypeError("@@toPrimitive must return a primitive value.")})(m.key))=="symbol"?d:String(d),m)}}function t(n){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,n=(this.hls=n).config,this.bwEstimator=new _.default(n.abrEwmaSlowVoD,n.abrEwmaFastVoD,n.abrEwmaDefaultEstimate),this.registerListeners()}(l=t.prototype).registerListeners=function(){var n=this.hls;n.on(g.Events.FRAG_LOADING,this.onFragLoading,this),n.on(g.Events.FRAG_LOADED,this.onFragLoaded,this),n.on(g.Events.FRAG_BUFFERED,this.onFragBuffered,this),n.on(g.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.on(g.Events.ERROR,this.onError,this)},l.unregisterListeners=function(){var n=this.hls;n.off(g.Events.FRAG_LOADING,this.onFragLoading,this),n.off(g.Events.FRAG_LOADED,this.onFragLoaded,this),n.off(g.Events.FRAG_BUFFERED,this.onFragBuffered,this),n.off(g.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.off(g.Events.ERROR,this.onError,this)},l.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},l.onFragLoading=function(n,a){var d=a.frag;d.type!==E.PlaylistLevelType.MAIN||this.timer||(this.fragCurrent=d,this.partCurrent=(d=a.part)!=null?d:null,this.timer=self.setInterval(this.onCheck,100))},l.onLevelLoaded=function(n,a){var d=this.hls.config;a.details.live?this.bwEstimator.update(d.abrEwmaSlowLive,d.abrEwmaFastLive):this.bwEstimator.update(d.abrEwmaSlowVoD,d.abrEwmaFastVoD)},l._abandonRulesCheck=function(){var n=this.fragCurrent,a=this.partCurrent,d=this.hls,p=d.autoLevelEnabled,m=d.media;if(n&&m){var x=(a||n).stats,b=(a||n).duration;if(x.aborted||x.loaded&&x.loaded===x.total||n.level===0)this.clearTimer(),this._nextAutoLevel=-1;else if(p&&!m.paused&&m.playbackRate&&m.readyState&&(p=d.mainForwardBufferInfo,p!==null)){var C=performance.now()-x.loading.start,m=Math.abs(m.playbackRate);if(!(C<=500*b/m)){var v=x.loaded&&x.loading.first,y=this.bwEstimator.getEstimate(),S=d.levels,L=d.minAutoLevel,A=S[n.level],A=x.total||Math.max(x.loaded,Math.round(b*A.maxBitrate/8)),B=v?1e3*x.loaded/C:0,A=B?(A-x.loaded)/B:8*A/y,I=p.len/m;if(!(A<=I)){for(var U=Number.POSITIVE_INFINITY,P=n.level-1;L<P;P--){var F=S[P].maxBitrate;if((U=B?b*F/(6.4*B):b*F/y)<I)break}A<=U||(h.logger.warn("Fragment "+n.sn+(a?" part "+a.index:"")+" of level "+n.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+P+`
      Current BW estimate: `+((0,f.isFiniteNumber)(y)?(y/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+A.toFixed(3)+` s
      Estimated load time for the next fragment: `+U.toFixed(3)+` s
      Time to underbuffer: `+I.toFixed(3)+" s"),d.nextLoadLevel=P,v&&this.bwEstimator.sample(C,x.loaded),this.clearTimer(),(n.loader||n.keyLoader)&&(this.fragCurrent=this.partCurrent=null,n.abortRequests()),d.trigger(g.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,part:a,stats:x}))}}}}},l.onFragLoaded=function(n,C){var d,p,m,x,b=C.frag,C=C.part;b.type===E.PlaylistLevelType.MAIN&&(0,f.isFiniteNumber)(b.sn)&&(d=(C||b).stats,m=(C||b).duration,this.clearTimer(),this.lastLoadedFragLevel=b.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate&&(p=((x=this.hls.levels[b.level]).loaded?x.loaded.bytes:0)+d.loaded,m=(x.loaded?x.loaded.duration:0)+m,x.loaded={bytes:p,duration:m},x.realBitrate=Math.round(8*p/m)),b.bitrateTest)&&(x={stats:d,frag:b,part:C,id:b.type},this.onFragBuffered(g.Events.FRAG_BUFFERED,x))},l.onFragBuffered=function(n,m){var d,p=m.frag,m=m.part,m=(m||p).stats;m.aborted||p.type!==E.PlaylistLevelType.MAIN||p.sn==="initSegment"||(d=m.parsing.end-m.loading.start,this.bwEstimator.sample(d,m.loaded),m.bwEstimate=this.bwEstimator.getEstimate(),p.bitrateTest?this.bitrateTestDelay=d/1e3:this.bitrateTestDelay=0)},l.onError=function(n,a){var d;if(((d=a.frag)==null?void 0:d.type)===E.PlaylistLevelType.MAIN)if(a.type===T.ErrorTypes.KEY_SYSTEM_ERROR)this.clearTimer();else switch(a.details){case T.ErrorDetails.FRAG_LOAD_ERROR:case T.ErrorDetails.FRAG_LOAD_TIMEOUT:case T.ErrorDetails.KEY_LOAD_ERROR:case T.ErrorDetails.KEY_LOAD_TIMEOUT:this.clearTimer()}},l.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},l.getNextABRAutoLevel=function(){var b=this.fragCurrent,p=this.partCurrent,x=this.hls,n=x.maxAutoLevel,a=x.config,d=x.minAutoLevel,m=x.media,p=p?p.duration:b?b.duration:0,b=m&&m.playbackRate!==0?Math.abs(m.playbackRate):1,m=this.bwEstimator?this.bwEstimator.getEstimate():a.abrEwmaDefaultEstimate,x=x.mainForwardBufferInfo,x=(x?x.len:0)/b,b=this.findBestLevel(m,d,n,x,a.abrBandWidthFactor,a.abrBandWidthUpFactor);if(0<=b)return b;h.logger.trace((x?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var C,v=p?Math.min(p,a.maxStarvationDelay):a.maxStarvationDelay,y=a.abrBandWidthFactor,S=a.abrBandWidthUpFactor;return x||(C=this.bitrateTestDelay)&&(v=(p?Math.min(p,a.maxLoadingDelay):a.maxLoadingDelay)-C,h.logger.trace("bitrate test took "+Math.round(1e3*C)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*v)+" ms"),y=S=1),b=this.findBestLevel(m,d,n,x+v,y,S),Math.max(b,0)},l.findBestLevel=function(n,a,d,p,m,x){for(var b,C=this.fragCurrent,v=this.partCurrent,y=this.lastLoadedFragLevel,S=this.hls.levels,L=S[y],B=!(L==null||(b=L.details)==null||!b.live),A=L?.codecSet,I=v?v.duration:C?C.duration:0,U=d;a<=U;U--){var P=S[U];if(P&&(!A||P.codecSet===A)){var F,P=P.details,P=(v?P?.partTarget:P?.averagetargetduration)||I,M=S[U].maxBitrate,w=M*P/(F=U<=y?m*n:x*n);if(h.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+U+"/"+Math.round(F)+"/"+M+"/"+P+"/"+p+"/"+w),M<F&&(w==0||!(0,f.isFiniteNumber)(w)||B&&!this.bitrateTestDelay||w<p))return U}}return-1},k((l=t).prototype,[{key:"nextAutoLevel",get:function(){var n=this._nextAutoLevel,a=this.bwEstimator;return n!==-1&&!a.canEstimate()||(a=this.getNextABRAutoLevel(),n!==-1&&this.hls.levels[a].loadError)?n:n!==-1?Math.min(n,a):a},set:function(n){this._nextAutoLevel=n}}]),Object.defineProperty(l,"prototype",{writable:!1});const r=t},"./src/controller/audio-stream-controller.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>y});var f,_=o("./src/polyfills/number.ts"),g=o("./src/controller/base-stream-controller.ts"),T=o("./src/events.ts"),E=o("./src/utils/buffer-helper.ts"),h=o("./src/controller/fragment-tracker.ts"),k=o("./src/types/level.ts"),t=o("./src/types/loader.ts"),r=o("./src/loader/fragment.ts"),n=o("./src/demux/chunk-cache.ts"),a=o("./src/demux/transmuxer-interface.ts"),d=o("./src/types/transmuxer.ts"),p=o("./src/controller/fragment-finders.ts"),m=o("./src/utils/discontinuities.ts"),x=o("./src/errors.ts");function b(){return(b=Object.assign?Object.assign.bind():function(S){for(var L=1;L<arguments.length;L++){var B,A=arguments[L];for(B in A)Object.prototype.hasOwnProperty.call(A,B)&&(S[B]=A[B])}return S}).apply(this,arguments)}function C(S,L){return(C=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(B,A){return B.__proto__=A,B})(S,L)}function v(S,L,B){return(S=f.call(this,S,L,B,"[audio-stream-controller]")||this).videoBuffer=null,S.videoTrackCC=-1,S.waitingVideoCC=-1,S.audioSwitch=!1,S.trackId=-1,S.waitingData=null,S.mainDetails=null,S.bufferFlushed=!1,S.cachedTrackLoadedData=null,S._registerListeners(),S}f=g.default,l=f,(o=v).prototype=Object.create(l.prototype),C(o.prototype.constructor=o,l),(o=v.prototype).onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},o._registerListeners=function(){var S=this.hls;S.on(T.Events.MEDIA_ATTACHED,this.onMediaAttached,this),S.on(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),S.on(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),S.on(T.Events.LEVEL_LOADED,this.onLevelLoaded,this),S.on(T.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),S.on(T.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),S.on(T.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),S.on(T.Events.ERROR,this.onError,this),S.on(T.Events.BUFFER_RESET,this.onBufferReset,this),S.on(T.Events.BUFFER_CREATED,this.onBufferCreated,this),S.on(T.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),S.on(T.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),S.on(T.Events.FRAG_BUFFERED,this.onFragBuffered,this)},o._unregisterListeners=function(){var S=this.hls;S.off(T.Events.MEDIA_ATTACHED,this.onMediaAttached,this),S.off(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),S.off(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),S.off(T.Events.LEVEL_LOADED,this.onLevelLoaded,this),S.off(T.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),S.off(T.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),S.off(T.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),S.off(T.Events.ERROR,this.onError,this),S.off(T.Events.BUFFER_RESET,this.onBufferReset,this),S.off(T.Events.BUFFER_CREATED,this.onBufferCreated,this),S.off(T.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),S.off(T.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),S.off(T.Events.FRAG_BUFFERED,this.onFragBuffered,this)},o.onInitPtsFound=function(S,I){var B=I.frag,A=I.id,I=I.initPTS;A==="main"&&(A=B.cc,this.initPTS[B.cc]=I,this.log("InitPTS for cc: "+A+" found from main: "+I),this.videoTrackCC=A,this.state===g.State.WAITING_INIT_PTS)&&this.tick()},o.startLoad=function(S){var L;this.levels?(L=this.lastCurrentTime,this.stopLoad(),this.setInterval(100),(this.fragLoadError=0)<L&&S===-1?(this.log("Override startPosition with lastCurrentTime @"+L.toFixed(3)),S=L,this.state=g.State.IDLE):(this.loadedmetadata=!1,this.state=g.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=S,this.tick()):(this.startPosition=S,this.state=g.State.STOPPED)},o.doTick=function(){switch(this.state){case g.State.IDLE:this.doTickIdle();break;case g.State.WAITING_TRACK:var A=this.levels,S=this.trackId,S=A==null||(A=A[S])==null?void 0:A.details;if(S){if(this.waitForCdnTuneIn(S))break;this.state=g.State.WAITING_INIT_PTS}break;case g.State.FRAG_LOADING_WAITING_RETRY:A=performance.now(),S=this.retryDate,(!S||S<=A||(S=this.media)!=null&&S.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=g.State.IDLE);break;case g.State.WAITING_INIT_PTS:var L,B,A=this.waitingData;A?(S=A.frag,L=A.part,B=A.cache,A=A.complete,this.initPTS[S.cc]!==void 0?(this.waitingData=null,this.waitingVideoCC=-1,this.state=g.State.FRAG_LOADING,L={frag:S,part:L,payload:B.flush(),networkDetails:null},this._handleFragmentLoadProgress(L),A&&f.prototype._handleFragmentLoadComplete.call(this,L)):this.videoTrackCC!==this.waitingVideoCC?(this.log("Waiting fragment cc ("+S.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment()):(B=this.getLoadPosition(),A=E.BufferHelper.bufferInfo(this.mediaBuffer,B,this.config.maxBufferHole),(0,p.fragmentWithinToleranceTest)(A.end,this.config.maxFragLookUpTolerance,S)<0&&(this.log("Waiting fragment cc ("+S.cc+") @ "+S.start+" cancelled because another fragment at "+A.end+" is needed"),this.clearWaitingFragment()))):this.state=g.State.IDLE}this.onTickEnd()},o.clearWaitingFragment=function(){var S=this.waitingData;S&&(this.fragmentTracker.removeFragment(S.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=g.State.IDLE)},o.resetLoadingState=function(){this.clearWaitingFragment(),f.prototype.resetLoadingState.call(this)},o.onTickEnd=function(){var S=this.media;S&&S.readyState&&(this.lastCurrentTime=S.currentTime)},o.doTickIdle=function(){var S,L,B=this.hls,A=this.levels,I=this.media,U=this.trackId,P=B.config;A&&A[U]&&(I||!this.startFragRequested&&P.startFragPrefetch)&&(!(P=A[U].details)||P.live&&this.levelLastLoaded!==U||this.waitForCdnTuneIn(P)?this.state=g.State.WAITING_TRACK:(A=this.mediaBuffer||this.media,this.bufferFlushed&&A&&(this.bufferFlushed=!1,this.afterBufferFlushed(A,r.ElementaryStreamTypes.AUDIO,t.PlaylistLevelType.AUDIO)),(U=this.getFwdBufferInfo(A,t.PlaylistLevelType.AUDIO))!==null&&(!(A=this.audioSwitch)&&this._streamEnded(U,P)?(B.trigger(T.Events.BUFFER_EOS,{type:"audio"}),this.state=g.State.ENDED):(B=this.getFwdBufferInfo(this.videoBuffer||this.media,t.PlaylistLevelType.MAIN),U.len>=this.getMaxBufferLength(B?.len)&&!A||(S=P.fragments[0].start,L=U.end,A&&I&&(L=A=this.getLoadPosition(),P.PTSKnown)&&A<S&&(U.end>S||U.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),I.currentTime=S+.05),B&&L>B.end+P.targetduration)||!(B&&B.len||!U.len)||((A=this.getNextFragment(L,P))?this.loadFragment(A,P,L):this.bufferFlushed=!0)))))},o.getMaxBufferLength=function(S){var L=f.prototype.getMaxBufferLength.call(this);return S?Math.max(L,S):L},o.onMediaDetaching=function(){this.videoBuffer=null,f.prototype.onMediaDetaching.call(this)},o.onAudioTracksUpdated=function(S,L){L=L.audioTracks,this.resetTransmuxer(),this.levels=L.map(function(B){return new k.Level(B)})},o.onAudioTrackSwitching=function(S,A){var B=!!A.url,A=(this.trackId=A.id,this.fragCurrent);A&&A.abortRequests(),this.fragCurrent=null,this.clearWaitingFragment(),B?this.setInterval(100):this.resetTransmuxer(),B?(this.audioSwitch=!0,this.state=g.State.IDLE):this.state=g.State.STOPPED,this.tick()},o.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},o.onLevelLoaded=function(S,L){this.mainDetails=L.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(T.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},o.onAudioTrackLoaded=function(S,L){if(this.mainDetails!=null){var B=this.levels,A=L.details,I=L.id;if(B){this.log("Track "+I+" loaded ["+A.startSN+","+A.endSN+"],duration:"+A.totalduration);var B=B[I],U=0;if(A.live||(P=B.details)!=null&&P.live){var P=this.mainDetails;if(A.fragments[0]||(A.deltaUpdateFailed=!0),A.deltaUpdateFailed||!P)return;U=!B.details&&A.hasProgramDateTime&&P.hasProgramDateTime?((0,m.alignMediaPlaylistByPDT)(A,P),A.fragments[0].start):this.alignPlaylists(A,B.details)}B.details=A,this.levelLastLoaded=I,this.startFragRequested||!this.mainDetails&&A.live||this.setStartPosition(B.details,U),this.state!==g.State.WAITING_TRACK||this.waitForCdnTuneIn(A)||(this.state=g.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+I)}else this.cachedTrackLoadedData=L},o._handleFragmentLoadProgress=function(F){var L,B,A,I,U=F.frag,P=F.part,F=F.payload,M=this.config,w=this.trackId,R=this.levels;R?(R=R[w],console.assert(R,"Audio track is defined on fragment load progress"),L=R.details,console.assert(L,"Audio track details are defined on fragment load progress"),M=M.defaultAudioCodec||R.audioCodec||"mp4a.40.2",R=(R=this.transmuxer)||(this.transmuxer=new a.default(this.hls,t.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this))),B=this.initPTS[U.cc],A=(A=U.initSegment)==null?void 0:A.data,B!==void 0?(I=P?P.index:-1,I=new d.ChunkMetadata(U.level,U.sn,U.stats.chunkCount,F.byteLength,I,I!==-1),R.push(F,A,M,"",U,P,L.totalduration,!1,I,B)):(this.log("Unknown video PTS for cc "+U.cc+", waiting for video PTS before demuxing audio frag "+U.sn+" of ["+L.startSN+" ,"+L.endSN+"],track "+w),(this.waitingData=this.waitingData||{frag:U,part:P,cache:new n.default,complete:!1}).cache.push(new Uint8Array(F)),this.waitingVideoCC=this.videoTrackCC,this.state=g.State.WAITING_INIT_PTS)):this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+U.sn+" of level "+U.level+" will not be buffered")},o._handleFragmentLoadComplete=function(S){this.waitingData?this.waitingData.complete=!0:f.prototype._handleFragmentLoadComplete.call(this,S)},o.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},o.onBufferCreated=function(S,L){var B=L.tracks.audio;B&&(this.mediaBuffer=B.buffer||null),L.tracks.video&&(this.videoBuffer=L.tracks.video.buffer||null)},o.onFragBuffered=function(S,A){var B=A.frag,A=A.part;B.type===t.PlaylistLevelType.AUDIO?this.fragContextChanged(B)?this.warn("Fragment "+B.sn+(A?" p: "+A.index:"")+" of level "+B.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):(B.sn!=="initSegment"&&(this.fragPrevious=B,this.audioSwitch)&&(this.audioSwitch=!1,this.hls.trigger(T.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.fragBufferedComplete(B,A)):this.loadedmetadata||B.type!==t.PlaylistLevelType.MAIN||(A=this.videoBuffer||this.media)!=null&&A.buffered.length&&(this.loadedmetadata=!0)},o.onError=function(S,L){if(L.type!==x.ErrorTypes.KEY_SYSTEM_ERROR)switch(L.details){case x.ErrorDetails.FRAG_LOAD_ERROR:case x.ErrorDetails.FRAG_LOAD_TIMEOUT:case x.ErrorDetails.FRAG_PARSING_ERROR:case x.ErrorDetails.KEY_LOAD_ERROR:case x.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(t.PlaylistLevelType.AUDIO,L);break;case x.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case x.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==g.State.ERROR&&this.state!==g.State.STOPPED&&(this.state=L.fatal?g.State.ERROR:g.State.IDLE,this.warn(L.details+" while loading frag, switching to "+this.state+" state"));break;case x.ErrorDetails.BUFFER_FULL_ERROR:var B,A;L.parent!=="audio"||this.state!==g.State.PARSING&&this.state!==g.State.PARSED||(B=!0,(B=(A=this.getFwdBufferInfo(this.mediaBuffer,t.PlaylistLevelType.AUDIO))&&.5<A.len?!this.reduceMaxBufferLength(A.len):B)&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,f.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState())}else this.onFragmentOrKeyLoadError(t.PlaylistLevelType.AUDIO,L)},o.onBufferFlushed=function(S,L){L.type===r.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0,this.state===g.State.ENDED)&&(this.state=g.State.IDLE)},o._handleTransmuxComplete=function(O){var L,B,A,I,U,P,F,M,w=this.hls,R=O.remuxResult,O=O.chunkMeta,j=this.getCurrentContext(O);j?(L=j.frag,B=j.part,j=j.level.details,A=R.audio,I=R.text,U=R.id3,R=R.initSegment,!this.fragContextChanged(L)&&j&&(this.state=g.State.PARSING,this.audioSwitch&&A&&this.completeAudioSwitch(),R!=null&&R.tracks&&(this._bufferInitSegment(R.tracks,L,O),w.trigger(T.Events.FRAG_PARSING_INIT_SEGMENT,{frag:L,id:"audio",tracks:R.tracks})),A&&(R=A.startPTS,F=A.endPTS,M=A.startDTS,P=A.endDTS,B&&(B.elementaryStreams[r.ElementaryStreamTypes.AUDIO]={startPTS:R,endPTS:F,startDTS:M,endDTS:P}),L.setElementaryStreamInfo(r.ElementaryStreamTypes.AUDIO,R,F,M,P),this.bufferFragmentData(A,L,B,O)),U!=null&&(R=U.samples)!=null&&R.length&&(F=b({id:"audio",frag:L,details:j},U),w.trigger(T.Events.FRAG_PARSING_METADATA,F)),I)&&(M=b({id:"audio",frag:L,details:j},I),w.trigger(T.Events.FRAG_PARSING_USERDATA,M))):(this.warn("The loading context changed while buffering fragment "+O.sn+" of level "+O.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(O.level))},o._bufferInitSegment=function(S,L,B){var A;this.state===g.State.PARSING&&(S.video&&delete S.video,A=S.audio)&&(A.levelCodec=A.codec,A.id="audio",this.log("Init audio buffer, container:"+A.container+", codecs[parsed]=["+A.codec+"]"),this.hls.trigger(T.Events.BUFFER_CODECS,S),(S=A.initSegment)!=null&&S.byteLength&&(A={type:"audio",frag:L,part:null,chunkMeta:B,parent:L.type,data:S},this.hls.trigger(T.Events.BUFFER_APPENDING,A)),this.tick())},o.loadFragment=function(S,L,B){var A=this.fragmentTracker.getState(S);this.fragCurrent=S,!this.audioSwitch&&A!==h.FragmentState.NOT_LOADED&&A!==h.FragmentState.PARTIAL||(S.sn==="initSegment"?this._loadInitSegment(S,L):L.live&&!(0,_.isFiniteNumber)(this.initPTS[S.cc])?(this.log("Waiting for video PTS in continuity counter "+S.cc+" of live stream before loading audio fragment "+S.sn+" of level "+this.trackId),this.state=g.State.WAITING_INIT_PTS):(this.startFragRequested=!0,f.prototype.loadFragment.call(this,S,L,B)))},o.completeAudioSwitch=function(){var S=this.hls,L=this.media,B=this.trackId;L&&(this.log("Switching audio track : flushing all audio"),f.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,S.trigger(T.Events.AUDIO_TRACK_SWITCHED,{id:B})};const y=v},"./src/controller/audio-track-controller.ts":(c,T,o)=>{o.r(T),o.d(T,{default:()=>r});var f,_=o("./src/events.ts"),g=o("./src/errors.ts"),T=o("./src/controller/base-playlist-controller.ts"),E=o("./src/types/loader.ts");function h(n,a){for(var d,p=0;p<a.length;p++){var m=a[p];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(n,typeof(d=(function(x){if(typeof x!="object"||x===null)return x;var b=x[Symbol.toPrimitive];if(b===void 0)return String(x);if(b=b.call(x,"string"),typeof b!="object")return b;throw new TypeError("@@toPrimitive must return a primitive value.")})(m.key))=="symbol"?d:String(d),m)}}function k(n,a){return(k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(d,p){return d.__proto__=p,d})(n,a)}function t(n){return(n=f.call(this,n,"[audio-track-controller]")||this).tracks=[],n.groupId=null,n.tracksInGroup=[],n.trackId=-1,n.trackName="",n.selectDefaultTrack=!0,n.registerListeners(),n}f=T.default,o=f,(T=t).prototype=Object.create(o.prototype),k(T.prototype.constructor=T,o),(T=t.prototype).registerListeners=function(){var n=this.hls;n.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.on(_.Events.LEVEL_LOADING,this.onLevelLoading,this),n.on(_.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),n.on(_.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.on(_.Events.ERROR,this.onError,this)},T.unregisterListeners=function(){var n=this.hls;n.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.off(_.Events.LEVEL_LOADING,this.onLevelLoading,this),n.off(_.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),n.off(_.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.off(_.Events.ERROR,this.onError,this)},T.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,f.prototype.destroy.call(this)},T.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},T.onManifestParsed=function(n,a){this.tracks=a.audioTracks||[]},T.onAudioTrackLoaded=function(n,a){var d,p=a.id,m=a.details,x=this.tracksInGroup[p];x?(d=x.details,x.details=a.details,this.log("audioTrack "+p+" loaded ["+m.startSN+"-"+m.endSN+"]"),p===this.trackId&&(this.retryCount=0,this.playlistLoaded(p,a,d))):this.warn("Invalid audio track id "+p)},T.onLevelLoading=function(n,a){this.switchLevel(a.level)},T.onLevelSwitching=function(n,a){this.switchLevel(a.level)},T.switchLevel=function(p){var a,d,p=this.hls.levels[p];p!=null&&p.audioGroupIds&&(a=p.audioGroupIds[p.urlId],this.groupId!==a)&&(this.groupId=a,p=this.tracks.filter(function(m){return!a||m.groupId===a}),this.selectDefaultTrack&&!p.some(function(m){return m.default})&&(this.selectDefaultTrack=!1),d={audioTracks:this.tracksInGroup=p},this.log("Updating audio tracks, "+p.length+' track(s) found in "'+a+'" group-id'),this.hls.trigger(_.Events.AUDIO_TRACKS_UPDATED,d),this.selectInitialTrack())},T.onError=function(n,a){f.prototype.onError.call(this,n,a),!a.fatal&&a.context&&a.context.type===E.PlaylistContextType.AUDIO_TRACK&&a.context.id===this.trackId&&a.context.groupId===this.groupId&&this.retryLoadingOrFail(a)},T.setAudioTrack=function(n){var a,d,p,m,x,b,C=this.tracksInGroup;n<0||n>=C.length?this.warn("Invalid id passed to audio-track controller"):(this.clearTimer(),a=C[this.trackId],this.log("Now switching to audio-track index "+n),d=(C=C[n]).id,p=(p=C.groupId)===void 0?"":p,m=C.name,x=C.type,b=C.url,this.trackId=n,this.trackName=m,this.selectDefaultTrack=!1,this.hls.trigger(_.Events.AUDIO_TRACK_SWITCHING,{id:d,groupId:p,name:m,type:x,url:b}),C.details&&!C.details.live||(n=this.switchParams(C.url,a?.details),this.loadPlaylist(n)))},T.selectInitialTrack=function(){var n=this.tracksInGroup,n=(console.assert(n.length,"Initial audio track should be selected when tracks are known"),this.trackName),n=this.findTrackId(n)||this.findTrackId();n!==-1?this.setAudioTrack(n):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(_.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},T.findTrackId=function(n){for(var a=this.tracksInGroup,d=0;d<a.length;d++){var p=a[d];if((!this.selectDefaultTrack||p.default)&&(!n||n===p.name))return p.id}return-1},T.loadPlaylist=function(n){f.prototype.loadPlaylist.call(this);var a=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(a)){var d=a.id,p=a.groupId,a=a.url;if(n)try{a=n.addDirectives(a)}catch(x){this.warn("Could not construct new URL with HLS Delivery Directives: "+x)}this.log("loading audio-track playlist for id: "+d),this.clearTimer(),this.hls.trigger(_.Events.AUDIO_TRACK_LOADING,{url:a,id:d,groupId:p,deliveryDirectives:n||null})}},h((o=t).prototype,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(n){this.selectDefaultTrack=!1,this.setAudioTrack(n)}}]),Object.defineProperty(o,"prototype",{writable:!1});const r=t},"./src/controller/base-playlist-controller.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>E});var f=o("./src/types/level.ts"),_=o("./src/controller/level-helper.ts"),g=o("./src/utils/logger.ts"),T=o("./src/errors.ts"),E=((l=h.prototype).destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},l.onError=function(k,t){!t.fatal||t.type!==T.ErrorTypes.NETWORK_ERROR&&t.type!==T.ErrorTypes.KEY_SYSTEM_ERROR||this.stopLoad()},l.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},l.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.requestScheduled=-1,this.loadPlaylist()},l.stopLoad=function(){this.canLoad=!1,this.clearTimer()},l.switchParams=function(k,t){var r=t?.renditionReports;if(r)for(var n=0;n<r.length;n++){var a,d=r[n],p=void 0;try{p=new self.URL(d.URI,t.url).href}catch(m){g.logger.warn("Could not construct new URL for Rendition Report: "+m),p=d.URI||""}if(p===k.slice(-p.length))return p=parseInt(d["LAST-MSN"])||t?.lastPartSn,d=parseInt(d["LAST-PART"])||t?.lastPartIndex,this.hls.config.lowLatencyMode&&(a=Math.min(t.age-t.partTarget,t.targetduration),0<=d)&&a>t.partTarget&&(d+=1),new f.HlsUrlParameters(p,0<=d?d:void 0,f.HlsSkip.No)}},l.loadPlaylist=function(k){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())},l.shouldLoadTrack=function(k){return this.canLoad&&k&&!!k.url&&(!k.details||k.details.live)},l.playlistLoaded=function(k,t,r){var n=this,a=t.details,d=t.stats,p=self.performance.now(),m=d.loading.first?Math.max(0,p-d.loading.first):0;if(a.advancedDateTime=Date.now()-m,a.live||r!=null&&r.live){if(a.reloaded(r),r&&this.log("live playlist "+k+" "+(a.advanced?"REFRESHED "+a.lastPartSn+"-"+a.lastPartIndex:"MISSED")),r&&0<a.fragments.length&&(0,_.mergeDetails)(r,a),this.canLoad&&a.live){var x,m=void 0,b=void 0;if(a.canBlockReload&&a.endSN&&a.advanced){var C=this.hls.config.lowLatencyMode,y=a.lastPartSn,L=a.endSN,S=a.lastPartIndex,v=y===L,y=(S!==-1?(m=v?L+1:y,b=v?C?0:S:S+1):m=L+1,a.age),S=y+a.ageHeader,L=Math.min(S-a.partTarget,1.5*a.targetduration);if(0<L&&(r&&L>r.tuneInGoal?(this.warn("CDN Tune-in goal increased from: "+r.tuneInGoal+" to: "+L+" with playlist age: "+a.age),L=0):(m+=S=Math.floor(L/a.targetduration),b!==void 0&&(b+=Math.round(L%a.targetduration/a.partTarget)),this.log("CDN Tune-in age: "+a.ageHeader+"s last advanced "+y.toFixed(2)+"s goal: "+L+" skip sn "+S+" to part "+b)),a.tuneInGoal=L),x=this.getDeliveryDirectives(a,t.deliveryDirectives,m,b),C||!v)return void this.loadPlaylist(x)}else x=this.getDeliveryDirectives(a,t.deliveryDirectives,m,b);r=this.hls.mainForwardBufferInfo,y=r?r.end-r.len:0,S=1e3*(a.edge-y),L=(0,_.computeReloadInterval)(a,S),C=(a.updated?p>this.requestScheduled+L&&(this.requestScheduled=d.loading.start):this.requestScheduled=-1,m!==void 0&&a.canBlockReload?this.requestScheduled=d.loading.first+L-(1e3*a.partTarget||1e3):this.requestScheduled=(this.requestScheduled===-1?p:this.requestScheduled)+L,this.requestScheduled-p),C=Math.max(0,C),this.log("reload live playlist "+k+" in "+Math.round(C)+" ms"),this.timer=self.setTimeout(function(){return n.loadPlaylist(x)},C)}}else this.clearTimer()},l.getDeliveryDirectives=function(k,t,r,n){var a=(0,f.getSkipValue)(k,r);return t!=null&&t.skip&&k.deltaUpdateFailed&&(r=t.msn,n=t.part,a=f.HlsSkip.No),new f.HlsUrlParameters(r,n,a)},l.retryLoadingOrFail=function(k){var t,r=this,n=this.hls.config,a=this.retryCount<n.levelLoadingMaxRetry;return a?(this.requestScheduled=-1,this.retryCount++,-1<k.details.indexOf("LoadTimeOut")&&(t=k.context)!=null&&t.deliveryDirectives?(this.warn("retry playlist loading #"+this.retryCount+' after "'+k.details+'"'),this.loadPlaylist()):(t=Math.min(Math.pow(2,this.retryCount)*n.levelLoadingRetryDelay,n.levelLoadingMaxRetryTimeout),this.timer=self.setTimeout(function(){return r.loadPlaylist()},t),this.warn("retry playlist loading #"+this.retryCount+" in "+t+' ms after "'+k.details+'"'))):(this.warn('cannot recover from error "'+k.details+'"'),this.clearTimer(),k.fatal=!0),a},h);function h(k,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=g.logger.log.bind(g.logger,t+":"),this.warn=g.logger.warn.bind(g.logger,t+":"),this.hls=k}},"./src/controller/base-stream-controller.ts":(c,_,o)=>{o.r(_),o.d(_,{State:()=>S,default:()=>L});var f=o("./src/polyfills/number.ts"),_=o("./src/task-loop.ts"),g=o("./src/controller/fragment-tracker.ts"),T=o("./src/utils/buffer-helper.ts"),E=o("./src/utils/logger.ts"),h=o("./src/events.ts"),k=o("./src/errors.ts"),t=o("./src/types/transmuxer.ts"),r=o("./src/utils/mp4-tools.ts"),n=o("./src/utils/discontinuities.ts"),a=o("./src/controller/fragment-finders.ts"),d=o("./src/controller/level-helper.ts"),p=o("./src/loader/fragment-loader.ts"),m=o("./src/crypt/decrypter.ts"),x=o("./src/utils/time-ranges.ts"),b=o("./src/types/loader.ts");function C(A,I){for(var U,P=0;P<I.length;P++){var F=I[P];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(A,typeof(U=(function(M){if(typeof M!="object"||M===null)return M;var w=M[Symbol.toPrimitive];if(w===void 0)return String(M);if(w=w.call(M,"string"),typeof w!="object")return w;throw new TypeError("@@toPrimitive must return a primitive value.")})(F.key))=="symbol"?U:String(U),F)}}function v(A,I){return(v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(U,P){return U.__proto__=P,U})(A,I)}var y,S={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},L=(y=_.default,o=y,(_=B).prototype=Object.create(o.prototype),v(_.prototype.constructor=_,o),(_=B.prototype).doTick=function(){this.onTickEnd()},_.onTickEnd=function(){},_.startLoad=function(A){},_.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort();var A=this.fragCurrent;A&&(A.abortRequests(),this.fragmentTracker.removeFragment(A)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=S.STOPPED},_._streamEnded=function(A,I){return!(I.live||A.nextStart||!A.end||!this.media)&&((A=I.partList)!=null&&A.length?(A=A[A.length-1],T.BufferHelper.isBuffered(this.media,A.start+A.duration/2)):(A=I.fragments[I.fragments.length-1].type,this.fragmentTracker.isEndListAppended(A)))},_.getLevelDetails=function(){var A;return!this.levels||this.levelLastLoaded===null||(A=this.levels[this.levelLastLoaded])==null?void 0:A.details},_.onMediaAttached=function(A,I){I=this.media=this.mediaBuffer=I.media,this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),I.addEventListener("seeking",this.onvseeking),I.addEventListener("ended",this.onvended),I=this.config,this.levels&&I.autoStartLoad&&this.state===S.STOPPED&&this.startLoad(I.startPosition)},_.onMediaDetaching=function(){var A=this.media;A!=null&&A.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),A&&this.onvseeking&&this.onvended&&(A.removeEventListener("seeking",this.onvseeking),A.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},_.onMediaSeeking=function(){var A=this.config,I=this.fragCurrent,U=this.media,M=this.mediaBuffer,P=this.state,F=U?U.currentTime:0,M=T.BufferHelper.bufferInfo(M||U,F,A.maxBufferHole);this.log("media seeking to "+((0,f.isFiniteNumber)(F)?F.toFixed(3):F)+", state: "+P),this.state===S.ENDED?this.resetLoadingState():I&&(P=A.maxFragLookUpTolerance,A=I.start-P,P=I.start+I.duration+P,!M.len||P<M.start||A>M.end)&&(P=P<F,F<A||P)&&(P&&I.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),I.abortRequests()),this.resetLoadingState()),U&&(this.lastCurrentTime=F),this.loadedmetadata||M.len||(this.nextLoadPosition=this.startPosition=F),this.tickImmediate()},_.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},_.onLevelSwitching=function(A,I){this.fragLoadError=0},_.onHandlerDestroying=function(){this.stopLoad(),y.prototype.onHandlerDestroying.call(this)},_.onHandlerDestroyed=function(){this.state=S.STOPPED,this.hls.off(h.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,y.prototype.onHandlerDestroyed.call(this)},_.loadFragment=function(A,I,U){this._loadFragForPlayback(A,I,U)},_._loadFragForPlayback=function(A,I,U){var P=this;this._doFragLoad(A,I,U,function(F){P.fragContextChanged(A)?(P.warn("Fragment "+A.sn+(F.part?" p: "+F.part.index:"")+" of level "+A.level+" was dropped during download."),P.fragmentTracker.removeFragment(A)):(A.stats.chunkCount++,P._handleFragmentLoadProgress(F))}).then(function(F){var M;F&&(P.fragLoadError=0,M=P.state,P.fragContextChanged(A)?M!==S.FRAG_LOADING&&(P.fragCurrent||M!==S.PARSING)||(P.fragmentTracker.removeFragment(A),P.state=S.IDLE):("payload"in F&&(P.log("Loaded fragment "+A.sn+" of level "+A.level),P.hls.trigger(h.Events.FRAG_LOADED,F)),P._handleFragmentLoadComplete(F)))}).catch(function(F){P.state!==S.STOPPED&&P.state!==S.ERROR&&(P.warn(F),P.resetFragmentLoading(A))})},_.flushMainBuffer=function(A,I,U){U===void 0&&(U=null),A-I&&(A={startOffset:A,endOffset:I,type:U},this.fragLoadError=0,this.hls.trigger(h.Events.BUFFER_FLUSHING,A))},_._loadInitSegment=function(A,I){var U=this;this._doFragLoad(A,I).then(function(P){if(P&&!U.fragContextChanged(A)&&U.levels)return P;throw new Error("init load aborted")}).then(function(P){var F,M=U.hls,w=P.payload,R=A.decryptdata;return w&&0<w.byteLength&&R&&R.key&&R.iv&&R.method==="AES-128"?(F=self.performance.now(),U.decrypter.decrypt(new Uint8Array(w),R.key.buffer,R.iv.buffer).then(function(O){var j=self.performance.now();return M.trigger(h.Events.FRAG_DECRYPTED,{frag:A,payload:O,stats:{tstart:F,tdecrypt:j}}),P.payload=O,P})):P}).then(function(P){var F=U.fragCurrent,M=U.hls,w=U.levels;if(!w)throw new Error("init load aborted, missing levels");w=w[A.level].details,console.assert(w,"Level details are defined when init segment is loaded"),w=A.stats,U.state=S.IDLE,U.fragLoadError=0,A.data=new Uint8Array(P.payload),w.parsing.start=w.buffering.start=self.performance.now(),w.parsing.end=w.buffering.end=self.performance.now(),P.frag===F&&M.trigger(h.Events.FRAG_BUFFERED,{stats:w,frag:F,part:null,id:A.type}),U.tick()}).catch(function(P){U.state!==S.STOPPED&&U.state!==S.ERROR&&(U.warn(P),U.resetFragmentLoading(A))})},_.fragContextChanged=function(A){var I=this.fragCurrent;return!A||!I||A.level!==I.level||A.sn!==I.sn||A.urlId!==I.urlId},_.fragBufferedComplete=function(A,I){var U=this.mediaBuffer||this.media;this.log("Buffered "+A.type+" sn: "+A.sn+(I?" part: "+I.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+A.level+" (frag:["+(A.startPTS||NaN).toFixed(3)+"-"+(A.endPTS||NaN).toFixed(3)+"] > buffer:"+(U?x.default.toString(T.BufferHelper.getBuffered(U)):"(detached)")+")"),this.state=S.IDLE,U&&(!this.loadedmetadata&&A.type==b.PlaylistLevelType.MAIN&&U.buffered.length&&((I=this.fragCurrent)==null?void 0:I.sn)===((A=this.fragPrevious)==null?void 0:A.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},_.seekToStartPos=function(){},_._handleFragmentLoadComplete=function(A){var I,U,P=this.transmuxer;P&&(U=A.frag,I=A.part,A=!(A=A.partsLoaded)||A.length===0||A.some(function(F){return!F}),U=new t.ChunkMetadata(U.level,U.sn,U.stats.chunkCount+1,0,I?I.index:-1,!A),P.flush(U))},_._handleFragmentLoadProgress=function(A){},_._doFragLoad=function(A,I,U,P){var F=this;if(U===void 0&&(U=null),!this.levels)throw new Error("frag load aborted, missing levels");var M=null;if(!A.encrypted||(R=A.decryptdata)!=null&&R.key?!A.encrypted&&I.encryptedFragments.length&&this.keyLoader.loadClear(A,I.encryptedFragments):(this.log("Loading key for "+A.sn+" of ["+I.startSN+"-"+I.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+A.level),this.state=S.KEY_LOADING,this.fragCurrent=A,M=this.keyLoader.load(A).then(function(z){if(!F.fragContextChanged(z.frag))return F.hls.trigger(h.Events.KEY_LOADED,z),z}),this.hls.trigger(h.Events.KEY_LOADING,{frag:A}),this.throwIfFragContextChanged("KEY_LOADING")),U=Math.max(A.start,U||0),this.config.lowLatencyMode&&I){var w=I.partList;if(w&&P){U>A.end&&I.fragmentHint&&(A=I.fragmentHint);var R,O=this.getNextPart(w,A,U);if(-1<O)return R=w[O],this.log("Loading part sn: "+A.sn+" p: "+R.index+" cc: "+A.cc+" of playlist ["+I.startSN+"-"+I.endSN+"] parts [0-"+O+"-"+(w.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+A.level+", target: "+parseFloat(U.toFixed(3))),this.nextLoadPosition=R.start+R.duration,this.state=S.FRAG_LOADING,this.hls.trigger(h.Events.FRAG_LOADING,{frag:A,part:w[O],targetBufferTime:U}),this.throwIfFragContextChanged("FRAG_LOADING parts"),M?M.then(function(z){return!z||F.fragContextChanged(z.frag)?null:F.doFragPartsLoad(A,w,O,P)}).catch(function(z){return F.handleFragLoadError(z)}):this.doFragPartsLoad(A,w,O,P).catch(function(z){return F.handleFragLoadError(z)});if(!A.url||this.loadedEndOfParts(w,U))return Promise.resolve(null)}}this.log("Loading fragment "+A.sn+" cc: "+A.cc+" "+(I?"of ["+I.startSN+"-"+I.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+A.level+", target: "+parseFloat(U.toFixed(3))),(0,f.isFiniteNumber)(A.sn)&&!this.bitrateTest&&(this.nextLoadPosition=A.start+A.duration),this.state=S.FRAG_LOADING,this.hls.trigger(h.Events.FRAG_LOADING,{frag:A,targetBufferTime:U}),this.throwIfFragContextChanged("FRAG_LOADING");var j=this.config.progressive;return j&&M?M.then(function(z){return!z||F.fragContextChanged(z?.frag)?null:F.fragmentLoader.load(A,P)}).catch(function(z){return F.handleFragLoadError(z)}):Promise.all([this.fragmentLoader.load(A,j?P:void 0),M]).then(function(z){return z=z[0],!j&&z&&P&&P(z),z}).catch(function(z){return F.handleFragLoadError(z)})},_.throwIfFragContextChanged=function(A){if(this.fragCurrent===null)throw new Error("frag load aborted, context changed in "+A)},_.doFragPartsLoad=function(A,I,U,P){var F=this;return new Promise(function(M,w){var R=[];(function O(j){var z=I[j];F.fragmentLoader.loadPart(A,z,P).then(function($){var K=(R[z.index]=$).part,$=(F.hls.trigger(h.Events.FRAG_LOADED,$),I[j+1]);if(!$||$.fragment!==A)return M({frag:A,part:K,partsLoaded:R});O(j+1)}).catch(w)})(U)})},_.handleFragLoadError=function(A){var I;return"data"in A?(I=A.data,A.data&&I.details===k.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(I.frag,I.part):this.hls.trigger(h.Events.ERROR,I)):this.hls.trigger(h.Events.ERROR,{type:k.ErrorTypes.OTHER_ERROR,details:k.ErrorDetails.INTERNAL_EXCEPTION,err:A,fatal:!0}),null},_._handleTransmuxerFlush=function(A){var I,U,P,F=this.getCurrentContext(A);F&&this.state===S.PARSING?(I=F.frag,U=F.part,F=F.level,P=self.performance.now(),I.stats.parsing.end=P,U&&(U.stats.parsing.end=P),this.updateLevelTiming(I,U,F,A.partial)):this.fragCurrent||this.state===S.STOPPED||this.state===S.ERROR||(this.state=S.IDLE)},_.getCurrentContext=function(M){var I,U=this.levels,P=M.level,F=M.sn,M=M.part;return U&&U[P]?(U=U[P],(I=(M=-1<M?(0,d.getPartWith)(U,F,M):null)?M.fragment:(0,d.getFragmentWithSN)(U,F,this.fragCurrent))?{frag:I,part:M,level:U}:null):(this.warn("Levels object was unset while buffering fragment "+F+" of level "+P+". The current chunk will not be buffered."),null)},_.bufferFragmentData=function(A,I,U,P){var F,M,w;A&&this.state===S.PARSING&&(w=A.data1,F=A.data2,M=(M=w)&&F?(0,r.appendUint8Array)(w,F):M)&&M.length&&(w={type:A.type,frag:I,part:U,chunkMeta:P,parent:I.type,data:M},this.hls.trigger(h.Events.BUFFER_APPENDING,w),A.dropped)&&A.independent&&!U&&this.flushBufferGap(I)},_.flushBufferGap=function(A){var I,U,P=this.media;P&&(T.BufferHelper.isBuffered(P,P.currentTime)?(I=P.currentTime,P=T.BufferHelper.bufferInfo(P,I,0),U=A.duration,U=Math.min(2*this.config.maxFragLookUpTolerance,.25*U),P=Math.max(Math.min(A.start-U,P.end-U),I+U),A.start-P>U&&this.flushMainBuffer(P,A.start)):this.flushMainBuffer(0,A.start))},_.getFwdBufferInfo=function(A,I){var U=this.config,P=this.getLoadPosition();if(!(0,f.isFiniteNumber)(P))return null;var F=T.BufferHelper.bufferInfo(A,P,U.maxBufferHole);return F.len===0&&F.nextStart!==void 0&&(I=this.fragmentTracker.getBufferedFrag(P,I),I&&F.nextStart<I.end)?T.BufferHelper.bufferInfo(A,P,Math.max(F.nextStart,U.maxBufferHole)):F},_.getMaxBufferLength=function(U){var I=this.config,U=U?Math.max(8*I.maxBufferSize/U,I.maxBufferLength):I.maxBufferLength;return Math.min(U,I.maxMaxBufferLength)},_.reduceMaxBufferLength=function(U){var I=this.config,U=U||I.maxBufferLength;return I.maxMaxBufferLength>=U&&(I.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+I.maxMaxBufferLength+"s"),!0)},_.getNextFragment=function(A,I){var U=I.fragments,P=U.length;if(!P)return null;var F,M=this.config,w=U[0].start;if(I.live){var R=M.initialLiveManifestSize;if(P<R)return this.warn("Not enough fragments to start playback (have: "+P+", need: "+R+")"),null;I.PTSKnown||this.startFragRequested||this.startPosition!==-1||(F=this.getInitialLiveFragment(I,U),this.startPosition=F?this.hls.liveSyncPosition||F.start:A)}else A<=w&&(F=U[0]);return F||(P=M.lowLatencyMode?I.partEnd:I.fragmentEnd,F=this.getFragmentAtPosition(A,P,I)),this.mapToInitFragWhenRequired(F)},_.mapToInitFragWhenRequired=function(A){return A==null||!A.initSegment||A!=null&&A.initSegment.data||this.bitrateTest?A:A.initSegment},_.getNextPart=function(A,I,U){for(var P=-1,F=!1,M=!0,w=0,R=A.length;w<R;w++){var O=A[w],M=M&&!O.independent;if(-1<P&&U<O.start)break;var j=O.loaded;j?P=-1:(F||O.independent||M)&&O.fragment===I&&(P=w),F=j}return P},_.loadedEndOfParts=function(A,I){return A=A[A.length-1],A&&I>A.start&&A.loaded},_.getInitialLiveFragment=function(A,I){var U,P=this.fragPrevious,F=null;return P?(A.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+P.programDateTime),F=(0,a.findFragmentByPDT)(I,P.endProgramDateTime,this.config.maxFragLookUpTolerance)),F||((U=P.sn+1)>=A.startSN&&U<=A.endSN&&(U=I[U-A.startSN],P.cc===U.cc)&&this.log("Live playlist, switching playlist, load frag with next SN: "+(F=U).sn),F)||(F=(0,a.findFragWithCC)(I,P.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+F.sn)):(U=this.hls.liveSyncPosition)!==null&&(F=this.getFragmentAtPosition(U,this.bitrateTest?A.fragmentEnd:A.edge,A)),F},_.getFragmentAtPosition=function(A,I,U){var O=this.config,P=this.fragPrevious,F=U.fragments,M=U.endSN,w=U.fragmentHint,R=O.maxFragLookUpTolerance,O=!!(O.lowLatencyMode&&U.partList&&w);return O&&w&&!this.bitrateTest&&(F=F.concat(w),M=w.sn),(w=A<I?(0,a.findFragmentByPTS)(P,F,A,I-R<A?0:R):F[F.length-1])&&(I=w.sn-U.startSN,P=this.fragmentTracker.getState(w)===g.FragmentState.OK?w:P)&&w.sn===P.sn&&!O&&P&&w.level===P.level&&(A=F[1+I],w=w.sn<M&&this.fragmentTracker.getState(A)!==g.FragmentState.OK?(this.log("SN "+w.sn+" just loaded, load next one: "+A.sn),A):null),w},_.synchronizeToLiveEdge=function(A){var I,U,P,F,M=this.config,w=this.media;w&&(I=this.hls.liveSyncPosition,U=w.currentTime,F=A.fragments[0].start,P=A.edge,F=U>=F-M.maxFragLookUpTolerance&&U<=P,I!==null)&&w.duration>I&&(U<I||!F)&&(M=M.liveMaxLatencyDuration!==void 0?M.liveMaxLatencyDuration:M.liveMaxLatencyDurationCount*A.targetduration,!F&&w.readyState<4||U<P-M)&&(this.loadedmetadata||(this.nextLoadPosition=I),w.readyState)&&(this.warn("Playback: "+U.toFixed(3)+" is located too far from the end of live sliding playlist: "+P+", reset currentTime to : "+I.toFixed(3)),w.currentTime=I)},_.alignPlaylists=function(A,I){var U,P,F,w=this.levels,R=this.levelLastLoaded,M=this.fragPrevious,w=R!==null?w[R]:null,R=A.fragments.length;return R?(U=A.fragments[0].start,F=!I,P=A.alignedSliding&&(0,f.isFiniteNumber)(U),F||!P&&!U?((0,n.alignStream)(M,w,A),F=A.fragments[0].start,this.log("Live playlist sliding: "+F.toFixed(2)+" start-sn: "+(I?I.startSN:"na")+"->"+A.startSN+" prev-sn: "+(M?M.sn:"na")+" fragments: "+R),F):U):(this.warn("No fragments in live playlist"),0)},_.waitForCdnTuneIn=function(A){return A.live&&A.canBlockReload&&A.partTarget&&A.tuneInGoal>Math.max(A.partHoldBack,3*A.partTarget)},_.setStartPosition=function(A,I){var U,P=this.startPosition;(P=P<I?-1:P)!==-1&&this.lastCurrentTime!==-1||(U=A.startTimeOffset,(0,f.isFiniteNumber)(U)?(P=I+U,U<0&&(P+=A.totalduration),P=Math.min(Math.max(I,P),I+A.totalduration),this.log("Start time offset "+U+" found in playlist, adjust startPosition to "+P),this.startPosition=P):A.live?P=this.hls.liveSyncPosition||I:this.startPosition=P=0,this.lastCurrentTime=P),this.nextLoadPosition=P},_.getLoadPosition=function(){var A=this.media,I=0;return this.loadedmetadata&&A?I=A.currentTime:this.nextLoadPosition&&(I=this.nextLoadPosition),I},_.handleFragLoadAborted=function(A,I){this.transmuxer&&A.sn!=="initSegment"&&A.stats.aborted&&(this.warn("Fragment "+A.sn+(I?" part"+I.index:"")+" of level "+A.level+" was aborted"),this.resetFragmentLoading(A))},_.resetFragmentLoading=function(A){this.fragCurrent&&(this.fragContextChanged(A)||this.state===S.FRAG_LOADING_WAITING_RETRY)||(this.state=S.IDLE)},_.onFragmentOrKeyLoadError=function(A,I){var U,P,F;I.fatal?(this.stopLoad(),this.state=S.ERROR):(U=this.config,I.chunkMeta&&(P=this.getCurrentContext(I.chunkMeta))&&(I.frag=P.frag,I.levelRetry=!0,this.fragLoadError=U.fragLoadingMaxRetry),(P=I.frag)&&P.type===A&&(F=this.fragCurrent,console.assert(F&&P.sn===F.sn&&P.level===F.level&&P.urlId===F.urlId,"Frag load error must match current frag to retry"),this.fragLoadError+1<=U.fragLoadingMaxRetry?(this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),F=Math.min(Math.pow(2,this.fragLoadError)*U.fragLoadingRetryDelay,U.fragLoadingMaxRetryTimeout),this.warn("Fragment "+P.sn+" of "+A+" "+P.level+" failed to load, retrying in "+F+"ms"),this.retryDate=self.performance.now()+F,this.fragLoadError++,this.state=S.FRAG_LOADING_WAITING_RETRY):I.levelRetry?(A===b.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=S.IDLE):(E.logger.error(I.details+" reaches max retry, redispatch as fatal ..."),I.fatal=!0,this.hls.stopLoad(),this.state=S.ERROR)))},_.afterBufferFlushed=function(A,I,U){A&&(A=T.BufferHelper.getBuffered(A),this.fragmentTracker.detectEvictedFragments(I,A,U),this.state===S.ENDED)&&this.resetLoadingState()},_.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=S.IDLE},_.resetStartWhenNotLoaded=function(A){this.loadedmetadata||(this.startFragRequested=!1,(A=this.levels?this.levels[A].details:null)!=null&&A.live?(this.startPosition=-1,this.setStartPosition(A,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition)},_.updateLevelTiming=function(A,I,U,P){var F=this,M=U.details;console.assert(!!M,"level.details must be defined"),Object.keys(A.elementaryStreams).reduce(function(w,R){var O,j=A.elementaryStreams[R];return j?(O=j.endPTS-j.startPTS)<=0?(F.warn("Could not parse fragment "+A.sn+" "+R+" duration reliably ("+O+")"),w||!1):(O=P?0:(0,d.updateFragPTSDTS)(M,A,j.startPTS,j.endPTS,j.startDTS,j.endDTS),F.hls.trigger(h.Events.LEVEL_PTS_UPDATED,{details:M,level:U,drift:O,type:R,frag:A,start:j.startPTS,end:j.endPTS}),!0):w},!1)||(this.warn("Found no media in fragment "+A.sn+" of level "+U.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=S.PARSED,this.hls.trigger(h.Events.FRAG_PARSED,{frag:A,part:I})},_.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},C((o=B).prototype,[{key:"state",get:function(){return this._state},set:function(A){var I=this._state;I!==A&&(this._state=A,this.log(I+"->"+A))}}]),Object.defineProperty(o,"prototype",{writable:!1}),B);function B(A,I,U,P){var F;return(F=y.call(this)||this).hls=void 0,F.fragPrevious=null,F.fragCurrent=null,F.fragmentTracker=void 0,F.transmuxer=null,F._state=S.STOPPED,F.media=null,F.mediaBuffer=null,F.config=void 0,F.bitrateTest=!1,F.lastCurrentTime=0,F.nextLoadPosition=0,F.startPosition=0,F.loadedmetadata=!1,F.fragLoadError=0,F.retryDate=0,F.levels=null,F.fragmentLoader=void 0,F.keyLoader=void 0,F.levelLastLoaded=null,F.startFragRequested=!1,F.decrypter=void 0,F.initPTS=[],F.onvseeking=null,F.onvended=null,F.logPrefix="",F.log=void 0,F.warn=void 0,F.logPrefix=P,F.log=E.logger.log.bind(E.logger,P+":"),F.warn=E.logger.warn.bind(E.logger,P+":"),F.hls=A,F.fragmentLoader=new p.default(A.config),F.keyLoader=U,F.fragmentTracker=I,F.config=A.config,F.decrypter=new m.default(A.config),A.on(h.Events.LEVEL_SWITCHING,F.onLevelSwitching,(function(M){if(M===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return M})(F)),F}},"./src/controller/buffer-controller.ts":(c,h,o)=>{o.r(h),o.d(h,{default:()=>a});var f=o("./src/polyfills/number.ts"),_=o("./src/events.ts"),g=o("./src/utils/logger.ts"),T=o("./src/errors.ts"),E=o("./src/utils/buffer-helper.ts"),h=o("./src/utils/mediasource-helper.ts"),k=o("./src/loader/fragment.ts"),t=o("./src/controller/buffer-operation-queue.ts"),r=(0,h.getMediaSource)(),n=/([ha]vc.)(?:\.[^.,]+)+/,a=((o=d.prototype).hasSourceTypes=function(){return 0<this.getSourceBufferTypes().length||0<Object.keys(this.pendingTracks).length},o.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null},o.registerListeners=function(){var p=this.hls;p.on(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),p.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),p.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),p.on(_.Events.BUFFER_RESET,this.onBufferReset,this),p.on(_.Events.BUFFER_APPENDING,this.onBufferAppending,this),p.on(_.Events.BUFFER_CODECS,this.onBufferCodecs,this),p.on(_.Events.BUFFER_EOS,this.onBufferEos,this),p.on(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),p.on(_.Events.LEVEL_UPDATED,this.onLevelUpdated,this),p.on(_.Events.FRAG_PARSED,this.onFragParsed,this),p.on(_.Events.FRAG_CHANGED,this.onFragChanged,this)},o.unregisterListeners=function(){var p=this.hls;p.off(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),p.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),p.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),p.off(_.Events.BUFFER_RESET,this.onBufferReset,this),p.off(_.Events.BUFFER_APPENDING,this.onBufferAppending,this),p.off(_.Events.BUFFER_CODECS,this.onBufferCodecs,this),p.off(_.Events.BUFFER_EOS,this.onBufferEos,this),p.off(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),p.off(_.Events.LEVEL_UPDATED,this.onLevelUpdated,this),p.off(_.Events.FRAG_PARSED,this.onFragParsed,this),p.off(_.Events.FRAG_CHANGED,this.onFragChanged,this)},o._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new t.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null},o.onManifestParsed=function(p,m){var x=2;(!m.audio||m.video)&&m.altAudio||(x=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=x,this.details=null,g.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},o.onMediaAttaching=function(p,b){var x,b=this.media=b.media;b&&r&&((x=this.mediaSource=new r).addEventListener("sourceopen",this._onMediaSourceOpen),x.addEventListener("sourceended",this._onMediaSourceEnded),x.addEventListener("sourceclose",this._onMediaSourceClose),b.src=self.URL.createObjectURL(x),this._objectUrl=b.src)},o.onMediaDetaching=function(){var p=this.media,m=this.mediaSource,x=this._objectUrl;if(m){if(g.logger.log("[buffer-controller]: media source detaching"),m.readyState==="open")try{m.endOfStream()}catch(b){g.logger.warn("[buffer-controller]: onMediaDetaching: "+b.message+" while calling endOfStream")}this.onBufferReset(),m.removeEventListener("sourceopen",this._onMediaSourceOpen),m.removeEventListener("sourceended",this._onMediaSourceEnded),m.removeEventListener("sourceclose",this._onMediaSourceClose),p&&(x&&self.URL.revokeObjectURL(x),p.src===x?(p.removeAttribute("src"),p.load()):g.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(_.Events.MEDIA_DETACHED,void 0)},o.onBufferReset=function(){var p=this;this.getSourceBufferTypes().forEach(function(m){var x=p.sourceBuffer[m];try{x&&(p.removeBufferListeners(m),p.mediaSource&&p.mediaSource.removeSourceBuffer(x),p.sourceBuffer[m]=void 0)}catch(b){g.logger.warn("[buffer-controller]: Failed to reset the "+m+" buffer",b)}}),this._initSourceBuffer()},o.onBufferCodecs=function(p,m){var x=this,b=this.getSourceBufferTypes().length;Object.keys(m).forEach(function(C){var v,y,S,L,B,A,I,U;b?(v=x.tracks[C])&&typeof v.buffer.changeType=="function"&&(y=(A=m[C]).id,S=A.codec,L=A.levelCodec,B=A.container,A=A.metadata,(I=(v.levelCodec||v.codec).replace(n,"$1"))!==(U=(L||S).replace(n,"$1")))&&(x.appendChangeType(C,B+";codecs="+(L||S)),g.logger.log("[buffer-controller]: switching codec "+I+" to "+U),x.tracks[C]={buffer:v.buffer,codec:S,container:B,levelCodec:L,metadata:A,id:y}):x.pendingTracks[C]=m[C]}),b||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},o.appendChangeType=function(p,m){var x=this,b=this.operationQueue;b.append({execute:function(){var C=x.sourceBuffer[p];C&&(g.logger.log("[buffer-controller]: changing "+p+" sourceBuffer type to "+m),C.changeType(m)),b.shiftAndExecuteNext(p)},onStart:function(){},onComplete:function(){},onError:function(C){g.logger.warn("[buffer-controller]: Failed to change "+p+" SourceBuffer type",C)}},p)},o.onBufferAppending=function(p,F){var x=this,b=this.hls,C=this.operationQueue,v=this.tracks,y=F.data,S=F.type,L=F.frag,B=F.part,A=F.chunkMeta,I=A.buffering[S],F=self.performance.now(),U=(I.start=F,L.stats.buffering),P=B?B.stats.buffering:null,F=(U.start===0&&(U.start=F),P&&P.start===0&&(P.start=F),v.audio),M=!1,w=(S==="audio"&&F?.container==="audio/mpeg"&&(M=!this.lastMpegAudioChunk||A.id===1||this.lastMpegAudioChunk.sn!==A.sn,this.lastMpegAudioChunk=A),L.start);C.append({execute:function(){var R,O;I.executeStart=self.performance.now(),M&&(R=x.sourceBuffer[S])&&(O=w-R.timestampOffset,.1<=Math.abs(O))&&(g.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+w+" (delta: "+O+") sn: "+L.sn+")"),R.timestampOffset=w),x.appendExecutor(y,S)},onStart:function(){},onComplete:function(){var R,O=self.performance.now(),j=(I.executeEnd=I.end=O,U.first===0&&(U.first=O),P&&P.first===0&&(P.first=O),x.sourceBuffer),z={};for(R in j)z[R]=E.BufferHelper.getBuffered(j[R]);x.appendError=0,x.hls.trigger(_.Events.BUFFER_APPENDED,{type:S,frag:L,part:B,chunkMeta:A,parent:L.type,timeRanges:z})},onError:function(R){g.logger.error("[buffer-controller]: Error encountered while trying to append to the "+S+" SourceBuffer",R);var O={type:T.ErrorTypes.MEDIA_ERROR,parent:L.type,details:T.ErrorDetails.BUFFER_APPEND_ERROR,err:R,fatal:!1};R.code===DOMException.QUOTA_EXCEEDED_ERR?O.details=T.ErrorDetails.BUFFER_FULL_ERROR:(x.appendError++,O.details=T.ErrorDetails.BUFFER_APPEND_ERROR,x.appendError>b.config.appendErrorMaxRetry&&(g.logger.error("[buffer-controller]: Failed "+b.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),O.fatal=!0,b.stopLoad())),b.trigger(_.Events.ERROR,O)}},S)},o.onBufferFlushing=function(p,m){function x(v){return{execute:b.removeExecutor.bind(b,v,m.startOffset,m.endOffset),onStart:function(){},onComplete:function(){b.hls.trigger(_.Events.BUFFER_FLUSHED,{type:v})},onError:function(y){g.logger.warn("[buffer-controller]: Failed to remove from "+v+" SourceBuffer",y)}}}var b=this,C=this.operationQueue;m.type?C.append(x(m.type),m.type):this.getSourceBufferTypes().forEach(function(v){C.append(x(v),v)})},o.onFragParsed=function(p,v){var x=this,b=v.frag,C=v.part,v=[],y=(C||b).elementaryStreams;y[k.ElementaryStreamTypes.AUDIOVIDEO]?v.push("audiovideo"):(y[k.ElementaryStreamTypes.AUDIO]&&v.push("audio"),y[k.ElementaryStreamTypes.VIDEO]&&v.push("video")),v.length===0&&g.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+b.type+" level: "+b.level+" sn: "+b.sn),this.blockBuffers(function(){var S=self.performance.now(),S=(b.stats.buffering.end=S,C&&(C.stats.buffering.end=S),(C||b).stats);x.hls.trigger(_.Events.FRAG_BUFFERED,{frag:b,part:C,stats:S,id:b.type})},v)},o.onFragChanged=function(p,m){this.flushBackBuffer()},o.onBufferEos=function(p,m){var x=this;this.getSourceBufferTypes().reduce(function(b,C){var v=x.sourceBuffer[C];return!v||m.type&&m.type!==C||(v.ending=!0,v.ended)||(v.ended=!0,g.logger.log("[buffer-controller]: "+C+" sourceBuffer now EOS")),b&&!(v&&!v.ended)},!0)&&(g.logger.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(function(){x.getSourceBufferTypes().forEach(function(C){C=x.sourceBuffer[C],C&&(C.ending=!1)});var b=x.mediaSource;b&&b.readyState==="open"?(g.logger.log("[buffer-controller]: Calling mediaSource.endOfStream()"),b.endOfStream()):b&&g.logger.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: "+b.readyState)}))},o.onLevelUpdated=function(p,m){m=m.details,m.fragments.length&&(this.details=m,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},o.flushBackBuffer=function(){var p,m,x,b,C,v=this.hls,y=this.details,S=this.media,L=this.sourceBuffer;S&&y!==null&&(p=this.getSourceBufferTypes()).length&&(m=y.live&&v.config.liveBackBufferLength!==null?v.config.liveBackBufferLength:v.config.backBufferLength,!(0,f.isFiniteNumber)(m)||m<0||(x=S.currentTime,b=y.levelTargetDuration,S=Math.max(m,b),C=Math.floor(x/b)*b-S,p.forEach(function(B){var A=L[B];if(A){var I=E.BufferHelper.getBuffered(A);if(0<I.length&&C>I.start(0)){if(v.trigger(_.Events.BACK_BUFFER_REACHED,{bufferEnd:C}),y.live)v.trigger(_.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:C});else if(A.ended&&I.end(I.length-1)-x<2*b)return void g.logger.info("[buffer-controller]: Cannot flush "+B+" back buffer while SourceBuffer is in ended state");v.trigger(_.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:C,type:B})}}})))},o.updateMediaElementDuration=function(){var p,m,x,b,C,v;this.details&&this.media&&this.mediaSource&&this.mediaSource.readyState==="open"&&(p=this.details,m=this.hls,C=this.media,x=this.mediaSource,b=p.fragments[0].start+p.totalduration,C=C.duration,v=(0,f.isFiniteNumber)(x.duration)?x.duration:0,p.live&&m.config.liveDurationInfinity?(g.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),x.duration=1/0,this.updateSeekableRange(p)):(v<b&&C<b||!(0,f.isFiniteNumber)(C))&&(g.logger.log("[buffer-controller]: Updating Media Source duration to "+b.toFixed(3)),x.duration=b))},o.updateSeekableRange=function(p){var m=this.mediaSource,x=p.fragments;x.length&&p.live&&m!=null&&m.setLiveSeekableRange&&(x=Math.max(0,x[0].start),p=Math.max(x,x+p.totalduration),m.setLiveSeekableRange(x,p))},o.checkPendingTracks=function(){var p=this.bufferCodecEventsExpected,m=this.operationQueue,x=this.pendingTracks,b=Object.keys(x).length;(b&&!p||b===2)&&(this.createSourceBuffers(x),this.pendingTracks={},(p=this.getSourceBufferTypes()).length===0?this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"}):p.forEach(function(C){m.executeNext(C)}))},o.createSourceBuffers=function(p){var m=this.sourceBuffer,x=this.mediaSource;if(!x)throw Error("createSourceBuffers called when mediaSource was null");var b,C=0;for(b in p)if(!m[b]){var v=p[b];if(!v)throw Error("source buffer exists for track "+b+", however track does not");var y=v.levelCodec||v.codec,S=v.container+";codecs="+y;g.logger.log("[buffer-controller]: creating sourceBuffer("+S+")");try{var L=m[b]=x.addSourceBuffer(S),B=b;this.addBufferListener(B,"updatestart",this._onSBUpdateStart),this.addBufferListener(B,"updateend",this._onSBUpdateEnd),this.addBufferListener(B,"error",this._onSBUpdateError),this.tracks[b]={buffer:L,codec:y,container:v.container,levelCodec:v.levelCodec,metadata:v.metadata,id:v.id},C++}catch(A){g.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+A.message),this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:A,mimeType:S})}}C&&this.hls.trigger(_.Events.BUFFER_CREATED,{tracks:this.tracks})},o._onSBUpdateStart=function(p){this.operationQueue.current(p).onStart()},o._onSBUpdateEnd=function(p){var m=this.operationQueue;m.current(p).onComplete(),m.shiftAndExecuteNext(p)},o._onSBUpdateError=function(p,m){g.logger.error("[buffer-controller]: "+p+" SourceBuffer error",m),this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1}),p=this.operationQueue.current(p),p&&p.onError(m)},o.removeExecutor=function(p,m,x){var b=this.media,C=this.mediaSource,v=this.operationQueue,y=this.sourceBuffer[p];b&&C&&y?(b=(0,f.isFiniteNumber)(b.duration)?b.duration:1/0,C=(0,f.isFiniteNumber)(C.duration)?C.duration:1/0,(m=Math.max(0,m))<(x=Math.min(x,b,C))&&!y.ending?(y.ended=!1,g.logger.log("[buffer-controller]: Removing ["+m+","+x+"] from the "+p+" SourceBuffer"),console.assert(!y.updating,p+" sourceBuffer must not be updating"),y.remove(m,x)):v.shiftAndExecuteNext(p)):(g.logger.warn("[buffer-controller]: Attempting to remove from the "+p+" SourceBuffer, but it does not exist"),v.shiftAndExecuteNext(p))},o.appendExecutor=function(p,m){var x=this.operationQueue,b=this.sourceBuffer[m];b?(b.ended=!1,console.assert(!b.updating,m+" sourceBuffer must not be updating"),b.appendBuffer(p)):(g.logger.warn("[buffer-controller]: Attempting to append to the "+m+" SourceBuffer, but it does not exist"),x.shiftAndExecuteNext(m))},o.blockBuffers=function(p,m){var x,b,C=this;(m=m===void 0?this.getSourceBufferTypes():m).length?(x=this.operationQueue,b=m.map(function(v){return x.appendBlocker(v)}),Promise.all(b).then(function(){p(),m.forEach(function(v){var y=C.sourceBuffer[v];y&&y.updating||x.shiftAndExecuteNext(v)})})):(g.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(p))},o.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},o.addBufferListener=function(p,m,x){var b=this.sourceBuffer[p];b&&(x=x.bind(this,p),this.listeners[p].push({event:m,listener:x}),b.addEventListener(m,x))},o.removeBufferListeners=function(p){var m=this.sourceBuffer[p];m&&this.listeners[p].forEach(function(x){m.removeEventListener(x.event,x.listener)})},d);function d(p){var m=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var x=m.hls,b=m.media,C=m.mediaSource;g.logger.log("[buffer-controller]: Media source opened"),b&&(m.updateMediaElementDuration(),x.trigger(_.Events.MEDIA_ATTACHED,{media:b})),C&&C.removeEventListener("sourceopen",m._onMediaSourceOpen),m.checkPendingTracks()},this._onMediaSourceClose=function(){g.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){g.logger.log("[buffer-controller]: Media source ended")},this.hls=p,this._initSourceBuffer(),this.registerListeners()}},"./src/controller/buffer-operation-queue.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>_});var f=o("./src/utils/logger.ts"),_=((l=g.prototype).append=function(T,E){var h=this.queues[E];h.push(T),h.length===1&&this.buffers[E]&&this.executeNext(E)},l.insertAbort=function(T,E){this.queues[E].unshift(T),this.executeNext(E)},l.appendBlocker=function(T){var E,h=new Promise(function(t){E=t}),k={execute:E,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(k,T),h},l.executeNext=function(T){var E=this.buffers,k=this.queues,h=E[T],k=k[T];if(k.length){var t=k[0];try{t.execute()}catch(r){f.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),t.onError(r),h&&h.updating||(k.shift(),this.executeNext(T))}}},l.shiftAndExecuteNext=function(T){this.queues[T].shift(),this.executeNext(T)},l.current=function(T){return this.queues[T][0]},g);function g(T){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=T}},"./src/controller/cap-level-controller.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>T});var f=o("./src/events.ts");function _(E,h){for(var k,t=0;t<h.length;t++){var r=h[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(E,typeof(k=(function(n){if(typeof n!="object"||n===null)return n;var a=n[Symbol.toPrimitive];if(a===void 0)return String(n);if(a=a.call(n,"string"),typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")})(r.key))=="symbol"?k:String(k),r)}}function g(E){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=E,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}(l=g.prototype).setStreamController=function(E){this.streamController=E},l.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},l.registerListeners=function(){var E=this.hls;E.on(f.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),E.on(f.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),E.on(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),E.on(f.Events.BUFFER_CODECS,this.onBufferCodecs,this),E.on(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},l.unregisterListener=function(){var E=this.hls;E.off(f.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),E.off(f.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),E.off(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),E.off(f.Events.BUFFER_CODECS,this.onBufferCodecs,this),E.off(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},l.onFpsDropLevelCapping=function(E,h){g.isLevelAllowed(h.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(h.droppedLevel)},l.onMediaAttaching=function(E,h){this.media=h.media instanceof HTMLVideoElement?h.media:null,this.clientRect=null},l.onManifestParsed=function(E,h){var k=this.hls;this.restrictedLevels=[],this.firstLevel=h.firstLevel,k.config.capLevelToPlayerSize&&h.video&&this.startCapping()},l.onBufferCodecs=function(E,h){this.hls.config.capLevelToPlayerSize&&h.video&&this.startCapping()},l.onMediaDetaching=function(){this.stopCapping()},l.detectPlayerSize=function(){var E,h;this.media&&0<this.mediaHeight&&0<this.mediaWidth&&(E=this.hls.levels).length&&((h=this.hls).autoLevelCapping=this.getMaxLevel(E.length-1),h.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=h.autoLevelCapping)},l.getMaxLevel=function(E){var h=this,k=this.hls.levels;return k.length?(k=k.filter(function(t,r){return g.isLevelAllowed(r,h.restrictedLevels)&&r<=E}),this.clientRect=null,g.getMaxLevelByMediaSize(k,this.mediaWidth,this.mediaHeight)):-1},l.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},l.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},l.getDimensions=function(){var E,h,k;return this.clientRect||(h={width:0,height:0},(E=this.media)&&(k=E.getBoundingClientRect(),h.width=k.width,h.height=k.height,h.width||h.height||(h.width=k.right-k.left||E.width||0,h.height=k.bottom-k.top||E.height||0)),this.clientRect=h)},g.isLevelAllowed=function(E,h){return(h=h===void 0?[]:h).indexOf(E)===-1},g.getMaxLevelByMediaSize=function(E,h,k){if(!E||!E.length)return-1;for(var t,r=E.length-1,n=0;n<E.length;n+=1){var a=E[n];if((a.width>=h||a.height>=k)&&(!(t=E[n+1])||a.width!==t.width||a.height!==t.height)){r=n;break}}return r},_((l=g).prototype,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var E=1;if(!this.hls.config.ignoreDevicePixelRatio)try{E=self.devicePixelRatio}catch{}return E}}]),Object.defineProperty(l,"prototype",{writable:!1});const T=g},"./src/controller/cmcd-controller.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>n});var f=o("./src/events.ts"),_=o("./src/types/cmcd.ts"),g=o("./src/utils/buffer-helper.ts"),T=o("./src/utils/logger.ts");function E(d,p){for(var m,x=0;x<p.length;x++){var b=p[x];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(d,typeof(m=(function(C){if(typeof C!="object"||C===null)return C;var v=C[Symbol.toPrimitive];if(v===void 0)return String(C);if(v=v.call(C,"string"),typeof v!="object")return v;throw new TypeError("@@toPrimitive must return a primitive value.")})(b.key))=="symbol"?m:String(m),b)}}function h(d,p,m){p&&E(d.prototype,p),Object.defineProperty(d,"prototype",{writable:!1})}function k(d,p){var m,x=typeof Symbol<"u"&&d[Symbol.iterator]||d["@@iterator"];if(x)return(x=x.call(d)).next.bind(x);if(Array.isArray(d)||(x=(function(b){var C;if(b)return typeof b=="string"?t(b,void 0):(C=(C=Object.prototype.toString.call(b).slice(8,-1))==="Object"&&b.constructor?b.constructor.name:C)==="Map"||C==="Set"?Array.from(b):C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C)?t(b,void 0):void 0})(d))||p)return x&&(d=x),m=0,function(){return m>=d.length?{done:!0}:{done:!1,value:d[m++]}};throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function t(d,p){(p==null||p>d.length)&&(p=d.length);for(var m=0,x=new Array(p);m<p;m++)x[m]=d[m];return x}function r(){return(r=Object.assign?Object.assign.bind():function(d){for(var p=1;p<arguments.length;p++){var m,x=arguments[p];for(m in x)Object.prototype.hasOwnProperty.call(x,m)&&(d[m]=x[m])}return d}).apply(this,arguments)}(l=a.prototype).registerListeners=function(){var d=this.hls;d.on(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),d.on(f.Events.MEDIA_DETACHED,this.onMediaDetached,this),d.on(f.Events.BUFFER_CREATED,this.onBufferCreated,this)},l.unregisterListeners=function(){var d=this.hls;d.off(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),d.off(f.Events.MEDIA_DETACHED,this.onMediaDetached,this),d.off(f.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},l.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},l.onMediaAttached=function(d,p){this.media=p.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},l.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},l.onBufferCreated=function(d,p){var m;this.audioBuffer=(m=p.tracks.audio)==null?void 0:m.buffer,this.videoBuffer=(m=p.tracks.video)==null?void 0:m.buffer},l.createData=function(){var d;return{v:_.CMCDVersion,sf:_.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(d=this.media)==null?void 0:d.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},l.apply=function(d,p){r(p=p===void 0?{}:p,this.createData());var m=p.ot===_.CMCDObjectType.INIT||p.ot===_.CMCDObjectType.VIDEO||p.ot===_.CMCDObjectType.MUXED;this.starved&&m&&(p.bs=!0,p.su=!0,this.starved=!1),p.su==null&&(p.su=this.buffering),this.useHeaders?(m=a.toHeaders(p),Object.keys(m).length&&(d.headers||(d.headers={}),r(d.headers,m))):(m=a.toQuery(p))&&(d.url=a.appendQueryToUri(d.url,m))},l.getObjectType=function(d){var p=d.type;return p==="subtitle"?_.CMCDObjectType.TIMED_TEXT:d.sn==="initSegment"?_.CMCDObjectType.INIT:p==="audio"?_.CMCDObjectType.AUDIO:p==="main"?this.hls.audioTracks.length?_.CMCDObjectType.VIDEO:_.CMCDObjectType.MUXED:void 0},l.getTopBandwidth=function(d){for(var p=0,m=this.hls,x=k(d===_.CMCDObjectType.AUDIO?m.audioTracks:(d=-1<(d=m.maxAutoLevel)?d+1:m.levels.length,m.levels.slice(0,d)));!(b=x()).done;){var b=b.value;b.bitrate>p&&(p=b.bitrate)}return 0<p?p:NaN},l.getBufferLength=function(m){var p=this.hls.media,m=m===_.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return m&&p?1e3*g.BufferHelper.bufferInfo(m,p.currentTime,this.config.maxBufferHole).len:NaN},l.createPlaylistLoader=function(){var d=this.config.pLoader,p=this.applyPlaylistData,m=d||this.config.loader;return(d=x.prototype).destroy=function(){this.loader.destroy()},d.abort=function(){this.loader.abort()},d.load=function(b,C,v){p(b),this.loader.load(b,C,v)},h(x,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),x;function x(b){this.loader=void 0,this.loader=new m(b)}},l.createFragmentLoader=function(){var d=this.config.fLoader,p=this.applyFragmentData,m=d||this.config.loader;return(d=x.prototype).destroy=function(){this.loader.destroy()},d.abort=function(){this.loader.abort()},d.load=function(b,C,v){p(b),this.loader.load(b,C,v)},h(x,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),x;function x(b){this.loader=void 0,this.loader=new m(b)}},a.uuid=function(){var d=URL.createObjectURL(new Blob),p=d.toString();return URL.revokeObjectURL(d),p.slice(p.lastIndexOf("/")+1)},a.serialize=function(d){for(var p=[],m=function(B){return Math.round(B)},x=function(B){return 100*m(B/100)},b={br:m,d:m,bl:x,dl:x,mtp:x,nor:function(B){return encodeURIComponent(B)},rtp:x,tb:m},C=k(Object.keys(d||{}).sort());!(S=C()).done;){var v,y,S=S.value,L=d[S];v=L,Number.isNaN(v)||v==null||v===""||v===!1||S==="v"&&L===1||S=="pr"&&L===1||(v=typeof(L=(v=b[S])?v(L):L),y=void 0,y=S==="ot"||S==="sf"||S==="st"?S+"="+L:v=="boolean"?S:v=="number"?S+"="+L:S+"="+JSON.stringify(L),p.push(y))}return p.join(",")},a.toHeaders=function(d){for(var p={},m=["Object","Request","Session","Status"],x=[{},{},{},{}],b={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},C=0,v=Object.keys(d);C<v.length;C++){var y=v[C];x[b[y]!=null?b[y]:1][y]=d[y]}for(var S=0;S<x.length;S++){var L=a.serialize(x[S]);L&&(p["CMCD-"+m[S]]=L)}return p},a.toQuery=function(d){return"CMCD="+encodeURIComponent(a.serialize(d))},a.appendQueryToUri=function(d,p){var m;return p?(m=d.includes("?")?"&":"?",d+m+p):d};var n=a;function a(m){var p=this,m=(this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){p.initialized&&(p.starved=!0),p.buffering=!0},this.onPlaying=function(){p.initialized||(p.initialized=!0),p.buffering=!1},this.applyPlaylistData=function(b){try{p.apply(b,{ot:_.CMCDObjectType.MANIFEST,su:!p.initialized})}catch(C){T.logger.warn("Could not generate manifest CMCD data.",C)}},this.applyFragmentData=function(b){try{var C=b.frag,v=p.hls.levels[C.level],y=p.getObjectType(C),S={d:1e3*C.duration,ot:y};y!==_.CMCDObjectType.VIDEO&&y!==_.CMCDObjectType.AUDIO&&y!=_.CMCDObjectType.MUXED||(S.br=v.bitrate/1e3,S.tb=p.getTopBandwidth(y)/1e3,S.bl=p.getBufferLength(y)),p.apply(b,S)}catch(L){T.logger.warn("Could not generate segment CMCD data.",L)}},this.hls=m,this.config=m.config),x=m.cmcd;x!=null&&(m.pLoader=this.createPlaylistLoader(),m.fLoader=this.createFragmentLoader(),this.sid=x.sessionId||a.uuid(),this.cid=x.contentId,this.useHeaders=x.useHeaders===!0,this.registerListeners())}},"./src/controller/eme-controller.ts":(c,b,o)=>{o.r(b),o.d(b,{default:()=>B});var f=o("./src/events.ts"),_=o("./src/errors.ts"),g=o("./src/utils/logger.ts"),T=o("./src/utils/mediakeys-helper.ts"),E=o("./src/utils/keysystem-util.ts"),h=o("./src/utils/numeric-encoding-utils.ts"),k=o("./src/loader/level-key.ts"),t=o("./src/utils/hex.ts"),r=o("./src/utils/mp4-tools.ts"),b=o("./node_modules/eventemitter3/index.js"),n=o.n(b);function a(A){var I=typeof Map=="function"?new Map:void 0;return(a=function(U){if(U===null||Function.toString.call(U).indexOf("[native code]")===-1)return U;if(typeof U!="function")throw new TypeError("Super expression must either be null or a function");if(I!==void 0){if(I.has(U))return I.get(U);I.set(U,P)}function P(){return d(U,arguments,m(this).constructor)}return P.prototype=Object.create(U.prototype,{constructor:{value:P,enumerable:!1,writable:!0,configurable:!0}}),p(P,U)})(A)}function d(A,I,U){return(d=(function(){if(!(typeof Reflect>"u"||!Reflect.construct)&&!Reflect.construct.sham){if(typeof Proxy=="function")return 1;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),1}catch{}}})()?Reflect.construct.bind():function(P,R,M){var w=[null],R=(w.push.apply(w,R),new(Function.bind.apply(P,w)));return M&&p(R,M.prototype),R}).apply(null,arguments)}function p(A,I){return(p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(U,P){return U.__proto__=P,U})(A,I)}function m(A){return(m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(I){return I.__proto__||Object.getPrototypeOf(I)})(A)}var x="[eme]",b=((o=C.prototype).destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null},o.registerListeners=function(){this.hls.on(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(f.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(f.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},o.unregisterListeners=function(){this.hls.off(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(f.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(f.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},o.getLicenseServerUrl=function(A){var I=this.config,U=I.drmSystems,I=I.widevineLicenseUrl,U=U[A];if(U)return U.licenseUrl;if(A===T.KeySystems.WIDEVINE&&I)return I;throw new Error('no license server URL configured for key-system "'+A+'"')},o.getServerCertificateUrl=function(A){var I=this.config.drmSystems[A];if(I)return I.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+A+'"]')},o.attemptKeySystemAccess=function(A){function I(w,R,O){return!!w&&O.indexOf(w)===R}var U=this,P=this.hls.levels,F=P.map(function(w){return w.audioCodec}).filter(I),M=P.map(function(w){return w.videoCodec}).filter(I);return F.length+M.length===0&&M.push("avc1.42e01e"),new Promise(function(w,R){(function O(j){var z=j.shift();U.getMediaKeysPromise(z,F,M).then(function(G){return w({keySystem:z,mediaKeys:G})}).catch(function(G){j.length?O(j):R(G instanceof S?G:new S({type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:G,fatal:!0},G.message))})})(A)})},o.requestMediaKeySystemAccess=function(A,I){var U,P=this.config.requestMediaKeySystemAccessFunc;return typeof P!="function"?(U="Configured requestMediaKeySystemAccess is not a function "+P,T.requestMediaKeySystemAccess===null&&self.location.protocol==="http:"&&(U="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(U))):P(A,I)},o.getMediaKeysPromise=function(A,M,R){var P,F=this,M=(0,T.getSupportedMediaKeySystemConfigurations)(A,M,R,this.config.drmSystemOptions),w=this.keySystemAccessPromises[A],R=w?.keySystemAccess;return R?R.then(function(){return w.mediaKeys}):(this.log('Requesting encrypted media "'+A+'" key-system access with config: '+JSON.stringify(M)),R=this.requestMediaKeySystemAccess(A,M),P=this.keySystemAccessPromises[A]={keySystemAccess:R},R.catch(function(O){F.log('Failed to obtain access to key-system "'+A+'": '+O)}),R.then(function(O){F.log('Access for key-system "'+O.keySystem+'" obtained');var j=F.fetchServerCertificate(A);return F.log('Create media-keys for "'+A+'"'),P.mediaKeys=O.createMediaKeys().then(function(z){return F.log('Media-keys created for "'+A+'"'),j.then(function(G){return G?F.setMediaKeysServerCertificate(z,A,G):z})}),P.mediaKeys.catch(function(z){F.error('Failed to create media-keys for "'+A+'"}: '+z)}),P.mediaKeys}))},o.createMediaKeySessionContext=function(U){var F=U.decryptdata,I=U.keySystem,U=U.mediaKeys,P=(console.assert(!!U,"mediaKeys is defined"),this.log('Creating key-system session "'+I+'" keyId: '+t.default.hexDump(F.keyId||[])),U.createSession()),F={decryptdata:F,keySystem:I,mediaKeys:U,mediaKeysSession:P,keyStatus:"status-pending"};return this.mediaKeySessions.push(F),F},o.renewKeySession=function(A){var I,U,P=A.decryptdata;P.pssh?(I=this.createMediaKeySessionContext(A),U=this.getKeyIdString(P),this.keyIdToKeySessionPromise[U]=this.generateRequestWithPreferredKeySession(I,"cenc",P.pssh,"expired")):this.warn("Could not renew expired session. Missing pssh initData."),this.removeSession(A)},o.getKeyIdString=function(A){if(!A)throw new Error("Could not read keyId of undefined decryptdata");if(A.keyId===null)throw new Error("keyId is null");return t.default.hexDump(A.keyId)},o.updateKeySession=function(A,I){var U=A.mediaKeysSession;return this.log('Updating key-session "'+U.sessionId+'" for keyID '+t.default.hexDump(((A=A.decryptdata)==null?void 0:A.keyId)||[])+`
      } (data length: `+(I&&I.byteLength)+")"),U.update(I)},o.selectKeySystemFormat=function(A){var I=Object.keys(A.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+A.sn+" "+A.type+": "+A.level+") key formats "+I.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(I)),this.keyFormatPromise},o.getKeyFormatPromise=function(A){var I=this;return new Promise(function(U,P){var F=(0,T.getKeySystemsForConfig)(I.config),M=A.map(T.keySystemFormatToKeySystemDomain).filter(function(w){return!!w&&F.indexOf(w)!==-1});return I.getKeySystemSelectionPromise(M).then(function(R){var R=R.keySystem,O=(0,T.keySystemDomainToKeySystemFormat)(R);O?U(O):P(new Error('Unable to find format for key-system "'+R+'"'))}).catch(P)})},o.loadKey=function(A){var I=this,U=A.keyInfo.decryptdata,P=this.getKeyIdString(U),F="(keyId: "+P+' format: "'+U.keyFormat+'" method: '+U.method+" uri: "+U.uri+")",M=(this.log("Starting session for key "+F),this.keyIdToKeySessionPromise[P]);return M||(M=this.keyIdToKeySessionPromise[P]=this.getKeySystemForKeyPromise(U).then(function(w){var R=w.keySystem,O=w.mediaKeys;return I.throwIfDestroyed(),I.log("Handle encrypted media sn: "+A.frag.sn+" "+A.frag.type+": "+A.frag.level+" using key "+F),I.attemptSetMediaKeys(R,O).then(function(){I.throwIfDestroyed();var j=I.createMediaKeySessionContext({keySystem:R,mediaKeys:O,decryptdata:U});return I.generateRequestWithPreferredKeySession(j,"cenc",U.pssh,"playlist-key")})})).catch(function(w){return I.handleError(w)}),M},o.throwIfDestroyed=function(A){if(!this.hls)throw new Error("invalid state")},o.handleError=function(A){this.hls&&(this.error(A.message),A instanceof S?this.hls.trigger(f.Events.ERROR,A.data):this.hls.trigger(f.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_KEYS,error:A,fatal:!0}))},o.getKeySystemForKeyPromise=function(A){var I=this.getKeyIdString(A),I=this.keyIdToKeySessionPromise[I];return I||(A=(I=(0,T.keySystemFormatToKeySystemDomain)(A.keyFormat))?[I]:(0,T.getKeySystemsForConfig)(this.config),this.attemptKeySystemAccess(A))},o.getKeySystemSelectionPromise=function(A){if((A=A.length?A:(0,T.getKeySystemsForConfig)(this.config)).length===0)throw new S({type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(A)},o._onMediaEncrypted=function(A){var I,U,P=this,F=A.initDataType,M=A.initData;if(this.debug('"'+A.type+'" event: init data type: "'+F+'"'),M!==null){if(F==="sinf"&&this.config.drmSystems[T.KeySystems.FAIRPLAY]){var w=(0,r.bin2str)(new Uint8Array(M));try{var R=(0,h.base64Decode)(JSON.parse(w).sinf),O=(0,r.parseSinf)(new Uint8Array(R));if(!O)return;I=O.subarray(8,24),U=T.KeySystems.FAIRPLAY}catch{return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{if(w=(0,r.parsePssh)(M),w===null)return;w.version===0&&w.systemId===T.KeySystemIds.WIDEVINE&&w.data&&(I=w.data.subarray(8,24)),U=(0,T.keySystemIdToKeySystemDomain)(w.systemId)}if(U&&I){for(var j=t.default.hexDump(I),z=this.keyIdToKeySessionPromise,G=this.mediaKeySessions,K=z[j],$=0;$<G.length;$++){var V=(function(Z){var J,re=G[Z],Z=re.decryptdata;return Z.pssh||!Z.keyId?"continue":(J=t.default.hexDump(Z.keyId),j===J||Z.uri.replace(/-/g,"").indexOf(j)!==-1?(K=z[J],delete z[J],Z.pssh=new Uint8Array(M),Z.keyId=I,K=z[j]=K.then(function(){return P.generateRequestWithPreferredKeySession(re,F,M,"encrypted-event-key-match")}),"break"):void 0)})($);if(V!=="continue"&&V==="break")break}(K=K||(z[j]=this.getKeySystemSelectionPromise([U]).then(function(q){var J=q.keySystem,re=q.mediaKeys,Z=(P.throwIfDestroyed(),new k.LevelKey("ISO-23001-7",j,(q=(0,T.keySystemDomainToKeySystemFormat)(J))!=null?q:""));return Z.pssh=new Uint8Array(M),Z.keyId=I,P.attemptSetMediaKeys(J,re).then(function(){P.throwIfDestroyed();var W=P.createMediaKeySessionContext({decryptdata:Z,keySystem:J,mediaKeys:re});return P.generateRequestWithPreferredKeySession(W,F,M,"encrypted-event-no-match")})}))).catch(function(q){return P.handleError(q)})}}},o._onWaitingForKey=function(A){this.log('"'+A.type+'" event')},o.attemptSetMediaKeys=function(A,I){var U=this,P=this.setMediaKeysQueue.slice(),F=(this.log('Setting media-keys for "'+A+'"'),Promise.all(P).then(function(){if(U.media)return U.media.setMediaKeys(I);throw new Error("Attempted to set mediaKeys without media element attached")}));return this.setMediaKeysQueue.push(F),F.then(function(){U.log('Media-keys set for "'+A+'"'),P.push(F),U.setMediaKeysQueue=U.setMediaKeysQueue.filter(function(M){return P.indexOf(M)===-1})})},o.generateRequestWithPreferredKeySession=function(A,I,U,P){var F,M,w,R=this,O=(O=this.config.drmSystems)==null||(O=O[A.keySystem])==null?void 0:O.generateRequest;if(O)try{var j=O.call(this.hls,I,U,A);if(!j)throw new Error("Invalid response from configured generateRequest filter");I=j.initDataType,U=A.decryptdata.pssh=j.initData?new Uint8Array(j.initData):null}catch(z){if(this.warn(z.message),(O=this.hls)!=null&&O.config.debug)throw z}return U===null?(this.log('Skipping key-session request for "'+P+'" (no initData)'),Promise.resolve(A)):(F=this.getKeyIdString(A.decryptdata),this.log('Generating key-session request for "'+P+'": '+F+" (init data type: "+I+" length: "+(U?U.byteLength:null)+")"),M=new(n()),A.mediaKeysSession.onmessage=function(z){var G,K=A.mediaKeysSession;K?(G=z.messageType,z=z.message,R.log('"'+G+'" message event for session "'+K.sessionId+'" message size: '+z.byteLength),G==="license-request"||G==="license-renewal"?R.renewLicense(A,z).catch(function($){R.handleError($),M.emit("error",$)}):G==="license-release"?A.keySystem===T.KeySystems.FAIRPLAY&&(R.updateKeySession(A,(0,E.strToUtf8array)("acknowledged")),R.removeSession(A)):R.warn('unhandled media key message type "'+G+'"')):M.emit("error",new Error("invalid state"))},A.mediaKeysSession.onkeystatuseschange=function(z){var G;A.mediaKeysSession?(R.onKeyStatusChange(A),G=A.keyStatus,M.emit("keyStatus",G),G==="expired"&&(R.warn(A.keySystem+" expired for key "+F),R.renewKeySession(A))):M.emit("error",new Error("invalid state"))},w=new Promise(function(z,G){M.on("error",G),M.on("keyStatus",function(K){K.startsWith("usable")?z():K==="output-restricted"?G(new S({type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):K==="internal-error"?G(new S({type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+K+'"')):K==="expired"?G(new Error("key expired while generating request")):R.warn('unhandled key status change "'+K+'"')})}),A.mediaKeysSession.generateRequest(I,U).then(function(){var z;R.log('Request generated for key-session "'+((z=A.mediaKeysSession)==null?void 0:z.sessionId)+'" keyId: '+F)}).catch(function(z){throw new S({type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_SESSION,error:z,fatal:!1},"Error generating key-session request: "+z)}).then(function(){return w}).catch(function(z){throw M.removeAllListeners(),R.removeSession(A),z}).then(function(){return M.removeAllListeners(),A}))},o.onKeyStatusChange=function(A){var I=this;A.mediaKeysSession.keyStatuses.forEach(function(U,P){I.log('key status change "'+U+'" for keyStatuses keyId: '+t.default.hexDump("buffer"in P?new Uint8Array(P.buffer,P.byteOffset,P.byteLength):new Uint8Array(P))+" session keyId: "+t.default.hexDump(new Uint8Array(A.decryptdata.keyId||[]))+" uri: "+A.decryptdata.uri),A.keyStatus=U})},o.fetchServerCertificate=function(A){var I=this;return new Promise(function(U,P){var F=I.getServerCertificateUrl(A);if(!F)return U();I.log('Fetching serverCertificate for "'+A+'"');var M=new XMLHttpRequest;M.open("GET",F,!0),M.responseType="arraybuffer",M.onreadystatechange=function(){M.readyState===XMLHttpRequest.DONE&&(M.status===200?U(M.response):P(new S({type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:M},'"'+A+'" certificate request XHR failed ('+F+"). Status: "+M.status+" ("+M.statusText+")")))},M.send()})},o.setMediaKeysServerCertificate=function(A,I,U){var P=this;return new Promise(function(F,M){A.setServerCertificate(U).then(function(w){P.log("setServerCertificate "+(w?"success":"not supported by CDM")+" ("+U?.byteLength+') on "'+I+'"'),F(A)}).catch(function(w){M(new S({type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:w,fatal:!0},w.message))})})},o.renewLicense=function(A,I){var U=this;return this.requestLicense(A,new Uint8Array(I)).then(function(P){return U.updateKeySession(A,new Uint8Array(P)).catch(function(F){throw new S({type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:F,fatal:!0},F.message)})})},o.setupLicenseXHR=function(A,I,U,P){var F=this,M=this.config.licenseXhrSetup;return M?Promise.resolve().then(function(){if(U.decryptdata)return M.call(F.hls,A,I,U,P);throw new Error("Key removed")}).catch(function(w){if(U.decryptdata)return A.open("POST",I,!0),M.call(F.hls,A,I,U,P);throw w}).then(function(w){return A.readyState||A.open("POST",I,!0),{xhr:A,licenseChallenge:w||P}}):(A.open("POST",I,!0),Promise.resolve({xhr:A,licenseChallenge:P}))},o.requestLicense=function(A,I){var U=this;return new Promise(function(P,F){var M=U.getLicenseServerUrl(A.keySystem),w=(U.log("Sending license request to URL: "+M),new XMLHttpRequest);w.responseType="arraybuffer",w.onreadystatechange=function(){if(!U.hls||!A.mediaKeysSession)return F(new Error("invalid state"));if(w.readyState===4)if(w.status===200){U._requestLicenseFailureCount=0;var R=w.response,O=(U.log("License received "+(R instanceof ArrayBuffer?R.byteLength:R)),U.config.licenseResponseCallback);if(O)try{R=O.call(U.hls,w,M,A)}catch(j){U.error(j)}P(R)}else U._requestLicenseFailureCount++,3<U._requestLicenseFailureCount||400<=w.status&&w.status<500?F(new S({type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:w},"License Request XHR failed ("+M+"). Status: "+w.status+" ("+w.statusText+")")):(O=3-U._requestLicenseFailureCount+1,U.warn("Retrying license request, "+O+" attempts left"),U.requestLicense(A,I).then(P,F))},A.licenseXhr&&A.licenseXhr.readyState!==XMLHttpRequest.DONE&&A.licenseXhr.abort(),A.licenseXhr=w,U.setupLicenseXHR(w,M,A,I).then(function(j){var O=j.xhr,j=j.licenseChallenge;O.send(j)})})},o.onMediaAttached=function(A,I){this.config.emeEnabled&&(I=I.media,(this.media=I).addEventListener("encrypted",this.onMediaEncrypted),I.addEventListener("waitingforkey",this.onWaitingForKey))},o.onMediaDetached=function(){var A=this,I=this.media,U=this.mediaKeySessions,P=(I&&(I.removeEventListener("encrypted",this.onMediaEncrypted),I.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},k.LevelKey.clearKeyUriToKeyIdMap(),U.length);C.CDMCleanupPromise=Promise.all(U.map(function(F){return A.removeSession(F)}).concat(I?.setMediaKeys(null).catch(function(F){A.log("Could not clear media keys: "+F+". media.src: "+I?.src)}))).then(function(){P&&(A.log("finished closing key sessions and clearing media keys"),U.length=0)}).catch(function(F){A.log("Could not close sessions and clear media keys: "+F+". media.src: "+I?.src)})},o.onManifestLoaded=function(A,U){var U=U.sessionKeys;U&&this.config.emeEnabled&&!this.keyFormatPromise&&(U=U.reduce(function(P,F){return P.indexOf(F.keyFormat)===-1&&P.push(F.keyFormat),P},[]),this.log("Selecting key-system from session-keys "+U.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(U))},o.removeSession=function(A){var I=this,U=A.mediaKeysSession,P=A.licenseXhr;if(U)return this.log("Remove licenses and keys and close session "+U.sessionId),U.onmessage=null,U.onkeystatuseschange=null,P&&P.readyState!==XMLHttpRequest.DONE&&P.abort(),A.mediaKeysSession=A.decryptdata=A.licenseXhr=void 0,-1<(P=this.mediaKeySessions.indexOf(A))&&this.mediaKeySessions.splice(P,1),U.remove().catch(function(F){I.log("Could not remove session: "+F)}).then(function(){return U.close()}).catch(function(F){I.log("Could not close session: "+F)})},C);function C(A){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=C.CDMCleanupPromise?[C.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=g.logger.debug.bind(g.logger,x),this.log=g.logger.log.bind(g.logger,x),this.warn=g.logger.warn.bind(g.logger,x),this.error=g.logger.error.bind(g.logger,x),this.hls=A,this.config=A.config,this.registerListeners()}b.CDMCleanupPromise=void 0,v=a(Error),o=v,(y=L).prototype=Object.create(o.prototype),p(y.prototype.constructor=y,o);var v,y,S=L;function L(A,I){return(I=v.call(this,I)||this).data=void 0,(I.data=A).err=A.error,I}const B=b},"./src/controller/fps-controller.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>T});var f=o("./src/events.ts"),_=o("./src/utils/logger.ts");function g(E){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=E,this.registerListeners()}(l=g.prototype).setStreamController=function(E){this.streamController=E},l.registerListeners=function(){this.hls.on(f.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},l.unregisterListeners=function(){this.hls.off(f.Events.MEDIA_ATTACHING,this.onMediaAttaching)},l.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},l.onMediaAttaching=function(E,h){var k=this.hls.config;k.capLevelOnFPSDrop&&(h=h.media instanceof self.HTMLVideoElement?h.media:null,(this.media=h)&&typeof h.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),k.fpsDroppedMonitoringPeriod))},l.checkFPS=function(E,h,k){var t,r,n,a,d=performance.now();h&&(this.lastTime&&(a=d-this.lastTime,t=k-this.lastDroppedFrames,r=h-this.lastDecodedFrames,a=1e3*t/a,(n=this.hls).trigger(f.Events.FPS_DROP,{currentDropped:t,currentDecoded:r,totalDroppedFrames:k}),0<a)&&t>n.config.fpsDroppedMonitoringThreshold*r&&(a=n.currentLevel,_.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+a),0<a)&&(n.autoLevelCapping===-1||n.autoLevelCapping>=a)&&(n.trigger(f.Events.FPS_DROP_LEVEL_CAPPING,{level:--a,droppedLevel:n.currentLevel}),n.autoLevelCapping=a,this.streamController.nextLevelSwitch()),this.lastTime=d,this.lastDroppedFrames=k,this.lastDecodedFrames=h)},l.checkFPSInterval=function(){var E,h=this.media;h&&(this.isVideoPlaybackQualityAvailable?(E=h.getVideoPlaybackQuality(),this.checkFPS(h,E.totalVideoFrames,E.droppedVideoFrames)):this.checkFPS(h,h.webkitDecodedFrameCount,h.webkitDroppedFrameCount))};const T=g},"./src/controller/fragment-finders.ts":(c,l,o)=>{o.r(l),o.d(l,{findFragWithCC:()=>function(E,h){return _.default.search(E,function(k){return k.cc<h?1:k.cc>h?-1:0})},findFragmentByPDT:()=>function(E,h,k){if(h!==null&&Array.isArray(E)&&E.length&&(0,f.isFiniteNumber)(h)&&!(h<(E[0].programDateTime||0)||h>=(E[E.length-1].endProgramDateTime||0))){k=k||0;for(var t=0;t<E.length;++t){var r=E[t];if(T(h,k,r))return r}}return null},findFragmentByPTS:()=>function(E,h,k,t){k===void 0&&(k=0),t===void 0&&(t=0);var r=null;return E?r=h[E.sn-h[0].sn+1]||null:k===0&&h[0].start===0&&(r=h[0]),r&&g(k,t,r)===0||!(h=_.default.search(h,g.bind(null,k,t)))||h===E&&r?r:h},fragmentWithinToleranceTest:()=>g,pdtWithinToleranceTest:()=>T});var f=o("./src/polyfills/number.ts"),_=o("./src/utils/binary-search.ts");function g(E,h,k){return h===void 0&&(h=0),k.start<=(E=E===void 0?0:E)&&k.start+k.duration>E?0:(h=Math.min(h,k.duration+(k.deltaPTS||0)),k.start+k.duration-h<=E?1:k.start-h>E&&k.start?-1:0)}function T(E,h,k){return h=1e3*Math.min(h,k.duration+(k.deltaPTS||0)),(k.endProgramDateTime||0)-h>E}},"./src/controller/fragment-tracker.ts":(c,l,o)=>{o.r(l),o.d(l,{FragmentState:()=>f,FragmentTracker:()=>T});var f,_=o("./src/events.ts"),g=o("./src/types/loader.ts"),T=((l=f=f||{}).NOT_LOADED="NOT_LOADED",l.APPENDING="APPENDING",l.PARTIAL="PARTIAL",l.OK="OK",(o=E.prototype)._registerListeners=function(){var t=this.hls;t.on(_.Events.BUFFER_APPENDED,this.onBufferAppended,this),t.on(_.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.on(_.Events.FRAG_LOADED,this.onFragLoaded,this)},o._unregisterListeners=function(){var t=this.hls;t.off(_.Events.BUFFER_APPENDED,this.onBufferAppended,this),t.off(_.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.off(_.Events.FRAG_LOADED,this.onFragLoaded,this)},o.destroy=function(){this._unregisterListeners(),this.fragments=this.endListFragments=this.timeRanges=this.activeFragment=this.activeParts=null},o.getAppendedFrag=function(t,r){if(r===g.PlaylistLevelType.MAIN){var n=this.activeFragment,a=this.activeParts;if(!n)return null;if(a)for(var d=a.length;d--;){var p=a[d],m=p?p.end:n.appendedPTS;if(p.start<=t&&m!==void 0&&t<=m)return 9<d&&(this.activeParts=a.slice(d-9)),p}else if(n.start<=t&&n.appendedPTS!==void 0&&t<=n.appendedPTS)return n}return this.getBufferedFrag(t,r)},o.getBufferedFrag=function(t,r){for(var n=this.fragments,a=Object.keys(n),d=a.length;d--;){var p=n[a[d]];if(p?.body.type===r&&p.buffered&&(p=p.body,p.start<=t&&t<=p.end))return p}return null},o.detectEvictedFragments=function(t,r,n){var a=this;this.timeRanges&&(this.timeRanges[t]=r),Object.keys(this.fragments).forEach(function(d){var p=a.fragments[d];p&&(p.buffered||p.loaded?(d=p.range[t])&&d.time.some(function(m){return m=!a.isTimeBuffered(m.startPTS,m.endPTS,r),m&&a.removeFragment(p.body),m}):p.body.type===n&&a.removeFragment(p.body))})},o.detectPartialFragments=function(t){var r,n=this,a=this.timeRanges,d=t.frag,p=t.part;a&&d.sn!=="initSegment"&&(t=k(d),r=this.fragments[t])&&(Object.keys(a).forEach(function(m){var x,b=d.elementaryStreams[m];b&&(x=a[m],b=p!==null||b.partial===!0,r.range[m]=n.getBufferedTimes(d,p,b,x))}),r.loaded=null,Object.keys(r.range).length?(r.buffered=!0,r.body.endList&&(this.endListFragments[r.body.type]=r)):this.removeFragment(r.body))},o.fragBuffered=function(t){t=k(t),t=this.fragments[t],t&&(t.loaded=null,t.buffered=!0)},o.getBufferedTimes=function(t,r,n,a){for(var d={time:[],partial:n},p=(r||t).start,m=(r||t).end,x=t.minEndPTS||m,b=t.maxStartPTS||p,C=0;C<a.length;C++){var v=a.start(C)-this.bufferPadding,y=a.end(C)+this.bufferPadding;if(v<=b&&x<=y){d.time.push({startPTS:Math.max(p,a.start(C)),endPTS:Math.min(m,a.end(C))});break}if(p<y&&v<m)d.partial=!0,d.time.push({startPTS:Math.max(p,a.start(C)),endPTS:Math.min(m,a.end(C))});else if(m<=v)break}return d},o.getPartialFragment=function(t){var r,n,a=null,d=0,p=this.bufferPadding,m=this.fragments;return Object.keys(m).forEach(function(x){x=m[x],x&&h(x)&&(r=x.body.start-p,n=x.body.end+p,r<=t)&&t<=n&&(r=Math.min(t-r,n-t),d<=r)&&(a=x.body,d=r)}),a},o.isEndListAppended=function(t){return t=this.endListFragments[t],t!==void 0&&(t.buffered||h(t))},o.getState=function(t){return t=k(t),t=this.fragments[t],t?t.buffered?h(t)?f.PARTIAL:f.OK:f.APPENDING:f.NOT_LOADED},o.isTimeBuffered=function(t,r,n){for(var a,d,p=0;p<n.length;p++){if(a=n.start(p)-this.bufferPadding,d=n.end(p)+this.bufferPadding,a<=t&&r<=d)return!0;if(r<=a)return!1}return!1},o.onFragLoaded=function(t,r){var n=r.frag,a=r.part;n.sn==="initSegment"||n.bitrateTest||a||(a=k(n),this.fragments[a]={body:n,loaded:r,buffered:!1,range:Object.create(null)})},o.onBufferAppended=function(t,r){var n=this,a=r.frag,d=r.part,p=r.timeRanges;a.type===g.PlaylistLevelType.MAIN&&(this.activeFragment!==a&&((this.activeFragment=a).appendedPTS=void 0),d?((r=this.activeParts)||(this.activeParts=r=[]),r.push(d)):this.activeParts=null),this.timeRanges=p,Object.keys(p).forEach(function(m){var x=p[m];if(n.detectEvictedFragments(m,x),!d&&a.type===g.PlaylistLevelType.MAIN){var b=a.elementaryStreams[m];if(b)for(var C=0;C<x.length;C++){var v=x.end(C);v<=b.endPTS&&v>b.startPTS?a.appendedPTS=Math.max(v,a.appendedPTS||0):a.appendedPTS=b.endPTS}}})},o.onFragBuffered=function(t,r){this.detectPartialFragments(r)},o.hasFragment=function(t){return t=k(t),!!this.fragments[t]},o.removeFragmentsInRange=function(t,r,n){var a=this;Object.keys(this.fragments).forEach(function(p){var p=a.fragments[p];p&&p.buffered&&(p=p.body).type===n&&p.start<r&&p.end>t&&a.removeFragment(p)})},o.removeFragment=function(t){var r=k(t);t.stats.loaded=0,t.clearElementaryStreamInfo(),t.appendedPTS=void 0,delete this.fragments[r],t.endList&&delete this.endListFragments[t.type]},o.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activeFragment=null,this.activeParts=null},E);function E(t){this.activeFragment=null,this.activeParts=null,this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=t,this._registerListeners()}function h(t){var r;return t.buffered&&(((r=t.range.video)==null?void 0:r.partial)||((r=t.range.audio)==null?void 0:r.partial))}function k(t){return t.type+"_"+t.level+"_"+t.urlId+"_"+t.sn}},"./src/controller/gap-controller.ts":(c,l,o)=>{o.r(l),o.d(l,{MAX_START_GAP_JUMP:()=>h,SKIP_BUFFER_HOLE_STEP_SECONDS:()=>k,SKIP_BUFFER_RANGE_START:()=>t,STALL_MINIMUM_DURATION_MS:()=>E,default:()=>r});var f=o("./src/utils/buffer-helper.ts"),_=o("./src/errors.ts"),g=o("./src/events.ts"),T=o("./src/utils/logger.ts"),E=250,h=2,k=.1,t=.05,r=((l=n.prototype).destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},l.poll=function(a,d){var p=this.config,m=this.media,x=this.stalled;if(m!==null){var b=m.currentTime,C=m.seeking,v=this.seeking&&!C,y=!this.seeking&&C;if(this.seeking=C,b===a){if((y||v)&&(this.stalled=null),!(m.paused&&!C||m.ended||m.playbackRate===0)&&f.BufferHelper.getBuffered(m).length&&(a=f.BufferHelper.bufferInfo(m,b,0),y=0<a.len,v=a.nextStart||0,y||v)){if(C){if(y=a.len>h,d=!v||d&&d.start<=b||h<v-b&&!this.fragmentTracker.getPartialFragment(b),y||d)return;this.moved=!1}if(!this.moved&&this.stalled!==null&&(y=Math.max(v,a.start||0)-b,d=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,v=d!=null&&(v=d.details)!=null&&v.live?2*d.details.targetduration:h,0<y&&y<=v))return void this._trySkipBufferHole(null);d=self.performance.now(),x!==null?(y=d-x,!C&&E<=y&&(this._reportStall(a),!this.media)||(v=f.BufferHelper.bufferInfo(m,b,p.maxBufferHole),this._tryFixBufferStall(v,y))):this.stalled=d}}else this.moved=!0,x!==null&&(this.stallReported&&(C=self.performance.now()-x,T.logger.warn("playback not stuck anymore @"+b+", after "+Math.round(C)+"ms"),this.stallReported=!1),this.stalled=null,this.nudgeRetry=0)}},l._tryFixBufferStall=function(a,d){var p=this.config,m=this.fragmentTracker,x=this.media;x!==null&&(x=x.currentTime,!(m=m.getPartialFragment(x))||!this._trySkipBufferHole(m)&&this.media)&&a.len>p.maxBufferHole&&d>1e3*p.highBufferWatchdogPeriod&&(T.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},l._reportStall=function(a){var d=this.hls,p=this.media;!this.stallReported&&p&&(this.stallReported=!0,T.logger.warn("Playback stalling at @"+p.currentTime+" due to low buffer ("+JSON.stringify(a)+")"),d.trigger(g.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:a.len}))},l._trySkipBufferHole=function(a){var d=this.config,p=this.hls,m=this.media;if(m!==null)for(var x=m.currentTime,b=0,C=f.BufferHelper.getBuffered(m),v=0;v<C.length;v++){var y=C.start(v);if(x+d.maxBufferHole>=b&&x<y)return y=Math.max(y+t,m.currentTime+k),T.logger.warn("skipping hole, adjusting currentTime from "+x+" to "+y),this.moved=!0,this.stalled=null,m.currentTime=y,a&&p.trigger(g.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+x+" to "+y,frag:a}),y;b=C.end(v)}return 0},l._tryNudgeBuffer=function(){var a,d=this.config,p=this.hls,m=this.media,x=this.nudgeRetry;m!==null&&(a=m.currentTime,this.nudgeRetry++,x<d.nudgeMaxRetry?(x=a+(x+1)*d.nudgeOffset,T.logger.warn("Nudging 'currentTime' from "+a+" to "+x),m.currentTime=x,p.trigger(g.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})):(T.logger.error("Playhead still not moving while enough data buffered @"+a+" after "+d.nudgeMaxRetry+" nudges"),p.trigger(g.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})))},n);function n(a,d,p,m){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=a,this.media=d,this.fragmentTracker=p,this.hls=m}},"./src/controller/id3-track-controller.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>a});var f=o("./src/polyfills/number.ts"),_=o("./src/events.ts"),g=o("./src/utils/texttrack-utils.ts"),T=o("./src/demux/id3.ts"),E=o("./src/loader/date-range.ts"),h=o("./src/types/demuxer.ts");function k(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var t=(function(){var d=k();try{new d(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function r(d,p){return d.getTime()/1e3-p}function n(d){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=d,this._registerListeners()}(l=n.prototype).destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},l._registerListeners=function(){var d=this.hls;d.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),d.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),d.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),d.on(_.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),d.on(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),d.on(_.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},l._unregisterListeners=function(){var d=this.hls;d.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),d.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),d.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),d.off(_.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),d.off(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),d.off(_.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},l.onMediaAttached=function(d,p){this.media=p.media},l.onMediaDetaching=function(){this.id3Track&&((0,g.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},l.onManifestLoading=function(){this.dateRangeCuesAppended={}},l.createTrack=function(d){return d=this.getID3Track(d.textTracks),d.mode="hidden",d},l.getID3Track=function(d){if(this.media){for(var p=0;p<d.length;p++){var m=d[p];if(m.kind==="metadata"&&m.label==="id3")return(0,g.sendAddTrackEvent)(m,this.media),m}return this.media.addTextTrack("metadata","id3")}},l.onFragParsingMetadata=function(d,p){if(this.media){var m=this.hls.config,x=m.enableEmsgMetadataCues,b=m.enableID3MetadataCues;if(x||b){var C=p.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var v=k(),y=0;y<C.length;y++){var S=C[y].type;if((S!==h.MetadataSchema.emsg||x)&&b){var L=T.getID3Frames(C[y].data);if(L){var B=C[y].pts,A=B+C[y].duration;(A=t<A?t:A)-B<=0&&(A=B+.25);for(var I=0;I<L.length;I++){var U,P=L[I];T.isTimeStampFrame(P)||(this.updateId3CueEnds(B),(U=new v(B,A,"")).value=P,S&&(U.type=S),this.id3Track.addCue(U))}}}}}}},l.updateId3CueEnds=function(d){var p,m=(p=this.id3Track)==null?void 0:p.cues;if(m)for(var x=m.length;x--;){var b=m[x];b.startTime<d&&b.endTime===t&&(b.endTime=d)}},l.onBufferFlushing=function(d,v){var m,x,b=v.startOffset,C=v.endOffset,v=v.type,y=this.id3Track,S=this.hls;S&&(S=S.config,m=S.enableEmsgMetadataCues,x=S.enableID3MetadataCues,y)&&(m||x)&&(0,g.removeCuesInRange)(y,b,C,v==="audio"?function(L){return L.type===h.MetadataSchema.audioId3&&x}:v==="video"?function(L){return L.type===h.MetadataSchema.emsg&&m}:function(L){return L.type===h.MetadataSchema.audioId3&&x||L.type===h.MetadataSchema.emsg&&m})},l.onLevelUpdated=function(d,x){var m=this,x=x.details;if(this.media&&x.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var b=this.dateRangeCuesAppended,C=this.id3Track,v=x.dateRanges,y=Object.keys(v);if(C)for(var S=Object.keys(b).filter(function(U){return!y.includes(U)}),L=S.length;L--;)(function(U){var P=S[U];Object.keys(b[P].cues).forEach(function(F){C.removeCue(b[P].cues[F])}),delete b[P]})(L);if(x=x.fragments[x.fragments.length-1],y.length!==0&&(0,f.isFiniteNumber)(x?.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var B=x.programDateTime/1e3-x.start,A=k(),I=0;I<y.length;I++)(function(P){var P=y[P],F=v[P],M=b[P],w=M?.cues||{},R=M?.durationKnown||!1,O=r(F.startDate,B),j=t,z=F.endDate;z?(j=r(z,B),R=!0):F.endOnNext&&!R&&(z=y.reduce(function(re,Z){var W=v[Z];return W.class===F.class&&W.id!==Z&&W.startDate>F.startDate&&re.push(W),re},[]).sort(function(re,Z){return re.startDate.getTime()-Z.startDate.getTime()})[0])&&(j=r(z.startDate,B),R=!0);for(var G,K=Object.keys(F.attr),$=0;$<K.length;$++){var V,q,J=K[$];J!==E.DateRangeAttribute.ID&&J!==E.DateRangeAttribute.CLASS&&J!==E.DateRangeAttribute.START_DATE&&J!==E.DateRangeAttribute.DURATION&&J!==E.DateRangeAttribute.END_DATE&&J!==E.DateRangeAttribute.END_ON_NEXT&&((q=w[J])?R&&!M.durationKnown&&(q.endTime=j):(V=F.attr[J],q=new A(O,j,""),J!==E.DateRangeAttribute.SCTE35_OUT&&J!==E.DateRangeAttribute.SCTE35_IN||(G=V,V=Uint8Array.from(G.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),q.value={key:J,data:V},q.type=h.MetadataSchema.dateRange,m.id3Track.addCue(q),w[J]=q))}b[P]={cues:w,dateRange:F,durationKnown:R}})(I)}}};const a=n},"./src/controller/latency-controller.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>E});var f=o("./src/errors.ts"),_=o("./src/events.ts"),g=o("./src/utils/logger.ts");function T(k,t){for(var r,n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(k,typeof(r=(function(d){if(typeof d!="object"||d===null)return d;var p=d[Symbol.toPrimitive];if(p===void 0)return String(d);if(p=p.call(d,"string"),typeof p!="object")return p;throw new TypeError("@@toPrimitive must return a primitive value.")})(a.key))=="symbol"?r:String(r),a)}}(l=h.prototype).destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},l.registerListeners=function(){this.hls.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(_.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(_.Events.ERROR,this.onError,this)},l.unregisterListeners=function(){this.hls.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(_.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(_.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(_.Events.ERROR,this.onError)},l.onMediaAttached=function(k,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},l.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},l.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},l.onLevelUpdated=function(k,t){t=t.details,(this.levelDetails=t).advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},l.onError=function(k,t){t.details===f.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,g.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},l.timeupdate=function(){var k,t,r,n=this.media,a=this.levelDetails;n&&a&&(this.currentTime=n.currentTime,(t=this.computeLatency())!==null)&&(this._latency=t,r=(k=this.config).lowLatencyMode,k=k.maxLiveSyncPlaybackRate,r)&&k!==1&&(r=this.targetLatency)!==null&&(r=(t=t-r)<Math.min(this.maxLatency,r+a.targetduration),a.live&&r&&.05<t&&1<this.forwardBufferLength?(a=Math.min(2,Math.max(1,k)),r=Math.round(2/(1+Math.exp(-.75*t-this.edgeStalled))*20)/20,n.playbackRate=Math.min(a,Math.max(1,r))):n.playbackRate!==1&&n.playbackRate!==0&&(n.playbackRate=1))},l.estimateLiveEdge=function(){var k=this.levelDetails;return k===null?null:k.edge+k.age},l.computeLatency=function(){var k=this.estimateLiveEdge();return k===null?null:k-this.currentTime},T((l=h).prototype,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var k=this.config,t=this.levelDetails;return k.liveMaxLatencyDuration!==void 0?k.liveMaxLatencyDuration:t?k.liveMaxLatencyDurationCount*t.targetduration:0}},{key:"targetLatency",get:function(){var k,t,r,n,a,d=this.levelDetails;return d===null?null:(k=d.holdBack,n=d.partHoldBack,d=d.targetduration,t=(a=this.config).liveSyncDuration,r=a.liveSyncDurationCount,a=a.lowLatencyMode&&n||k,(a=(n=this.hls.userConfig).liveSyncDuration||n.liveSyncDurationCount||a===0?t!==void 0?t:r*d:a)+Math.min(+this.stallCount,d))}},{key:"liveSyncPosition",get:function(){var k,t=this.estimateLiveEdge(),r=this.targetLatency,n=this.levelDetails;return t===null||r===null||n===null?null:(k=n.edge,t=t-r-this.edgeStalled,r=k-n.totalduration,k=k-(this.config.lowLatencyMode&&n.partTarget||n.targetduration),Math.min(Math.max(r,t),k))}},{key:"drift",get:function(){var k=this.levelDetails;return k===null?1:k.drift}},{key:"edgeStalled",get:function(){var k,t=this.levelDetails;return t===null?0:(k=3*(this.config.lowLatencyMode&&t.partTarget||t.targetduration),Math.max(t.age-k,0))}},{key:"forwardBufferLength",get:function(){var k,t=this.media,r=this.levelDetails;return t&&r?((k=t.buffered.length)?t.buffered.end(k-1):r.edge)-this.currentTime:0}}]),Object.defineProperty(l,"prototype",{writable:!1});var E=h;function h(k){var t=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return t.timeupdate()},this.hls=k,this.config=k.config,this.registerListeners()}},"./src/controller/level-controller.ts":(c,h,o)=>{o.r(h),o.d(h,{default:()=>p});var f=o("./src/types/level.ts"),_=o("./src/events.ts"),g=o("./src/errors.ts"),T=o("./src/utils/codecs.ts"),E=o("./src/controller/level-helper.ts"),h=o("./src/controller/base-playlist-controller.ts"),k=o("./src/types/loader.ts");function t(){return(t=Object.assign?Object.assign.bind():function(x){for(var b=1;b<arguments.length;b++){var C,v=arguments[b];for(C in v)Object.prototype.hasOwnProperty.call(v,C)&&(x[C]=v[C])}return x}).apply(this,arguments)}function r(x,b){for(var C,v=0;v<b.length;v++){var y=b[v];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(x,typeof(C=(function(S){if(typeof S!="object"||S===null)return S;var L=S[Symbol.toPrimitive];if(L===void 0)return String(S);if(L=L.call(S,"string"),typeof L!="object")return L;throw new TypeError("@@toPrimitive must return a primitive value.")})(y.key))=="symbol"?C:String(C),y)}}function n(x,b){return(n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(C,v){return C.__proto__=v,C})(x,b)}var a,d=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),p=(a=h.default,o=a,(h=m).prototype=Object.create(o.prototype),n(h.prototype.constructor=h,o),(h=m.prototype)._registerListeners=function(){var x=this.hls;x.on(_.Events.MANIFEST_LOADED,this.onManifestLoaded,this),x.on(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),x.on(_.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),x.on(_.Events.FRAG_LOADED,this.onFragLoaded,this),x.on(_.Events.ERROR,this.onError,this)},h._unregisterListeners=function(){var x=this.hls;x.off(_.Events.MANIFEST_LOADED,this.onManifestLoaded,this),x.off(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),x.off(_.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),x.off(_.Events.FRAG_LOADED,this.onFragLoaded,this),x.off(_.Events.ERROR,this.onError,this)},h.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,a.prototype.destroy.call(this)},h.startLoad=function(){this._levels.forEach(function(x){x.loadError=0}),a.prototype.startLoad.call(this)},h.onManifestLoaded=function(x,b){var C,v,y=[],S=[],L=[],B={},A=!1,I=!1,U=!1;if(b.levels.forEach(function(M){var w=M.attrs,R=(A=A||!(!M.width||!M.height),I=I||!!M.videoCodec,U=U||!!M.audioCodec,d&&M.audioCodec&&M.audioCodec.indexOf("mp4a.40.34")!==-1&&(M.audioCodec=void 0),M.bitrate+"-"+M.attrs.RESOLUTION+"-"+M.attrs.CODECS);(v=B[R])?v.url.push(M.url):(v=new f.Level(M),B[R]=v,y.push(v)),w&&(w.AUDIO&&(0,E.addGroupId)(v,"audio",w.AUDIO),w.SUBTITLES)&&(0,E.addGroupId)(v,"text",w.SUBTITLES)}),y=(y=(A||I)&&U?y.filter(function(O){var w=O.videoCodec,R=O.width,O=O.height;return!!w||!(!R||!O)}):y).filter(function(R){var w=R.audioCodec,R=R.videoCodec;return(!w||(0,T.isCodecSupportedInMp4)(w,"audio"))&&(!R||(0,T.isCodecSupportedInMp4)(R,"video"))}),b.audioTracks&&(S=b.audioTracks.filter(function(M){return!M.audioCodec||(0,T.isCodecSupportedInMp4)(M.audioCodec,"audio")}),(0,E.assignTrackIdsByGroup)(S)),b.subtitles&&(L=b.subtitles,(0,E.assignTrackIdsByGroup)(L)),0<y.length){C=y[0].bitrate,y.sort(function(w,R){return w.attrs["HDCP-LEVEL"]!==R.attrs["HDCP-LEVEL"]?(w.attrs["HDCP-LEVEL"]||"")>(R.attrs["HDCP-LEVEL"]||"")?1:-1:w.bitrate!==R.bitrate?w.bitrate-R.bitrate:w.attrs.SCORE!==R.attrs.SCORE?w.attrs.decimalFloatingPoint("SCORE")-R.attrs.decimalFloatingPoint("SCORE"):A&&w.height!==R.height?w.height-R.height:0}),this._levels=y;for(var P=0;P<y.length;P++)if(y[P].bitrate===C){this._firstLevel=P,this.log("manifest loaded, "+y.length+" level(s) found, first bitrate: "+C);break}var F=U&&!I,L={levels:y,audioTracks:S,subtitleTracks:L,sessionData:b.sessionData,sessionKeys:b.sessionKeys,firstLevel:this._firstLevel,stats:b.stats,audio:U,video:I,altAudio:!F&&S.some(function(w){return!!w.url})};this.hls.trigger(_.Events.MANIFEST_PARSED,L),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(_.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:b.url,reason:"no level with compatible codecs found in manifest"})},h.onError=function(x,b){if(a.prototype.onError.call(this,x,b),!b.fatal){var C=b.context,v=this._levels[this.currentLevelIndex];if(C&&(C.type===k.PlaylistContextType.AUDIO_TRACK&&v.audioGroupIds&&C.groupId===v.audioGroupIds[v.urlId]||C.type===k.PlaylistContextType.SUBTITLE_TRACK&&v.textGroupIds&&C.groupId===v.textGroupIds[v.urlId]))this.redundantFailover(this.currentLevelIndex);else{var y,S,L=!1,B=!0;switch(b.details){case g.ErrorDetails.FRAG_LOAD_ERROR:case g.ErrorDetails.FRAG_LOAD_TIMEOUT:case g.ErrorDetails.KEY_LOAD_ERROR:case g.ErrorDetails.KEY_LOAD_TIMEOUT:b.frag&&(S=b.frag.type===k.PlaylistLevelType.MAIN?b.frag.level:this.currentLevelIndex,!(A=this._levels[S])||(A.fragmentError++,A.fragmentError>this.hls.config.fragLoadingMaxRetry))&&(y=S);break;case g.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:var A=v.attrs["HDCP-LEVEL"];A&&(this.hls.maxHdcpLevel=f.HdcpLevels[f.HdcpLevels.indexOf(A)-1],this.warn('Restricting playback to HDCP-LEVEL of "'+this.hls.maxHdcpLevel+'" or lower'));case g.ErrorDetails.FRAG_PARSING_ERROR:case g.ErrorDetails.KEY_SYSTEM_NO_SESSION:y=((S=b.frag)==null?void 0:S.type)===k.PlaylistLevelType.MAIN?b.frag.level:this.currentLevelIndex,b.levelRetry=!1;break;case g.ErrorDetails.LEVEL_LOAD_ERROR:case g.ErrorDetails.LEVEL_LOAD_TIMEOUT:C&&(C.deliveryDirectives&&(B=!1),y=C.level),L=!0;break;case g.ErrorDetails.REMUX_ALLOC_ERROR:y=(A=b.level)!=null?A:this.currentLevelIndex,L=!0}y!==void 0&&this.recoverLevel(b,y,L,B)}}},h.recoverLevel=function(x,b,C,v){var y=x.details,S=this._levels[b];if(S.loadError++,C){if(!this.retryLoadingOrFail(x))return void(this.currentLevelIndex=-1);x.levelRetry=!0}if(v){if(C=S.url.length,1<C&&S.loadError<C)x.levelRetry=!0,this.redundantFailover(b);else if(this.manualLevelIndex===-1){for(var L=-1,B=this._levels,A=B.length;A--;){var I=(A+this.currentLevelIndex)%B.length;if(I!==this.currentLevelIndex&&B[I].loadError===0){L=I;break}}-1<L&&this.currentLevelIndex!==L?(this.warn(y+": switch to "+L),x.levelRetry=!0,this.hls.nextAutoLevel=L):x.levelRetry===!1&&(x.fatal=!0)}}},h.redundantFailover=function(x){var b,C=this._levels[x],v=C.url.length;1<v&&(b=(C.urlId+1)%v,this.warn("Switching to redundant URL-id "+b),this._levels.forEach(function(y){y.urlId=b}),this.level=x)},h.onFragLoaded=function(x,C){var C=C.frag;C!==void 0&&C.type===k.PlaylistLevelType.MAIN&&(C=this._levels[C.level])!==void 0&&(C.fragmentError=0,C.loadError=0)},h.onLevelLoaded=function(x,b){var C=b.level,v=b.details,y=this._levels[C];y?C===this.currentLevelIndex?(y.fragmentError===0&&(y.loadError=0,this.retryCount=0),this.playlistLoaded(C,b,y.details)):(y=b.deliveryDirectives)!=null&&y.skip&&(v.deltaUpdateFailed=!0):(this.warn("Invalid level index "+C),(y=b.deliveryDirectives)!=null&&y.skip&&(v.deltaUpdateFailed=!0))},h.onAudioTrackSwitched=function(x,b){var C=this.hls.levels[this.currentLevelIndex];if(C&&C.audioGroupIds){for(var v=-1,y=this.hls.audioTracks[b.id].groupId,S=0;S<C.audioGroupIds.length;S++)if(C.audioGroupIds[S]===y){v=S;break}v!==C.urlId&&(C.urlId=v,this.startLoad())}},h.loadPlaylist=function(x){a.prototype.loadPlaylist.call(this);var b=this.currentLevelIndex,C=this._levels[b];if(this.canLoad&&C&&0<C.url.length){var v=C.urlId,C=C.url[v];if(x)try{C=x.addDirectives(C)}catch(S){this.warn("Could not construct new URL with HLS Delivery Directives: "+S)}this.log("Attempt loading level index "+b+(x?.msn!==void 0?" at sn "+x.msn+" part "+x.part:"")+" with URL-id "+v+" "+C),this.clearTimer(),this.hls.trigger(_.Events.LEVEL_LOADING,{url:C,level:b,id:v,deliveryDirectives:x||null})}},h.removeLevel=function(x,b){function C(y,S){return S!==b}var v=this._levels.filter(function(y,S){return S!==x||1<y.url.length&&b!==void 0&&(y.url=y.url.filter(C),y.audioGroupIds&&(y.audioGroupIds=y.audioGroupIds.filter(C)),y.textGroupIds&&(y.textGroupIds=y.textGroupIds.filter(C)),!(y.urlId=0))}).map(function(y,S){var L=y.details;return L!=null&&L.fragments&&L.fragments.forEach(function(B){B.level=S}),y});this._levels=v,this.hls.trigger(_.Events.LEVELS_UPDATED,{levels:v})},r((o=m).prototype,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(x){var b=this._levels;if(b.length!==0&&(this.currentLevelIndex!==x||(v=b[x])==null||!v.details)){if(x<0||x>=b.length){var v=x<0;if(this.hls.trigger(_.Events.ERROR,{type:g.ErrorTypes.OTHER_ERROR,details:g.ErrorDetails.LEVEL_SWITCH_ERROR,level:x,fatal:v,reason:"invalid level idx"}),v)return;x=Math.min(x,b.length-1)}this.clearTimer();var v=this.currentLevelIndex,C=b[v],b=b[x],v=(this.log("switching to level "+x+" from "+v),t({},b,{level:this.currentLevelIndex=x,maxBitrate:b.maxBitrate,uri:b.uri,urlId:b.urlId})),x=(delete v._urlId,this.hls.trigger(_.Events.LEVEL_SWITCHING,v),b.details);x&&!x.live||(v=this.switchParams(b.uri,C?.details),this.loadPlaylist(v))}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(x){this.manualLevelIndex=x,this._startLevel===void 0&&(this._startLevel=x),x!==-1&&(this.level=x)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(x){this._firstLevel=x}},{key:"startLevel",get:function(){var x;return this._startLevel===void 0?(x=this.hls.config.startLevel)!==void 0?x:this._firstLevel:this._startLevel},set:function(x){this._startLevel=x}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(x){this.level=x,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=x)}}]),Object.defineProperty(o,"prototype",{writable:!1}),m);function m(x){return(x=a.call(this,x,"[level-controller]")||this)._levels=[],x._firstLevel=-1,x._startLevel=void 0,x.currentLevelIndex=-1,x.manualLevelIndex=-1,x.onParsedComplete=void 0,x._registerListeners(),x}},"./src/controller/level-helper.ts":(c,l,o)=>{o.r(l),o.d(l,{addGroupId:()=>function(a,d,p){switch(d){case"audio":a.audioGroupIds||(a.audioGroupIds=[]),a.audioGroupIds.push(p);break;case"text":a.textGroupIds||(a.textGroupIds=[]),a.textGroupIds.push(p)}},addSliding:()=>n,adjustSliding:()=>r,assignTrackIdsByGroup:()=>function(a){var d={};a.forEach(function(p){var m=p.groupId||"";p.id=d[m]=d[m]||0,d[m]++})},computeReloadInterval:()=>function(a,d){d===void 0&&(d=1/0);var p=1e3*a.targetduration;return a.updated?(a=a.fragments).length&&d<4*p&&(d=1e3*a[a.length-1].duration)<p&&(p=d):p/=2,Math.round(p)},getFragmentWithSN:()=>function(a,d,p){var m;return a&&a.details?(a=a.details,(m=a.fragments[d-a.startSN])||((m=a.fragmentHint)&&m.sn===d?m:d<a.startSN&&p&&p.sn===d?p:null)):null},getPartWith:()=>function(a,d,p){if(a&&a.details){var m=a.details.partList;if(m)for(var x=m.length;x--;){var b=m[x];if(b.index===p&&b.fragment.sn===d)return b}}return null},mapFragmentIntersection:()=>t,mapPartIntersection:()=>k,mergeDetails:()=>function(a,d){for(var p=null,m=a.fragments,x=m.length-1;0<=x;x--){var b=m[x].initSegment;if(b){p=b;break}}a.fragmentHint&&delete a.fragmentHint.endPTS;var C,v,y,S=0;if(t(a,d,function(P,F){P.relurl&&(S=P.cc-F.cc),(0,f.isFiniteNumber)(P.startPTS)&&(0,f.isFiniteNumber)(P.endPTS)&&(F.start=F.startPTS=P.startPTS,F.startDTS=P.startDTS,F.appendedPTS=P.appendedPTS,F.maxStartPTS=P.maxStartPTS,F.endPTS=P.endPTS,F.endDTS=P.endDTS,F.minEndPTS=P.minEndPTS,F.duration=P.endPTS-P.startPTS,F.duration&&(C=F),d.PTSKnown=d.alignedSliding=!0),F.elementaryStreams=P.elementaryStreams,F.loader=P.loader,F.stats=P.stats,F.urlId=P.urlId,P.initSegment&&(F.initSegment=P.initSegment,p=P.initSegment)}),p&&(d.fragmentHint?d.fragments.concat(d.fragmentHint):d.fragments).forEach(function(P){var F;P.initSegment&&P.initSegment.relurl!==((F=p)==null?void 0:F.relurl)||(P.initSegment=p)}),d.skippedSegments)if(d.deltaUpdateFailed=d.fragments.some(function(P){return!P}),d.deltaUpdateFailed){_.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var L=d.skippedSegments;L--;)d.fragments.shift();d.startSN=d.fragments[0].sn,d.startCC=d.fragments[0].cc}else d.canSkipDateRanges&&(d.dateRanges=(I=a.dateRanges,v=d.dateRanges,U=d.recentlyRemovedDateranges,y=T({},I),U&&U.forEach(function(P){delete y[P]}),Object.keys(v).forEach(function(P){var F=new g.DateRange(v[P].attr,y[P]);F.isValid?y[P]=F:_.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(v[P].attr)+'"')}),y));var B=d.fragments;if(S){_.logger.warn("discontinuity sliding from playlist, take drift into account");for(var A=0;A<B.length;A++)B[A].cc+=S}d.skippedSegments&&(d.startCC=d.fragments[0].cc),k(a.partList,d.partList,function(P,F){F.elementaryStreams=P.elementaryStreams,F.stats=P.stats}),C?h(d,C,C.startPTS,C.endPTS,C.startDTS,C.endDTS):r(a,d),B.length&&(d.totalduration=d.edge-B[0].start),d.driftStartTime=a.driftStartTime,d.driftStart=a.driftStart;var I=d.advancedDateTime;{var U;d.advanced&&I?(U=d.edge,d.driftStart||(d.driftStartTime=I,d.driftStart=U),d.driftEndTime=I,d.driftEnd=U):(d.driftEndTime=a.driftEndTime,d.driftEnd=a.driftEnd,d.advancedDateTime=a.advancedDateTime)}},updateFragPTSDTS:()=>h,updatePTS:()=>function(a,d,p){E(a[d],a[p])}});var f=o("./src/polyfills/number.ts"),_=o("./src/utils/logger.ts"),g=o("./src/loader/date-range.ts");function T(){return(T=Object.assign?Object.assign.bind():function(a){for(var d=1;d<arguments.length;d++){var p,m=arguments[d];for(p in m)Object.prototype.hasOwnProperty.call(m,p)&&(a[p]=m[p])}return a}).apply(this,arguments)}function E(a,d){var p,m=d.startPTS;(0,f.isFiniteNumber)(m)?(p=0,(m=d.sn>a.sn?(p=m-a.start,a):(p=a.start-m,d)).duration!==p&&(m.duration=p)):d.sn>a.sn?a.cc===d.cc&&a.minEndPTS?d.start=a.start+(a.minEndPTS-a.start):d.start=a.start+a.duration:d.start=Math.max(a.start-d.duration,0)}function h(a,d,p,m,x,b){m-p<=0&&(_.logger.warn("Fragment should have a positive duration",d),m=p+d.duration,b=x+d.duration);var C=p,v=m,L=d.startPTS,B=d.endPTS,y=((0,f.isFiniteNumber)(L)&&(y=Math.abs(L-p),(0,f.isFiniteNumber)(d.deltaPTS)?d.deltaPTS=Math.max(y,d.deltaPTS):d.deltaPTS=y,C=Math.max(p,L),p=Math.min(p,L),x=Math.min(x,d.startDTS),v=Math.min(m,B),m=Math.max(m,B),b=Math.max(b,d.endDTS)),d.duration=m-p,p-d.start);d.start=d.startPTS=p,d.maxStartPTS=C,d.startDTS=x,d.endPTS=m,d.minEndPTS=v,d.endDTS=b;var S,L=d.sn;if(!a||L<a.startSN||L>a.endSN)return 0;var B=L-a.startSN,A=a.fragments;for(A[B]=d,S=B;0<S;S--)E(A[S],A[S-1]);for(S=B;S<A.length-1;S++)E(A[S],A[S+1]);return a.fragmentHint&&E(A[A.length-1],a.fragmentHint),a.PTSKnown=a.alignedSliding=!0,y}function k(a,d,p){if(a&&d)for(var m=0,x=0,b=a.length;x<=b;x++){var C=a[x],v=d[x+m];C&&v&&C.index===v.index&&C.fragment.sn===v.fragment.sn?p(C,v):m--}}function t(a,d,p){for(var m=d.skippedSegments,x=Math.max(a.startSN,d.startSN)-d.startSN,b=(a.fragmentHint?1:0)+(m?d.endSN:Math.min(a.endSN,d.endSN))-d.startSN,C=d.startSN-a.startSN,v=d.fragmentHint?d.fragments.concat(d.fragmentHint):d.fragments,y=a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments,S=x;S<=b;S++){var L=y[C+S],B=v[S];m&&!B&&S<m&&(B=d.fragments[S]=L),L&&B&&p(L,B)}}function r(m,d){var p=d.startSN+d.skippedSegments-m.startSN,m=m.fragments;p<0||p>=m.length||n(d,m[p].start)}function n(a,d){if(d){for(var p=a.fragments,m=a.skippedSegments;m<p.length;m++)p[m].start+=d;a.fragmentHint&&(a.fragmentHint.start+=d)}}},"./src/controller/stream-controller.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>b});var f=o("./src/polyfills/number.ts"),_=o("./src/controller/base-stream-controller.ts"),g=o("./src/is-supported.ts"),T=o("./src/events.ts"),E=o("./src/utils/buffer-helper.ts"),h=o("./src/controller/fragment-tracker.ts"),k=o("./src/types/loader.ts"),t=o("./src/loader/fragment.ts"),r=o("./src/demux/transmuxer-interface.ts"),n=o("./src/types/transmuxer.ts"),a=o("./src/controller/gap-controller.ts"),d=o("./src/errors.ts");function p(v,y){for(var S,L=0;L<y.length;L++){var B=y[L];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(v,typeof(S=(function(A){if(typeof A!="object"||A===null)return A;var I=A[Symbol.toPrimitive];if(I===void 0)return String(A);if(I=I.call(A,"string"),typeof I!="object")return I;throw new TypeError("@@toPrimitive must return a primitive value.")})(B.key))=="symbol"?S:String(S),B)}}function m(v,y){return(m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(S,L){return S.__proto__=L,S})(v,y)}x=_.default,l=x,(o=C).prototype=Object.create(l.prototype),m(o.prototype.constructor=o,l),(o=C.prototype)._registerListeners=function(){var v=this.hls;v.on(T.Events.MEDIA_ATTACHED,this.onMediaAttached,this),v.on(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),v.on(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.on(T.Events.MANIFEST_PARSED,this.onManifestParsed,this),v.on(T.Events.LEVEL_LOADING,this.onLevelLoading,this),v.on(T.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.on(T.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),v.on(T.Events.ERROR,this.onError,this),v.on(T.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),v.on(T.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),v.on(T.Events.BUFFER_CREATED,this.onBufferCreated,this),v.on(T.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),v.on(T.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),v.on(T.Events.FRAG_BUFFERED,this.onFragBuffered,this)},o._unregisterListeners=function(){var v=this.hls;v.off(T.Events.MEDIA_ATTACHED,this.onMediaAttached,this),v.off(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),v.off(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.off(T.Events.MANIFEST_PARSED,this.onManifestParsed,this),v.off(T.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.off(T.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),v.off(T.Events.ERROR,this.onError,this),v.off(T.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),v.off(T.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),v.off(T.Events.BUFFER_CREATED,this.onBufferCreated,this),v.off(T.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),v.off(T.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),v.off(T.Events.FRAG_BUFFERED,this.onFragBuffered,this)},o.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},o.startLoad=function(v){var y,S,L;this.levels?(y=this.lastCurrentTime,S=this.hls,this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,this.startFragRequested||((L=S.startLevel)===-1&&(S.config.testBandwidth&&1<this.levels.length?this.bitrateTest=!(L=0):L=S.nextAutoLevel),this.level=S.nextLoadLevel=L,this.loadedmetadata=!1),0<y&&v===-1&&(this.log("Override startPosition with lastCurrentTime @"+y.toFixed(3)),v=y),this.state=_.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=v,this.tick()):(this._forceStartLoad=!0,this.state=_.State.STOPPED)},o.stopLoad=function(){this._forceStartLoad=!1,x.prototype.stopLoad.call(this)},o.doTick=function(){switch(this.state){case _.State.IDLE:this.doTickIdle();break;case _.State.WAITING_LEVEL:var v=this.levels,y=this.level,y=v==null||(v=v[y])==null?void 0:v.details;if(y&&(!y.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(y))break;this.state=_.State.IDLE}break;case _.State.FRAG_LOADING_WAITING_RETRY:v=self.performance.now(),y=this.retryDate,(!y||y<=v||(y=this.media)!=null&&y.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=_.State.IDLE)}this.onTickEnd()},o.onTickEnd=function(){x.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},o.doTickIdle=function(){var v=this.hls,y=this.levelLastLoaded,S=this.levels,L=this.media,B=v.config,A=v.nextLoadLevel;y===null||!(L||!this.startFragRequested&&B.startFragPrefetch)||this.altAudio&&this.audioOnly||!S||!S[A]||(y=S[A],(L=this.getMainFwdBufferInfo())!==null&&((B=this.getLevelDetails())&&this._streamEnded(L,B)?(S={},this.altAudio&&(S.type="video"),this.hls.trigger(T.Events.BUFFER_EOS,S),this.state=_.State.ENDED):(this.level=v.nextLoadLevel=A,!(B=y.details)||this.state===_.State.WAITING_LEVEL||B.live&&this.levelLastLoaded!==A?(this.level=A,this.state=_.State.WAITING_LEVEL):L.len>=this.getMaxBufferLength(y.maxBitrate)||(this.backtrackFragment&&this.backtrackFragment.start>L.end&&(this.backtrackFragment=null),S=this.backtrackFragment?this.backtrackFragment.start:L.end,v=this.getNextFragment(S,B),this.couldBacktrack&&!this.fragPrevious&&v&&v.sn!=="initSegment"&&this.fragmentTracker.getState(v)!==h.FragmentState.OK?(y=((A=this.backtrackFragment)!=null?A:v).sn-B.startSN,(A=B.fragments[y-1])&&v.cc===A.cc&&this.fragmentTracker.removeFragment(v=A)):this.backtrackFragment&&L.len&&(this.backtrackFragment=null),v&&this.fragmentTracker.getState(v)===h.FragmentState.OK&&this.nextLoadPosition>S&&((A=((y=this.audioOnly&&!this.altAudio?t.ElementaryStreamTypes.AUDIO:t.ElementaryStreamTypes.VIDEO)===t.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media)&&this.afterBufferFlushed(A,y,k.PlaylistLevelType.MAIN),v=this.getNextFragment(this.nextLoadPosition,B)),v&&(!v.initSegment||v.initSegment.data||this.bitrateTest||(v=v.initSegment),this.loadFragment(v,B,S))))))},o.loadFragment=function(v,y,S){var L=this.fragmentTracker.getState(v);this.fragCurrent=v,L===h.FragmentState.NOT_LOADED?v.sn==="initSegment"?this._loadInitSegment(v,y):this.bitrateTest?(this.log("Fragment "+v.sn+" of level "+v.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(v,y)):(this.startFragRequested=!0,x.prototype.loadFragment.call(this,v,y,S)):L===h.FragmentState.APPENDING?this.reduceMaxBufferLength(v.duration)&&this.fragmentTracker.removeFragment(v):((y=this.media)==null?void 0:y.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},o.getAppendedFrag=function(v){return v=this.fragmentTracker.getAppendedFrag(v,k.PlaylistLevelType.MAIN),v&&"fragment"in v?v.fragment:v},o.getBufferedFrag=function(v){return this.fragmentTracker.getBufferedFrag(v,k.PlaylistLevelType.MAIN)},o.followingBufferedFrag=function(v){return v?this.getBufferedFrag(v.end+.5):null},o.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},o.nextLevelSwitch=function(){var v,y=this.levels,S=this.media;S!=null&&S.readyState&&((v=this.getAppendedFrag(S.currentTime))&&1<v.start&&this.flushMainBuffer(0,v.start-1),v=!S.paused&&y&&(v=y[this.hls.nextLoadLevel],y=this.fragLastKbps)&&this.fragCurrent?this.fragCurrent.duration*v.maxBitrate/(1e3*y)+1:0,y=this.getBufferedFrag(S.currentTime+v))&&(S=this.followingBufferedFrag(y))&&(this.abortCurrentFrag(),v=S.maxStartPTS||S.start,S=S.duration,y=Math.max(y.end,v+Math.min(Math.max(S-this.config.maxFragLookUpTolerance,.5*S),.75*S)),this.flushMainBuffer(y,Number.POSITIVE_INFINITY))},o.abortCurrentFrag=function(){var v=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,v&&v.abortRequests(),this.state){case _.State.KEY_LOADING:case _.State.FRAG_LOADING:case _.State.FRAG_LOADING_WAITING_RETRY:case _.State.PARSING:case _.State.PARSED:this.state=_.State.IDLE}this.nextLoadPosition=this.getLoadPosition()},o.flushMainBuffer=function(v,y){x.prototype.flushMainBuffer.call(this,v,y,this.altAudio?"video":null)},o.onMediaAttached=function(v,y){x.prototype.onMediaAttached.call(this,v,y),v=y.media,this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),v.addEventListener("playing",this.onvplaying),v.addEventListener("seeked",this.onvseeked),this.gapController=new a.default(this.config,v,this.fragmentTracker,this.hls)},o.onMediaDetaching=function(){var v=this.media;v&&this.onvplaying&&this.onvseeked&&(v.removeEventListener("playing",this.onvplaying),v.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),x.prototype.onMediaDetaching.call(this)},o.onMediaPlaying=function(){this.tick()},o.onMediaSeeked=function(){var v=this.media,v=v?v.currentTime:null;(0,f.isFiniteNumber)(v)&&this.log("Media seeked to "+v.toFixed(3)),this.tick()},o.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(T.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},o.onManifestParsed=function(v,y){var S,L=!1,B=!1;y.levels.forEach(function(A){(S=A.audioCodec)&&(S.indexOf("mp4a.40.2")!==-1&&(L=!0),S.indexOf("mp4a.40.5")!==-1)&&(B=!0)}),this.audioCodecSwitch=L&&B&&!(0,g.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=y.levels,this.startFragRequested=!1},o.onLevelLoading=function(v,y){var S=this.levels;S&&this.state===_.State.IDLE&&(!(S=S[y.level]).details||S.details.live&&this.levelLastLoaded!==y.level||this.waitForCdnTuneIn(S.details))&&(this.state=_.State.WAITING_LEVEL)},o.onLevelLoaded=function(v,y){var S=this.levels,L=y.level,B=y.details,A=B.totalduration;if(S){if(this.log("Level "+L+" loaded ["+B.startSN+","+B.endSN+"], cc ["+B.startCC+", "+B.endCC+"] duration:"+A),A=this.fragCurrent,y=(!A||this.state!==_.State.FRAG_LOADING&&this.state!==_.State.FRAG_LOADING_WAITING_RETRY||A.level!==y.level&&A.loader&&(this.state=_.State.IDLE,this.backtrackFragment=null,A.abortRequests()),S[L]),A=0,B.live||(S=y.details)!=null&&S.live){if(B.fragments[0]||(B.deltaUpdateFailed=!0),B.deltaUpdateFailed)return;A=this.alignPlaylists(B,y.details)}if(y.details=B,this.levelLastLoaded=L,this.hls.trigger(T.Events.LEVEL_UPDATED,{details:B,level:L}),this.state===_.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(B))return;this.state=_.State.IDLE}this.startFragRequested?B.live&&this.synchronizeToLiveEdge(B):this.setStartPosition(B,A),this.tick()}else this.warn("Levels were reset while loading level "+L)},o._handleFragmentLoadProgress=function(M){var y,S,L,B,A,I,U,P=M.frag,F=M.part,M=M.payload,w=this.levels;w?(y=(w=w[P.level]).details)?(S=w.videoCodec,L=y.PTSKnown||!y.live,B=(B=P.initSegment)==null?void 0:B.data,w=this._getAudioCodec(w),A=this.transmuxer=this.transmuxer||new r.default(this.hls,k.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),I=F?F.index:-1,I=new n.ChunkMetadata(P.level,P.sn,P.stats.chunkCount,M.byteLength,I,I!==-1),U=this.initPTS[P.cc],A.push(M,B,w,S,P,F,y.totalduration,L,I,U)):this.warn("Dropping fragment "+P.sn+" of level "+P.level+" after level details were reset"):this.warn("Levels were reset while fragment load was in progress. Fragment "+P.sn+" of level "+P.level+" will not be buffered")},o.onAudioTrackSwitching=function(v,B){var S=this.altAudio,L=!!B.url,B=B.id;L||(this.mediaBuffer!==this.media?(this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media,(L=this.fragCurrent)&&(this.log("Switching to main audio track, cancel main fragment load"),L.abortRequests()),this.resetTransmuxer(),this.resetLoadingState()):this.audioOnly&&this.resetTransmuxer(),L=this.hls,S&&L.trigger(T.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),L.trigger(T.Events.AUDIO_TRACK_SWITCHED,{id:B}))},o.onAudioTrackSwitched=function(v,L){var S,L=L.id,L=!!this.hls.audioTracks[L].url;L&&(S=this.videoBuffer)&&this.mediaBuffer!==S&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=S),this.altAudio=L,this.tick()},o.onBufferCreated=function(v,y){var S,L=y.tracks,B=!1;for(S in L){var A,I,U=L[S];U.id==="main"?(I=U,(A=S)==="video"&&(U=L[S])&&(this.videoBuffer=U.buffer)):B=!0}B&&I?(this.log("Alternate track found, use "+A+".buffered to schedule main fragment loading"),this.mediaBuffer=I.buffer):this.mediaBuffer=this.media},o.onFragBuffered=function(v,B){var S,L=B.frag,B=B.part;L&&L.type!==k.PlaylistLevelType.MAIN||(this.fragContextChanged(L)?(this.warn("Fragment "+L.sn+(B?" p: "+B.index:"")+" of level "+L.level+" finished buffering, but was aborted. state: "+this.state),this.state===_.State.PARSED&&(this.state=_.State.IDLE)):(S=(B||L).stats,this.fragLastKbps=Math.round(8*S.total/(S.buffering.end-S.loading.first)),L.sn!=="initSegment"&&(this.fragPrevious=L),this.fragBufferedComplete(L,B)))},o.onError=function(v,y){if(y.type!==d.ErrorTypes.KEY_SYSTEM_ERROR)switch(y.details){case d.ErrorDetails.FRAG_LOAD_ERROR:case d.ErrorDetails.FRAG_LOAD_TIMEOUT:case d.ErrorDetails.FRAG_PARSING_ERROR:case d.ErrorDetails.KEY_LOAD_ERROR:case d.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(k.PlaylistLevelType.MAIN,y);break;case d.ErrorDetails.LEVEL_LOAD_ERROR:case d.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==_.State.ERROR&&(y.fatal?(this.warn(""+y.details),this.state=_.State.ERROR):y.levelRetry||this.state!==_.State.WAITING_LEVEL||(this.state=_.State.IDLE));break;case d.ErrorDetails.BUFFER_FULL_ERROR:var S,L;y.parent!=="main"||this.state!==_.State.PARSING&&this.state!==_.State.PARSED||(S=!0,(S=(L=this.getFwdBufferInfo(this.media,k.PlaylistLevelType.MAIN))&&.5<L.len?!this.reduceMaxBufferLength(L.len):S)&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState())}else this.onFragmentOrKeyLoadError(k.PlaylistLevelType.MAIN,y)},o.checkBuffer=function(){var v,y=this.media,S=this.gapController;y&&S&&y.readyState&&(!this.loadedmetadata&&E.BufferHelper.getBuffered(y).length||(v=this.state!==_.State.IDLE?this.fragCurrent:null,S.poll(this.lastCurrentTime,v)),this.lastCurrentTime=y.currentTime)},o.onFragLoadEmergencyAborted=function(){this.state=_.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},o.onBufferFlushed=function(v,L){var S,L=L.type;(L!==t.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio)&&(S=(L===t.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media,this.afterBufferFlushed(S,L,k.PlaylistLevelType.MAIN))},o.onLevelsUpdated=function(v,y){this.levels=y.levels},o.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},o.seekToStartPos=function(){var v,y,S,L=this.media;L&&(v=L.currentTime,0<=(y=this.startPosition))&&v<y&&(L.seeking?this.log("could not seek to "+y+", already seeking at "+v):(0<(S=((S=E.BufferHelper.getBuffered(L)).length?S.start(0):0)-y)&&(S<this.config.maxBufferHole||S<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+S+" to match buffer start"),this.startPosition=y+=S),this.log("seek to target start position "+y+" from current time "+v),L.currentTime=y))},o._getAudioCodec=function(v){return v=this.config.defaultAudioCodec||v.audioCodec,this.audioCodecSwap&&v&&(this.log("Swapping audio codec"),v=v.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),v},o._loadBitrateTestFrag=function(v,y){var S=this;v.bitrateTest=!0,this._doFragLoad(v,y).then(function(L){var B,A=S.hls;L&&!S.fragContextChanged(v)&&(S.fragLoadError=0,S.state=_.State.IDLE,S.startFragRequested=!1,S.bitrateTest=!1,(B=v.stats).parsing.start=B.parsing.end=B.buffering.start=B.buffering.end=self.performance.now(),A.trigger(T.Events.FRAG_LOADED,L),v.bitrateTest=!1)})},o._handleTransmuxComplete=function(B){var y="main",S=this.hls,L=B.remuxResult,B=B.chunkMeta,A=this.getCurrentContext(B);if(A){var I=A.frag,U=A.part,A=A.level,P=L.video,F=L.text,M=L.id3,w=L.initSegment,R=A.details,O=this.altAudio?void 0:L.audio;if(!this.fragContextChanged(I)){if(this.state=_.State.PARSING,w&&(w.tracks&&(this._bufferInitSegment(A,w.tracks,I,B),S.trigger(T.Events.FRAG_PARSING_INIT_SEGMENT,{frag:I,id:y,tracks:w.tracks})),A=w.initPTS,w=w.timescale,(0,f.isFiniteNumber)(A))&&(this.initPTS[I.cc]=A,S.trigger(T.Events.INIT_PTS_FOUND,{frag:I,id:y,initPTS:A,timescale:w})),P&&L.independent!==!1){if(R){var A=P.startPTS,w=P.endPTS,j=P.startDTS,z=P.endDTS;if(U)U.elementaryStreams[P.type]={startPTS:A,endPTS:w,startDTS:j,endDTS:z};else if(P.firstKeyFrame&&P.independent&&B.id===1&&(this.couldBacktrack=!0),P.dropped&&P.independent){var G=this.getMainFwdBufferInfo();if((G?G.end:this.getLoadPosition())+this.config.maxBufferHole<(P.firstKeyFramePTS||A)-this.config.maxBufferHole)return void this.backtrack(I);I.setElementaryStreamInfo(P.type,I.start,w,I.start,z,!0)}I.setElementaryStreamInfo(P.type,A,w,j,z),this.backtrackFragment&&(this.backtrackFragment=I),this.bufferFragmentData(P,I,U,B)}}else if(L.independent===!1)return void this.backtrack(I);O&&(G=O.startPTS,A=O.endPTS,w=O.startDTS,j=O.endDTS,U&&(U.elementaryStreams[t.ElementaryStreamTypes.AUDIO]={startPTS:G,endPTS:A,startDTS:w,endDTS:j}),I.setElementaryStreamInfo(t.ElementaryStreamTypes.AUDIO,G,A,w,j),this.bufferFragmentData(O,I,U,B)),R&&M!=null&&(z=M.samples)!=null&&z.length&&(P={id:y,frag:I,details:R,samples:M.samples},S.trigger(T.Events.FRAG_PARSING_METADATA,P)),R&&F&&(L={id:y,frag:I,details:R,samples:F.samples},S.trigger(T.Events.FRAG_PARSING_USERDATA,L))}}else this.warn("The loading context changed while buffering fragment "+B.sn+" of level "+B.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(B.level)},o._bufferInitSegment=function(v,y,S,L){var B,A,I,U,P,F=this;this.state===_.State.PARSING&&(this.audioOnly=!!y.audio&&!y.video,this.altAudio&&!this.audioOnly&&delete y.audio,B=y.audio,A=y.video,I=y.audiovideo,B&&(U=v.audioCodec,P=navigator.userAgent.toLowerCase(),this.audioCodecSwitch&&(U=U&&(U.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),B.metadata.channelCount!==1)&&P.indexOf("firefox")===-1&&(U="mp4a.40.5"),P.indexOf("android")!==-1&&B.container!=="audio/mpeg"&&this.log("Android: force audio codec to "+(U="mp4a.40.2")),v.audioCodec&&v.audioCodec!==U&&this.log('Swapping manifest audio codec "'+v.audioCodec+'" for "'+U+'"'),B.levelCodec=U,B.id="main",this.log("Init audio buffer, container:"+B.container+", codecs[selected/level/parsed]=["+(U||"")+"/"+(v.audioCodec||"")+"/"+B.codec+"]")),A&&(A.levelCodec=v.videoCodec,A.id="main",this.log("Init video buffer, container:"+A.container+", codecs[level/parsed]=["+(v.videoCodec||"")+"/"+A.codec+"]")),I&&this.log("Init audiovideo buffer, container:"+I.container+", codecs[level/parsed]=["+(v.attrs.CODECS||"")+"/"+I.codec+"]"),this.hls.trigger(T.Events.BUFFER_CODECS,y),Object.keys(y).forEach(function(M){var w=y[M].initSegment;w!=null&&w.byteLength&&F.hls.trigger(T.Events.BUFFER_APPENDING,{type:M,data:w,frag:S,part:null,chunkMeta:L,parent:S.type})}),this.tick())},o.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer||this.media,k.PlaylistLevelType.MAIN)},o.backtrack=function(v){this.couldBacktrack=!0,this.backtrackFragment=v,this.resetTransmuxer(),this.flushBufferGap(v),this.fragmentTracker.removeFragment(v),this.fragPrevious=null,this.nextLoadPosition=v.start,this.state=_.State.IDLE},o.checkFragmentChanged=function(){var v,y=this.media,S=null;y&&1<y.readyState&&y.seeking===!1&&(v=y.currentTime,E.BufferHelper.isBuffered(y,v)?S=this.getAppendedFrag(v):E.BufferHelper.isBuffered(y,v+.1)&&(S=this.getAppendedFrag(v+.1)),S)&&(this.backtrackFragment=null,y=this.fragPlaying,v=S.level,y&&S.sn===y.sn&&y.level===v&&S.urlId===y.urlId||(this.fragPlaying=S,this.hls.trigger(T.Events.FRAG_CHANGED,{frag:S}),y&&y.level===v)||this.hls.trigger(T.Events.LEVEL_SWITCHED,{level:v}))},p((l=C).prototype,[{key:"nextLevel",get:function(){var v=this.nextBufferedFrag;return v?v.level:-1}},{key:"currentFrag",get:function(){var v=this.media;return v?this.fragPlaying||this.getAppendedFrag(v.currentTime):null}},{key:"currentProgramDateTime",get:function(){var v=this.media;if(v){var v=v.currentTime,y=this.currentFrag;if(y&&(0,f.isFiniteNumber)(v)&&(0,f.isFiniteNumber)(y.programDateTime))return v=y.programDateTime+1e3*(v-y.start),new Date(v)}return null}},{key:"currentLevel",get:function(){var v=this.currentFrag;return v?v.level:-1}},{key:"nextBufferedFrag",get:function(){var v=this.currentFrag;return v?this.followingBufferedFrag(v):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),Object.defineProperty(l,"prototype",{writable:!1});var x,b=C;function C(v,y,S){return(v=x.call(this,v,y,S,"[stream-controller]")||this).audioCodecSwap=!1,v.gapController=null,v.level=-1,v._forceStartLoad=!1,v.altAudio=!1,v.audioOnly=!1,v.fragPlaying=null,v.onvplaying=null,v.onvseeked=null,v.fragLastKbps=0,v.couldBacktrack=!1,v.backtrackFragment=null,v.audioCodecSwitch=!1,v.videoBuffer=null,v._registerListeners(),v}},"./src/controller/subtitle-stream-controller.ts":(c,l,o)=>{o.r(l),o.d(l,{SubtitleStreamController:()=>p});var f=o("./src/events.ts"),_=o("./src/utils/buffer-helper.ts"),g=o("./src/controller/fragment-finders.ts"),T=o("./src/utils/discontinuities.ts"),E=o("./src/controller/level-helper.ts"),h=o("./src/controller/fragment-tracker.ts"),k=o("./src/controller/base-stream-controller.ts"),t=o("./src/types/loader.ts"),r=o("./src/types/level.ts");function n(b,C){for(var v,y=0;y<C.length;y++){var S=C[y];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(b,typeof(v=(function(L){if(typeof L!="object"||L===null)return L;var B=L[Symbol.toPrimitive];if(B===void 0)return String(L);if(B=B.call(L,"string"),typeof B!="object")return B;throw new TypeError("@@toPrimitive must return a primitive value.")})(S.key))=="symbol"?v:String(v),S)}}function a(b,C){return(a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(v,y){return v.__proto__=y,v})(b,C)}d=k.default,l=d,(o=x).prototype=Object.create(l.prototype),a(o.prototype.constructor=o,l),(o=x.prototype).onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},o._registerListeners=function(){var b=this.hls;b.on(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),b.on(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),b.on(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),b.on(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),b.on(f.Events.ERROR,this.onError,this),b.on(f.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),b.on(f.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),b.on(f.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),b.on(f.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),b.on(f.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),b.on(f.Events.FRAG_BUFFERED,this.onFragBuffered,this)},o._unregisterListeners=function(){var b=this.hls;b.off(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),b.off(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),b.off(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),b.off(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),b.off(f.Events.ERROR,this.onError,this),b.off(f.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),b.off(f.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),b.off(f.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),b.off(f.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),b.off(f.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),b.off(f.Events.FRAG_BUFFERED,this.onFragBuffered,this)},o.startLoad=function(b){this.stopLoad(),this.state=k.State.IDLE,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=b,this.tick()},o.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},o.onLevelLoaded=function(b,C){this.mainDetails=C.details},o.onSubtitleFragProcessed=function(b,y){var v=y.frag,y=y.success;if(this.fragPrevious=v,this.state=k.State.IDLE,y){var S=this.tracksBuffered[this.currentTrackId];if(S){for(var L,B=v.start,A=0;A<S.length;A++)if(B>=S[A].start&&B<=S[A].end){L=S[A];break}y=v.start+v.duration,L?L.end=y:S.push(L={start:B,end:y}),this.fragmentTracker.fragBuffered(v)}}},o.onBufferFlushing=function(b,C){var v,y,S,L=C.startOffset,B=C.endOffset;L===0&&B!==Number.POSITIVE_INFINITY&&(v=this.currentTrackId,(y=this.levels).length)&&y[v]&&y[v].details&&((S=B-y[v].details.targetduration)<=0||(C.endOffsetSubtitles=Math.max(0,S),this.tracksBuffered.forEach(function(A){for(var I=0;I<A.length;)if(A[I].end<=S)A.shift();else{if(!(A[I].start<S))break;A[I].start=S,I++}}),this.fragmentTracker.removeFragmentsInRange(L,S,t.PlaylistLevelType.SUBTITLE)))},o.onFragBuffered=function(b,C){this.loadedmetadata||C.frag.type!==t.PlaylistLevelType.MAIN||(C=this.media)!=null&&C.buffered.length&&(this.loadedmetadata=!0)},o.onError=function(b,C){C=C.frag,C&&C.type===t.PlaylistLevelType.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state=k.State.IDLE)},o.onSubtitleTracksUpdated=function(b,y){var v=this,y=y.subtitleTracks;this.tracksBuffered=[],this.levels=y.map(function(S){return new r.Level(S)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(S){v.tracksBuffered[S.id]=[]}),this.mediaBuffer=null},o.onSubtitleTrackSwitch=function(b,C){this.currentTrackId=C.id,this.levels.length&&this.currentTrackId!==-1?((C=this.levels[this.currentTrackId])!=null&&C.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,C&&this.setInterval(500)):this.clearInterval()},o.onSubtitleTrackLoaded=function(b,y){var v=y.details,y=y.id,S=this.currentTrackId,L=this.levels;if(L.length){var B=L[S];if(!(y>=L.length||y!==S)&&B){if(this.mediaBuffer=this.mediaBufferTimeRanges,L=0,v.live||(S=B.details)!=null&&S.live){if(S=this.mainDetails,v.deltaUpdateFailed||!S)return;var A=S.fragments[0];B.details?(L=this.alignPlaylists(v,B.details))===0&&A&&(L=A.start,(0,E.addSliding)(v,L)):v.hasProgramDateTime&&S.hasProgramDateTime?((0,T.alignMediaPlaylistByPDT)(v,S),L=v.fragments[0].start):A&&(L=A.start,(0,E.addSliding)(v,L))}B.details=v,this.levelLastLoaded=y,this.startFragRequested||!this.mainDetails&&v.live||this.setStartPosition(B.details,L),this.tick(),!v.live||this.fragCurrent||!this.media||this.state!==k.State.IDLE||(0,g.findFragmentByPTS)(null,v.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),B.details=void 0)}}},o._handleFragmentLoadComplete=function(S){var C,v=this,y=S.frag,S=S.payload,L=y.decryptdata,B=this.hls;!this.fragContextChanged(y)&&S&&0<S.byteLength&&L&&L.key&&L.iv&&L.method==="AES-128"&&(C=performance.now(),this.decrypter.decrypt(new Uint8Array(S),L.key.buffer,L.iv.buffer).then(function(A){var I=performance.now();B.trigger(f.Events.FRAG_DECRYPTED,{frag:y,payload:A,stats:{tstart:C,tdecrypt:I}})}).catch(function(A){v.warn(A.name+": "+A.message),v.state=k.State.IDLE}))},o.doTick=function(){var b,C,v,y,S,L,B,A;this.media?this.state===k.State.IDLE&&(A=this.currentTrackId,(b=this.levels).length)&&b[A]&&b[A].details&&(A=(b=b[A].details).targetduration,C=this.config,y=this.getLoadPosition(),v=(y=_.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],y-A,C.maxBufferHole)).end,y=y.len,S=this.getFwdBufferInfo(this.media,t.PlaylistLevelType.MAIN),y>this.getMaxBufferLength(S?.len)+A||(console.assert(b,"Subtitle track details are defined on idle subtitle stream controller tick"),S=(y=b.fragments).length,A=b.edge,L=null,B=this.fragPrevious,v<A?(A=C.maxFragLookUpTolerance,!(L=(0,g.findFragmentByPTS)(B,y,Math.max(y[0].start,v),A))&&B&&B.start<y[0].start&&(L=y[0])):L=y[S-1],L&&(L=this.mapToInitFragWhenRequired(L),this.fragmentTracker.getState(L)===h.FragmentState.NOT_LOADED)&&this.loadFragment(L,b,v))):this.state=k.State.IDLE},o.getMaxBufferLength=function(b){var C=d.prototype.getMaxBufferLength.call(this);return b?Math.max(C,b):C},o.loadFragment=function(b,C,v){(this.fragCurrent=b).sn==="initSegment"?this._loadInitSegment(b,C):(this.startFragRequested=!0,d.prototype.loadFragment.call(this,b,C,v))},n((l=x).prototype,[{key:"mediaBufferTimeRanges",get:function(){return new m(this.tracksBuffered[this.currentTrackId]||[])}}]),Object.defineProperty(l,"prototype",{writable:!1});var d,p=x,m=function(b){this.buffered=void 0;function C(v,y,S){if((y>>>=0)>S-1)throw new DOMException("Failed to execute '"+v+"' on 'TimeRanges': The index provided ("+y+") is greater than the maximum bound ("+S+")");return b[y][v]}this.buffered={get length(){return b.length},end:function(v){return C("end",v,b.length)},start:function(v){return C("start",v,b.length)}}};function x(b,C,v){return(b=d.call(this,b,C,v,"[subtitle-stream-controller]")||this).levels=[],b.currentTrackId=-1,b.tracksBuffered=[],b.mainDetails=null,b._registerListeners(),b}},"./src/controller/subtitle-track-controller.ts":(c,T,o)=>{o.r(T),o.d(T,{default:()=>n});var f,_=o("./src/events.ts"),g=o("./src/utils/texttrack-utils.ts"),T=o("./src/controller/base-playlist-controller.ts"),E=o("./src/types/loader.ts");function h(a,d){for(var p,m=0;m<d.length;m++){var x=d[m];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(a,typeof(p=(function(b){if(typeof b!="object"||b===null)return b;var C=b[Symbol.toPrimitive];if(C===void 0)return String(b);if(C=C.call(b,"string"),typeof C!="object")return C;throw new TypeError("@@toPrimitive must return a primitive value.")})(x.key))=="symbol"?p:String(p),x)}}function k(a,d){return(k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(p,m){return p.__proto__=m,p})(a,d)}function t(a){var d;return(d=f.call(this,a,"[subtitle-track-controller]")||this).media=null,d.tracks=[],d.groupId=null,d.tracksInGroup=[],d.trackId=-1,d.selectDefaultTrack=!0,d.queuedDefaultTrack=-1,d.trackChangeListener=function(){return d.onTextTracksChanged()},d.asyncPollTrackChange=function(){return d.pollTrackChange(0)},d.useTextTrackPolling=!1,d.subtitlePollingInterval=-1,d._subtitleDisplay=!0,d.registerListeners(),d}function r(a){for(var d=[],p=0;p<a.length;p++){var m=a[p];m.kind==="subtitles"&&m.label&&d.push(a[p])}return d}f=T.default,o=f,(T=t).prototype=Object.create(o.prototype),k(T.prototype.constructor=T,o),(T=t.prototype).destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,f.prototype.destroy.call(this)},T.registerListeners=function(){var a=this.hls;a.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.on(_.Events.LEVEL_LOADING,this.onLevelLoading,this),a.on(_.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),a.on(_.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),a.on(_.Events.ERROR,this.onError,this)},T.unregisterListeners=function(){var a=this.hls;a.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.off(_.Events.LEVEL_LOADING,this.onLevelLoading,this),a.off(_.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),a.off(_.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),a.off(_.Events.ERROR,this.onError,this)},T.onMediaAttached=function(a,d){this.media=d.media,this.media&&(-1<this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},T.pollTrackChange=function(a){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,a)},T.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),-1<this.trackId&&(this.queuedDefaultTrack=this.trackId),r(this.media.textTracks).forEach(function(a){(0,g.clearCurrentCues)(a)}),this.subtitleTrack=-1,this.media=null)},T.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},T.onManifestParsed=function(a,d){this.tracks=d.subtitleTracks},T.onSubtitleTrackLoaded=function(a,d){var p,m=d.id,x=d.details,b=this.trackId,b=this.tracksInGroup[b];b?(p=b.details,b.details=d.details,this.log("subtitle track "+m+" loaded ["+x.startSN+"-"+x.endSN+"]"),m===this.trackId&&(this.retryCount=0,this.playlistLoaded(m,d,p))):this.warn("Invalid subtitle track id "+m)},T.onLevelLoading=function(a,d){this.switchLevel(d.level)},T.onLevelSwitching=function(a,d){this.switchLevel(d.level)},T.switchLevel=function(b){var d,p,m,x,b=this.hls.levels[b];b!=null&&b.textGroupIds&&(d=b.textGroupIds[b.urlId],this.groupId!==d)&&(b=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,p=this.tracks.filter(function(C){return!d||C.groupId===d}),this.tracksInGroup=p,m=this.findTrackId(b?.name)||this.findTrackId(),this.groupId=d,x={subtitleTracks:p},this.log("Updating subtitle tracks, "+p.length+' track(s) found in "'+d+'" group-id'),this.hls.trigger(_.Events.SUBTITLE_TRACKS_UPDATED,x),m!==-1)&&this.setSubtitleTrack(m,b)},T.findTrackId=function(a){for(var d=this.tracksInGroup,p=0;p<d.length;p++){var m=d[p];if((!this.selectDefaultTrack||m.default)&&(!a||a===m.name))return m.id}return-1},T.onError=function(a,d){f.prototype.onError.call(this,a,d),!d.fatal&&d.context&&d.context.type===E.PlaylistContextType.SUBTITLE_TRACK&&d.context.id===this.trackId&&d.context.groupId===this.groupId&&this.retryLoadingOrFail(d)},T.loadPlaylist=function(a){f.prototype.loadPlaylist.call(this);var d=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(d)){var p=d.id,m=d.groupId,d=d.url;if(a)try{d=a.addDirectives(d)}catch(b){this.warn("Could not construct new URL with HLS Delivery Directives: "+b)}this.log("Loading subtitle playlist for id "+p),this.hls.trigger(_.Events.SUBTITLE_TRACK_LOADING,{url:d,id:p,groupId:m,deliveryDirectives:a||null})}},T.toggleTrackModes=function(a){var d,p=this,m=this.media,x=this.trackId;m&&(d=(m=r(m.textTracks)).filter(function(b){return b.groupId===p.groupId}),a===-1?[].slice.call(m).forEach(function(b){b.mode="disabled"}):(m=d[x])&&(m.mode="disabled"),x=d[a])&&(x.mode=this.subtitleDisplay?"showing":"hidden")},T.setSubtitleTrack=function(a,d){var p,m,x,b,C,v=this.tracksInGroup;this.media?(this.trackId!==a&&this.toggleTrackModes(a),this.trackId===a&&(a===-1||(p=v[a])!=null&&p.details)||a<-1||a>=v.length||(this.clearTimer(),p=v[a],this.log("Switching to subtitle track "+a),this.trackId=a,p?(v=p.id,m=p.groupId,x=p.name,b=p.type,C=p.url,this.hls.trigger(_.Events.SUBTITLE_TRACK_SWITCH,{id:v,groupId:m===void 0?"":m,name:x,type:b,url:C}),v=this.switchParams(p.url,d?.details),this.loadPlaylist(v)):this.hls.trigger(_.Events.SUBTITLE_TRACK_SWITCH,{id:a}))):this.queuedDefaultTrack=a},T.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var a=-1,d=r(this.media.textTracks),p=0;p<d.length;p++)if(d[p].mode==="hidden")a=p;else if(d[p].mode==="showing"){a=p;break}this.subtitleTrack!==a&&(this.subtitleTrack=a)}},h((o=t).prototype,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(a){this._subtitleDisplay=a,-1<this.trackId&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(a){this.selectDefaultTrack=!1;var d=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(a,d)}}]),Object.defineProperty(o,"prototype",{writable:!1});const n=t},"./src/controller/timeline-controller.ts":(c,l,o)=>{o.r(l),o.d(l,{TimelineController:()=>a});var f=o("./src/polyfills/number.ts"),_=o("./src/events.ts"),g=o("./src/utils/cea-608-parser.ts"),T=o("./src/utils/output-filter.ts"),E=o("./src/utils/webvtt-parser.ts"),h=o("./src/utils/texttrack-utils.ts"),k=o("./src/utils/imsc1-ttml-parser.ts"),t=o("./src/utils/mp4-tools.ts"),r=o("./src/types/loader.ts"),n=o("./src/utils/logger.ts"),a=((l=d.prototype).destroy=function(){var p=this.hls;p.off(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),p.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),p.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),p.off(_.Events.MANIFEST_LOADED,this.onManifestLoaded,this),p.off(_.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),p.off(_.Events.FRAG_LOADING,this.onFragLoading,this),p.off(_.Events.FRAG_LOADED,this.onFragLoaded,this),p.off(_.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),p.off(_.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),p.off(_.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),p.off(_.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),p.off(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},l.addCues=function(p,m,x,b,C){for(var v,y,S,L=!1,B=C.length;B--;){var A=C[B],I=(v=A[0],I=A[1],y=m,Math.min(I,x)-Math.max(v,y));if(0<=I&&(A[0]=Math.min(A[0],m),A[1]=Math.max(A[1],x),L=!0,.5<I/(x-m)))return}L||C.push([m,x]),this.config.renderTextTracksNatively?(S=this.captionsTracks[p],this.Cues.newCue(S,m,x,b)):(S=this.Cues.newCue(null,m,x,b),this.hls.trigger(_.Events.CUES_PARSED,{type:"captions",cues:S,track:p}))},l.onInitPtsFound=function(p,y){var x=this,b=y.frag,C=y.id,v=y.initPTS,y=y.timescale,S=this.unparsedVttFrags;C==="main"&&(this.initPTS[b.cc]=v,this.timescale[b.cc]=y),S.length&&(this.unparsedVttFrags=[],S.forEach(function(L){x.onFragLoaded(_.Events.FRAG_LOADED,L)}))},l.getExistingTrack=function(p){var m=this.media;if(m)for(var x=0;x<m.textTracks.length;x++){var b=m.textTracks[x];if(b[p])return b}return null},l.createCaptionsTrack=function(p){this.config.renderTextTracksNatively?this.createNativeTrack(p):this.createNonNativeTrack(p)},l.createNativeTrack=function(p){var m,x,b,C,v;this.captionsTracks[p]||(C=this.captionsProperties,m=this.captionsTracks,x=this.media,b=(C=C[p]).label,C=C.languageCode,(v=this.getExistingTrack(p))?(m[p]=v,(0,h.clearCurrentCues)(m[p]),(0,h.sendAddTrackEvent)(m[p],x)):(v=this.createTextTrack("captions",b,C))&&(v[p]=!0,m[p]=v))},l.createNonNativeTrack=function(p){var m;this.nonNativeCaptionsTracks[p]||(m=this.captionsProperties[p])&&(m={_id:p,label:m.label,kind:"captions",default:!!m.media&&!!m.media.default,closedCaptions:m.media},this.nonNativeCaptionsTracks[p]=m,this.hls.trigger(_.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[m]}))},l.createTextTrack=function(p,m,x){var b=this.media;if(b)return b.addTextTrack(p,m,x)},l.onMediaAttaching=function(p,m){this.media=m.media,this._cleanTracks()},l.onMediaDetaching=function(){var p=this.captionsTracks;Object.keys(p).forEach(function(m){(0,h.clearCurrentCues)(p[m]),delete p[m]}),this.nonNativeCaptionsTracks={}},l.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},l._cleanTracks=function(){var p=this.media;if(p){var m=p.textTracks;if(m)for(var x=0;x<m.length;x++)(0,h.clearCurrentCues)(m[x])}},l.onSubtitleTracksUpdated=function(p,C){var x,b=this,C=(this.textTracks=[],C.subtitleTracks||[]),v=C.some(function(y){return y.textCodec===k.IMSC1_CODEC});(this.config.enableWebVTT||v&&this.config.enableIMSC1)&&(v=this.tracks&&C&&this.tracks.length===C.length,this.tracks=C||[],this.config.renderTextTracksNatively?(x=this.media?this.media.textTracks:[],this.tracks.forEach(function(y,S){var L,B,A;if(S<x.length){for(var I=null,U=0;U<x.length;U++)if(B=x[U],A=y,B&&B.label===A.name&&!B.textTrack1&&!B.textTrack2){I=x[U];break}I&&(L=I)}L?(0,h.clearCurrentCues)(L):(S=b._captionsOrSubtitlesFromCharacteristics(y),(L=b.createTextTrack(S,y.name,y.lang))&&(L.mode="disabled")),L&&(L.groupId=y.groupId,b.textTracks.push(L))})):!v&&this.tracks&&this.tracks.length&&(C=this.tracks.map(function(y){return{label:y.name,kind:y.type.toLowerCase(),default:y.default,subtitleTrack:y}}),this.hls.trigger(_.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:C})))},l._captionsOrSubtitlesFromCharacteristics=function(p){if((m=p.attrs)!=null&&m.CHARACTERISTICS){var m=/transcribes-spoken-dialog/gi.test(p.attrs.CHARACTERISTICS),p=/describes-music-and-sound/gi.test(p.attrs.CHARACTERISTICS);if(m&&p)return"captions"}return"subtitles"},l.onManifestLoaded=function(p,m){var x=this;this.config.enableCEA708Captions&&m.captions&&m.captions.forEach(function(b){var C=/(?:CC|SERVICE)([1-4])/.exec(b.instreamId);C&&(C="textTrack"+C[1],C=x.captionsProperties[C])&&(C.label=b.name,b.lang&&(C.languageCode=b.lang),C.media=b)})},l.closedCaptionsForLevel=function(p){return p=this.hls.levels[p.level],p?.attrs["CLOSED-CAPTIONS"]},l.onFragLoading=function(p,m){var x,b=this.cea608Parser1,C=this.cea608Parser2,v=this.lastSn,y=this.lastPartIndex;this.enabled&&b&&C&&m.frag.type===r.PlaylistLevelType.MAIN&&(x=m.frag.sn,m=(m=m==null||(m=m.part)==null?void 0:m.index)!=null?m:-1,x===v+1||x===v&&m===y+1||(b.reset(),C.reset()),this.lastSn=x,this.lastPartIndex=m)},l.onFragLoaded=function(p,m){var x,b,C=m.frag,v=m.payload,y=this.initPTS,S=this.unparsedVttFrags;C.type===r.PlaylistLevelType.SUBTITLE&&(v.byteLength?(0,f.isFiniteNumber)(y[C.cc])?(x=C.decryptdata,b="stats"in m,x!=null&&x.encrypted&&!b||(x=this.tracks[C.level],(b=this.vttCCs)[C.cc]||(b[C.cc]={start:C.start,prevCC:this.prevCC,new:!0},this.prevCC=C.cc),x&&x.textCodec===k.IMSC1_CODEC?this._parseIMSC1(C,v):this._parseVTTs(C,v,b))):(S.push(m),y.length&&this.hls.trigger(_.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:C,error:new Error("Missing initial subtitle PTS")})):this.hls.trigger(_.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:C,error:new Error("Empty subtitle payload")}))},l._parseIMSC1=function(p,m){var x=this,b=this.hls;(0,k.parseIMSC1)(m,this.initPTS[p.cc],this.timescale[p.cc],function(C){x._appendCues(C,p.level),b.trigger(_.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:p})},function(C){n.logger.log("Failed to parse IMSC1: "+C),b.trigger(_.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:p,error:C})})},l._parseVTTs=function(p,m,x){var b=this,C=this.hls,v=(v=p.initSegment)!=null&&v.data?(0,t.appendUint8Array)(p.initSegment.data,new Uint8Array(m)):m;(0,E.parseWebVTT)(v,this.initPTS[p.cc],this.timescale[p.cc],x,p.cc,p.start,function(y){b._appendCues(y,p.level),C.trigger(_.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:p})},function(y){b._fallbackToIMSC1(p,m),n.logger.log("Failed to parse VTT cue: "+y),C.trigger(_.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:p,error:y})})},l._fallbackToIMSC1=function(p,m){var x=this,b=this.tracks[p.level];b.textCodec||(0,k.parseIMSC1)(m,this.initPTS[p.cc],this.timescale[p.cc],function(){b.textCodec=k.IMSC1_CODEC,x._parseIMSC1(p,m)},function(){b.textCodec="wvtt"})},l._appendCues=function(p,m){var x,b,C=this.hls;this.config.renderTextTracksNatively?(x=this.textTracks[m])&&x.mode!=="disabled"&&p.forEach(function(v){return(0,h.addCueToTrack)(x,v)}):(b=this.tracks[m])&&(b=b.default?"default":"subtitles"+m,C.trigger(_.Events.CUES_PARSED,{type:"subtitles",cues:p,track:b}))},l.onFragDecrypted=function(p,m){var x=m.frag;x.type===r.PlaylistLevelType.SUBTITLE&&((0,f.isFiniteNumber)(this.initPTS[x.cc])?this.onFragLoaded(_.Events.FRAG_LOADED,m):this.unparsedVttFrags.push(m))},l.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},l.onFragParsingUserdata=function(p,m){var x=this.cea608Parser1,b=this.cea608Parser2;if(this.enabled&&x&&b){var C=m.frag,v=m.samples;if(C.type!==r.PlaylistLevelType.MAIN||this.closedCaptionsForLevel(C)!=="NONE")for(var y=0;y<v.length;y++){var S=v[y].bytes;S&&(S=this.extractCea608Data(S),x.addData(v[y].pts,S[0]),b.addData(v[y].pts,S[1]))}}},l.onBufferFlushing=function(p,S){var x,b,C=S.startOffset,v=S.endOffset,y=S.endOffsetSubtitles,S=S.type,L=this.media;!L||L.currentTime<v||(S&&S!=="video"||(x=this.captionsTracks,Object.keys(x).forEach(function(B){return(0,h.removeCuesInRange)(x[B],C,v)})),this.config.renderTextTracksNatively&&C===0&&y!==void 0&&(b=this.textTracks,Object.keys(b).forEach(function(B){return(0,h.removeCuesInRange)(b[B],C,y)})))},l.extractCea608Data=function(p){for(var m=[[],[]],x=31&p[0],b=2,C=0;C<x;C++){var v=p[b++],y=127&p[b++],S=127&p[b++];y==0&&S==0||(4&v)==0||(v=3&v)!=0&&v!=1||(m[v].push(y),m[v].push(S))}return m},d);function d(p){var m,x,b,C;this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=p,this.config=p.config,this.Cues=p.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions&&(m=new T.default(this,"textTrack1"),x=new T.default(this,"textTrack2"),b=new T.default(this,"textTrack3"),C=new T.default(this,"textTrack4"),this.cea608Parser1=new g.default(1,m,x),this.cea608Parser2=new g.default(3,b,C)),p.on(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),p.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),p.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),p.on(_.Events.MANIFEST_LOADED,this.onManifestLoaded,this),p.on(_.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),p.on(_.Events.FRAG_LOADING,this.onFragLoading,this),p.on(_.Events.FRAG_LOADED,this.onFragLoaded,this),p.on(_.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),p.on(_.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),p.on(_.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),p.on(_.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),p.on(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}},"./src/crypt/aes-crypto.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>f}),_.prototype.decrypt=function(g,T){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},T,g)};var f=_;function _(g,T){this.subtle=void 0,this.aesIV=void 0,this.subtle=g,this.aesIV=T}},"./src/crypt/aes-decryptor.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>_,removePadding:()=>function(T){var E=T.byteLength,h=E&&new DataView(T.buffer).getUint8(E-1);return h?(0,f.sliceUint8)(T,0,E-h):T}});var f=o("./src/utils/typed-array.ts");(l=g.prototype).uint8ArrayToUint32Array_=function(T){for(var E=new DataView(T),h=new Uint32Array(4),k=0;k<4;k++)h[k]=E.getUint32(4*k);return h},l.initTable=function(){for(var T=this.sBox,E=this.invSBox,n=this.subMix,h=n[0],k=n[1],t=n[2],r=n[3],n=this.invSubMix,a=n[0],d=n[1],p=n[2],m=n[3],x=new Uint32Array(256),b=0,C=0,v=0,v=0;v<256;v++)x[v]=v<128?v<<1:v<<1^283;for(v=0;v<256;v++){var y=C^C<<1^C<<2^C<<3^C<<4,S=(T[b]=y=y>>>8^255&y^99,x[E[y]=b]),L=x[S],B=x[L],A=257*x[y]^16843008*y;h[b]=A<<24|A>>>8,k[b]=A<<16|A>>>16,t[b]=A<<8|A>>>24,r[b]=A,a[y]=(A=16843009*B^65537*L^257*S^16843008*b)<<24|A>>>8,d[y]=A<<16|A>>>16,p[y]=A<<8|A>>>24,m[y]=A,b?(b=S^x[x[x[B^S]]],C^=x[x[C]]):b=C=1}},l.expandKey=function(T){for(var E=this.uint8ArrayToUint32Array_(T),h=!0,k=0;k<E.length&&h;)h=E[k]===this.key[k],k++;if(!h){this.key=E;var t=this.keySize=E.length;if(t!==4&&t!==6&&t!==8)throw new Error("Invalid aes key size="+t);for(var r,n,a,d=this.ksRows=4*(t+6+1),p=this.keySchedule=new Uint32Array(d),m=this.invKeySchedule=new Uint32Array(d),x=this.sBox,b=this.rcon,T=this.invSubMix,C=T[0],v=T[1],y=T[2],S=T[3],L=0;L<d;L++)L<t?n=p[L]=E[L]:(a=n,L%t==0?(a=x[(a=a<<8|a>>>24)>>>24]<<24|x[a>>>16&255]<<16|x[a>>>8&255]<<8|x[255&a],a^=b[L/t|0]<<24):6<t&&L%t==4&&(a=x[a>>>24]<<24|x[a>>>16&255]<<16|x[a>>>8&255]<<8|x[255&a]),p[L]=n=(p[L-t]^a)>>>0);for(r=0;r<d;r++)L=d-r,a=3&r?p[L]:p[L-4],m[r]=r<4||L<=4?a:C[x[a>>>24]]^v[x[a>>>16&255]]^y[x[a>>>8&255]]^S[x[255&a]],m[r]=m[r]>>>0}},l.networkToHostOrderSwap=function(T){return T<<24|(65280&T)<<8|(16711680&T)>>8|T>>>24},l.decrypt=function(T,E,h){for(var k,t,r,n,a,d,p,m,x,b,C,v,y,S,L=this.keySize+6,B=this.invKeySchedule,A=this.invSBox,M=this.invSubMix,I=M[0],U=M[1],P=M[2],F=M[3],M=this.uint8ArrayToUint32Array_(h),w=M[0],R=M[1],O=M[2],j=M[3],z=new Int32Array(T),G=new Int32Array(z.length),K=this.networkToHostOrderSwap;E<z.length;){for(x=K(z[E]),b=K(z[E+1]),C=K(z[E+2]),v=K(z[E+3]),a=x^B[0],d=v^B[1],p=C^B[2],m=b^B[3],y=4,S=1;S<L;S++)k=I[a>>>24]^U[d>>16&255]^P[p>>8&255]^F[255&m]^B[y],t=I[d>>>24]^U[p>>16&255]^P[m>>8&255]^F[255&a]^B[y+1],r=I[p>>>24]^U[m>>16&255]^P[a>>8&255]^F[255&d]^B[y+2],n=I[m>>>24]^U[a>>16&255]^P[d>>8&255]^F[255&p]^B[y+3],a=k,d=t,p=r,m=n,y+=4;k=A[a>>>24]<<24^A[d>>16&255]<<16^A[p>>8&255]<<8^A[255&m]^B[y],t=A[d>>>24]<<24^A[p>>16&255]<<16^A[m>>8&255]<<8^A[255&a]^B[y+1],r=A[p>>>24]<<24^A[m>>16&255]<<16^A[a>>8&255]<<8^A[255&d]^B[y+2],n=A[m>>>24]<<24^A[a>>16&255]<<16^A[d>>8&255]<<8^A[255&p]^B[y+3],G[E]=K(k^w),G[E+1]=K(n^R),G[E+2]=K(r^O),G[E+3]=K(t^j),w=x,R=b,O=C,j=v,E+=4}return G.buffer};var _=g;function g(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}},"./src/crypt/decrypter.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>k});var f=o("./src/crypt/aes-crypto.ts"),_=o("./src/crypt/fast-aes-key.ts"),g=o("./src/crypt/aes-decryptor.ts"),T=o("./src/utils/logger.ts"),E=o("./src/utils/mp4-tools.ts"),h=o("./src/utils/typed-array.ts"),k=((l=t.prototype).destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},l.isSync=function(){return this.useSoftware},l.flush=function(){var r=this.currentResult,n=this.remainderData;return!r||n?(T.logger.error("[softwareDecrypt] "+(n?"overflow bytes: "+n.byteLength:"no result")),this.reset(),null):(n=new Uint8Array(r),this.reset(),this.removePKCS7Padding?(0,g.removePadding)(n):n)},l.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},l.decrypt=function(r,n,a){var d=this;return this.useSoftware?new Promise(function(p,m){d.softwareDecrypt(new Uint8Array(r),n,a);var x=d.flush();x?p(x.buffer):m(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(r),n,a)},l.softwareDecrypt=function(r,n,a){var d=this.currentIV,p=this.currentResult,m=this.remainderData,m=(this.logOnce("JS AES decrypt"),m&&(r=(0,E.appendUint8Array)(m,r),this.remainderData=null),this.getValidChunk(r));return m.length?(d&&(a=d),r=this.softwareDecrypter,(r=r||(this.softwareDecrypter=new g.default)).expandKey(n),d=p,this.currentResult=r.decrypt(m.buffer,0,a),this.currentIV=(0,h.sliceUint8)(m,-16).buffer,d||null):null},l.webCryptoDecrypt=function(r,n,a){var d=this,p=this.subtle;return this.key===n&&this.fastAesKey||(this.key=n,this.fastAesKey=new _.default(p,n)),this.fastAesKey.expandKey().then(function(m){return p?(d.logOnce("WebCrypto AES decrypt"),new f.default(p,new Uint8Array(a)).decrypt(r.buffer,m)):Promise.reject(new Error("web crypto not initialized"))}).catch(function(m){return T.logger.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+m.name+": "+m.message),d.onWebCryptoError(r,n,a)})},l.onWebCryptoError=function(r,n,a){if(this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(r,n,a),r=this.flush(),r)return r.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},l.getValidChunk=function(r){var n=r,a=r.length-r.length%16;return a!==r.length&&(n=(0,h.sliceUint8)(r,0,a),this.remainderData=(0,h.sliceUint8)(r,a)),n},l.logOnce=function(r){this.logEnabled&&(T.logger.log("[decrypter]: "+r),this.logEnabled=!1)},t);function t(r,n){if(n=(n===void 0?{}:n).removePKCS7Padding,n=n===void 0||n,this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=r.enableSoftwareAES,this.removePKCS7Padding=n)try{var a=self.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch{}this.subtle===null&&(this.useSoftware=!0)}},"./src/crypt/fast-aes-key.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>f}),_.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])};var f=_;function _(g,T){this.subtle=void 0,this.key=void 0,this.subtle=g,this.key=T}},"./src/demux/aacdemuxer.ts":(c,_,o)=>{o.r(_),o.d(_,{default:()=>t});var f,_=o("./src/demux/base-audio-demuxer.ts"),g=o("./src/demux/adts.ts"),T=o("./src/utils/logger.ts"),E=o("./src/demux/id3.ts");function h(r,n){return(h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,d){return a.__proto__=d,a})(r,n)}function k(r,n){var a;return(a=f.call(this)||this).observer=void 0,a.config=void 0,a.observer=r,a.config=n,a}f=_.default,o=f,(_=k).prototype=Object.create(o.prototype),h(_.prototype.constructor=_,o),(_=k.prototype).resetInitSegment=function(r,n,a,d){f.prototype.resetInitSegment.call(this,r,n,a,d),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:n,duration:d,inputTimeScale:9e4,dropped:0}},k.probe=function(r){if(r){for(var n=(E.getID3Data(r,0)||[]).length,a=r.length;n<a;n++)if(g.probe(r,n))return T.logger.log("ADTS sync word found !"),!0}return!1},_.canParse=function(r,n){return g.canParse(r,n)},_.appendFrame=function(r,n,a){if(g.initTrackConfig(r,this.observer,n,a,r.manifestCodec),r=g.appendFrame(r,n,a,this.basePTS,this.frameIndex),r&&r.missing===0)return r};const t=k},"./src/demux/adts.ts":(c,l,o)=>{o.r(l),o.d(l,{appendFrame:()=>function(d,p,m,v,y){var C,v=v+y*n(d.samplerate),y=a(p,m);{var S,L;if(y)return S=y.frameLength,y=y.headerLength,S=y+S,(L=Math.max(0,m+S-p.length))?(C=new Uint8Array(S-y)).set(p.subarray(m+y,p.length),0):C=p.subarray(m+y,m+S),y={unit:C,pts:v},L||d.samples.push(y),{sample:y,length:S,missing:L}}return d=p.length-m,(C=new Uint8Array(d)).set(p.subarray(m,p.length),0),{sample:{unit:C,pts:v},length:d,missing:-1}},canGetFrameLength:()=>t,canParse:()=>function(d,p){return t(d,p)&&E(d,p)&&k(d,p)<=d.length-p},getAudioConfig:()=>T,getFrameDuration:()=>n,getFullFrameLength:()=>k,getHeaderLength:()=>h,initTrackConfig:()=>function(d,p,m,x,b){d.samplerate||(p=T(p,m,x,b))&&(d.config=p.config,d.samplerate=p.samplerate,d.channelCount=p.channelCount,d.codec=p.codec,d.manifestCodec=p.manifestCodec,f.logger.log("parsed codec:"+d.codec+", rate:"+p.samplerate+", channels:"+p.channelCount))},isHeader:()=>r,isHeaderPattern:()=>E,parseFrameHeader:()=>a,probe:()=>function(d,p){{var m,x;if(r(d,p))return x=h(d,p),!(p+x>=d.length||(m=k(d,p))<=x)&&((x=p+m)===d.length||r(d,x))}return!1}});var f=o("./src/utils/logger.ts"),_=o("./src/errors.ts"),g=o("./src/events.ts");function T(d,p,m,x){var b,C,v=navigator.userAgent.toLowerCase(),y=x,S=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],L=1+((192&p[m+2])>>>6),B=(60&p[m+2])>>>2;if(!(S.length-1<B))return b=(1&p[m+2])<<2,b|=(192&p[m+3])>>>6,f.logger.log("manifest codec:"+x+", ADTS type:"+L+", samplingIndex:"+B),p=/firefox/i.test(v)?6<=B?(L=5,C=new Array(4),B-3):(L=2,C=new Array(2),B):v.indexOf("android")!==-1?(L=2,C=new Array(2),B):(L=5,C=new Array(4),x&&(x.indexOf("mp4a.40.29")!==-1||x.indexOf("mp4a.40.5")!==-1)||!x&&6<=B?B-3:((x&&x.indexOf("mp4a.40.2")!==-1&&(6<=B&&b==1||/vivaldi/i.test(v))||!x&&b==1)&&(L=2,C=new Array(2)),B)),C[0]=L<<3,C[0]|=(14&B)>>1,C[1]|=(1&B)<<7,C[1]|=b<<3,L===5&&(C[1]|=(14&p)>>1,C[2]=(1&p)<<7,C[2]|=8,C[3]=0),{config:C,samplerate:S[B],channelCount:b,codec:"mp4a.40."+L,manifestCodec:y};d.trigger(g.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+B})}function E(d,p){return d[p]===255&&(246&d[p+1])==240}function h(d,p){return 1&d[p+1]?7:9}function k(d,p){return(3&d[p+3])<<11|d[p+4]<<3|(224&d[p+5])>>>5}function t(d,p){return p+5<d.length}function r(d,p){return p+1<d.length&&E(d,p)}function n(d){return 9216e4/d}function a(d,p){var m=h(d,p);if(p+m<=d.length&&(d=k(d,p)-m,0<d))return{headerLength:m,frameLength:d}}},"./src/demux/base-audio-demuxer.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>r,initPTSFn:()=>k});var f=o("./src/polyfills/number.ts"),_=o("./src/demux/id3.ts"),g=o("./src/types/demuxer.ts"),T=o("./src/demux/dummy-demuxed-track.ts"),E=o("./src/utils/mp4-tools.ts"),h=o("./src/utils/typed-array.ts");(l=t.prototype).resetInitSegment=function(n,a,d,p){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},l.resetTimeStamp=function(n){this.initPTS=n,this.resetContiguity()},l.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},l.canParse=function(n,a){return!1},l.appendFrame=function(n,a,d){},l.demux=function(n,a){this.cachedData&&(n=(0,E.appendUint8Array)(this.cachedData,n),this.cachedData=null);var d,p,m=_.getID3Data(n,0),x=m?m.length:0,b=this._audioTrack,C=this._id3Track,v=m?_.getTimeStamp(m):void 0,y=n.length;for((this.basePTS===null||this.frameIndex===0&&(0,f.isFiniteNumber)(v))&&(this.basePTS=k(v,a,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),m&&0<m.length&&C.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:m,type:g.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});x<y;)this.canParse(n,x)?(p=this.appendFrame(b,n,x))?(this.frameIndex++,this.lastPTS=p.sample.pts,d=x+=p.length):x=y:_.canParse(n,x)?(m=_.getID3Data(n,x),C.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:m,type:g.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),d=x+=m.length):x++,x===y&&d!==y&&(p=(0,h.sliceUint8)(n,d),this.cachedData?this.cachedData=(0,E.appendUint8Array)(this.cachedData,p):this.cachedData=p);return{audioTrack:b,videoTrack:(0,T.dummyTrack)(),id3Track:C,textTrack:(0,T.dummyTrack)()}},l.demuxSampleAes=function(n,a,d){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},l.flush=function(n){var a=this.cachedData;return a&&(this.cachedData=null,this.demux(a,0)),{audioTrack:this._audioTrack,videoTrack:(0,T.dummyTrack)(),id3Track:this._id3Track,textTrack:(0,T.dummyTrack)()}},l.destroy=function(){};var k=function(n,a,d){return(0,f.isFiniteNumber)(n)?90*n:9e4*a+(d||0)};function t(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}const r=t},"./src/demux/chunk-cache.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>f}),(o=_.prototype).push=function(g){this.chunks.push(g),this.dataLength+=g.length},o.flush=function(){var g=this.chunks,T=this.dataLength;return g.length?(g=g.length===1?g[0]:(function(E){for(var h=new Uint8Array(T),k=0,t=0;t<E.length;t++){var r=E[t];h.set(r,k),k+=r.length}return h})(g),this.reset(),g):new Uint8Array(0)},o.reset=function(){this.chunks.length=0,this.dataLength=0};var f=_;function _(){this.chunks=[],this.dataLength=0}},"./src/demux/dummy-demuxed-track.ts":(c,l,o)=>{o.r(l),o.d(l,{dummyTrack:()=>function(f,_){return{type:f=f===void 0?"":f,id:-1,pid:-1,inputTimeScale:_=_===void 0?9e4:_,sequenceNumber:-1,samples:[],dropped:0}}})},"./src/demux/exp-golomb.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>_});var f=o("./src/utils/logger.ts");(l=g.prototype).loadWord=function(){var T=this.data,k=this.bytesAvailable,E=T.byteLength-k,h=new Uint8Array(4),k=Math.min(4,k);if(k===0)throw new Error("no bytes available");h.set(T.subarray(E,E+k)),this.word=new DataView(h.buffer).getUint32(0),this.bitsAvailable=8*k,this.bytesAvailable-=k},l.skipBits=function(T){var E;T=Math.min(T,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>T||(T=(T-=this.bitsAvailable)-((E=T>>3)<<3),this.bytesAvailable-=E,this.loadWord()),this.word<<=T,this.bitsAvailable-=T},l.readBits=function(T){var E=Math.min(this.bitsAvailable,T),h=this.word>>>32-E;if(32<T&&f.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=E,0<this.bitsAvailable)this.word<<=E;else{if(!(0<this.bytesAvailable))throw new Error("no bits available");this.loadWord()}return 0<(E=T-E)&&this.bitsAvailable?h<<E|this.readBits(E):h},l.skipLZ=function(){for(var T=0;T<this.bitsAvailable;++T)if((this.word&2147483648>>>T)!=0)return this.word<<=T,this.bitsAvailable-=T,T;return this.loadWord(),T+this.skipLZ()},l.skipUEG=function(){this.skipBits(1+this.skipLZ())},l.skipEG=function(){this.skipBits(1+this.skipLZ())},l.readUEG=function(){var T=this.skipLZ();return this.readBits(T+1)-1},l.readEG=function(){var T=this.readUEG();return 1&T?1+T>>>1:-1*(T>>>1)},l.readBoolean=function(){return this.readBits(1)===1},l.readUByte=function(){return this.readBits(8)},l.readUShort=function(){return this.readBits(16)},l.readUInt=function(){return this.readBits(32)},l.skipScalingList=function(T){for(var E=8,h=8,k=0;k<T;k++)E=(h=h!==0?(E+this.readEG()+256)%256:h)===0?E:h},l.readSPS=function(){var T,E,h,k=0,t=0,r=0,n=0,a=this.readUByte.bind(this),y=this.readBits.bind(this),d=this.readUEG.bind(this),p=this.readBoolean.bind(this),m=this.skipBits.bind(this),x=this.skipEG.bind(this),v=this.skipUEG.bind(this),b=this.skipScalingList.bind(this),C=(a(),a());if(y(5),m(3),a(),v(),(C===100||C===110||C===122||C===244||C===44||C===83||C===86||C===118||C===128)&&(C=d(),C===3&&m(1),v(),v(),m(1),p()))for(E=C!==3?8:12,h=0;h<E;h++)p()&&b(h<6?16:64);if(v(),C=d(),C===0)d();else if(C===1)for(m(1),x(),x(),T=d(),h=0;h<T;h++)x();v(),m(1);var C=d(),v=d(),y=y(1),S=(y===0&&m(1),m(1),p()&&(k=d(),t=d(),r=d(),n=d()),[1,1]);if(p()&&p())switch(a()){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:S=[a()<<8|a(),a()<<8|a()]}return{width:Math.ceil(16*(C+1)-2*k-2*t),height:(2-y)*(v+1)*16-(y?2:4)*(r+n),pixelRatio:S}},l.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()};const _=g;function g(T){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=T,this.bytesAvailable=T.byteLength,this.word=0,this.bitsAvailable=0}},"./src/demux/id3.ts":(c,l,o)=>{o.r(l),o.d(l,{canParse:()=>h,decodeFrame:()=>a,getID3Data:()=>T,getID3Frames:()=>n,getTimeStamp:()=>k,isFooter:()=>g,isHeader:()=>_,isTimeStampFrame:()=>t,testables:()=>C,utf8ArrayToStr:()=>b});var f,_=function(v,y){return y+10<=v.length&&v[y]===73&&v[y+1]===68&&v[y+2]===51&&v[y+3]<255&&v[y+4]<255&&v[y+6]<128&&v[y+7]<128&&v[y+8]<128&&v[y+9]<128},g=function(v,y){return y+10<=v.length&&v[y]===51&&v[y+1]===68&&v[y+2]===73&&v[y+3]<255&&v[y+4]<255&&v[y+6]<128&&v[y+7]<128&&v[y+8]<128&&v[y+9]<128},T=function(v,y){for(var S=y,L=0;_(v,y);)L=(L+=10)+E(v,y+6),g(v,y+10)&&(L+=10),y+=L;if(0<L)return v.subarray(S,S+L)},E=function(v,y){var S=0,S=(127&v[y])<<21;return(S=(S|=(127&v[y+1])<<14)|(127&v[y+2])<<7)|127&v[y+3]},h=function(v,y){return _(v,y)&&E(v,y+6)+10<=v.length-y},k=function(v){for(var y=n(v),S=0;S<y.length;S++){var L=y[S];if(t(L))return x(L)}},t=function(v){return v&&v.key==="PRIV"&&v.info==="com.apple.streaming.transportStreamTimestamp"},r=function(v){var y=String.fromCharCode(v[0],v[1],v[2],v[3]),S=E(v,4);return{type:y,size:S,data:v.subarray(10,10+S)}},n=function(v){for(var y=0,S=[];_(v,y);){for(var L=E(v,y+6),B=(y+=10)+L;y+8<B;){var A=r(v.subarray(y)),I=a(A);I&&S.push(I),y+=A.size+10}g(v,y)&&(y+=10)}return S},a=function(v){return(v.type==="PRIV"?d:v.type[0]==="W"?m:p)(v)},d=function(v){var y,S;if(!(v.size<2))return y=b(v.data,!0),S=new Uint8Array(v.data.subarray(y.length+1)),{key:v.type,info:y,data:S.buffer}},p=function(v){var y,S;if(!(v.size<2))return v.type==="TXXX"?(y=1,y+=(S=b(v.data.subarray(1),!0)).length+1,y=b(v.data.subarray(y)),{key:v.type,info:S,data:y}):(S=b(v.data.subarray(1)),{key:v.type,data:S})},m=function(v){var y,S;return v.type==="WXXX"?v.size<2?void 0:(y=1,y+=(S=b(v.data.subarray(1),!0)).length+1,y=b(v.data.subarray(y)),{key:v.type,info:S,data:y}):(S=b(v.data),{key:v.type,data:S})},x=function(v){var y;if(v.data.byteLength===8)return y=1&(v=new Uint8Array(v.data))[3],v=(v[4]<<23)+(v[5]<<15)+(v[6]<<7)+v[7],v/=45,y&&(v+=4772185884e-2),Math.round(v)},b=function(v,y){y===void 0&&(y=!1);var S,L;if(f=f||self.TextDecoder===void 0?f:new self.TextDecoder("utf-8"),f)return S=f.decode(v),y?(L=S.indexOf("\0"))!==-1?S.substring(0,L):S:S.replace(/\0/g,"");for(var B,A,I,U=v.length,P="",F=0;F<U;){if((B=v[F++])===0&&y)return P;if(B!==0&&B!==3)switch(B>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:P+=String.fromCharCode(B);break;case 12:case 13:A=v[F++],P+=String.fromCharCode((31&B)<<6|63&A);break;case 14:A=v[F++],I=v[F++],P+=String.fromCharCode((15&B)<<12|(63&A)<<6|(63&I)<<0)}}return P},C={decodeTextFrame:p}},"./src/demux/mp3demuxer.ts":(c,_,o)=>{o.r(_),o.d(_,{default:()=>t});var f,_=o("./src/demux/base-audio-demuxer.ts"),g=o("./src/demux/id3.ts"),T=o("./src/utils/logger.ts"),E=o("./src/demux/mpegaudio.ts");function h(r,n){return(h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,d){return a.__proto__=d,a})(r,n)}function k(){return f.apply(this,arguments)||this}f=_.default,o=f,(_=k).prototype=Object.create(o.prototype),h(_.prototype.constructor=_,o),(_=k.prototype).resetInitSegment=function(r,n,a,d){f.prototype.resetInitSegment.call(this,r,n,a,d),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:n,duration:d,inputTimeScale:9e4,dropped:0}},k.probe=function(r){if(r){for(var n=(g.getID3Data(r,0)||[]).length,a=r.length;n<a;n++)if(E.probe(r,n))return T.logger.log("MPEG Audio sync word found !"),!0}return!1},_.canParse=function(r,n){return E.canParse(r,n)},_.appendFrame=function(r,n,a){if(this.basePTS!==null)return E.appendFrame(r,n,a,this.basePTS,this.frameIndex)};const t=k},"./src/demux/mp4demuxer.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>h});var f=o("./src/polyfills/number.ts"),_=o("./src/types/demuxer.ts"),g=o("./src/utils/mp4-tools.ts"),T=o("./src/demux/dummy-demuxed-track.ts"),E=/\/emsg[-/]ID3/i;(l=k.prototype).resetTimeStamp=function(){},l.resetInitSegment=function(t,r,n,a){var d,p,m,x=this.videoTrack=(0,T.dummyTrack)("video",1),b=this.audioTrack=(0,T.dummyTrack)("audio",1),C=this.txtTrack=(0,T.dummyTrack)("text",1);this.id3Track=(0,T.dummyTrack)("id3",1),this.timeOffset=0,t&&t.byteLength&&((t=(0,g.parseInitSegment)(t)).video&&(d=(m=t.video).id,p=m.timescale,m=m.codec,x.id=d,x.timescale=C.timescale=p,x.codec=m),t.audio&&(p=(d=t.audio).id,m=d.timescale,t=d.codec,b.id=p,b.timescale=m,b.codec=t),C.id=g.RemuxerTrackIdConfig.text,x.sampleDuration=0,x.duration=b.duration=a)},l.resetContiguity=function(){},k.probe=function(t){return t=16384<t.length?t.subarray(0,16384):t,0<(0,g.findBox)(t,["moof"]).length},l.demux=function(p,r){this.timeOffset=r;var n=p,a=this.videoTrack,d=this.txtTrack,p=(this.config.progressive?(this.remainderData&&(n=(0,g.appendUint8Array)(this.remainderData,p)),p=(0,g.segmentValidRange)(n),this.remainderData=p.remainder,a.samples=p.valid||new Uint8Array):a.samples=n,this.extractID3Track(a,r));return d.samples=(0,g.parseSamples)(r,a),{videoTrack:a,audioTrack:this.audioTrack,id3Track:p,textTrack:this.txtTrack}},l.flush=function(){var t=this.timeOffset,r=this.videoTrack,n=this.txtTrack,a=(r.samples=this.remainderData||new Uint8Array,this.remainderData=null,this.extractID3Track(r,this.timeOffset));return n.samples=(0,g.parseSamples)(t,r),{videoTrack:r,audioTrack:(0,T.dummyTrack)(),id3Track:a,textTrack:(0,T.dummyTrack)()}},l.extractID3Track=function(t,r){var n=this.id3Track;return t.samples.length&&(t=(0,g.findBox)(t.samples,["emsg"]))&&t.forEach(function(m){var d,p,m=(0,g.parseEmsg)(m);E.test(m.schemeIdUri)&&(d=(0,f.isFiniteNumber)(m.presentationTime)?m.presentationTime/m.timeScale:r+m.presentationTimeDelta/m.timeScale,(p=m.eventDuration===4294967295?Number.POSITIVE_INFINITY:m.eventDuration/m.timeScale)<=.001&&(p=Number.POSITIVE_INFINITY),m=m.payload,n.samples.push({data:m,len:m.byteLength,dts:d,pts:d,type:_.MetadataSchema.emsg,duration:p}))}),n},l.demuxSampleAes=function(t,r,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},l.destroy=function(){};const h=k;function k(t,r){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=r}},"./src/demux/mpegaudio.ts":(c,l,o)=>{o.r(l),o.d(l,{appendFrame:()=>function(r,n,a,d,p){if(!(a+24>n.length)){var m=h(n,a);if(m&&a+m.frameLength<=n.length)return d=d+p*(9e4*m.samplesPerFrame/m.sampleRate),p={unit:n.subarray(a,a+m.frameLength),pts:d,dts:d},r.config=[],r.channelCount=m.channelCount,r.samplerate=m.sampleRate,r.samples.push(p),{sample:p,length:m.frameLength,missing:0}}},canParse:()=>function(r,n){return k(r,n)&&4<=r.length-n},isHeader:()=>t,isHeaderPattern:()=>k,parseHeader:()=>h,probe:()=>function(r,n){{var a,d;if(n+1<r.length&&k(r,n))return d=h(r,n),a=4,d!=null&&d.frameLength&&(a=d.frameLength),(d=n+a)===r.length||t(r,d)}return!1}});var f=null,_=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],g=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],T=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],E=[0,1,1,4];function h(r,n){var a,d,p,m,x,b=r[n+1]>>3&3,C=r[n+1]>>1&3,v=r[n+2]>>4&15,y=r[n+2]>>2&3;if(b!=1&&v!=0&&v!=15&&y!=3)return x=r[n+2]>>1&1,a=r[n+3]>>6,v=1e3*_[14*(b==3?3-C:C==3?3:4)+v-1],y=g[3*(b==3?0:b==2?1:2)+y],d=a==3?1:2,m=8*(b=T[b][C])*(p=E[C]),b=Math.floor(b*v/y+x)*p,f===null&&(x=(navigator.userAgent||"").match(/Chrome\/(\d+)/i),f=x?parseInt(x[1]):0),f&&f<=87&&C==2&&224e3<=v&&a==0&&(r[n+3]=128|r[n+3]),{sampleRate:y,channelCount:d,frameLength:b,samplesPerFrame:m}}function k(r,n){return r[n]===255&&(224&r[n+1])==224&&(6&r[n+1])!=0}function t(r,n){return n+1<r.length&&k(r,n)}},"./src/demux/sample-aes.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>g});var f=o("./src/crypt/decrypter.ts"),_=o("./src/utils/mp4-tools.ts");(l=T.prototype).decryptBuffer=function(E){return this.decrypter.decrypt(E,this.keyData.key.buffer,this.keyData.iv.buffer)},l.decryptAacSample=function(E,h,k){var t,r=this,n=E[h].unit;n.length<=16||(t=(t=n.subarray(16,n.length-n.length%16)).buffer.slice(t.byteOffset,t.byteOffset+t.length),this.decryptBuffer(t).then(function(a){a=new Uint8Array(a),n.set(a,16),r.decrypter.isSync()||r.decryptAacSamples(E,h+1,k)}))},l.decryptAacSamples=function(E,h,k){for(;;h++){if(h>=E.length)return void k();if(!(E[h].unit.length<32||(this.decryptAacSample(E,h,k),this.decrypter.isSync())))return}},l.getAvcEncryptedData=function(E){for(var h=16*Math.floor((E.length-48)/160)+16,k=new Int8Array(h),t=0,r=32;r<E.length-16;r+=160,t+=16)k.set(E.subarray(r,r+16),t);return k},l.getAvcDecryptedUnit=function(E,h){for(var k=new Uint8Array(h),t=0,r=32;r<E.length-16;r+=160,t+=16)E.set(k.subarray(t,t+16),r);return E},l.decryptAvcSample=function(E,h,k,t,r){var n=this,a=(0,_.discardEPB)(r.data),d=this.getAvcEncryptedData(a);this.decryptBuffer(d.buffer).then(function(p){r.data=n.getAvcDecryptedUnit(a,p),n.decrypter.isSync()||n.decryptAvcSamples(E,h,k+1,t)})},l.decryptAvcSamples=function(E,h,k,t){if(E instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;h++,k=0){if(h>=E.length)return void t();for(var r=E[h].units;!(k>=r.length);k++){var n=r[k];if(!(n.data.length<=48||n.type!==1&&n.type!==5||(this.decryptAvcSample(E,h,k,t,n),this.decrypter.isSync())))return}}};const g=T;function T(E,h,k){this.keyData=void 0,this.decrypter=void 0,this.keyData=k,this.decrypter=new f.default(h,{removePKCS7Padding:!1})}},"./src/demux/transmuxer-interface.ts":(c,h,o)=>{o.r(h),o.d(h,{default:()=>r});var f=o("./src/demux/webworkify-webpack.js"),_=o("./src/events.ts"),g=o("./src/demux/transmuxer.ts"),T=o("./src/utils/logger.ts"),E=o("./src/errors.ts"),h=o("./src/utils/mediasource-helper.ts"),k=o("./node_modules/eventemitter3/index.js"),t=(0,h.getMediaSource)()||{isTypeSupported:function(){return!1}},r=((o=n.prototype).destroy=function(){var a=this.worker,a=(a?(a.removeEventListener("message",this.onwmsg),a.terminate(),this.worker=null,this.onwmsg=void 0):(a=this.transmuxer)&&(a.destroy(),this.transmuxer=null),this.observer);a&&a.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},o.push=function(a,d,p,m,x,b,C,v,y,S){var L=this,B=(y.transmuxing.start=self.performance.now(),this.transmuxer),A=this.worker,I=(b||x).start,U=x.decryptdata,P=this.frag,F=!(P&&x.cc===P.cc),M=!(P&&y.level===P.level),j=P?y.sn-P.sn:-1,w=this.part?y.part-this.part.index:-1,R=j==0&&1<y.id&&y.id===P?.stats.chunkCount,R=!M&&(j==1||j==0&&(w==1||R&&w<=0)),O=self.performance.now(),O=((M||j||x.stats.parsing.start===0)&&(x.stats.parsing.start=O),!b||!w&&R||(b.stats.parsing.start=O),!(P&&((j=x.initSegment)==null?void 0:j.url)===((w=P.initSegment)==null?void 0:w.url))),j=new g.TransmuxState(F,R,v,M,I,O);R&&!F&&!O||(T.logger.log("[transmuxer-interface, "+x.type+"]: Starting new transmux session for sn: "+y.sn+" p: "+y.part+" level: "+y.level+" id: "+y.id+`
        discontinuity: `+F+`
        trackSwitch: `+M+`
        contiguous: `+R+`
        accurateTimeOffset: `+v+`
        timeOffset: `+I+`
        initSegmentChange: `+O),P=new g.TransmuxConfig(p,m,d,C,S),this.configureTransmuxer(P)),this.frag=x,this.part=b,A?A.postMessage({cmd:"demux",data:a,decryptdata:U,chunkMeta:y,state:j},a instanceof ArrayBuffer?[a]:[]):B&&(w=B.push(a,U,y,j),(0,g.isPromise)(w)?(B.async=!0,w.then(function(z){L.handleTransmuxComplete(z)}).catch(function(z){L.transmuxerError(z,y,"transmuxer-interface push error")})):(B.async=!1,this.handleTransmuxComplete(w)))},o.flush=function(a){var d=this,p=(a.transmuxing.start=self.performance.now(),this.transmuxer),m=this.worker;m?m.postMessage({cmd:"flush",chunkMeta:a}):p&&(m=p.flush(a),(0,g.isPromise)(m)||p.async?(m=(0,g.isPromise)(m)?m:Promise.resolve(m)).then(function(x){d.handleFlushResult(x,a)}).catch(function(x){d.transmuxerError(x,a,"transmuxer-interface flush error")}):this.handleFlushResult(m,a))},o.transmuxerError=function(a,d,p){this.hls&&this.hls.trigger(_.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:d,fatal:!1,error:a,err:a,reason:p})},o.handleFlushResult=function(a,d){var p=this;a.forEach(function(m){p.handleTransmuxComplete(m)}),this.onFlush(d)},o.onWorkerMessage=function(a){var d=a.data,p=this.hls;switch(d.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(d.data);break;case"flush":this.onFlush(d.data);break;case"workerLog":T.logger[d.data.logType]&&T.logger[d.data.logType](d.data.message);break;default:d.data=d.data||{},d.data.frag=this.frag,d.data.id=this.id,p.trigger(d.event,d.data)}},o.configureTransmuxer=function(a){var d=this.worker,p=this.transmuxer;d?d.postMessage({cmd:"configure",config:a}):p&&p.configure(a)},o.handleTransmuxComplete=function(a){a.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(a)},n);function n(a,d,y,S){function x(L,B){(B=B||{}).frag=C.frag,B.id=C.id,C.hls.trigger(L,B)}var b,C=this,v=(this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,a.config),y=(this.hls=a,this.id=d,this.useWorker=!!v.enableWorker,this.onTransmuxComplete=y,this.onFlush=S,this.observer=new k.EventEmitter,this.observer.on(_.Events.FRAG_DECRYPTED,x),this.observer.on(_.Events.ERROR,x),{mp4:t.isTypeSupported("video/mp4"),mpeg:t.isTypeSupported("audio/mpeg"),mp3:t.isTypeSupported('audio/mp4; codecs="mp3"')}),S=navigator.vendor;if(this.useWorker&&typeof Worker<"u"){T.logger.log("demuxing in webworker");try{b=this.worker=(0,f.default)("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),b.addEventListener("message",this.onwmsg),b.onerror=function(L){C.useWorker=!1,T.logger.warn("Exception in webworker, fallback to inline"),C.hls.trigger(_.Events.ERROR,{type:E.ErrorTypes.OTHER_ERROR,details:E.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(L.message+"  ("+L.filename+":"+L.lineno+")")})},b.postMessage({cmd:"init",typeSupported:y,vendor:S,id:d,config:JSON.stringify(v)})}catch(L){T.logger.warn("Error in worker:",L),T.logger.error("Error while initializing DemuxerWorker, fallback to inline"),b&&self.URL.revokeObjectURL(b.objectURL),this.transmuxer=new g.default(this.observer,y,v,S,d),this.worker=null}}else this.transmuxer=new g.default(this.observer,y,v,S,d)}},"./src/demux/transmuxer-worker.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>function(r){function n(d,p){r.postMessage({event:d,data:p})}var a=new T.EventEmitter;a.on(_.Events.FRAG_DECRYPTED,n),a.on(_.Events.ERROR,n),r.addEventListener("message",function(d){var p=d.data;switch(p.cmd){case"init":var m,b=JSON.parse(p.config);for(m in r.transmuxer=new f.default(a,p.typeSupported,b,p.vendor,p.id),(0,g.enableLogs)(b.debug,p.id),g.logger)(function(C){g.logger[C]=function(v){n("workerLog",{logType:C,message:v})}})(m);n("init",null);break;case"configure":r.transmuxer.configure(p.config);break;case"demux":b=r.transmuxer.push(p.data,p.decryptdata,p.chunkMeta,p.state),(0,f.isPromise)(b)?(r.transmuxer.async=!0,b.then(function(C){h(r,C)}).catch(function(C){n(_.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:p.chunkMeta,fatal:!1,error:C,err:C,reason:"transmuxer-worker push error"})})):(r.transmuxer.async=!1,h(r,b));break;case"flush":var x=p.chunkMeta,b=r.transmuxer.flush(x);(0,f.isPromise)(b)||r.transmuxer.async?(b=(0,f.isPromise)(b)?b:Promise.resolve(b)).then(function(C){t(r,C,x)}).catch(function(C){n(_.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:p.chunkMeta,fatal:!1,error:C,err:C,reason:"transmuxer-worker flush error"})}):t(r,b,x)}})}});var f=o("./src/demux/transmuxer.ts"),_=o("./src/events.ts"),g=o("./src/utils/logger.ts"),T=o("./node_modules/eventemitter3/index.js"),E=o("./src/errors.ts");function h(r,n){var a,d,p;return!!((a=n.remuxResult).audio||a.video||a.text||a.id3||a.initSegment)&&(a=[],d=(p=n.remuxResult).audio,p=p.video,d&&k(a,d),p&&k(a,p),r.postMessage({event:"transmuxComplete",data:n},a),!0)}function k(r,n){n.data1&&r.push(n.data1.buffer),n.data2&&r.push(n.data2.buffer)}function t(r,n,a){n.reduce(function(d,p){return h(r,p)||d},!1)||r.postMessage({event:"transmuxComplete",data:n[0]}),r.postMessage({event:"flush",data:a})}},"./src/demux/transmuxer.ts":(c,E,o)=>{o.r(E),o.d(E,{TransmuxConfig:()=>C,TransmuxState:()=>v,default:()=>p,isPromise:()=>b});var f,_=o("./src/events.ts"),g=o("./src/errors.ts"),T=o("./src/crypt/decrypter.ts"),E=o("./src/demux/aacdemuxer.ts"),h=o("./src/demux/mp4demuxer.ts"),k=o("./src/demux/tsdemuxer.ts"),t=o("./src/demux/mp3demuxer.ts"),r=o("./src/remux/mp4-remuxer.ts"),n=o("./src/remux/passthrough-remuxer.ts"),a=o("./src/utils/logger.ts");try{f=self.performance.now.bind(self.performance)}catch{a.logger.debug("Unable to use Performance API on this environment"),f=self.Date.now}var d=[{demux:h.default,remux:n.default},{demux:k.default,remux:r.default},{demux:E.default,remux:r.default},{demux:t.default,remux:r.default}],p=((o=x.prototype).configure=function(y){this.transmuxConfig=y,this.decrypter&&this.decrypter.reset()},o.push=function(U,S,L,O){var A=this,I=L.transmuxing,U=(I.executeStart=f(),new Uint8Array(U)),P=this.currentTransmuxState,$=this.transmuxConfig,O=(O&&(this.currentTransmuxState=O),O||P),P=O.contiguous,F=O.discontinuity,M=O.trackSwitch,w=O.accurateTimeOffset,R=O.timeOffset,O=O.initSegmentChange,j=$.audioCodec,z=$.videoCodec,G=$.defaultInitPts,K=$.duration,$=$.initSegmentData,V=(V=null,V=0<U.byteLength&&S!=null&&S.key!=null&&S.iv!==null&&S.method!=null?S:V);if(V&&V.method==="AES-128"){var q=this.getDecrypter();if(!q.isSync())return this.decryptionPromise=q.webCryptoDecrypt(U,V.key.buffer,V.iv.buffer).then(function(J){return J=A.push(J,null,L),A.decryptionPromise=null,J}),this.decryptionPromise;if(q=q.softwareDecrypt(U,V.key.buffer,V.iv.buffer),!q)return I.executeEnd=f(),m(L);U=new Uint8Array(q)}return q=this.needsProbing(F,M),q&&this.configureTransmuxer(U),(F||M||O||q)&&this.resetInitSegment($,j,z,K,S),(F||O||q)&&this.resetInitialTimestamp(G),P||this.resetContiguity(),M=this.transmux(U,V,R,w,L),$=this.currentTransmuxState,$.contiguous=!0,$.discontinuity=!1,$.trackSwitch=!1,I.executeEnd=f(),M},o.flush=function(y){var S,L=this,B=y.transmuxing,A=(B.executeStart=f(),this.decrypter),I=this.currentTransmuxState,U=this.decryptionPromise;return U?U.then(function(){return L.flush(y)}):(S=[],U=I.timeOffset,A&&(I=A.flush())&&S.push(this.push(I,null,y)),A=this.demuxer,I=this.remuxer,A&&I?b(I=A.flush(U))?I.then(function(P){return L.flushRemux(S,P,y),S}):(this.flushRemux(S,I,y),S):(this.observer.emit(_.Events.ERROR,_.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),B.executeEnd=f(),[m(y)]))},o.flushRemux=function(y,I,L){var F=I.audioTrack,B=I.videoTrack,A=I.id3Track,I=I.textTrack,P=this.currentTransmuxState,U=P.accurateTimeOffset,P=P.timeOffset,F=(a.logger.log("[transmuxer.ts]: Flushed fragment "+L.sn+(-1<L.part?" p: "+L.part:"")+" of level "+L.level),this.remuxer.remux(F,B,A,I,P,U,!0,this.id));y.push({remuxResult:F,chunkMeta:L}),L.transmuxing.executeEnd=f()},o.resetInitialTimestamp=function(y){var S=this.demuxer,L=this.remuxer;S&&L&&(S.resetTimeStamp(y),L.resetTimeStamp(y))},o.resetContiguity=function(){var y=this.demuxer,S=this.remuxer;y&&S&&(y.resetContiguity(),S.resetNextTimestamp())},o.resetInitSegment=function(y,S,L,B,A){var I=this.demuxer,U=this.remuxer;I&&U&&(I.resetInitSegment(y,S,L,B),U.resetInitSegment(y,S,L,A))},o.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},o.transmux=function(y,S,L,B,A){return S&&S.method==="SAMPLE-AES"?this.transmuxSampleAes(y,S,L,B,A):this.transmuxUnencrypted(y,L,B,A)},o.transmuxUnencrypted=function(P,S,L,B){var P=this.demuxer.demux(P,S,!1,!this.config.progressive),A=P.audioTrack,I=P.videoTrack,U=P.id3Track,P=P.textTrack;return{remuxResult:this.remuxer.remux(A,I,U,P,S,L,!1,this.id),chunkMeta:B}},o.transmuxSampleAes=function(y,S,L,B,A){var I=this;return this.demuxer.demuxSampleAes(y,S,L).then(function(U){return{remuxResult:I.remuxer.remux(U.audioTrack,U.videoTrack,U.id3Track,U.textTrack,L,B,!1,I.id),chunkMeta:A}})},o.configureTransmuxer=function(y){for(var S,L=this.config,B=this.observer,A=this.typeSupported,I=this.vendor,U=0,P=d.length;U<P;U++)if(d[U].demux.probe(y)){S=d[U];break}S||(a.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),S={demux:h.default,remux:n.default});var F=this.demuxer,M=this.remuxer,w=S.remux,R=S.demux;M&&M instanceof w||(this.remuxer=new w(B,L,A,I)),F&&F instanceof R||(this.demuxer=new R(B,L,A),this.probe=R.probe)},o.needsProbing=function(y,S){return!this.demuxer||!this.remuxer||y||S},o.getDecrypter=function(){return this.decrypter||(this.decrypter=new T.default(this.config))},x),m=function(y){return{remuxResult:{},chunkMeta:y}};function x(y,S,L,B,A){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=y,this.typeSupported=S,this.config=L,this.vendor=B,this.id=A}function b(y){return"then"in y&&y.then instanceof Function}var C=function(y,S,L,B,A){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=y,this.videoCodec=S,this.initSegmentData=L,this.duration=B,this.defaultInitPts=A},v=function(y,S,L,B,A,I){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=y,this.contiguous=S,this.accurateTimeOffset=L,this.trackSwitch=B,this.timeOffset=A,this.initSegmentChange=I}},"./src/demux/tsdemuxer.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>x});var f=o("./src/demux/adts.ts"),_=o("./src/demux/mpegaudio.ts"),g=o("./src/demux/exp-golomb.ts"),T=o("./src/demux/sample-aes.ts"),E=o("./src/events.ts"),h=o("./src/utils/mp4-tools.ts"),k=o("./src/utils/logger.ts"),t=o("./src/errors.ts"),r=o("./src/types/demuxer.ts");function n(){return(n=Object.assign?Object.assign.bind():function(b){for(var C=1;C<arguments.length;C++){var v,y=arguments[C];for(v in y)Object.prototype.hasOwnProperty.call(y,v)&&(b[v]=y[v])}return b}).apply(this,arguments)}function a(b,C,v){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=b,this.config=C,this.typeSupported=v}function d(b,C,v,y){return{key:b,frame:!1,pts:C,dts:v,units:[],debug:y,length:0}}function p(b){var C,v,y,S,L=0,B=b.data;if(!b||b.size===0)return null;for(;B[0].length<19&&1<B.length;){var A=new Uint8Array(B[0].length+B[1].length);A.set(B[0]),A.set(B[1],B[0].length),B[0]=A,B.splice(1,1)}if(((C=B[0])[0]<<16)+(C[1]<<8)+C[2]!==1||(v=(C[4]<<8)+C[5])&&v>b.size-6)return null;var I=C[7],U=(192&I&&(y=536870912*(14&C[9])+4194304*(255&C[10])+16384*(254&C[11])+128*(255&C[12])+(254&C[13])/2,64&I?54e5<y-(S=536870912*(14&C[14])+4194304*(255&C[15])+16384*(254&C[16])+128*(255&C[17])+(254&C[18])/2)&&(k.logger.warn(Math.round((y-S)/9e4)+"s delta between PTS and DTS, align them"),y=S):S=y),(I=C[8])+9);if(b.size<=U)return null;b.size-=U;for(var P=new Uint8Array(b.size),F=0,M=B.length;F<M;F++){var w=(C=B[F]).byteLength;if(U){if(w<U){U-=w;continue}C=C.subarray(U),w-=U,U=0}P.set(C,L),L+=w}return v&&(v-=I+3),{data:P,pts:y,dts:S,len:v}}function m(b,C){if(b.units.length&&b.frame){if(b.pts===void 0){var v=C.samples,y=v.length;if(!y)return C.dropped++;v=v[y-1],b.pts=v.pts,b.dts=v.dts}C.samples.push(b)}b.debug.length&&k.logger.log(b.pts+"/"+b.dts+":"+b.debug)}a.probe=function(b){return b=a.syncOffset(b),0<b&&k.logger.warn("MPEG2-TS detected but first sync word found @ offset "+b),b!==-1},a.syncOffset=function(b){for(var C=Math.min(940,b.length-376)+1,v=0;v<C;){if(b[v]===71&&b[v+188]===71)return v;v++}return-1},a.createTrack=function(b,C){return{container:b==="video"||b==="audio"?"video/mp2t":void 0,type:b,id:h.RemuxerTrackIdConfig[b],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:b==="audio"?C:void 0}},(l=a.prototype).resetInitSegment=function(b,C,v,y){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=a.createTrack("video"),this._audioTrack=a.createTrack("audio",y),this._id3Track=a.createTrack("id3"),this._txtTrack=a.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=C,this.videoCodec=v,this._duration=y},l.resetTimeStamp=function(){},l.resetContiguity=function(){var b=this._audioTrack,C=this._avcTrack,v=this._id3Track;b&&(b.pesData=null),C&&(C.pesData=null),v&&(v.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},l.demux=function(b,C,v,y){y===void 0&&(y=!1),(v=v===void 0?!1:v)||(this.sampleAes=null);var S,L=this._avcTrack,B=this._audioTrack,A=this._id3Track,I=this._txtTrack,U=L.pid,P=L.pesData,F=B.pid,M=A.pid,w=B.pesData,R=A.pesData,O=null,j=this.pmtParsed,z=this._pmtId,G=b.length;if(this.remainderData&&(G=(b=(0,h.appendUint8Array)(this.remainderData,b)).length,this.remainderData=null),G<188&&!y)return this.remainderData=b,{audioTrack:B,videoTrack:L,id3Track:A,textTrack:I};var K=Math.max(0,a.syncOffset(b));(G-=(G-K)%188)<b.byteLength&&!y&&(this.remainderData=new Uint8Array(b.buffer,G,b.buffer.byteLength-G));for(var $,V=0,q=K;q<G;q+=188)if(b[q]===71){var J=!!(64&b[q+1]),re=((31&b[q+1])<<8)+b[q+2],Z=void 0;if(1<(48&b[q+3])>>4){if((Z=q+5+b[q+4])===q+188)continue}else Z=q+4;switch(re){case U:J&&(P&&(S=p(P))&&this.parseAVCPES(L,I,S,!1),P={data:[],size:0}),P&&(P.data.push(b.subarray(Z,q+188)),P.size+=q+188-Z);break;case F:if(J){if(w&&(S=p(w)))switch(B.segmentCodec){case"aac":this.parseAACPES(B,S);break;case"mp3":this.parseMPEGPES(B,S)}w={data:[],size:0}}w&&(w.data.push(b.subarray(Z,q+188)),w.size+=q+188-Z);break;case M:J&&(R&&(S=p(R))&&this.parseID3PES(A,S),R={data:[],size:0}),R&&(R.data.push(b.subarray(Z,q+188)),R.size+=q+188-Z);break;case 0:J&&(Z+=b[Z]+1),z=this._pmtId=(31&(W=b)[($=Z)+10])<<8|W[$+11];break;case z:J&&(Z+=b[Z]+1);var W=(function(se,ie,ne,me){var ce={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},le=ie+3+((15&se[ie+1])<<8|se[ie+2])-4;for(ie+=12+((15&se[ie+10])<<8|se[ie+11]);ie<le;){var ge=(31&se[ie+1])<<8|se[ie+2];switch(se[ie]){case 207:if(!me){k.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:ce.audio===-1&&(ce.audio=ge);break;case 21:ce.id3===-1&&(ce.id3=ge);break;case 219:if(!me){k.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:ce.avc===-1&&(ce.avc=ge);break;case 3:case 4:ne.mpeg!==!0&&ne.mp3!==!0?k.logger.log("MPEG audio found, not supported in this browser"):ce.audio===-1&&(ce.audio=ge,ce.segmentCodec="mp3");break;case 36:k.logger.warn("Unsupported HEVC stream type found")}ie+=5+((15&se[ie+3])<<8|se[ie+4])}return ce})(b,Z,this.typeSupported,v);0<(U=W.avc)&&(L.pid=U),0<(F=W.audio)&&(B.pid=F,B.segmentCodec=W.segmentCodec),0<(M=W.id3)&&(A.pid=M),O===null||j||(k.logger.log("unknown PID '"+O+"' in TS found"),O=null,q=K-188),j=this.pmtParsed=!0;break;case 17:case 8191:break;default:O=re}}else V++;0<V&&this.observer.emit(E.Events.ERROR,E.Events.ERROR,{type:t.ErrorTypes.MEDIA_ERROR,details:t.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+V+" TS packet/s that do not start with 0x47"}),L.pesData=P,B.pesData=w,A.pesData=R;var X={audioTrack:B,videoTrack:L,id3Track:A,textTrack:I};return y&&this.extractRemainingSamples(X),X},l.flush=function(){var b=this.remainderData;return this.remainderData=null,b=b?this.demux(b,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(b),this.sampleAes?this.decrypt(b,this.sampleAes):b},l.extractRemainingSamples=function(L){var C,v=L.audioTrack,y=L.videoTrack,S=L.id3Track,L=L.textTrack,B=y.pesData,A=v.pesData,I=S.pesData;if(B&&(C=p(B))?(this.parseAVCPES(y,L,C,!0),y.pesData=null):y.pesData=B,A&&(C=p(A))){switch(v.segmentCodec){case"aac":this.parseAACPES(v,C);break;case"mp3":this.parseMPEGPES(v,C)}v.pesData=null}else A!=null&&A.size&&k.logger.log("last AAC PES packet truncated,might overlap between fragments"),v.pesData=A;I&&(C=p(I))?(this.parseID3PES(S,C),S.pesData=null):S.pesData=I},l.demuxSampleAes=function(b,C,v){return b=this.demux(b,v,!0,!this.config.progressive),v=this.sampleAes=new T.default(this.observer,this.config,C),this.decrypt(b,v)},l.decrypt=function(b,C){return new Promise(function(v){var y=b.audioTrack,S=b.videoTrack;y.samples&&y.segmentCodec==="aac"?C.decryptAacSamples(y.samples,0,function(){S.samples?C.decryptAvcSamples(S.samples,0,0,function(){v(b)}):v(b)}):S.samples&&C.decryptAvcSamples(S.samples,0,0,function(){v(b)})})},l.destroy=function(){this._duration=0},l.parseAVCPES=function(b,C,v,y){var S,L=this,B=this.parseAVCNALu(b,v.data),A=this.avcSample,I=!1;v.data=null,A&&B.length&&!b.audFound&&(m(A,b),A=this.avcSample=d(!1,v.pts,v.dts,"")),B.forEach(function(U){switch(U.type){case 1:S=!0,(A=A||(L.avcSample=d(!0,v.pts,v.dts,""))).frame=!0;var P=U.data;I&&4<P.length&&((P=new g.default(P).readSliceType())!==2&&P!==4&&P!==7&&P!==9||(A.key=!0));break;case 5:S=!0,(A=A||(L.avcSample=d(!0,v.pts,v.dts,""))).key=!0,A.frame=!0;break;case 6:S=!0,(0,h.parseSEIMessageFromNALu)(U.data,1,v.pts,C.samples);break;case 7:if(I=S=!0,!b.sps){P=new g.default(U.data).readSPS(),b.width=P.width,b.height=P.height,b.pixelRatio=P.pixelRatio,b.sps=[U.data],b.duration=L._duration;for(var F=U.data.subarray(1,4),M="avc1.",w=0;w<3;w++){var R=F[w].toString(16);M+=R=R.length<2?"0"+R:R}b.codec=M}break;case 8:S=!0,b.pps||(b.pps=[U.data]);break;case 9:S=!1,b.audFound=!0,A&&m(A,b),A=L.avcSample=d(!1,v.pts,v.dts,"");break;case 12:S=!0;break;default:S=!1,A&&(A.debug+="unknown NAL "+U.type+" ")}A&&S&&A.units.push(U)}),y&&A&&(m(A,b),this.avcSample=null)},l.getLastNalUnit=function(b){var C,v=this.avcSample;return C=(b=v=v&&v.units.length!==0?v:b[b.length-1])!=null&&b.units?(b=v.units)[b.length-1]:C},l.parseAVCNALu=function(b,C){var v,y,S,L,B,A,I=C.byteLength,U=b.naluState||0,P=U,F=[],M=0,w=-1,R=0;for(U===-1&&(R=31&C[w=0],U=0,M=1);M<I;)v=C[M++],U=U?U!==1?v?v===1?(0<=w?(S={data:C.subarray(w,M-U-1),type:R},F.push(S)):(S=this.getLastNalUnit(b.samples))&&(P&&M<=4-P&&S.state&&(S.data=S.data.subarray(0,S.data.byteLength-P)),0<(y=M-U-1))&&((L=new Uint8Array(S.data.byteLength+y)).set(S.data,0),L.set(C.subarray(0,y),S.data.byteLength),S.data=L,S.state=0),M<I?(R=31&C[w=M],0):-1):0:3:v?0:2:v?0:1;return 0<=w&&0<=U&&(B={data:C.subarray(w,I),type:R,state:U},F.push(B)),F.length===0&&(B=this.getLastNalUnit(b.samples))&&((A=new Uint8Array(B.data.byteLength+C.byteLength)).set(B.data,0),A.set(C,B.data.byteLength),B.data=A),b.naluState=U,F},l.parseAACPES=function(b,C){var v,y,S,L,B,A=0,I=this.aacOverFlow,U=C.data;for(I&&(this.aacOverFlow=null,P=I.missing,L=I.sample.unit.byteLength,P===-1?((B=new Uint8Array(L+U.byteLength)).set(I.sample.unit,0),B.set(U,L),U=B):(B=L-P,I.sample.unit.set(U.subarray(0,P),B),b.samples.push(I.sample),A=I.missing)),v=A,y=U.length;v<y-1&&!f.isHeader(U,v);v++);if(v===A||(L=v<y-1?(S="AAC PES did not start with ADTS header,offset:"+v,!1):(S="no ADTS header found in AAC PES",!0),k.logger.warn("parsing error:"+S),this.observer.emit(E.Events.ERROR,E.Events.ERROR,{type:t.ErrorTypes.MEDIA_ERROR,details:t.ErrorDetails.FRAG_PARSING_ERROR,fatal:L,reason:S}),!L)){if(f.initTrackConfig(b,this.observer,U,v,this.audioCodec),C.pts!==void 0)F=C.pts;else{if(!I)return void k.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var P=f.getFrameDuration(b.samplerate),F=I.sample.pts+P}for(var M,w=0;v<y;){if(v+=(M=f.appendFrame(b,U,v,F,w)).length,M.missing){this.aacOverFlow=M;break}for(w++;v<y-1&&!f.isHeader(U,v);v++);}}},l.parseMPEGPES=function(b,C){var v=C.data,y=v.length,S=0,L=0,B=C.pts;if(B!==void 0)for(;L<y;)if(_.isHeader(v,L)){var A=_.appendFrame(b,v,L,B,S);if(!A)break;L+=A.length,S++}else L++;else k.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},l.parseID3PES=function(b,C){C.pts!==void 0?(C=n({},C,{type:this._avcTrack?r.MetadataSchema.emsg:r.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),b.samples.push(C)):k.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")};const x=a},"./src/demux/webworkify-webpack.js":(c,l,o)=>{o.r(l),o.d(l,{default:()=>function(h,a){a=a||{};var t={main:o.m},r=a.all?{main:Object.keys(t.main)}:(function(p){for(var m={main:[h]},x={main:[]},b={main:{}};(function(I){return Object.keys(I).reduce(function(U,P){return U||0<I[P].length},!1)})(m);)for(var C=Object.keys(m),v=0;v<C.length;v++){var y=C[v],S=m[y].pop();if(b[y]=b[y]||{},!b[y][S]&&p[y][S]){b[y][S]=!0,x[y]=x[y]||[],x[y].push(S);for(var L=(function(I,w,P){var F={},M=(F[P]=[],w.toString().replace(/^"[^"]+"/,"function")),w=M.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||M.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(w){for(var R,w=w[1],O=new RegExp("(\\\\n|\\W)"+T(w)+g,"g");R=O.exec(M);)R[3]!=="dll-reference"&&F[P].push(R[3]);for(O=new RegExp("\\("+T(w)+'\\("(dll-reference\\s('+_+'))"\\)\\)'+g,"g");R=O.exec(M);)I[R[2]]||(F[P].push(R[1]),I[R[2]]=o(R[1]).m),F[R[2]]=F[R[2]]||[],F[R[2]].push(R[4]);for(var j,z=Object.keys(F),G=0;G<z.length;G++)for(var K=0;K<F[z[G]].length;K++)j=F[z[G]][K],isNaN(+j)||(F[z[G]][K]=+F[z[G]][K])}return F})(p,p[y][S],y),B=Object.keys(L),A=0;A<B.length;A++)m[B[A]]=m[B[A]]||[],m[B[A]]=m[B[A]].concat(L[B[A]])}}return x})(t),n="",a=(Object.keys(r).filter(function(p){return p!=="main"}).forEach(function(p){for(var m=0;r[p][m];)m++;r[p].push(m),t[p][m]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",n=n+"var "+p+" = ("+E(r,t,m,modules)+`)();
`}),n=n+"new (("+E(r,t,h,"main")+")())(self);",new window.Blob([n],{type:"text/javascript"})),a=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(a),d=new window.Worker(a);return d.objectURL=a,d}});var f=(function(){function h(n){var a=t[n];return a!==void 0||(a=t[n]={exports:{}},k[n].call(a.exports,a,a.exports,h)),a.exports}var k=ENTRY_MODULE,t={},r=(h.m=k,h.n=function(n){var a=n&&n.__esModule?function(){return n.default}:function(){return n};return h.d(a,{a}),a},h.d=function(n,a){for(var d in a)h.o(a,d)&&!h.o(n,d)&&Object.defineProperty(n,d,{enumerable:!0,get:a[d]})},h.o=function(n,a){return Object.prototype.hasOwnProperty.call(n,a)},h.r=function(n){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},h(ENTRY_MODULE));return r.default||r}).toString().split("ENTRY_MODULE"),_="[\\.|\\-|\\+|\\w|/|@]+",g="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function T(h){return(h+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function E(h,k,t,r){return h=h[r].map(function(n){return'"'+n+'": '+k[r][n].toString().replace(/^"[^"]+"/,"function")}).join(","),f[0]+"{"+h+"}"+f[1]+'"'+t+'"'+f[2]}},"./src/errors.ts":(c,l,o)=>{var f,_;o.r(l),o.d(l,{ErrorDetails:()=>_,ErrorTypes:()=>f}),(o=f=f||{}).NETWORK_ERROR="networkError",o.MEDIA_ERROR="mediaError",o.KEY_SYSTEM_ERROR="keySystemError",o.MUX_ERROR="muxError",o.OTHER_ERROR="otherError",(l=_=_||{}).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",l.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",l.KEY_SYSTEM_NO_SESSION="keySystemNoSession",l.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",l.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",l.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",l.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",l.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",l.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",l.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",l.MANIFEST_LOAD_ERROR="manifestLoadError",l.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",l.MANIFEST_PARSING_ERROR="manifestParsingError",l.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",l.LEVEL_EMPTY_ERROR="levelEmptyError",l.LEVEL_LOAD_ERROR="levelLoadError",l.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",l.LEVEL_SWITCH_ERROR="levelSwitchError",l.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",l.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",l.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",l.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",l.FRAG_LOAD_ERROR="fragLoadError",l.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",l.FRAG_DECRYPT_ERROR="fragDecryptError",l.FRAG_PARSING_ERROR="fragParsingError",l.REMUX_ALLOC_ERROR="remuxAllocError",l.KEY_LOAD_ERROR="keyLoadError",l.KEY_LOAD_TIMEOUT="keyLoadTimeOut",l.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",l.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",l.BUFFER_APPEND_ERROR="bufferAppendError",l.BUFFER_APPENDING_ERROR="bufferAppendingError",l.BUFFER_STALLED_ERROR="bufferStalledError",l.BUFFER_FULL_ERROR="bufferFullError",l.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",l.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",l.INTERNAL_EXCEPTION="internalException",l.INTERNAL_ABORTED="aborted",l.UNKNOWN="unknown"},"./src/events.ts":(c,l,o)=>{var f;o.r(l),o.d(l,{Events:()=>f}),(o=f=f||{}).MEDIA_ATTACHING="hlsMediaAttaching",o.MEDIA_ATTACHED="hlsMediaAttached",o.MEDIA_DETACHING="hlsMediaDetaching",o.MEDIA_DETACHED="hlsMediaDetached",o.BUFFER_RESET="hlsBufferReset",o.BUFFER_CODECS="hlsBufferCodecs",o.BUFFER_CREATED="hlsBufferCreated",o.BUFFER_APPENDING="hlsBufferAppending",o.BUFFER_APPENDED="hlsBufferAppended",o.BUFFER_EOS="hlsBufferEos",o.BUFFER_FLUSHING="hlsBufferFlushing",o.BUFFER_FLUSHED="hlsBufferFlushed",o.MANIFEST_LOADING="hlsManifestLoading",o.MANIFEST_LOADED="hlsManifestLoaded",o.MANIFEST_PARSED="hlsManifestParsed",o.LEVEL_SWITCHING="hlsLevelSwitching",o.LEVEL_SWITCHED="hlsLevelSwitched",o.LEVEL_LOADING="hlsLevelLoading",o.LEVEL_LOADED="hlsLevelLoaded",o.LEVEL_UPDATED="hlsLevelUpdated",o.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",o.LEVELS_UPDATED="hlsLevelsUpdated",o.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",o.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",o.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",o.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",o.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",o.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",o.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",o.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",o.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",o.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",o.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",o.CUES_PARSED="hlsCuesParsed",o.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",o.INIT_PTS_FOUND="hlsInitPtsFound",o.FRAG_LOADING="hlsFragLoading",o.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",o.FRAG_LOADED="hlsFragLoaded",o.FRAG_DECRYPTED="hlsFragDecrypted",o.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",o.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",o.FRAG_PARSING_METADATA="hlsFragParsingMetadata",o.FRAG_PARSED="hlsFragParsed",o.FRAG_BUFFERED="hlsFragBuffered",o.FRAG_CHANGED="hlsFragChanged",o.FPS_DROP="hlsFpsDrop",o.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",o.ERROR="hlsError",o.DESTROYING="hlsDestroying",o.KEY_LOADING="hlsKeyLoading",o.KEY_LOADED="hlsKeyLoaded",o.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",o.BACK_BUFFER_REACHED="hlsBackBufferReached"},"./src/hls.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>C});var f=o("./node_modules/url-toolkit/src/url-toolkit.js"),_=o("./src/loader/playlist-loader.ts"),g=o("./src/controller/id3-track-controller.ts"),T=o("./src/controller/latency-controller.ts"),E=o("./src/controller/level-controller.ts"),h=o("./src/controller/fragment-tracker.ts"),k=o("./src/loader/key-loader.ts"),t=o("./src/controller/stream-controller.ts"),r=o("./src/is-supported.ts"),n=o("./src/utils/logger.ts"),a=o("./src/config.ts"),d=o("./node_modules/eventemitter3/index.js"),p=o("./src/events.ts"),m=o("./src/errors.ts"),x=o("./src/types/level.ts");function b(y,S){for(var L,B=0;B<S.length;B++){var A=S[B];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(y,typeof(L=(function(I){if(typeof I!="object"||I===null)return I;var U=I[Symbol.toPrimitive];if(U===void 0)return String(I);if(U=U.call(I,"string"),typeof U!="object")return U;throw new TypeError("@@toPrimitive must return a primitive value.")})(A.key))=="symbol"?L:String(L),A)}}v.isSupported=function(){return(0,r.isSupported)()},(l=v.prototype).createController=function(y,S){return y?(y=new y(this),S&&S.push(y),y):null},l.on=function(y,S,L){this._emitter.on(y,S,L=L===void 0?this:L)},l.once=function(y,S,L){this._emitter.once(y,S,L=L===void 0?this:L)},l.removeAllListeners=function(y){this._emitter.removeAllListeners(y)},l.off=function(y,S,L,B){this._emitter.off(y,S,L=L===void 0?this:L,B)},l.listeners=function(y){return this._emitter.listeners(y)},l.emit=function(y,S,L){return this._emitter.emit(y,S,L)},l.trigger=function(y,S){if(this.config.debug)return this.emit(y,y,S);try{return this.emit(y,y,S)}catch(L){n.logger.error("An internal error happened while handling event "+y+'. Error message: "'+L.message+'". Here is a stacktrace:',L),this.trigger(p.Events.ERROR,{type:m.ErrorTypes.OTHER_ERROR,details:m.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:y,error:L})}return!1},l.listenerCount=function(y){return this._emitter.listenerCount(y)},l.destroy=function(){n.logger.log("destroy"),this.trigger(p.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(y){return y.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(y){return y.destroy()}),this.coreComponents.length=0},l.attachMedia=function(y){n.logger.log("attachMedia"),this._media=y,this.trigger(p.Events.MEDIA_ATTACHING,{media:y})},l.detachMedia=function(){n.logger.log("detachMedia"),this.trigger(p.Events.MEDIA_DETACHING,void 0),this._media=null},l.loadSource=function(y){this.stopLoad();var S=this.media,L=this.url,B=this.url=f.buildAbsoluteURL(self.location.href,y,{alwaysNormalize:!0});n.logger.log("loadSource:"+B),S&&L&&L!==B&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(S)),this.trigger(p.Events.MANIFEST_LOADING,{url:y})},l.startLoad=function(y){y===void 0&&(y=-1),n.logger.log("startLoad("+y+")"),this.networkControllers.forEach(function(S){S.startLoad(y)})},l.stopLoad=function(){n.logger.log("stopLoad"),this.networkControllers.forEach(function(y){y.stopLoad()})},l.swapAudioCodec=function(){n.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},l.recoverMediaError=function(){n.logger.log("recoverMediaError");var y=this._media;this.detachMedia(),y&&this.attachMedia(y)},l.removeLevel=function(y,S){this.levelController.removeLevel(y,S=S===void 0?0:S)},l=[{key:"version",get:function(){return"1.3.2"}},{key:"Events",get:function(){return p.Events}},{key:"ErrorTypes",get:function(){return m.ErrorTypes}},{key:"ErrorDetails",get:function(){return m.ErrorDetails}},{key:"DefaultConfig",get:function(){return v.defaultConfig||a.hlsDefaultConfig},set:function(y){v.defaultConfig=y}}],b((o=v).prototype,[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(y){n.logger.log("set currentLevel:"+y),this.loadLevel=y,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(y){n.logger.log("set nextLevel:"+y),this.levelController.manualLevel=y,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(y){n.logger.log("set loadLevel:"+y),this.levelController.manualLevel=y}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(y){this.levelController.nextLoadLevel=y}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(y){n.logger.log("set firstLevel:"+y),this.levelController.firstLevel=y}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(y){n.logger.log("set startLevel:"+y),y!==-1&&(y=Math.max(y,this.minAutoLevel)),this.levelController.startLevel=y}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(y){y=!!y,y!==this.config.capLevelToPlayerSize&&(y?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=y)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(y){this._autoLevelCapping!==y&&(n.logger.log("set autoLevelCapping:"+y),this._autoLevelCapping=y)}},{key:"bandwidthEstimate",get:function(){var y=this.abrController.bwEstimator;return y?y.getEstimate():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(y){-1<x.HdcpLevels.indexOf(y)&&(this._maxHdcpLevel=y)}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var y=this.levels,S=this.config.minAutoBitrate;if(y){for(var L=y.length,B=0;B<L;B++)if(y[B].maxBitrate>=S)return B}return 0}},{key:"maxAutoLevel",get:function(){var y=this.levels,L=this.autoLevelCapping,S=this.maxHdcpLevel,L=L===-1&&y&&y.length?y.length-1:L;if(S)for(var B=L;B--;){var A=y[B].attrs["HDCP-LEVEL"];if(A&&A<=S)return B}return L}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(y){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,y)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var y=this.audioTrackController;return y?y.audioTracks:[]}},{key:"audioTrack",get:function(){var y=this.audioTrackController;return y?y.audioTrack:-1},set:function(y){var S=this.audioTrackController;S&&(S.audioTrack=y)}},{key:"subtitleTracks",get:function(){var y=this.subtitleTrackController;return y?y.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var y=this.subtitleTrackController;return y?y.subtitleTrack:-1},set:function(y){var S=this.subtitleTrackController;S&&(S.subtitleTrack=y)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var y=this.subtitleTrackController;return!!y&&y.subtitleDisplay},set:function(y){var S=this.subtitleTrackController;S&&(S.subtitleDisplay=y)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(y){this.config.lowLatencyMode=y}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}]),b(o,l),Object.defineProperty(o,"prototype",{writable:!1});var C=v;function v(R){R===void 0&&(R={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new d.EventEmitter,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var S=this.config=(0,a.mergeConfig)(v.DefaultConfig,R),R=(this.userConfig=R,(0,n.enableLogs)(S.debug,"Hls instance"),this._autoLevelCapping=-1,S.progressive&&(0,a.enableStreamingMode)(S),S.abrController),L=S.bufferController,B=S.capLevelController,A=S.fpsController,R=this.abrController=new R(this),L=this.bufferController=new L(this),B=this.capLevelController=new B(this),A=new A(this),F=new _.default(this),I=new g.default(this),M=this.levelController=new E.default(this),U=new h.FragmentTracker(this),P=new k.default(this.config),w=this.streamController=new t.default(this,U,P),F=(B.setStreamController(w),A.setStreamController(w),[F,M,w]),M=(this.networkControllers=F,[R,L,B,A,I,U]),w=(this.audioTrackController=this.createController(S.audioTrackController,F),S.audioStreamController),R=(w&&F.push(new w(this,U,P)),this.subtitleTrackController=this.createController(S.subtitleTrackController,F),S.subtitleStreamController);R&&F.push(new R(this,U,P)),this.createController(S.timelineController,M),P.emeController=this.emeController=this.createController(S.emeController,M),this.cmcdController=this.createController(S.cmcdController,M),this.latencyController=this.createController(T.default,M),this.coreComponents=M}C.defaultConfig=void 0},"./src/is-supported.ts":(c,l,o)=>{o.r(l),o.d(l,{changeTypeSupported:()=>function(){var g=_();return typeof(g==null||(g=g.prototype)==null?void 0:g.changeType)=="function"},isSupported:()=>function(){var g,T=(0,f.getMediaSource)();return!!T&&(g=_(),T=T&&typeof T.isTypeSupported=="function"&&T.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),g=!g||g.prototype&&typeof g.prototype.appendBuffer=="function"&&typeof g.prototype.remove=="function",!!T)&&!!g}});var f=o("./src/utils/mediasource-helper.ts");function _(){return self.SourceBuffer||self.WebKitSourceBuffer}},"./src/loader/date-range.ts":(c,l,o)=>{o.r(l),o.d(l,{DateRange:()=>k,DateRangeAttribute:()=>f});var f,_=o("./src/polyfills/number.ts"),g=o("./src/utils/attr-list.ts"),T=o("./src/utils/logger.ts");function E(){return(E=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var a,d=arguments[n];for(a in d)Object.prototype.hasOwnProperty.call(d,a)&&(r[a]=d[a])}return r}).apply(this,arguments)}function h(r,n){for(var a,d=0;d<n.length;d++){var p=n[d];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(r,typeof(a=(function(m){if(typeof m!="object"||m===null)return m;var x=m[Symbol.toPrimitive];if(x===void 0)return String(m);if(x=x.call(m,"string"),typeof x!="object")return x;throw new TypeError("@@toPrimitive must return a primitive value.")})(p.key))=="symbol"?a:String(a),p)}}(l=f=f||{}).ID="ID",l.CLASS="CLASS",l.START_DATE="START-DATE",l.DURATION="DURATION",l.END_DATE="END-DATE",l.END_ON_NEXT="END-ON-NEXT",l.PLANNED_DURATION="PLANNED-DURATION",l.SCTE35_OUT="SCTE35-OUT",l.SCTE35_IN="SCTE35-IN",h((o=t).prototype,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){var r;return this._endDate||((r=this.duration)!==null?new Date(this._startDate.getTime()+1e3*r):null)}},{key:"duration",get:function(){if(f.DURATION in this.attr){var r=this.attr.decimalFloatingPoint(f.DURATION);if((0,_.isFiniteNumber)(r))return r}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return f.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(f.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(f.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,_.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||0<=this.duration)&&(!this.endOnNext||!!this.class)}}]),Object.defineProperty(o,"prototype",{writable:!1});var k=t;function t(r,n){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,n){var a,d=n.attr;for(a in d)if(Object.prototype.hasOwnProperty.call(r,a)&&r[a]!==d[a]){T.logger.warn('DATERANGE tag attribute: "'+a+'" does not match for tags with ID: "'+r.ID+'"'),this._badValueForSameId=a;break}r=E(new g.AttrList({}),d,r)}this.attr=r,this._startDate=new Date(r[f.START_DATE]),f.END_DATE in this.attr&&(n=new Date(this.attr[f.END_DATE]),(0,_.isFiniteNumber)(n.getTime()))&&(this._endDate=n)}},"./src/loader/fragment-loader.ts":(c,l,o)=>{o.r(l),o.d(l,{LoadError:()=>d,default:()=>t});var f=o("./src/polyfills/number.ts"),_=o("./src/errors.ts");function g(m){var x=typeof Map=="function"?new Map:void 0;return(g=function(b){if(b===null||Function.toString.call(b).indexOf("[native code]")===-1)return b;if(typeof b!="function")throw new TypeError("Super expression must either be null or a function");if(x!==void 0){if(x.has(b))return x.get(b);x.set(b,C)}function C(){return T(b,arguments,h(this).constructor)}return C.prototype=Object.create(b.prototype,{constructor:{value:C,enumerable:!1,writable:!0,configurable:!0}}),E(C,b)})(m)}function T(m,x,b){return(T=(function(){if(!(typeof Reflect>"u"||!Reflect.construct)&&!Reflect.construct.sham){if(typeof Proxy=="function")return 1;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),1}catch{}}})()?Reflect.construct.bind():function(C,L,y){var S=[null],L=(S.push.apply(S,L),new(Function.bind.apply(C,S)));return y&&E(L,y.prototype),L}).apply(null,arguments)}function E(m,x){return(E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(b,C){return b.__proto__=C,b})(m,x)}function h(m){return(h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(x){return x.__proto__||Object.getPrototypeOf(x)})(m)}var k=Math.pow(2,17),t=((l=r.prototype).destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},l.abort=function(){this.loader&&this.loader.abort()},l.load=function(m,x){var b=this,C=m.url;if(!C)return Promise.reject(new d({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:m,networkDetails:null},"Fragment does not have a "+(C?"part list":"url")));this.abort();var v=this.config,y=v.fLoader,S=v.loader;return new Promise(function(L,B){b.loader&&b.loader.destroy();var A=b.loader=m.loader=new(y||S)(v),I=n(m),U={timeout:v.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:v.fragLoadingMaxRetryTimeout,highWaterMark:m.sn==="initSegment"?1/0:k};m.stats=A.stats,A.load(I,U,{onSuccess:function(P,F,M,w){b.resetLoader(m,A),P=P.data,M.resetIV&&m.decryptdata&&(m.decryptdata.iv=new Uint8Array(P.slice(0,16)),P=P.slice(16)),L({frag:m,part:null,payload:P,networkDetails:w})},onError:function(P,F,M){b.resetLoader(m,A),B(new d({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:m,response:P,networkDetails:M}))},onAbort:function(P,F,M){b.resetLoader(m,A),B(new d({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:m,networkDetails:M}))},onTimeout:function(P,F,M){b.resetLoader(m,A),B(new d({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:m,networkDetails:M}))},onProgress:function(P,F,M,w){x&&x({frag:m,part:null,payload:M,networkDetails:w})}})})},l.loadPart=function(m,x,b){var C=this,v=(this.abort(),this.config),y=v.fLoader,S=v.loader;return new Promise(function(L,B){C.loader&&C.loader.destroy();var A=C.loader=m.loader=new(y||S)(v),I=n(m,x),U={timeout:v.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:v.fragLoadingMaxRetryTimeout,highWaterMark:k};x.stats=A.stats,A.load(I,U,{onSuccess:function(P,F,M,w){C.resetLoader(m,A),C.updateStatsFromPart(m,x),P={frag:m,part:x,payload:P.data,networkDetails:w},b(P),L(P)},onError:function(P,F,M){C.resetLoader(m,A),B(new d({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:m,part:x,response:P,networkDetails:M}))},onAbort:function(P,F,M){m.stats.aborted=x.stats.aborted,C.resetLoader(m,A),B(new d({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:m,part:x,networkDetails:M}))},onTimeout:function(P,F,M){C.resetLoader(m,A),B(new d({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:m,part:x,networkDetails:M}))}})})},l.updateStatsFromPart=function(y,S){var b=y.stats,C=S.stats,v=C.total,y=(b.loaded+=C.loaded,v?(v=((y=Math.round(y.duration/S.duration))-(S=Math.min(Math.round(b.loaded/v),y)))*Math.round(b.loaded/S),b.total=b.loaded+v):b.total=Math.max(b.loaded,b.total),b.loading),S=C.loading;y.start?y.first+=S.first-S.start:(y.start=S.start,y.first=S.first),y.end=S.end},l.resetLoader=function(m,x){m.loader=null,this.loader===x&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),x.destroy()},r);function r(m){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=m}function n(m,v){var b,C,S=(v=v===void 0?null:v)||m,v={frag:m,part:v,responseType:"arraybuffer",url:S.url,headers:{},rangeStart:0,rangeEnd:0},y=S.byteRangeStartOffset,S=S.byteRangeEndOffset;return(0,f.isFiniteNumber)(y)&&(0,f.isFiniteNumber)(S)&&(b=y,C=S,m.sn==="initSegment"&&((m=m.decryptdata)==null?void 0:m.method)==="AES-128"&&((m=S-y)%16&&(C=S+(16-m%16)),y!==0)&&(v.resetIV=!0,b=y-16),v.rangeStart=b,v.rangeEnd=C),v}a=g(Error),o=a,(l=p).prototype=Object.create(o.prototype),E(l.prototype.constructor=l,o);var a,d=p;function p(m){for(var x,b=arguments.length,C=new Array(1<b?b-1:0),v=1;v<b;v++)C[v-1]=arguments[v];return(x=a.call.apply(a,[this].concat(C))||this).data=void 0,x.data=m,x}},"./src/loader/fragment.ts":(c,l,o)=>{o.r(l),o.d(l,{BaseSegment:()=>a,ElementaryStreamTypes:()=>f,Fragment:()=>d,Part:()=>p});var f,_=o("./src/polyfills/number.ts"),g=o("./node_modules/url-toolkit/src/url-toolkit.js"),T=o("./src/loader/load-stats.ts");function E(C,v){C.prototype=Object.create(v.prototype),h(C.prototype.constructor=C,v)}function h(C,v){return(h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(y,S){return y.__proto__=S,y})(C,v)}function k(C,v){for(var y,S=0;S<v.length;S++){var L=v[S];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(C,typeof(y=(function(B){if(typeof B!="object"||B===null)return B;var A=B[Symbol.toPrimitive];if(A===void 0)return String(B);if(A=A.call(B,"string"),typeof A!="object")return A;throw new TypeError("@@toPrimitive must return a primitive value.")})(L.key))=="symbol"?y:String(y),L)}}function t(C,v,y){v&&k(C.prototype,v),Object.defineProperty(C,"prototype",{writable:!1})}(l=f=f||{}).AUDIO="audio",l.VIDEO="video",l.AUDIOVIDEO="audiovideo",b.prototype.setByteRange=function(y,v){var y=y.split("@",2),S=[];y.length===1?S[0]=v?v.byteRangeEndOffset:0:S[0]=parseInt(y[1]),S[1]=parseInt(y[0])+S[0],this._byteRange=S},t(b,[{key:"byteRange",get:function(){return this._byteRange||[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,g.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(C){this._url=C}}]);var r,n,a=b,d=(E(x,n=a),(o=x.prototype).setKeyFormat=function(C){this.levelkeys&&(C=this.levelkeys[C])&&!this._decryptdata&&(this._decryptdata=C.getDecryptData(this.sn))},o.abortRequests=function(){var C;(C=this.loader)!=null&&C.abort(),(C=this.keyLoader)!=null&&C.abort()},o.setElementaryStreamInfo=function(C,v,y,S,L,B){B===void 0&&(B=!1);var A=this.elementaryStreams,I=A[C];I?(I.startPTS=Math.min(I.startPTS,v),I.endPTS=Math.max(I.endPTS,y),I.startDTS=Math.min(I.startDTS,S),I.endDTS=Math.max(I.endDTS,L)):A[C]={startPTS:v,endPTS:y,startDTS:S,endDTS:L,partial:B}},o.clearElementaryStreamInfo=function(){var C=this.elementaryStreams;C[f.AUDIO]=null,C[f.VIDEO]=null,C[f.AUDIOVIDEO]=null},t(x,[{key:"decryptdata",get:function(){if(!this.levelkeys&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var C=this.levelkeys.identity;if(C)this._decryptdata=C.getDecryptData(this.sn);else if(C=Object.keys(this.levelkeys),C.length===1)return this._decryptdata=this.levelkeys[C[0]].getDecryptData(this.sn)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){var C;return this.programDateTime!==null&&(0,_.isFiniteNumber)(this.programDateTime)?(C=(0,_.isFiniteNumber)(this.duration)?this.duration:0,this.programDateTime+1e3*C):null}},{key:"encrypted",get:function(){if((C=this._decryptdata)!=null&&C.encrypted)return!0;if(this.levelkeys){var C=Object.keys(this.levelkeys),v=C.length;if(1<v||v===1&&this.levelkeys[C[0]].encrypted)return!0}return!1}}]),x),p=(E(m,r=a),t(m,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var C=this.elementaryStreams;return!!(C.audio||C.video||C.audiovideo)}}]),m);function m(C,v,y,S,L){return(y=r.call(this,y)||this).fragOffset=0,y.duration=0,y.gap=!1,y.independent=!1,y.relurl=void 0,y.fragment=void 0,y.index=void 0,y.stats=new T.LoadStats,y.duration=C.decimalFloatingPoint("DURATION"),y.gap=C.bool("GAP"),y.independent=C.bool("INDEPENDENT"),y.relurl=C.enumeratedString("URI"),y.fragment=v,y.index=S,v=C.enumeratedString("BYTERANGE"),v&&y.setByteRange(v,L),L&&(y.fragOffset=L.fragOffset+L.duration),y}function x(C,v){return(v=n.call(this,v)||this)._decryptdata=null,v.rawProgramDateTime=null,v.programDateTime=null,v.tagList=[],v.duration=0,v.sn=0,v.levelkeys=void 0,v.type=void 0,v.loader=null,v.keyLoader=null,v.level=-1,v.cc=0,v.startPTS=void 0,v.endPTS=void 0,v.appendedPTS=void 0,v.startDTS=void 0,v.endDTS=void 0,v.start=0,v.deltaPTS=void 0,v.maxStartPTS=void 0,v.minEndPTS=void 0,v.stats=new T.LoadStats,v.urlId=0,v.data=void 0,v.bitrateTest=!1,v.title=null,v.initSegment=null,v.endList=void 0,v.type=C,v}function b(C){var v;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((v={})[f.AUDIO]=null,v[f.VIDEO]=null,v[f.AUDIOVIDEO]=null,v),this.baseurl=C}},"./src/loader/key-loader.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>g});var f=o("./src/errors.ts"),_=o("./src/loader/fragment-loader.ts"),g=((l=T.prototype).abort=function(){for(var E in this.keyUriToKeyInfo)E=this.keyUriToKeyInfo[E].loader,E&&E.abort()},l.detach=function(){for(var E in this.keyUriToKeyInfo){var h=this.keyUriToKeyInfo[E];(h.mediaKeySessionContext||h.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[E]}},l.destroy=function(){for(var E in this.detach(),this.keyUriToKeyInfo)E=this.keyUriToKeyInfo[E].loader,E&&E.destroy();this.keyUriToKeyInfo={}},l.createKeyLoadError=function(E,h,k,t){return h===void 0&&(h=f.ErrorDetails.KEY_LOAD_ERROR),new _.LoadError({type:f.ErrorTypes.NETWORK_ERROR,details:h,fatal:!1,frag:E,networkDetails:k})},l.loadClear=function(E,h){var k=this;if(this.emeController&&this.config.emeEnabled)for(var t=E.sn,r=E.cc,n=0;n<h.length&&(function(a){var d=h[a];if(r<=d.cc&&(t==="initSegment"||t<d.sn))return k.emeController.selectKeySystemFormat(d).then(function(p){d.setKeyFormat(p)}),"break"})(n)!=="break";n++);},l.load=function(E){var h=this;return!E.decryptdata&&E.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(E).then(function(k){return h.loadInternal(E,k)}):this.loadInternal(E)},l.loadInternal=function(E,h){h&&E.setKeyFormat(h);var k=E.decryptdata;if(!k)return Promise.reject(this.createKeyLoadError(E,f.ErrorDetails.KEY_LOAD_ERROR,null,h?"Expected frag.decryptdata to be defined after setting format "+h:"Missing decryption data on fragment in onKeyLoading"));if(h=k.uri,!h)return Promise.reject(this.createKeyLoadError(E,f.ErrorDetails.KEY_LOAD_ERROR,null,'Invalid key URI: "'+h+'"'));var t,r=this.keyUriToKeyInfo[h];if((t=r)!=null&&t.decryptdata.key)return k.key=r.decryptdata.key,Promise.resolve({frag:E,keyInfo:r});if((t=r)!=null&&t.keyLoadPromise)switch((t=r.mediaKeySessionContext)==null?void 0:t.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return r.keyLoadPromise}switch(r=this.keyUriToKeyInfo[h]={decryptdata:k,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},k.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return k.keyFormat==="identity"?this.loadKeyHTTP(r,E):this.loadKeyEME(r,E);case"AES-128":return this.loadKeyHTTP(r,E);default:return Promise.reject(this.createKeyLoadError(E,f.ErrorDetails.KEY_LOAD_ERROR,null,'Key supplied with unsupported METHOD: "'+k.method+'"'))}},l.loadKeyEME=function(E,h){var k={frag:h,keyInfo:E};return this.emeController&&this.config.emeEnabled&&(h=this.emeController.loadKey(k),h)?(E.keyLoadPromise=h.then(function(t){return E.mediaKeySessionContext=t,k})).catch(function(t){throw E.keyLoadPromise=null,t}):Promise.resolve(k)},l.loadKeyHTTP=function(E,h){var k=this,t=this.config,r=new t.loader(t);return h.keyLoader=E.loader=r,E.keyLoadPromise=new Promise(function(n,a){var d={keyInfo:E,frag:h,responseType:"arraybuffer",url:E.decryptdata.uri},p={timeout:t.fragLoadingTimeOut,maxRetry:0,retryDelay:t.fragLoadingRetryDelay,maxRetryDelay:t.fragLoadingMaxRetryTimeout,highWaterMark:0};r.load(d,p,{onSuccess:function(m,x,S,C){var v=S.frag,y=S.keyInfo,S=S.url;if(!v.decryptdata||y!==k.keyUriToKeyInfo[S])return a(k.createKeyLoadError(v,f.ErrorDetails.KEY_LOAD_ERROR,C,"after key load, decryptdata unset or changed"));y.decryptdata.key=v.decryptdata.key=new Uint8Array(m.data),v.keyLoader=null,y.loader=null,n({frag:v,keyInfo:y})},onError:function(m,x,b){k.resetLoader(x),a(k.createKeyLoadError(h,f.ErrorDetails.KEY_LOAD_ERROR,b))},onTimeout:function(m,x,b){k.resetLoader(x),a(k.createKeyLoadError(h,f.ErrorDetails.KEY_LOAD_TIMEOUT,b))},onAbort:function(m,x,b){k.resetLoader(x),a(k.createKeyLoadError(h,f.ErrorDetails.INTERNAL_ABORTED,b))}})})},l.resetLoader=function(t){var h=t.frag,k=t.keyInfo,t=t.url,r=k.loader;h.keyLoader===r&&(h.keyLoader=null,k.loader=null),delete this.keyUriToKeyInfo[t],r&&r.destroy()},T);function T(E){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=E}},"./src/loader/level-details.ts":(c,l,o)=>{o.r(l),o.d(l,{LevelDetails:()=>g});var f=o("./src/polyfills/number.ts");function _(E,h){for(var k,t=0;t<h.length;t++){var r=h[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(E,typeof(k=(function(n){if(typeof n!="object"||n===null)return n;var a=n[Symbol.toPrimitive];if(a===void 0)return String(n);if(a=a.call(n,"string"),typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")})(r.key))=="symbol"?k:String(k),r)}}T.prototype.reloaded=function(E){var h,k;E?(h=this.lastPartSn-E.lastPartSn,k=this.lastPartIndex-E.lastPartIndex,this.updated=this.endSN!==E.endSN||!!k||!!h,this.advanced=this.endSN>E.endSN||0<h||h==0&&0<k,this.updated||this.advanced?this.misses=Math.floor(.6*E.misses):this.misses=E.misses+1,this.availabilityDelay=E.availabilityDelay):(this.advanced=!0,this.updated=!0)},_((l=T).prototype,[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&(0,f.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var E=this.driftEndTime-this.driftStartTime;return 0<E?1e3*(this.driftEnd-this.driftStart)/E:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var E;return(E=this.partList)!=null&&E.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var E;return(E=this.fragments)!=null&&E.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var E;return(E=this.partList)!=null&&E.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var E;return(E=this.partList)!=null&&E.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),Object.defineProperty(l,"prototype",{writable:!1});var g=T;function T(E){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=E}},"./src/loader/level-key.ts":(c,l,o)=>{o.r(l),o.d(l,{LevelKey:()=>k});var f=o("./src/utils/keysystem-util.ts"),_=o("./src/utils/mediakeys-helper.ts"),g=o("./src/utils/mp4-tools.ts"),T=o("./src/utils/logger.ts"),E=o("./src/utils/numeric-encoding-utils.ts"),h={},k=(t.clearKeyUriToKeyIdMap=function(){h={}},(l=t.prototype).isSupported=function(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;switch(this.keyFormat){case"identity":return this.method==="SAMPLE-AES";case _.KeySystemFormats.FAIRPLAY:case _.KeySystemFormats.WIDEVINE:case _.KeySystemFormats.PLAYREADY:case _.KeySystemFormats.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1},l.getDecryptData=function(r){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv)return typeof r!="number"&&(this.method!=="AES-128"||this.iv||T.logger.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),r=0),r=(function(m){for(var x=new Uint8Array(16),b=12;b<16;b++)x[b]=m>>8*(15-b)&255;return x})(r),new t(this.method,this.uri,"identity",this.keyFormatVersions,r);var n,a=(0,f.convertDataUriToArrayBytes)(this.uri);if(a)switch(this.keyFormat){case _.KeySystemFormats.WIDEVINE:22<=(this.pssh=a).length&&(this.keyId=a.subarray(a.length-22,a.length-6));break;case _.KeySystemFormats.PLAYREADY:var p=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),p=(this.pssh=(0,g.mp4pssh)(p,null,a),new Uint16Array(a.buffer,a.byteOffset,a.byteLength/2)),p=String.fromCharCode.apply(null,Array.from(p)),p=p.substring(p.indexOf("<"),p.length),p=new DOMParser().parseFromString(p,"text/xml").getElementsByTagName("KID")[0];p&&(p=p.childNodes[0]?p.childNodes[0].nodeValue:p.getAttribute("VALUE"))&&(p=(0,E.base64Decode)(p).subarray(0,16),(0,f.changeEndianness)(p),this.keyId=p);break;default:var d,p=a.subarray(0,16);p.length!==16&&((d=new Uint8Array(16)).set(p,16-p.length),p=d),this.keyId=p}return this.keyId&&this.keyId.byteLength===16||((r=h[this.uri])||(n=Object.keys(h).length%Number.MAX_SAFE_INTEGER,r=new Uint8Array(16),new DataView(r.buffer,12,4).setUint32(0,n),h[this.uri]=r),this.keyId=r),this},t);function t(r,n,a,d,p){d===void 0&&(d=[1]),p===void 0&&(p=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=r,this.uri=n,this.keyFormat=a,this.keyFormatVersions=d,this.iv=p,this.encrypted=!!r&&r!=="NONE",this.isCommonEncryption=this.encrypted&&r!=="AES-128"}},"./src/loader/load-stats.ts":(c,l,o)=>{o.r(l),o.d(l,{LoadStats:()=>f});var f=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>x});var f=o("./src/polyfills/number.ts"),_=o("./node_modules/url-toolkit/src/url-toolkit.js"),g=o("./src/loader/date-range.ts"),T=o("./src/loader/fragment.ts"),E=o("./src/loader/level-details.ts"),h=o("./src/loader/level-key.ts"),k=o("./src/utils/attr-list.ts"),t=o("./src/utils/logger.ts"),r=o("./src/utils/codecs.ts");function n(){return(n=Object.assign?Object.assign.bind():function(L){for(var B=1;B<arguments.length;B++){var A,I=arguments[B];for(A in I)Object.prototype.hasOwnProperty.call(I,A)&&(L[A]=I[A])}return L}).apply(this,arguments)}var a=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+|#EXT-X-SESSION-KEY:([^\n\r]*)[\r\n]+/g,d=/#EXT-X-MEDIA:(.*)/g,p=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),m=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),x=(b.findGroup=function(L,B){for(var A=0;A<L.length;A++){var I=L[A];if(I.id===B)return I}},b.convertAVC1ToAVCOTI=function(L){var B,A=L.split(".");return 2<A.length?(B=A.shift()+".",(B+=parseInt(A.shift()).toString(16))+("000"+parseInt(A.shift()).toString(16)).slice(-4)):L},b.resolve=function(L,B){return(0,_.buildAbsoluteURL)(B,L,{alwaysNormalize:!0})},b.parseMasterPlaylist=function(L,B){var A,I,U,P,F=[],M=[],w={},R=[],O=!1;for(a.lastIndex=0;(A=a.exec(L))!=null;)A[1]?(P={attrs:I=new k.AttrList(A[1]),bitrate:I.decimalInteger("AVERAGE-BANDWIDTH")||I.decimalInteger("BANDWIDTH"),name:I.NAME,url:b.resolve(A[2],B)},(U=I.decimalResolution("RESOLUTION"))&&(P.width=U.width,P.height=U.height),(function(j,z){["video","audio","text"].forEach(function(G){var K,$=j.filter(function(V){return(0,r.isCodecType)(V,G)});$.length&&(K=$.filter(function(V){return V.lastIndexOf("avc1",0)===0||V.lastIndexOf("mp4a",0)===0}),z[G+"Codec"]=(0<K.length?K:$)[0],j=j.filter(function(V){return $.indexOf(V)===-1}))}),z.unknownCodecs=j})((I.CODECS||"").split(/[ ,]+/).filter(function(j){return j}),P),P.videoCodec&&P.videoCodec.indexOf("avc1")!==-1&&(P.videoCodec=b.convertAVC1ToAVCOTI(P.videoCodec)),(U=P.unknownCodecs)!=null&&U.length||M.push(P),F.push(P)):A[3]?(I=new k.AttrList(A[3]))["DATA-ID"]&&(O=!0,w[I["DATA-ID"]]=I):A[4]&&((P=C(U=A[4],B)).encrypted&&P.isSupported()?R.push(P):t.logger.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+U+'"'));return{levels:0<M.length&&M.length<F.length?M:F,sessionData:O?w:null,sessionKeys:R.length?R:null}},b.parseMasterPlaylistMedia=function(L,B,A,I){I===void 0&&(I=[]);var U=[],P=0;for(d.lastIndex=0;(M=d.exec(L))!==null;){var F,M=new k.AttrList(M[1]);M.TYPE===A&&(M={attrs:M,bitrate:0,id:P++,groupId:M["GROUP-ID"],instreamId:M["INSTREAM-ID"],name:M.NAME||M.LANGUAGE||"",type:A,default:M.bool("DEFAULT"),autoselect:M.bool("AUTOSELECT"),forced:M.bool("FORCED"),lang:M.LANGUAGE,url:M.URI?b.resolve(M.URI,B):""},I.length&&(v(M,F=b.findGroup(I,M.groupId)||I[0],"audioCodec"),v(M,F,"textCodec")),U.push(M))}return U},b.parseLevelPlaylist=function(L,B,A,I,U){var P,F,M,w=new E.LevelDetails(B),R=w.fragments,O=null,j=0,z=0,G=0,K=0,$=null,V=new T.Fragment(I,B),q=-1,J=!1;for(p.lastIndex=0,w.m3u8=L;(P=p.exec(L))!==null;){J&&(J=!1,(V=new T.Fragment(I,B)).start=G,V.sn=j,V.cc=K,V.level=A,O)&&(V.initSegment=O,V.rawProgramDateTime=O.rawProgramDateTime,O.rawProgramDateTime=null);var re=P[1];if(re){V.duration=parseFloat(re);var Z=(" "+P[2]).slice(1);V.title=Z||null,V.tagList.push(Z?["INF",re,Z]:["INF",re])}else if(P[3])(0,f.isFiniteNumber)(V.duration)&&(V.start=G,M&&(V.levelkeys=M,Z=w.encryptedFragments,!V.levelkeys||!Object.keys(V.levelkeys).some(function(Ne){return V.levelkeys[Ne].isCommonEncryption})||Z.length&&Z[Z.length-1].levelkeys===M||Z.push(V)),V.sn=j,V.level=A,V.cc=K,V.urlId=U,R.push(V),V.relurl=(" "+P[3]).slice(1),y(V,$),G+=($=V).duration,j++,J=!(z=0));else if(P[4])re=(" "+P[4]).slice(1),$?V.setByteRange(re,$):V.setByteRange(re);else if(P[5])V.rawProgramDateTime=(" "+P[5]).slice(1),V.tagList.push(["PROGRAM-DATE-TIME",V.rawProgramDateTime]),q===-1&&(q=R.length);else if(P=P[0].match(m)){for(F=1;F<P.length&&P[F]===void 0;F++);var W=(" "+P[F]).slice(1),X=(" "+P[F+1]).slice(1),se=P[F+2]?(" "+P[F+2]).slice(1):"";switch(W){case"PLAYLIST-TYPE":w.type=X.toUpperCase();break;case"MEDIA-SEQUENCE":j=w.startSN=parseInt(X);break;case"SKIP":var ie=new k.AttrList(X),ne=ie.decimalInteger("SKIPPED-SEGMENTS");if((0,f.isFiniteNumber)(ne)){for(var me=w.skippedSegments=ne;me--;)R.unshift(null);j+=ne}ne=ie.enumeratedString("RECENTLY-REMOVED-DATERANGES"),ne&&(w.recentlyRemovedDateranges=ne.split("	"));break;case"TARGETDURATION":w.targetduration=parseFloat(X);break;case"VERSION":w.version=parseInt(X);break;case"EXTM3U":break;case"ENDLIST":w.live=!1;break;case"#":(X||se)&&V.tagList.push(se?[X,se]:[X]);break;case"DISCONTINUITY":K++,V.tagList.push(["DIS"]);break;case"GAP":V.tagList.push([W]);break;case"BITRATE":V.tagList.push([W,X]);break;case"DATERANGE":ie=new k.AttrList(X),ne=new g.DateRange(ie,w.dateRanges[ie.ID]),ne.isValid||w.skippedSegments?w.dateRanges[ne.id]=ne:t.logger.warn('Ignoring invalid DATERANGE tag: "'+X+'"'),V.tagList.push(["EXT-X-DATERANGE",X]);break;case"DISCONTINUITY-SEQUENCE":K=parseInt(X);break;case"KEY":var ce=C(X,B);if(ce.isSupported()){if(ce.method==="NONE"){M=void 0;break}(M=(M=M||{})[ce.keyFormat]?n({},M):M)[ce.keyFormat]=ce}else t.logger.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+X+'"');break;case"START":ce=new k.AttrList(X).decimalFloatingPoint("TIME-OFFSET"),(0,f.isFiniteNumber)(ce)&&(w.startTimeOffset=ce);break;case"MAP":var le=new k.AttrList(X);V.duration?(S(ge=new T.Fragment(I,B),le,A,M),(V.initSegment=O=ge).rawProgramDateTime&&!V.rawProgramDateTime&&(V.rawProgramDateTime=O.rawProgramDateTime)):(S(V,le,A,M),O=V,J=!0);break;case"SERVER-CONTROL":var ge=new k.AttrList(X);w.canBlockReload=ge.bool("CAN-BLOCK-RELOAD"),w.canSkipUntil=ge.optionalFloat("CAN-SKIP-UNTIL",0),w.canSkipDateRanges=0<w.canSkipUntil&&ge.bool("CAN-SKIP-DATERANGES"),w.partHoldBack=ge.optionalFloat("PART-HOLD-BACK",0),w.holdBack=ge.optionalFloat("HOLD-BACK",0);break;case"PART-INF":le=new k.AttrList(X),w.partTarget=le.decimalFloatingPoint("PART-TARGET");break;case"PART":var ye=(ye=w.partList)||(w.partList=[]),Ee=0<z?ye[ye.length-1]:void 0,xe=z++,xe=new T.Part(new k.AttrList(X),V,B,xe,Ee);ye.push(xe),V.duration+=xe.duration;break;case"PRELOAD-HINT":Ee=new k.AttrList(X),w.preloadHint=Ee;break;case"RENDITION-REPORT":ye=new k.AttrList(X),w.renditionReports=w.renditionReports||[],w.renditionReports.push(ye);break;default:t.logger.warn("line parsed but not handled: "+P)}}else t.logger.warn("No matches on slow regex match for level playlist!")}$&&!$.relurl?(R.pop(),G-=$.duration,w.partList&&(w.fragmentHint=$)):w.partList&&(y(V,$),V.cc=K,w.fragmentHint=V);var ke=R.length,Le=R[0],De=R[ke-1];return 0<(G+=w.skippedSegments*w.targetduration)&&ke&&De?(w.averagetargetduration=G/ke,ke=De.sn,w.endSN=ke!=="initSegment"?ke:0,w.live||(De.endList=!0),Le&&(w.startCC=Le.cc)):(w.endSN=0,w.startCC=0),w.fragmentHint&&(G+=w.fragmentHint.duration),w.totalduration=G,w.endCC=K,0<q&&(function(Ne,ot){for(var it=Ne[ot],$e=ot;$e--;){var je=Ne[$e];if(!je)return;je.programDateTime=it.programDateTime-1e3*je.duration,it=je}})(R,q),w},b);function b(){}function C(F,B){var F=new k.AttrList(F),A=(A=F.enumeratedString("METHOD"))!=null?A:"",M=F.URI,I=F.hexadecimalInteger("IV"),U=F.enumeratedString("KEYFORMATVERSIONS"),P=(P=F.enumeratedString("KEYFORMAT"))!=null?P:"identity",F=(M&&F.IV&&!I&&t.logger.error("Invalid IV: "+F.IV),M?x.resolve(M,B):""),M=(U||"1").split("/").map(Number).filter(Number.isFinite);return new h.LevelKey(A,F,P,M,I)}function v(L,B,A){B=B[A],B&&(L[A]=B)}function y(L,B){L.rawProgramDateTime?L.programDateTime=Date.parse(L.rawProgramDateTime):B!=null&&B.programDateTime&&(L.programDateTime=B.endProgramDateTime),(0,f.isFiniteNumber)(L.programDateTime)||(L.programDateTime=null,L.rawProgramDateTime=null)}function S(L,B,A,I){L.relurl=B.URI,B.BYTERANGE&&L.setByteRange(B.BYTERANGE),L.level=A,L.sn="initSegment",I&&(L.levelkeys=I),L.initSegment=null}},"./src/loader/playlist-loader.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>n});var f=o("./src/polyfills/number.ts"),_=o("./src/events.ts"),g=o("./src/errors.ts"),T=o("./src/utils/logger.ts"),E=o("./src/loader/m3u8-parser.ts"),h=o("./src/types/loader.ts"),k=o("./src/utils/attr-list.ts");function t(a,d){return a=a.url,a=a!==void 0&&a.indexOf("data:")!==0?a:d.url}function r(a){this.hls=void 0,this.loaders=Object.create(null),this.hls=a,this.registerListeners()}(l=r.prototype).startLoad=function(a){},l.stopLoad=function(){this.destroyInternalLoaders()},l.registerListeners=function(){var a=this.hls;a.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(_.Events.LEVEL_LOADING,this.onLevelLoading,this),a.on(_.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),a.on(_.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},l.unregisterListeners=function(){var a=this.hls;a.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(_.Events.LEVEL_LOADING,this.onLevelLoading,this),a.off(_.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),a.off(_.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},l.createInternalLoader=function(a){var d=this.hls.config,m=d.pLoader,p=d.loader,m=new(m||p)(d);return a.loader=m,this.loaders[a.type]=m},l.getInternalLoader=function(a){return this.loaders[a.type]},l.resetInternalLoader=function(a){this.loaders[a]&&delete this.loaders[a]},l.destroyInternalLoaders=function(){for(var a in this.loaders){var d=this.loaders[a];d&&d.destroy(),this.resetInternalLoader(a)}},l.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},l.onManifestLoading=function(a,d){d=d.url,this.load({id:null,groupId:null,level:0,responseType:"text",type:h.PlaylistContextType.MANIFEST,url:d,deliveryDirectives:null})},l.onLevelLoading=function(a,b){var p=b.id,m=b.level,x=b.url,b=b.deliveryDirectives;this.load({id:p,groupId:null,level:m,responseType:"text",type:h.PlaylistContextType.LEVEL,url:x,deliveryDirectives:b})},l.onAudioTrackLoading=function(a,b){var p=b.id,m=b.groupId,x=b.url,b=b.deliveryDirectives;this.load({id:p,groupId:m,level:null,responseType:"text",type:h.PlaylistContextType.AUDIO_TRACK,url:x,deliveryDirectives:b})},l.onSubtitleTrackLoading=function(a,b){var p=b.id,m=b.groupId,x=b.url,b=b.deliveryDirectives;this.load({id:p,groupId:m,level:null,responseType:"text",type:h.PlaylistContextType.SUBTITLE_TRACK,url:x,deliveryDirectives:b})},l.load=function(a){var d,p,m,x,b=this.hls.config;if(C=this.getInternalLoader(a)){var v=C.context;if(v&&v.url===a.url)return void T.logger.trace("[playlist-loader]: playlist request ongoing");T.logger.log("[playlist-loader]: aborting previous loader for type: "+a.type),C.abort()}switch(a.type){case h.PlaylistContextType.MANIFEST:d=b.manifestLoadingMaxRetry,p=b.manifestLoadingTimeOut,m=b.manifestLoadingRetryDelay,x=b.manifestLoadingMaxRetryTimeout;break;case h.PlaylistContextType.LEVEL:case h.PlaylistContextType.AUDIO_TRACK:case h.PlaylistContextType.SUBTITLE_TRACK:d=0,p=b.levelLoadingTimeOut;break;default:d=b.levelLoadingMaxRetry,p=b.levelLoadingTimeOut,m=b.levelLoadingRetryDelay,x=b.levelLoadingMaxRetryTimeout}var C=this.createInternalLoader(a),v=((v=a.deliveryDirectives)!=null&&v.part&&(a.type===h.PlaylistContextType.LEVEL&&a.level!==null?y=this.hls.levels[a.level].details:a.type===h.PlaylistContextType.AUDIO_TRACK&&a.id!==null?y=this.hls.audioTracks[a.id].details:a.type===h.PlaylistContextType.SUBTITLE_TRACK&&a.id!==null&&(y=this.hls.subtitleTracks[a.id].details),y)&&(v=y.partTarget,y=y.targetduration,v&&y&&(p=Math.min(1e3*Math.max(3*v,.8*y),p))),{timeout:p,maxRetry:d,retryDelay:m,maxRetryDelay:x,highWaterMark:0}),y={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};C.load(a,v,y)},l.loadsuccess=function(a,d,p,m){m===void 0&&(m=null),this.resetInternalLoader(p.type);var x=a.data;x.indexOf("#EXTM3U")===0?(d.parsing.start=performance.now(),0<x.indexOf("#EXTINF:")||0<x.indexOf("#EXT-X-TARGETDURATION:")?this.handleTrackOrLevelPlaylist(a,d,p,m):this.handleMasterPlaylist(a,d,p,m)):this.handleManifestParsingError(a,p,"no EXTM3U delimiter",m)},l.loaderror=function(a,d,p){this.handleNetworkError(d,p=p===void 0?null:p,!1,a)},l.loadtimeout=function(a,d,p){this.handleNetworkError(d,p=p===void 0?null:p,!0)},l.handleMasterPlaylist=function(a,d,p,m){var x,b,C=this.hls,v=a.data,y=t(a,p),B=E.default.parseMasterPlaylist(v,y),S=B.levels,L=B.sessionData,B=B.sessionKeys;S.length?(x=S.map(function(A){return{id:A.attrs.AUDIO,audioCodec:A.audioCodec}}),b=S.map(function(A){return{id:A.attrs.SUBTITLES,textCodec:A.textCodec}}),x=E.default.parseMasterPlaylistMedia(v,y,"AUDIO",x),b=E.default.parseMasterPlaylistMedia(v,y,"SUBTITLES",b),v=E.default.parseMasterPlaylistMedia(v,y,"CLOSED-CAPTIONS"),x.length&&!x.some(function(A){return!A.url})&&S[0].audioCodec&&!S[0].attrs.AUDIO&&(T.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),x.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new k.AttrList({}),bitrate:0,url:""})),C.trigger(_.Events.MANIFEST_LOADED,{levels:S,audioTracks:x,subtitles:b,captions:v,url:y,stats:d,networkDetails:m,sessionData:L,sessionKeys:B})):this.handleManifestParsingError(a,p,"no level found in manifest",m)},l.handleTrackOrLevelPlaylist=function(a,d,p,m){var x=this.hls,v=p.id,S=p.level,b=p.type,C=t(a,p),v=(0,f.isFiniteNumber)(v)?v:0,S=(0,f.isFiniteNumber)(S)?S:v,y=(function(){switch(p.type){case h.PlaylistContextType.AUDIO_TRACK:return h.PlaylistLevelType.AUDIO;case h.PlaylistContextType.SUBTITLE_TRACK:return h.PlaylistLevelType.SUBTITLE;default:return h.PlaylistLevelType.MAIN}})(),S=E.default.parseLevelPlaylist(a.data,C,S,y,v);S.fragments.length?(b===h.PlaylistContextType.MANIFEST&&(y={attrs:new k.AttrList({}),bitrate:0,details:S,name:"",url:C},x.trigger(_.Events.MANIFEST_LOADED,{levels:[y],audioTracks:[],url:C,stats:d,networkDetails:m,sessionData:null,sessionKeys:null})),d.parsing.end=performance.now(),p.levelDetails=S,this.handlePlaylistLoaded(a,d,p,m)):x.trigger(_.Events.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:C,reason:"no fragments found in level",level:typeof p.level=="number"?p.level:void 0})},l.handleManifestParsingError=function(a,d,p,m){this.hls.trigger(_.Events.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:d.type===h.PlaylistContextType.MANIFEST,url:a.url,reason:p,response:a,context:d,networkDetails:m})},l.handleNetworkError=function(a,d,p,m){T.logger.warn("[playlist-loader]: A network "+((p=p===void 0?!1:p)?"timeout":"error")+" occurred while loading "+a.type+" level: "+a.level+" id: "+a.id+' group-id: "'+a.groupId+'"');var x=g.ErrorDetails.UNKNOWN,b=!1,C=this.getInternalLoader(a);switch(a.type){case h.PlaylistContextType.MANIFEST:x=p?g.ErrorDetails.MANIFEST_LOAD_TIMEOUT:g.ErrorDetails.MANIFEST_LOAD_ERROR,b=!0;break;case h.PlaylistContextType.LEVEL:x=p?g.ErrorDetails.LEVEL_LOAD_TIMEOUT:g.ErrorDetails.LEVEL_LOAD_ERROR,b=!1;break;case h.PlaylistContextType.AUDIO_TRACK:x=p?g.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:g.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,b=!1;break;case h.PlaylistContextType.SUBTITLE_TRACK:x=p?g.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:g.ErrorDetails.SUBTITLE_LOAD_ERROR,b=!1}C&&this.resetInternalLoader(a.type),C={type:g.ErrorTypes.NETWORK_ERROR,details:x,fatal:b,url:a.url,loader:C,context:a,networkDetails:d},m&&(C.response=m),this.hls.trigger(_.Events.ERROR,C)},l.handlePlaylistLoaded=function(a,d,p,m){var x=p.type,b=p.level,C=p.id,v=p.groupId,y=p.loader,S=p.levelDetails,L=p.deliveryDirectives;if(S!=null&&S.targetduration){if(y)switch(S.live&&(y.getCacheAge&&(S.ageHeader=y.getCacheAge()||0),y.getCacheAge&&!isNaN(S.ageHeader)||(S.ageHeader=0)),x){case h.PlaylistContextType.MANIFEST:case h.PlaylistContextType.LEVEL:this.hls.trigger(_.Events.LEVEL_LOADED,{details:S,level:b||0,id:C||0,stats:d,networkDetails:m,deliveryDirectives:L});break;case h.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(_.Events.AUDIO_TRACK_LOADED,{details:S,id:C||0,groupId:v||"",stats:d,networkDetails:m,deliveryDirectives:L});break;case h.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(_.Events.SUBTITLE_TRACK_LOADED,{details:S,id:C||0,groupId:v||"",stats:d,networkDetails:m,deliveryDirectives:L})}}else this.handleManifestParsingError(a,p,"invalid target duration",m)};const n=r},"./src/polyfills/number.ts":(c,l,o)=>{o.r(l),o.d(l,{MAX_SAFE_INTEGER:()=>_,isFiniteNumber:()=>f});var f=Number.isFinite||function(g){return typeof g=="number"&&isFinite(g)},_=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>f}),_.getSilentFrame=function(g,T){return g==="mp4a.40.2"?T===1?new Uint8Array([0,200,0,128,35,128]):T===2?new Uint8Array([33,0,73,144,2,25,0,35,128]):T===3?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]):T===4?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]):T===5?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]):T===6?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]):void 0:T===1?new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]):T===2||T===3?new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]):void 0};const f=_;function _(){}},"./src/remux/mp4-generator.ts":(c,l,_)=>{_.r(l),_.d(l,{default:()=>T});var f=Math.pow(2,32)-1,_=(g.init=function(){for(var E in g.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]})g.types.hasOwnProperty(E)&&(g.types[E]=[E.charCodeAt(0),E.charCodeAt(1),E.charCodeAt(2),E.charCodeAt(3)]);var h=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),k=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),h=(g.HDLR_TYPES={video:h,audio:k},new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])),k=new Uint8Array([0,0,0,0,0,0,0,0]),k=(g.STTS=g.STSC=g.STCO=k,g.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),g.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),g.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),g.STSD=new Uint8Array([0,0,0,0,0,0,0,1]),new Uint8Array([105,115,111,109])),t=new Uint8Array([97,118,99,49]),r=new Uint8Array([0,0,0,1]);g.FTYP=g.box(g.types.ftyp,k,r,k,t),g.DINF=g.box(g.types.dinf,g.box(g.types.dref,h))},g.box=function(E){for(var h=8,k=arguments.length,t=new Array(1<k?k-1:0),r=1;r<k;r++)t[r-1]=arguments[r];for(var n=t.length,a=n;n--;)h+=t[n].byteLength;var d=new Uint8Array(h);for(d[0]=h>>24&255,d[1]=h>>16&255,d[2]=h>>8&255,d[3]=255&h,d.set(E,4),n=0,h=8;n<a;n++)d.set(t[n],h),h+=t[n].byteLength;return d},g.hdlr=function(E){return g.box(g.types.hdlr,g.HDLR_TYPES[E])},g.mdat=function(E){return g.box(g.types.mdat,E)},g.mdhd=function(E,t){t*=E;var k=Math.floor(t/(1+f)),t=Math.floor(t%(1+f));return g.box(g.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,E>>24&255,E>>16&255,E>>8&255,255&E,k>>24,k>>16&255,k>>8&255,255&k,t>>24,t>>16&255,t>>8&255,255&t,85,196,0,0]))},g.mdia=function(E){return g.box(g.types.mdia,g.mdhd(E.timescale,E.duration),g.hdlr(E.type),g.minf(E))},g.mfhd=function(E){return g.box(g.types.mfhd,new Uint8Array([0,0,0,0,E>>24,E>>16&255,E>>8&255,255&E]))},g.minf=function(E){return E.type==="audio"?g.box(g.types.minf,g.box(g.types.smhd,g.SMHD),g.DINF,g.stbl(E)):g.box(g.types.minf,g.box(g.types.vmhd,g.VMHD),g.DINF,g.stbl(E))},g.moof=function(E,h,k){return g.box(g.types.moof,g.mfhd(E),g.traf(k,h))},g.moov=function(E){for(var h=E.length,k=[];h--;)k[h]=g.trak(E[h]);return g.box.apply(null,[g.types.moov,g.mvhd(E[0].timescale,E[0].duration)].concat(k).concat(g.mvex(E)))},g.mvex=function(E){for(var h=E.length,k=[];h--;)k[h]=g.trex(E[h]);return g.box.apply(null,[g.types.mvex].concat(k))},g.mvhd=function(r,t){t*=r;var k=Math.floor(t/(1+f)),t=Math.floor(t%(1+f)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,k>>24,k>>16&255,k>>8&255,255&k,t>>24,t>>16&255,t>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return g.box(g.types.mvhd,r)},g.sdtp=function(E){for(var h,k=E.samples||[],t=new Uint8Array(4+k.length),r=0;r<k.length;r++)h=k[r].flags,t[r+4]=h.dependsOn<<4|h.isDependedOn<<2|h.hasRedundancy;return g.box(g.types.sdtp,t)},g.stbl=function(E){return g.box(g.types.stbl,g.stsd(E),g.box(g.types.stts,g.STTS),g.box(g.types.stsc,g.STSC),g.box(g.types.stsz,g.STSZ),g.box(g.types.stco,g.STCO))},g.avc1=function(E){for(var h,k,t=[],r=[],n=0;n<E.sps.length;n++)k=(h=E.sps[n]).byteLength,t.push(k>>>8&255),t.push(255&k),t=t.concat(Array.prototype.slice.call(h));for(n=0;n<E.pps.length;n++)k=(h=E.pps[n]).byteLength,r.push(k>>>8&255),r.push(255&k),r=r.concat(Array.prototype.slice.call(h));var a=g.box(g.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|E.sps.length].concat(t).concat([E.pps.length]).concat(r))),d=E.width,p=E.height,m=E.pixelRatio[0],x=E.pixelRatio[1];return g.box(g.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>8&255,255&d,p>>8&255,255&p,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,g.box(g.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),g.box(g.types.pasp,new Uint8Array([m>>24,m>>16&255,m>>8&255,255&m,x>>24,x>>16&255,x>>8&255,255&x])))},g.esds=function(E){var h=E.config.length;return new Uint8Array([0,0,0,0,3,23+h,0,1,0,4,15+h,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([h]).concat(E.config).concat([6,1,2]))},g.mp4a=function(E){var h=E.samplerate;return g.box(g.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,E.channelCount,0,16,0,0,0,0,h>>8&255,255&h,0,0]),g.box(g.types.esds,g.esds(E)))},g.mp3=function(E){var h=E.samplerate;return g.box(g.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,E.channelCount,0,16,0,0,0,0,h>>8&255,255&h,0,0]))},g.stsd=function(E){return E.type==="audio"?E.segmentCodec==="mp3"&&E.codec==="mp3"?g.box(g.types.stsd,g.STSD,g.mp3(E)):g.box(g.types.stsd,g.STSD,g.mp4a(E)):g.box(g.types.stsd,g.STSD,g.avc1(E))},g.tkhd=function(t){var h=t.id,n=t.duration*t.timescale,k=t.width,t=t.height,r=Math.floor(n/(1+f)),n=Math.floor(n%(1+f));return g.box(g.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,h>>24&255,h>>16&255,h>>8&255,255&h,0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,k>>8&255,255&k,0,0,t>>8&255,255&t,0,0]))},g.traf=function(E,n){var k=g.sdtp(E),t=E.id,r=Math.floor(n/(1+f)),n=Math.floor(n%(1+f));return g.box(g.types.traf,g.box(g.types.tfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t])),g.box(g.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n])),g.trun(E,k.length+16+20+8+16+8+8),k)},g.trak=function(E){return E.duration=E.duration||4294967295,g.box(g.types.trak,g.tkhd(E),g.mdia(E))},g.trex=function(E){return E=E.id,g.box(g.types.trex,new Uint8Array([0,0,0,0,E>>24,E>>16&255,E>>8&255,255&E,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},g.trun=function(E,h){var k,t,r,n,a,d=E.samples||[],p=d.length,m=12+16*p,x=new Uint8Array(m);for(x.set([E.type==="video"?1:0,0,15,1,p>>>24&255,p>>>16&255,p>>>8&255,255&p,(h+=8+m)>>>24&255,h>>>16&255,h>>>8&255,255&h],0),k=0;k<p;k++)t=(a=d[k]).duration,r=a.size,n=a.flags,a=a.cts,x.set([t>>>24&255,t>>>16&255,t>>>8&255,255&t,r>>>24&255,r>>>16&255,r>>>8&255,255&r,n.isLeading<<2|n.dependsOn,n.isDependedOn<<6|n.hasRedundancy<<4|n.paddingValue<<1|n.isNonSync,61440&n.degradPrio,15&n.degradPrio,a>>>24&255,a>>>16&255,a>>>8&255,255&a],12+16*k);return g.box(g.types.trun,x)},g.initSegment=function(h){g.types||g.init();var h=g.moov(h),k=new Uint8Array(g.FTYP.byteLength+h.byteLength);return k.set(g.FTYP),k.set(h,g.FTYP.byteLength),k},g);function g(){}_.types=void 0,_.HDLR_TYPES=void 0,_.STTS=void 0,_.STSC=void 0,_.STCO=void 0,_.STSZ=void 0,_.VMHD=void 0,_.SMHD=void 0,_.STSD=void 0,_.FTYP=void 0,_.DINF=void 0;const T=_},"./src/remux/mp4-remuxer.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>d,flushTextTrackMetadataCueSamples:()=>x,flushTextTrackUserdataCueSamples:()=>b,normalizePts:()=>m});var f=o("./src/polyfills/number.ts"),_=o("./src/remux/aac-helper.ts"),g=o("./src/remux/mp4-generator.ts"),T=o("./src/events.ts"),E=o("./src/errors.ts"),h=o("./src/utils/logger.ts"),k=o("./src/types/loader.ts"),t=o("./src/utils/timescale-conversion.ts");function r(){return(r=Object.assign?Object.assign.bind():function(y){for(var S=1;S<arguments.length;S++){var L,B=arguments[S];for(L in B)Object.prototype.hasOwnProperty.call(B,L)&&(y[L]=B[L])}return y}).apply(this,arguments)}var n=null,a=null,d=((l=p.prototype).destroy=function(){},l.resetTimeStamp=function(y){h.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=y},l.resetNextTimestamp=function(){h.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},l.resetInitSegment=function(){h.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},l.getVideoStartPts=function(L){var S=!1,L=L.reduce(function(B,A){var I=A.pts-B;return I<-4294967296?(S=!0,m(B,A.pts)):0<I?B:A.pts},L[0].pts);return S&&h.logger.debug("PTS rollover detected"),L},l.remux=function(y,S,L,B,A,I,U,P){var F,M,w,R,O,j,z,G=A,K=A,$=-1<y.pid,V=-1<S.pid,q=S.samples.length,J=0<y.samples.length,re=U&&0<q||1<q;return($&&!J||V&&!re)&&!this.ISGenerated&&!U||(this.ISGenerated||(w=this.generateIS(y,S,A)),$=this.isVideoContiguous,U=-1,re&&(U=(function(Z){for(var W=0;W<Z.length;W++)if(Z[W].key)return W;return-1})(S.samples),!$)&&this.config.forceKeyFrameOnDiscontinuity&&(j=!0,0<U?(h.logger.warn("[mp4-remuxer]: Dropped "+U+" out of "+q+" video samples due to a missing keyframe"),z=this.getVideoStartPts(S.samples),S.samples=S.samples.slice(U),S.dropped+=U,z=K+=(S.samples[0].pts-z)/S.inputTimeScale):U===-1&&(h.logger.warn("[mp4-remuxer]: No keyframe found out of "+q+" video samples"),j=!1)),this.ISGenerated&&(J&&re&&(q=this.getVideoStartPts(S.samples),q=(m(y.samples[0].pts,q)-q)/S.inputTimeScale,G+=Math.max(0,q),K+=Math.max(0,-q)),J?(y.samplerate||(h.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),w=this.generateIS(y,S,A)),M=this.remuxAudio(y,G,this.isAudioContiguous,I,V||re||P===k.PlaylistLevelType.AUDIO?K:void 0),re&&(q=M?M.endPTS-M.startPTS:0,S.inputTimeScale||(h.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),w=this.generateIS(y,S,A)),F=this.remuxVideo(S,K,$,q))):re&&(F=this.remuxVideo(S,K,$,0)),F)&&(F.firstKeyFrame=U,F.independent=U!==-1,F.firstKeyFramePTS=z)),{audio:M,video:F,initSegment:w,independent:j,text:R=this.ISGenerated&&(L.samples.length&&(O=x(L,A,this._initPTS,this._initDTS)),B.samples.length)?b(B,A,this._initPTS):R,id3:O}},l.generateIS=function(y,S,L){var B,A,I,U=y.samples,P=S.samples,F=this.typeSupported,M={},w=!(0,f.isFiniteNumber)(this._initPTS),R="audio/mp4";if(w&&(I=A=1/0),y.config&&U.length&&(y.timescale=y.samplerate,y.segmentCodec==="mp3"&&(F.mpeg?(R="audio/mpeg",y.codec=""):F.mp3&&(y.codec="mp3")),M.audio={id:"audio",container:R,codec:y.codec,initSegment:y.segmentCodec==="mp3"&&F.mpeg?new Uint8Array(0):g.default.initSegment([y]),metadata:{channelCount:y.channelCount}},w)&&(B=y.inputTimeScale,I=A=U[0].pts-Math.round(B*L)),S.sps&&S.pps&&P.length&&(S.timescale=S.inputTimeScale,M.video={id:"main",container:"video/mp4",codec:S.codec,initSegment:g.default.initSegment([S]),metadata:{width:S.width,height:S.height}},w)&&(B=S.inputTimeScale,R=this.getVideoStartPts(P),F=Math.round(B*L),A=Math.min(A,m(P[0].dts,R)-F),I=Math.min(I,R-F)),Object.keys(M).length)return this.ISGenerated=!0,w&&(this._initPTS=I,this._initDTS=A),{tracks:M,initPTS:I,timescale:B}},l.remuxVideo=function(y,V,ce,B){var A=y.inputTimeScale,I=y.samples,U=[],P=I.length,F=this._initPTS,M=this.nextAvcDts,w=8,R=this.videoSampleDuration,O=Number.POSITIVE_INFINITY,j=Number.NEGATIVE_INFINITY,z=!1;ce&&M!==null||(M=V*A-(I[0].pts-m(I[0].dts,I[0].pts)));for(var G=0;G<P;G++){var K=I[G];K.pts=m(K.pts-F,M),K.dts=m(K.dts-F,M),K.dts<I[0<G?G-1:G].dts&&(z=!0)}z&&I.sort(function(qe,_t){var bt=qe.dts-_t.dts,qe=qe.pts-_t.pts;return bt||qe}),$=I[0].dts;var $,V=I[I.length-1].dts-$,q=V?Math.round(V/(P-1)):R||y.inputTimeScale/30;ce&&(ce=(V=$-M)<-1,(le=q<V)||ce)&&(le?h.logger.warn("AVC: "+(0,t.toMsFromMpegTsClock)(V,!0)+" ms ("+V+"dts) hole between fragments detected, filling it"):h.logger.warn("AVC: "+(0,t.toMsFromMpegTsClock)(-V,!0)+" ms ("+V+"dts) overlapping between fragments detected"),!ce||M>I[0].pts)&&($=M,le=I[0].pts-V,I[0].dts=$,I[0].pts=le,h.logger.log("Video: First PTS/DTS adjusted: "+(0,t.toMsFromMpegTsClock)(le,!0)+"/"+(0,t.toMsFromMpegTsClock)($,!0)+", delta: "+(0,t.toMsFromMpegTsClock)(V,!0)+" ms")),$=Math.max(0,$);for(var J=0,re=0,Z=0;Z<P;Z++){for(var W=I[Z],X=W.units,se=X.length,ie=0,ne=0;ne<se;ne++)ie+=X[ne].data.length;re+=ie,J+=se,W.length=ie,W.dts=Math.max(W.dts,$),O=Math.min(W.pts,O),j=Math.max(W.pts,j)}var me,ce=I[P-1].dts,le=re+4*J+8;try{me=new Uint8Array(le)}catch{return void this.observer.emit(T.Events.ERROR,T.Events.ERROR,{type:E.ErrorTypes.MUX_ERROR,details:E.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:le,reason:"fail allocating video mdat "+le})}var ge=new DataView(me.buffer);ge.setUint32(0,le),me.set(g.default.types.mdat,4);for(var ye=!1,Ee=Number.POSITIVE_INFINITY,xe=Number.POSITIVE_INFINITY,ke=Number.NEGATIVE_INFINITY,Le=Number.NEGATIVE_INFINITY,De=0;De<P;De++){for(var Ne=I[De],ot=Ne.units,it=0,$e=0,je=ot.length;$e<je;$e++){var Ke=ot[$e],Rt=Ke.data,Ke=Ke.data.byteLength;ge.setUint32(w,Ke),w+=4,me.set(Rt,w),w+=Ke,it+=4+Ke}var At,lt=void 0,Ve=(De<P-1?(R=I[De+1].dts-Ne.dts,lt=I[De+1].pts-Ne.pts):(Ve=this.config,At=0<De?Ne.dts-I[De-1].dts:q,lt=0<De?Ne.pts-I[De-1].pts:q,Ve.stretchShortVideoTrack&&this.nextAudioPts!==null&&Math.floor(Ve.maxBufferHole*A)<(Ve=(B?O+B*A:this.nextAudioPts)-Ne.pts)?((R=Ve-At)<0?R=At:ye=!0,h.logger.log("[mp4-remuxer]: It is approximately "+Ve/90+" ms to the next segment; using duration "+R/90+" ms for the last video frame.")):R=At),Math.round(Ne.pts-Ne.dts)),Ee=Math.min(Ee,R),ke=Math.max(ke,R),xe=Math.min(xe,lt),Le=Math.max(Le,lt);U.push(new C(Ne.key,R,it,Ve))}if(U.length){if(n)n<70&&((V=U[0].flags).dependsOn=2,V.isNonSync=0);else if(a&&Le-xe<ke-Ee&&q/ke<.025&&U[0].cts===0){h.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var ht=$,Re=0,ze=U.length;Re<ze;Re++){var Tr,zi=ht+U[Re].duration,Gi=ht+U[Re].cts;Re<ze-1?(Tr=zi+U[Re+1].cts,U[Re].duration=Tr-Gi):U[Re].duration=Re?U[Re-1].duration:q,U[Re].cts=0,ht=zi}}}return console.assert(R!==null,"mp4SampleDuration must be computed"),this.nextAvcDts=M=ce+(R=ye||!R?q:R),this.videoSampleDuration=R,this.isVideoContiguous=!0,le={data1:g.default.moof(y.sequenceNumber++,$,r({},y,{samples:U})),data2:me,startPTS:O/A,endPTS:(j+R)/A,startDTS:$/A,endDTS:M/A,type:"video",hasAudio:!1,hasVideo:!0,nb:U.length,dropped:y.dropped},y.samples=[],y.dropped=0,console.assert(me.length,"MDAT length must not be zero"),le},l.remuxAudio=function(y,S,L,B,A){var I=y.inputTimeScale,U=I/(y.samplerate||I),P=y.segmentCodec==="aac"?1024:1152,F=P*U,M=this._initPTS,w=y.segmentCodec==="mp3"&&this.typeSupported.mpeg,R=[],O=A!==void 0,j=y.samples,z=w?0:8,G=this.nextAudioPts||-1,K=S*I;if(this.isAudioContiguous=L=L||j.length&&0<G&&(B&&Math.abs(K-G)<9e3||Math.abs(m(j[0].pts-M,K)-G)<20*F),j.forEach(function(De){De.pts=m(De.pts-M,K)}),!L||G<0){if(!(j=j.filter(function(De){return 0<=De.pts})).length)return;G=A===0?0:B&&!O?Math.max(0,K):j[0].pts}if(y.segmentCodec==="aac")for(var $=this.config.maxAudioFramesDrift,V=0,q=G;V<j.length;V++){var J=j[V],re=J.pts,Z=re-q,W=Math.abs(1e3*Z/I);if(Z<=-$*F&&O)V===0&&(h.logger.warn("Audio frame @ "+(re/I).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*Z/I)+" ms."),this.nextAudioPts=G=q=re);else if($*F<=Z&&W<1e4&&O){var X=Math.round(Z/F);(q=re-X*F)<0&&(X--,q+=F),V===0&&(this.nextAudioPts=G=q),h.logger.warn("[mp4-remuxer]: Injecting "+X+" audio frame @ "+(q/I).toFixed(3)+"s due to "+Math.round(1e3*Z/I)+" ms gap.");for(var se=0;se<X;se++){var ie=Math.max(q,0),ne=_.default.getSilentFrame(y.manifestCodec||y.codec,y.channelCount);ne||(h.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ne=J.unit.subarray()),j.splice(V,0,{unit:ne,pts:ie}),q+=F,V++}}J.pts=q,q+=F}for(var me,ce=null,le=null,ge=0,ye=j.length;ye--;)ge+=j[ye].unit.byteLength;for(var Ee=0,xe=j.length;Ee<xe;Ee++){var Le=j[Ee],ke=Le.unit,Le=Le.pts;if(le!==null)R[Ee-1].duration=Math.round((Le-le)/U);else{if(ce=Le=L&&y.segmentCodec==="aac"?G:Le,!(0<ge))return;ge+=z;try{me=new Uint8Array(ge)}catch{return void this.observer.emit(T.Events.ERROR,T.Events.ERROR,{type:E.ErrorTypes.MUX_ERROR,details:E.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ge,reason:"fail allocating audio mdat "+ge})}w||(new DataView(me.buffer).setUint32(0,ge),me.set(g.default.types.mdat,4))}me.set(ke,z),ke=ke.byteLength,z+=ke,R.push(new C(!0,P,ke,0)),le=Le}if(S=R.length,S)return this.nextAudioPts=G=le+U*R[R.length-1].duration,A={data1:w?new Uint8Array(0):g.default.moof(y.sequenceNumber++,ce/U,r({},y,{samples:R})),data2:me,startPTS:A=ce/I,endPTS:B=G/I,startDTS:A,endDTS:B,type:"audio",hasAudio:!0,hasVideo:!(y.samples=[]),nb:S},this.isAudioContiguous=!0,console.assert(me.length,"MDAT length must not be zero"),A},l.remuxEmptyAudio=function(y,S,L,B){var A=y.inputTimeScale,I=A/(y.samplerate||A),P=this.nextAudioPts,U=(P!==null?P:B.startDTS*A)+this._initDTS,P=B.endDTS*A+this._initDTS,F=1024*I,M=Math.ceil((P-U)/F),w=_.default.getSilentFrame(y.manifestCodec||y.codec,y.channelCount);if(h.logger.warn("[mp4-remuxer]: remux empty Audio"),w){for(var R=[],O=0;O<M;O++){var j=U+O*F;R.push({unit:w,pts:j,dts:j})}return y.samples=R,this.remuxAudio(y,S,L,!1)}h.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},p);function p(y,S,L,B){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=y,this.config=S,this.typeSupported=L,this.ISGenerated=!1,n===null&&(y=(navigator.userAgent||"").match(/Chrome\/(\d+)/i),n=y?parseInt(y[1]):0),a===null&&(S=navigator.userAgent.match(/Safari\/(\d+)/i),a=S?parseInt(S[1]):0)}function m(y,S){var L;if(S!==null)for(L=S<y?-8589934592:8589934592;4294967296<Math.abs(y-S);)y+=L;return y}function x(y,S,L,B){var A=y.samples.length;if(A){for(var I=y.inputTimeScale,U=0;U<A;U++){var P=y.samples[U];P.pts=m(P.pts-L,S*I)/I,P.dts=m(P.dts-B,S*I)/I}var F=y.samples;return y.samples=[],{samples:F}}}function b(y,S,L){var B=y.samples.length;if(B){for(var A=y.inputTimeScale,I=0;I<B;I++){var U=y.samples[I];U.pts=m(U.pts-L,S*A)/A}y.samples.sort(function(F,M){return F.pts-M.pts});var P=y.samples;return y.samples=[],{samples:P}}}var C=function(y,S,L,B){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=S,this.size=L,this.cts=B,this.flags=new v(y)},v=function(y){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=y?2:1,this.isNonSync=y?0:1}},"./src/remux/passthrough-remuxer.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>k});var f=o("./src/polyfills/number.ts"),_=o("./src/remux/mp4-remuxer.ts"),g=o("./src/utils/mp4-tools.ts"),T=o("./src/loader/fragment.ts"),E=o("./src/utils/logger.ts");function h(r,n){return r=r?.codec,r&&4<r.length?r:r==="hvc1"||r==="hev1"?"hvc1.1.c.L120.90":r==="av01"?"av01.0.04M.08":r==="avc1"||n===T.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}(l=t.prototype).destroy=function(){},l.resetTimeStamp=function(r){this.initPTS=r,this.lastEndTime=null},l.resetNextTimestamp=function(){this.lastEndTime=null},l.resetInitSegment=function(r,n,a,d){this.audioCodec=n,this.videoCodec=a,this.generateInitSegment((0,g.patchEncyptionData)(r,d)),this.emitInitSegment=!0},l.generateInitSegment=function(r){var n,a,d=this.audioCodec,p=this.videoCodec;r&&r.byteLength?(n=this.initData=(0,g.parseInitSegment)(r),d=d||h(n.audio,T.ElementaryStreamTypes.AUDIO),p=p||h(n.video,T.ElementaryStreamTypes.VIDEO),a={},n.audio&&n.video?a.audiovideo={container:"video/mp4",codec:d+","+p,initSegment:r,id:"main"}:n.audio?a.audio={container:"audio/mp4",codec:d,initSegment:r,id:"audio"}:n.video?a.video={container:"video/mp4",codec:p,initSegment:r,id:"main"}:E.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=a):(this.initTracks=void 0,this.initData=void 0)},l.remux=function(r,S,a,d,p){var m,x,b,C=this.initPTS,v=this.lastEndTime,y={audio:void 0,video:void 0,text:d,id3:a,initSegment:void 0},S=((0,f.isFiniteNumber)(v)||(v=this.lastEndTime=p||0),S.samples);return S&&S.length&&(m={initPTS:void 0,timescale:1},(b=this.initData)&&b.length||(this.generateInitSegment(S),b=this.initData),b&&b.length?(this.emitInitSegment&&(m.tracks=this.initTracks,this.emitInitSegment=!1),x=(0,g.getStartDTS)(b,S),(0,f.isFiniteNumber)(C)||(this.initPTS=m.initPTS=C=x-p),v=(r=r?x-C:v)+(x=(0,g.getDuration)(S,b)),(0,g.offsetStartDTS)(b,S,C),0<x?this.lastEndTime=v:(E.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp()),C="",(x=!!b.audio)&&(C+="audio"),(b=!!b.video)&&(C+="video"),y.audio=(S={data1:S,startPTS:r,startDTS:r,endPTS:v,endDTS:v,type:C,hasAudio:x,hasVideo:b,nb:1,dropped:0}).type==="audio"?S:void 0,y.video=S.type!=="audio"?S:void 0,y.initSegment=m,v=(r=this.initPTS)!=null?r:0,y.id3=(0,_.flushTextTrackMetadataCueSamples)(a,p,v,v),d.samples.length&&(y.text=(0,_.flushTextTrackUserdataCueSamples)(d,p,v))):E.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment.")),y};const k=t;function t(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}},"./src/task-loop.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>f}),(o=_.prototype).destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},o.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},o.onHandlerDestroyed=function(){},o.hasInterval=function(){return!!this._tickInterval},o.hasNextTick=function(){return!!this._tickTimer},o.setInterval=function(g){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,g),!0)},o.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),!(this._tickInterval=null))},o.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),!(this._tickTimer=null))},o.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),1<this._tickCallCount&&this.tickImmediate(),this._tickCallCount=0)},o.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},o.doTick=function(){};var f=_;function _(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}},"./src/types/cmcd.ts":(c,l,o)=>{o.r(l),o.d(l,{CMCDObjectType:()=>f,CMCDStreamType:()=>g,CMCDStreamingFormat:()=>_,CMCDVersion:()=>T});var f,_,g,T=1;(o=f=f||{}).MANIFEST="m",o.AUDIO="a",o.VIDEO="v",o.MUXED="av",o.INIT="i",o.CAPTION="c",o.TIMED_TEXT="tt",o.KEY="k",o.OTHER="o",(l=_=_||{}).DASH="d",l.HLS="h",l.SMOOTH="s",l.OTHER="o",(o=g=g||{}).VOD="v",o.LIVE="l"},"./src/types/demuxer.ts":(c,l,o)=>{var f;o.r(l),o.d(l,{MetadataSchema:()=>f}),(o=f=f||{}).audioId3="org.id3",o.dateRange="com.apple.quicktime.HLS",o.emsg="https://aomedia.org/emsg/ID3"},"./src/types/level.ts":(c,l,o)=>{function f(t,r){for(var n,a=0;a<r.length;a++){var d=r[a];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(t,typeof(n=(function(p){if(typeof p!="object"||p===null)return p;var m=p[Symbol.toPrimitive];if(m===void 0)return String(p);if(m=m.call(p,"string"),typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")})(d.key))=="symbol"?n:String(n),d)}}o.r(l),o.d(l,{HdcpLevels:()=>g,HlsSkip:()=>_,HlsUrlParameters:()=>T,Level:()=>E,getSkipValue:()=>function(d,r){var n=d.canSkipUntil,a=d.canSkipDateRanges,d=d.endSN;return n&&(r!==void 0?r-d:0)<n?a?_.v2:_.Yes:_.No}});var _,g=["NONE","TYPE-0","TYPE-1","TYPE-2",null];(o=_=_||{}).No="",o.Yes="YES",o.v2="v2",k.prototype.addDirectives=function(t){return t=new self.URL(t),this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href};var T=k,E=(f((l=h).prototype,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(t){t%=this.url.length,this._urlId!==t&&(this.details=void 0,this._urlId=t)}}]),Object.defineProperty(l,"prototype",{writable:!1}),h);function h(t){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[t.url],this.attrs=t.attrs,this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.unknownCodecs=t.unknownCodecs,this.codecSet=[t.videoCodec,t.audioCodec].filter(function(r){return r}).join(",").replace(/\.[^.,]+/g,"")}function k(t,r,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=r,this.skip=n}},"./src/types/loader.ts":(c,l,o)=>{var f,_;o.r(l),o.d(l,{PlaylistContextType:()=>f,PlaylistLevelType:()=>_}),(o=f=f||{}).MANIFEST="manifest",o.LEVEL="level",o.AUDIO_TRACK="audioTrack",o.SUBTITLE_TRACK="subtitleTrack",(l=_=_||{}).MAIN="main",l.AUDIO="audio",l.SUBTITLE="subtitle"},"./src/types/transmuxer.ts":(c,l,o)=>{o.r(l),o.d(l,{ChunkMetadata:()=>f});var f=function(_,g,T,E,h,k){E===void 0&&(E=0),h===void 0&&(h=-1),k===void 0&&(k=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=_,this.sn=g,this.id=T,this.size=E,this.part=h,this.partial=k}},"./src/utils/attr-list.ts":(c,l,o)=>{o.r(l),o.d(l,{AttrList:()=>g});var f=/^(\d+)x(\d+)$/,_=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,g=((o=T.prototype).decimalInteger=function(E){return E=parseInt(this[E],10),E>Number.MAX_SAFE_INTEGER?1/0:E},o.hexadecimalInteger=function(E){if(this[E]){for(var h=(1&(h=(this[E]||"0x").slice(2)).length?"0":"")+h,k=new Uint8Array(h.length/2),t=0;t<h.length/2;t++)k[t]=parseInt(h.slice(2*t,2*t+2),16);return k}return null},o.hexadecimalIntegerAsNumber=function(E){return E=parseInt(this[E],16),E>Number.MAX_SAFE_INTEGER?1/0:E},o.decimalFloatingPoint=function(E){return parseFloat(this[E])},o.optionalFloat=function(E,h){return E=this[E],E?parseFloat(E):h},o.enumeratedString=function(E){return this[E]},o.bool=function(E){return this[E]==="YES"},o.decimalResolution=function(E){if(E=f.exec(this[E]),E!==null)return{width:parseInt(E[1],10),height:parseInt(E[2],10)}},T.parseAttrList=function(E){var h,k={};for(_.lastIndex=0;(h=_.exec(E))!==null;){var t=h[2];t.indexOf('"')===0&&t.lastIndexOf('"')===t.length-1&&(t=t.slice(1,-1)),k[h[1]]=t}return k},T);function T(E){for(var h in E=typeof E=="string"?T.parseAttrList(E):E)E.hasOwnProperty(h)&&(this[h]=E[h])}},"./src/utils/binary-search.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>f});const f={search:function(_,g){for(var T,E,h=0,k=_.length-1;h<=k;){var t=g(E=_[T=(h+k)/2|0]);if(0<t)h=1+T;else{if(!(t<0))return E;k=T-1}}return null}}},"./src/utils/buffer-helper.ts":(c,l,o)=>{o.r(l),o.d(l,{BufferHelper:()=>g});var f=o("./src/utils/logger.ts"),_={length:0,start:function(){return 0},end:function(){return 0}},g=(T.isBuffered=function(E,h){try{if(E){for(var k=T.getBuffered(E),t=0;t<k.length;t++)if(h>=k.start(t)&&h<=k.end(t))return!0}}catch{}return!1},T.bufferInfo=function(E,h,k){try{if(E){for(var t=T.getBuffered(E),r=[],n=0;n<t.length;n++)r.push({start:t.start(n),end:t.end(n)});return this.bufferedInfo(r,h,k)}}catch{}return{len:0,start:h,end:h,nextStart:void 0}},T.bufferedInfo=function(E,h,k){h=Math.max(0,h),E.sort(function(y,S){return y.start-S.start||S.end-y.end});var t=[];if(k)for(var r=0;r<E.length;r++){var n,a=t.length;a&&(n=t[a-1].end,E[r].start-n<k)?E[r].end>n&&(t[a-1].end=E[r].end):t.push(E[r])}else t=E;for(var d,p=0,m=h,x=h,b=0;b<t.length;b++){var C=t[b].start,v=t[b].end;if(C<=h+k&&h<v)m=C,p=(x=v)-h;else if(h+k<C){d=C;break}}return{len:p,start:m||0,end:x||0,nextStart:d}},T.getBuffered=function(E){try{return E.buffered}catch(h){return f.logger.log("failed to get media.buffered",h),_}},T);function T(){}},"./src/utils/cea-608-parser.ts":(c,l,o)=>{o.r(l),o.d(l,{CaptionScreen:()=>C,Row:()=>b,default:()=>F});function f(w){var R=w;return E.hasOwnProperty(w)&&(R=E[w]),String.fromCharCode(R)}function _(w){for(var R=[],O=0;O<w.length;O++)R.push(w[O].toString(16));return R}var g,T=o("./src/utils/logger.ts"),E={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},h=15,k=100,t={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},r={17:2,18:4,21:6,22:8,23:10,19:13,20:15},n={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},a={25:2,26:4,29:6,30:8,31:10,27:13,28:15},d=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],p=((l=g=g||{})[l.ERROR=0]="ERROR",l[l.TEXT=1]="TEXT",l[l.WARNING=2]="WARNING",l[l.INFO=2]="INFO",l[l.DEBUG=3]="DEBUG",l[l.DATA=3]="DATA",I.prototype.log=function(w,R){this.verboseLevel>=w&&(R=typeof R=="function"?R():R,T.logger.log(this.time+" ["+w+"] "+R))},I),m=((o=A.prototype).reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},o.setStyles=function(w){for(var R=["foreground","underline","italics","background","flash"],O=0;O<R.length;O++){var j=R[O];w.hasOwnProperty(j)&&(this[j]=w[j])}},o.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},o.equals=function(w){return this.foreground===w.foreground&&this.underline===w.underline&&this.italics===w.italics&&this.background===w.background&&this.flash===w.flash},o.copy=function(w){this.foreground=w.foreground,this.underline=w.underline,this.italics=w.italics,this.background=w.background,this.flash=w.flash},o.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},A),x=((l=B.prototype).reset=function(){this.uchar=" ",this.penState.reset()},l.setChar=function(w,R){this.uchar=w,this.penState.copy(R)},l.setPenState=function(w){this.penState.copy(w)},l.equals=function(w){return this.uchar===w.uchar&&this.penState.equals(w.penState)},l.copy=function(w){this.uchar=w.uchar,this.penState.copy(w.penState)},l.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},B),b=((o=L.prototype).equals=function(w){for(var R=!0,O=0;O<k;O++)if(!this.chars[O].equals(w.chars[O])){R=!1;break}return R},o.copy=function(w){for(var R=0;R<k;R++)this.chars[R].copy(w.chars[R])},o.isEmpty=function(){for(var w=!0,R=0;R<k;R++)if(!this.chars[R].isEmpty()){w=!1;break}return w},o.setCursor=function(w){this.pos!==w&&(this.pos=w),this.pos<0?(this.logger.log(g.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>k&&(this.logger.log(g.DEBUG,"Too large cursor position "+this.pos),this.pos=k)},o.moveCursor=function(w){var R=this.pos+w;if(1<w)for(var O=this.pos+1;O<R+1;O++)this.chars[O].setPenState(this.currPenState);this.setCursor(R)},o.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},o.insertChar=function(w){var R=this,O=(144<=w&&this.backSpace(),f(w));this.pos>=k?this.logger.log(g.ERROR,function(){return"Cannot insert "+w.toString(16)+" ("+O+") at position "+R.pos+". Skipping it!"}):(this.chars[this.pos].setChar(O,this.currPenState),this.moveCursor(1))},o.clearFromPos=function(w){for(var R=w;R<k;R++)this.chars[R].reset()},o.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},o.clearToEndOfRow=function(){this.clearFromPos(this.pos)},o.getTextString=function(){for(var w=[],R=!0,O=0;O<k;O++){var j=this.chars[O].uchar;j!==" "&&(R=!1),w.push(j)}return R?"":w.join("")},o.setPenStyles=function(w){this.currPenState.setStyles(w),this.chars[this.pos].setPenState(this.currPenState)},L),C=((l=S.prototype).reset=function(){for(var w=0;w<h;w++)this.rows[w].clear();this.currRow=14},l.equals=function(w){for(var R=!0,O=0;O<h;O++)if(!this.rows[O].equals(w.rows[O])){R=!1;break}return R},l.copy=function(w){for(var R=0;R<h;R++)this.rows[R].copy(w.rows[R])},l.isEmpty=function(){for(var w=!0,R=0;R<h;R++)if(!this.rows[R].isEmpty()){w=!1;break}return w},l.backSpace=function(){this.rows[this.currRow].backSpace()},l.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},l.insertChar=function(w){this.rows[this.currRow].insertChar(w)},l.setPen=function(w){this.rows[this.currRow].setPenStyles(w)},l.moveCursor=function(w){this.rows[this.currRow].moveCursor(w)},l.setCursor=function(w){this.logger.log(g.INFO,"setCursor: "+w),this.rows[this.currRow].setCursor(w)},l.setPAC=function(w){this.logger.log(g.INFO,function(){return"pacData = "+JSON.stringify(w)});var R=w.row-1;if(this.nrRollUpRows&&R<this.nrRollUpRows-1&&(R=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==R){for(var O=0;O<h;O++)this.rows[O].clear();var j=this.currRow+1-this.nrRollUpRows,z=this.lastOutputScreen;if(z){var G=z.rows[j].cueStartTime,K=this.logger.time;if(G&&K!==null&&G<K)for(var $=0;$<this.nrRollUpRows;$++)this.rows[R-this.nrRollUpRows+$+1].copy(z.rows[j+$])}}this.currRow=R,G=this.rows[this.currRow],w.indent!==null&&(K=w.indent,K=Math.max(K-1,0),G.setCursor(w.indent),w.color=G.chars[K].penState.foreground),G={foreground:w.color,underline:w.underline,italics:w.italics,background:"black",flash:!1},this.setPen(G)},l.setBkgData=function(w){this.logger.log(g.INFO,function(){return"bkgData = "+JSON.stringify(w)}),this.backSpace(),this.setPen(w),this.insertChar(32)},l.setRollUpRows=function(w){this.nrRollUpRows=w},l.rollUp=function(){var w,R=this;this.nrRollUpRows!==null?(this.logger.log(g.TEXT,function(){return R.getDisplayText()}),w=this.currRow+1-this.nrRollUpRows,(w=this.rows.splice(w,1)[0]).clear(),this.rows.splice(this.currRow,0,w),this.logger.log(g.INFO,"Rolling up")):this.logger.log(g.DEBUG,"roll_up but nrRollUpRows not set yet")},l.getDisplayText=function(w){w=w||!1;for(var R=[],O="",j=0;j<h;j++){var z=this.rows[j].getTextString();z&&R.push(w?"Row "+(j+1)+": '"+z+"'":z.trim())}return O=0<R.length?w?"["+R.join(" | ")+"]":R.join(`
`):O},l.getTextAndFormat=function(){return this.rows},S),v=((o=y.prototype).reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},o.getHandler=function(){return this.outputFilter},o.setHandler=function(w){this.outputFilter=w},o.setPAC=function(w){this.writeScreen.setPAC(w)},o.setBkgData=function(w){this.writeScreen.setBkgData(w)},o.setMode=function(w){w!==this.mode&&(this.mode=w,this.logger.log(g.INFO,function(){return"MODE="+w}),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=w)},o.insertChars=function(w){for(var R=this,O=0;O<w.length;O++)this.writeScreen.insertChar(w[O]);var j=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(g.INFO,function(){return j+": "+R.writeScreen.getDisplayText(!0)}),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(g.TEXT,function(){return"DISPLAYED: "+R.displayedMemory.getDisplayText(!0)}),this.outputDataUpdate())},o.ccRCL=function(){this.logger.log(g.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},o.ccBS=function(){this.logger.log(g.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory)&&this.outputDataUpdate()},o.ccAOF=function(){},o.ccAON=function(){},o.ccDER=function(){this.logger.log(g.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},o.ccRU=function(w){this.logger.log(g.INFO,"RU("+w+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(w)},o.ccFON=function(){this.logger.log(g.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},o.ccRDC=function(){this.logger.log(g.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},o.ccTR=function(){this.logger.log(g.INFO,"TR"),this.setMode("MODE_TEXT")},o.ccRTD=function(){this.logger.log(g.INFO,"RTD"),this.setMode("MODE_TEXT")},o.ccEDM=function(){this.logger.log(g.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},o.ccCR=function(){this.logger.log(g.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},o.ccENM=function(){this.logger.log(g.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},o.ccEOC=function(){var w,R=this;this.logger.log(g.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"&&(w=this.displayedMemory,this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=w,this.writeScreen=this.nonDisplayedMemory,this.logger.log(g.TEXT,function(){return"DISP: "+R.displayedMemory.getDisplayText()})),this.outputDataUpdate(!0)},o.ccTO=function(w){this.logger.log(g.INFO,"TO("+w+") - Tab Offset"),this.writeScreen.moveCursor(w)},o.ccMIDROW=function(w){var R={flash:!1};R.underline=w%2==1,R.italics=46<=w,R.italics?R.foreground="white":(w=Math.floor(w/2)-16,R.foreground=["white","green","blue","cyan","red","yellow","magenta"][w]),this.logger.log(g.INFO,"MIDROW: "+JSON.stringify(R)),this.writeScreen.setPen(R)},o.outputDataUpdate=function(w){w===void 0&&(w=!1);var R=this.logger.time;R!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,R,this.lastOutputScreen),w&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:R):this.cueStartTime=R,this.lastOutputScreen.copy(this.displayedMemory))},o.cueSplitAtTime=function(w){!this.outputFilter||this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,w,this.displayedMemory),this.cueStartTime=w)},y);function y(w,R,O){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=w,this.outputFilter=R,this.mode=null,this.verbose=0,this.displayedMemory=new C(O),this.nonDisplayedMemory=new C(O),this.lastOutputScreen=new C(O),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=O}function S(w){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var R=0;R<h;R++)this.rows.push(new b(w));this.logger=w,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}function L(w){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var R=0;R<k;R++)this.chars.push(new x);this.logger=w,this.pos=0,this.currPenState=new m}function B(w,R,O,j,z,G){this.uchar=void 0,this.penState=void 0,this.uchar=w||" ",this.penState=new m(R,O,j,z,G)}function A(w,R,O,j,z){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=w||"white",this.underline=R||!1,this.italics=O||!1,this.background=j||"black",this.flash=z||!1}function I(){this.time=null,this.verboseLevel=g.ERROR}function U(w,R,O){O.a=w,O.b=R}function P(w,R,O){return O.a===w&&O.b===R}(l=M.prototype).getHandler=function(w){return this.channels[w].getHandler()},l.setHandler=function(w,R){this.channels[w].setHandler(R)},l.addData=function(w,R){var O,j=!1;this.logger.time=w;for(var z=0;z<R.length;z+=2){var G,K=127&R[z],$=127&R[z+1];K==0&&$==0||(this.logger.log(g.DATA,"["+_([R[z],R[z+1]])+"] -> ("+_([K,$])+")"),!(O=(O=(O=(O=this.parseCmd(K,$))||this.parseMidrow(K,$))||this.parsePAC(K,$))||this.parseBackgroundAttributes(K,$))&&(j=this.parseChars(K,$))&&((G=this.currentChannel)&&0<G?this.channels[G].insertChars(j):this.logger.log(g.WARNING,"No channel found yet. TEXT-MODE?")),O)||j||this.logger.log(g.WARNING,"Couldn't parse cleaned data "+_([K,$])+" orig: "+_([R[z],R[z+1]]))}},l.parseCmd=function(w,R){var O,j,z=this.cmdHistory;return((w===20||w===28||w===21||w===29)&&32<=R&&R<=47||(w===23||w===31)&&33<=R&&R<=35)&&(P(w,R,z)?(U(null,null,z),this.logger.log(g.DEBUG,"Repeated command ("+_([w,R])+") is dropped")):(j=this.channels[O=w===20||w===21||w===23?1:2],w===20||w===21||w===28||w===29?R===32?j.ccRCL():R===33?j.ccBS():R===34?j.ccAOF():R===35?j.ccAON():R===36?j.ccDER():R===37?j.ccRU(2):R===38?j.ccRU(3):R===39?j.ccRU(4):R===40?j.ccFON():R===41?j.ccRDC():R===42?j.ccTR():R===43?j.ccRTD():R===44?j.ccEDM():R===45?j.ccCR():R===46?j.ccENM():R===47&&j.ccEOC():j.ccTO(R-32),U(w,R,z),this.currentChannel=O),!0)},l.parseMidrow=function(w,R){var O;return(w===17||w===25)&&32<=R&&R<=47&&((O=w===17?1:2)!==this.currentChannel?(this.logger.log(g.ERROR,"Mismatch channel in midrow parsing"),!1):!!(O=this.channels[O])&&(O.ccMIDROW(R),this.logger.log(g.DEBUG,"MIDROW ("+_([w,R])+")"),!0))},l.parsePAC=function(w,R){var O,j,z=this.cmdHistory;return((17<=w&&w<=23||25<=w&&w<=31)&&64<=R&&R<=127||(w===16||w===24)&&64<=R&&R<=95)&&(P(w,R,z)?(U(null,null,z),!0):!!(j=this.channels[O=w<=23?1:2])&&(j.setPAC(this.interpretPAC((64<=R&&R<=95?O==1?t:n:O==1?r:a)[w],R)),U(w,R,z),this.currentChannel=O,!0))},l.interpretPAC=function(w,R){return w={color:null,italics:!1,indent:null,underline:!1,row:w},R=95<R?R-96:R-64,w.underline=(1&R)==1,R<=13?w.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(R/2)]:R<=15?(w.italics=!0,w.color="white"):w.indent=4*Math.floor((R-16)/2),w},l.parseChars=function(w,R){var O,j=null,z=null;return 17<=(z=25<=w?(O=2,w-8):(O=1,w))&&z<=19?(this.logger.log(g.INFO,"Special char '"+f(z=z===17?R+80:z===18?R+112:R+144)+"' in channel "+O),j=[z]):32<=w&&w<=127&&(j=R===0?[w]:[w,R]),j&&(O=_(j),this.logger.log(g.DEBUG,"Char codes =  "+O.join(",")),U(w,R,this.cmdHistory)),j},l.parseBackgroundAttributes=function(w,R){var O,j;return((w===16||w===24)&&32<=R&&R<=47||(w===23||w===31)&&45<=R&&R<=47)&&(j={},w===16||w===24?(O=Math.floor((R-32)/2),j.background=d[O],R%2==1&&(j.background=j.background+"_semi")):R===45?j.background="transparent":(j.foreground="black",R===47&&(j.underline=!0)),this.channels[w<=23?1:2].setBkgData(j),U(w,R,this.cmdHistory),!0)},l.reset=function(){for(var w=0;w<Object.keys(this.channels).length;w++){var R=this.channels[w];R&&R.reset()}this.cmdHistory={a:null,b:null}},l.cueSplitAtTime=function(w){for(var R=0;R<this.channels.length;R++){var O=this.channels[R];O&&O.cueSplitAtTime(w)}};const F=M;function M(w,R,O){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var j=new p;this.channels=[null,new v(w,R,j),new v(w+1,O,j)],this.cmdHistory={a:null,b:null},this.logger=j}},"./src/utils/codecs.ts":(c,l,o)=>{o.r(l),o.d(l,{isCodecSupportedInMp4:()=>function(_,g){return MediaSource.isTypeSupported((g||"video")+'/mp4;codecs="'+_+'"')},isCodecType:()=>function(_,g){return g=f[g],!!g&&g[_.slice(0,4)]===!0}});var f={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}}},"./src/utils/cues.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>E});var f=o("./src/utils/vttparser.ts"),_=o("./src/utils/webvtt-parser.ts"),g=o("./src/utils/texttrack-utils.ts"),T=/\s/;const E={newCue:function(h,k,t,r){for(var n,a,d,p,m=[],x=self.VTTCue||self.TextTrackCue,b=0;b<r.rows.length;b++)if(a=!0,d=0,p="",!(n=r.rows[b]).isEmpty()){for(var C=0;C<n.chars.length;C++)T.test(n.chars[C].uchar)&&a?d++:(p+=n.chars[C].uchar,a=!1);(n.cueStartTime=k)===t&&(t+=1e-4),16<=d?d--:d++;var v=(0,f.fixLineBreaks)(p.trim()),y=(0,_.generateCueId)(k,t,v);h&&h.cues&&h.cues.getCueById(y)||((v=new x(k,t,v)).id=y,v.line=b+1,v.align="left",v.position=10+Math.min(80,10*Math.floor(8*d/32)),m.push(v))}return h&&m.length&&(m.sort(function(S,L){return S.line==="auto"||L.line==="auto"?0:8<S.line&&8<L.line?L.line-S.line:S.line-L.line}),m.forEach(function(S){return(0,g.addCueToTrack)(h,S)})),m}}},"./src/utils/discontinuities.ts":(c,l,o)=>{o.r(l),o.d(l,{adjustSlidingStart:()=>t,alignMediaPlaylistByPDT:()=>function(n,a){{var d,p,m;n.hasProgramDateTime&&a.hasProgramDateTime&&(d=n.fragments,a=a.fragments,d.length)&&a.length&&(a=a[Math.round(a.length/2)-1],d=T(d,a.cc)||d[Math.round(d.length/2)-1],p=a.programDateTime,m=d.programDateTime,p!==null)&&m!==null&&t((m-p)/1e3-(d.start-a.start),n)}},alignPDT:()=>r,alignStream:()=>function(n,a,d){var p;a&&(E(n,n=a,p=d)&&(n=h(n.details,p))&&(0,f.isFiniteNumber)(n.start)&&(_.logger.log("Adjusting PTS using last level due to CC increase within current level "+p.url),t(n.start,p)),!d.alignedSliding&&a.details&&r(d,a.details),d.alignedSliding||!a.details||d.skippedSegments||(0,g.adjustSliding)(a.details,d))},findDiscontinuousReferenceFrag:()=>h,findFirstFragWithCC:()=>T,shouldAlignOnDiscontinuities:()=>E});var f=o("./src/polyfills/number.ts"),_=o("./src/utils/logger.ts"),g=o("./src/controller/level-helper.ts");function T(n,a){for(var d=null,p=0,m=n.length;p<m;p++){var x=n[p];if(x&&x.cc===a){d=x;break}}return d}function E(n,a,d){return!(!a.details||!(d.endCC>d.startCC||n&&n.cc<d.startCC))}function h(n,a,d){if(n=n.fragments,a=a.fragments,a.length&&n.length){if(n=T(n,a[0].cc),n&&(!n||n.startPTS))return n;_.logger.log("No frag in previous level to align on")}else _.logger.log("No fragments to align")}function k(n,a){n&&(a=n.start+a,n.start=n.startPTS=a,n.endPTS=a+n.duration)}function t(n,a){for(var d=a.fragments,p=0,m=d.length;p<m;p++)k(d[p],n);a.fragmentHint&&k(a.fragmentHint,n),a.alignedSliding=!0}function r(n,a){var d,p;a.fragments.length&&n.hasProgramDateTime&&a.hasProgramDateTime&&(d=a.fragments[0].programDateTime,a=((p=n.fragments[0].programDateTime)-d)/1e3+a.fragments[0].start)&&(0,f.isFiniteNumber)(a)&&(_.logger.log("Adjusting PTS using programDateTime delta "+(p-d)+"ms, sliding:"+a.toFixed(3)+" "+n.url+" "),t(a,n))}},"./src/utils/ewma-bandwidth-estimator.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>_});var f=o("./src/utils/ewma.ts");(l=g.prototype).update=function(T,E){var h=this.slow_,k=this.fast_;this.slow_.halfLife!==T&&(this.slow_=new f.default(T,h.getEstimate(),h.getTotalWeight())),this.fast_.halfLife!==E&&(this.fast_=new f.default(E,k.getEstimate(),k.getTotalWeight()))},l.sample=function(T,E){T=(T=Math.max(T,this.minDelayMs_))/1e3,E=8*E/T,this.fast_.sample(T,E),this.slow_.sample(T,E)},l.canEstimate=function(){var T=this.fast_;return T&&T.getTotalWeight()>=this.minWeight_},l.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},l.destroy=function(){};const _=g;function g(T,E,h){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=h,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new f.default(T),this.fast_=new f.default(E)}},"./src/utils/ewma.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>f}),(o=_.prototype).sample=function(g,T){var E=Math.pow(this.alpha_,g);this.estimate_=T*(1-E)+E*this.estimate_,this.totalWeight_+=g},o.getTotalWeight=function(){return this.totalWeight_},o.getEstimate=function(){if(this.alpha_){var g=1-Math.pow(this.alpha_,this.totalWeight_);if(g)return this.estimate_/g}return this.estimate_};const f=_;function _(g,T,E){T===void 0&&(T=0),E===void 0&&(E=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=g,this.alpha_=g?Math.exp(Math.log(.5)/g):0,this.estimate_=T,this.totalWeight_=E}},"./src/utils/fetch-loader.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>x,fetchSupported:()=>function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}});var f=o("./src/polyfills/number.ts"),_=o("./src/loader/load-stats.ts"),g=o("./src/demux/chunk-cache.ts");function T(b){var C=typeof Map=="function"?new Map:void 0;return(T=function(v){if(v===null||Function.toString.call(v).indexOf("[native code]")===-1)return v;if(typeof v!="function")throw new TypeError("Super expression must either be null or a function");if(C!==void 0){if(C.has(v))return C.get(v);C.set(v,y)}function y(){return E(v,arguments,k(this).constructor)}return y.prototype=Object.create(v.prototype,{constructor:{value:y,enumerable:!1,writable:!0,configurable:!0}}),h(y,v)})(b)}function E(b,C,v){return(E=(function(){if(!(typeof Reflect>"u"||!Reflect.construct)&&!Reflect.construct.sham){if(typeof Proxy=="function")return 1;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),1}catch{}}})()?Reflect.construct.bind():function(y,A,L){var B=[null],A=(B.push.apply(B,A),new(Function.bind.apply(y,B)));return L&&h(A,L.prototype),A}).apply(null,arguments)}function h(b,C){return(h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(v,y){return v.__proto__=y,v})(b,C)}function k(b){return(k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(C){return C.__proto__||Object.getPrototypeOf(C)})(b)}function t(){return(t=Object.assign?Object.assign.bind():function(b){for(var C=1;C<arguments.length;C++){var v,y=arguments[C];for(v in y)Object.prototype.hasOwnProperty.call(y,v)&&(b[v]=y[v])}return b}).apply(this,arguments)}(l=r.prototype).destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},l.abortInternal=function(){var b=this.response;b&&b.ok||(this.stats.aborted=!0,this.controller.abort())},l.abort=function(){var b;this.abortInternal(),(b=this.callbacks)!=null&&b.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},l.load=function(b,C,v){var y=this,S=this.stats;if(S.loading.start)throw new Error("Loader can only be used once.");S.loading.start=self.performance.now();var L=(function(U,P){return P={method:"GET",mode:"cors",credentials:"same-origin",signal:P,headers:new self.Headers(t({},U.headers))},U.rangeEnd&&P.headers.set("Range","bytes="+U.rangeStart+"-"+String(U.rangeEnd-1)),P})(b,this.controller.signal),B=v.onProgress,A=b.responseType==="arraybuffer",I=A?"byteLength":"length";this.context=b,this.config=C,this.callbacks=v,this.request=this.fetchSetup(b,L),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){y.abortInternal(),v.onTimeout(S,b,y.response)},C.timeout),self.fetch(this.request).then(function(U){var P,F;if((y.response=y.loader=U).ok)return S.loading.first=Math.max(self.performance.now(),S.loading.start),S.total=parseInt(U.headers.get("Content-Length")||"0"),B&&(0,f.isFiniteNumber)(C.highWaterMark)?y.loadProgressively(U,S,b,C.highWaterMark,B):A?U.arrayBuffer():U.text();throw P=U.status,F=U.statusText,new p(F||"fetch, bad network response",P,U)}).then(function(U){var P=y.response,F=(self.clearTimeout(y.requestTimeout),S.loading.end=Math.max(self.performance.now(),S.loading.first),U[I]),F=(F&&(S.loaded=S.total=F),{url:P.url,data:U});B&&!(0,f.isFiniteNumber)(C.highWaterMark)&&B(S,b,U,P),v.onSuccess(F,S,b,P)}).catch(function(U){var P,F;self.clearTimeout(y.requestTimeout),S.aborted||(P=U&&U.code||0,F=U?U.message:null,v.onError({code:P,text:F},b,U?U.details:null))})},l.getCacheAge=function(){var b,C=null;return C=this.response?(b=this.response.headers.get("age"))?parseFloat(b):null:C},l.loadProgressively=function(b,C,v,y,S){y===void 0&&(y=0);var L=new g.default,B=b.body.getReader();return(function A(){return B.read().then(function(I){var U;return I.done?(L.dataLength&&S(C,v,L.flush(),b),Promise.resolve(new ArrayBuffer(0))):(U=(I=I.value).length,C.loaded+=U,U<y||L.dataLength?(L.push(I),L.dataLength>=y&&S(C,v,L.flush(),b)):S(C,v,I,b),A())}).catch(function(){return Promise.reject()})})()},o=r;function r(b){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=b.fetchSetup||n,this.controller=new self.AbortController,this.stats=new _.LoadStats}function n(b,C){return new self.Request(b.url,C)}a=T(Error),l=a,(d=m).prototype=Object.create(l.prototype),h(d.prototype.constructor=d,l);var a,d,p=m;function m(b,C,v){return(b=a.call(this,b)||this).code=void 0,b.details=void 0,b.code=C,b.details=v,b}const x=o},"./src/utils/hex.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>f});const f={hexDump:function(_){for(var g="",T=0;T<_.length;T++){var E=_[T].toString(16);g+=E=E.length<2?"0"+E:E}return g}}},"./src/utils/imsc1-ttml-parser.ts":(c,l,o)=>{o.r(l),o.d(l,{IMSC1_CODEC:()=>t,parseIMSC1:()=>function(C,v,y,S,L){var B=(0,f.findBox)(new Uint8Array(C),["mdat"]);if(B.length!==0){var B=B.map(function(U){return(0,T.utf8ArrayToStr)(U)}),A=(0,E.toTimescaleFromScale)(v,1,y);try{B.forEach(function(U){return S((function(P,F){var M,w,R,O,j,z=new DOMParser().parseFromString(P,"text/xml").getElementsByTagName("tt")[0];if(z)return M={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},w=Object.keys(M).reduce(function(G,K){return G[K]=z.getAttribute("ttp:"+K)||M[K],G},{}),R=z.getAttribute("xml:space")!=="preserve",O=p(d(z,"styling","style")),j=p(d(z,"layout","region")),P=d(z,"body","[begin]"),[].map.call(P,function(X){var W=(function se(ie,ne){return[].slice.call(ie.childNodes).reduce(function(me,ce,le){return ce.nodeName==="br"&&le?me+`
`:(le=ce.childNodes)!=null&&le.length?se(ce,ne):ne?me+ce.textContent.trim().replace(/\s+/g," "):me+ce.textContent},"")})(X,R);if(!W||!X.hasAttribute("begin"))return null;var K=b(X.getAttribute("begin"),w),Z=b(X.getAttribute("dur"),w),$=b(X.getAttribute("end"),w);if(K===null)throw x(X);if($===null){if(Z===null)throw x(X);$=K+Z}var V,q,J,re,Z=new g.default(K-F,$-F,W),W=(Z.id=(0,h.generateCueId)(Z.startTime,Z.endTime,Z.text),V=j[X.getAttribute("region")],q=O[X.getAttribute("style")],K=O,J="http://www.w3.org/ns/ttml#styling",($=(re=null)!=V&&V.hasAttribute("style")?V.getAttribute("style"):null)&&K.hasOwnProperty($)&&(re=K[$]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(se,ie){var ne=m(q,J,ie)||m(V,J,ie)||m(re,J,ie);return ne&&(se[ie]=ne),se},{})),X=W.textAlign;return X&&((K=a[X])&&(Z.lineAlign=K),Z.align=X),k(Z,W),Z}).filter(function(G){return G!==null});throw new Error("Invalid ttml")})(U,A))})}catch(U){L(U)}}else L(new Error("Could not parse IMSC1 mdat"))}});var f=o("./src/utils/mp4-tools.ts"),_=o("./src/utils/vttparser.ts"),g=o("./src/utils/vttcue.ts"),T=o("./src/demux/id3.ts"),E=o("./src/utils/timescale-conversion.ts"),h=o("./src/utils/webvtt-parser.ts");function k(){return(k=Object.assign?Object.assign.bind():function(C){for(var v=1;v<arguments.length;v++){var y,S=arguments[v];for(y in S)Object.prototype.hasOwnProperty.call(S,y)&&(C[y]=S[y])}return C}).apply(this,arguments)}var t="stpp.ttml.im1t",r=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,n=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,a={left:"start",center:"center",right:"end",start:"start",end:"end"};function d(C,v,y){return C=C.getElementsByTagName(v)[0],C?[].slice.call(C.querySelectorAll(y)):[]}function p(C){return C.reduce(function(v,y){var S=y.getAttribute("xml:id");return S&&(v[S]=y),v},{})}function m(C,v,y){return C&&C.hasAttributeNS(v,y)?C.getAttributeNS(v,y):null}function x(C){return new Error("Could not parse ttml timestamp "+C)}function b(C,v){var y,S,L,B;return C?((y=(0,_.parseTimeStamp)(C))===null&&(r.test(C)?(S=v,L=r.exec(C),B=(0|L[4])+(0|L[5])/S.subFrameRate,y=3600*(0|L[1])+60*(0|L[2])+(0|L[3])+B/S.frameRate):n.test(C)&&(y=(function(A){var I=n.exec(C),U=Number(I[1]);switch(I[2]){case"h":return 3600*U;case"m":return 60*U;case"ms":return 1e3*U;case"f":return U/A.frameRate;case"t":return U/A.tickRate}return U})(v))),y):null}},"./src/utils/keysystem-util.ts":(c,l,o)=>{o.r(l),o.d(l,{changeEndianness:()=>function(g){function T(E,h,k){var t=E[h];E[h]=E[k],E[k]=t}T(g,0,3),T(g,1,2),T(g,4,5),T(g,6,7)},convertDataUriToArrayBytes:()=>function(T){var T=T.split(":"),E=null;{var h,k;T[0]==="data"&&T.length===2&&(T=T[1].split(";"),(k=T[T.length-1].split(",")).length===2)&&(h=k[0]==="base64",k=k[1],E=h?(T.splice(-1,1),(0,f.base64Decode)(k)):(h=_(k).subarray(0,16),(T=new Uint8Array(16)).set(h,16-h.length),T))}return E},strToUtf8array:()=>_});var f=o("./src/utils/numeric-encoding-utils.ts");function _(g){return Uint8Array.from(unescape(encodeURIComponent(g)),function(T){return T.charCodeAt(0)})}},"./src/utils/logger.ts":(c,l,o)=>{o.r(l),o.d(l,{enableLogs:()=>function(E,h){if(self.console&&E===!0||typeof E=="object"){(function(k){for(var t=arguments.length,r=new Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];r.forEach(function(a){var d;g[a]=k[a]?k[a].bind(k):(a=a,(d=self.console[a])?d.bind(self.console,"["+a+"] >"):f)})})(E,"debug","log","info","warn","error");try{g.log('Debug logs enabled for "'+h+'"')}catch{g=_}}else g=_},logger:()=>T});function f(){}var _={trace:f,debug:f,log:f,warn:f,info:f,error:f},g=_,T=_},"./src/utils/mediakeys-helper.ts":(c,l,o)=>{var f,_,g;o.r(l),o.d(l,{KeySystemFormats:()=>_,KeySystemIds:()=>g,KeySystems:()=>f,getKeySystemsForConfig:()=>function(k){var h=k.drmSystems,k=k.widevineLicenseUrl,t=h?[f.FAIRPLAY,f.WIDEVINE,f.PLAYREADY,f.CLEARKEY].filter(function(r){return!!h[r]}):[];return!t[f.WIDEVINE]&&k&&t.push(f.WIDEVINE),t},getSupportedMediaKeySystemConfigurations:()=>function(E,h,k,t){var r;switch(E){case f.FAIRPLAY:r=["cenc","sinf"];break;case f.WIDEVINE:case f.PLAYREADY:r=["cenc"];break;case f.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+E)}var n=t;return[{initDataTypes:r,persistentState:n.persistentState||"not-allowed",distinctiveIdentifier:n.distinctiveIdentifier||"not-allowed",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:h.map(function(a){return{contentType:'audio/mp4; codecs="'+a+'"',robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null}}),videoCapabilities:k.map(function(a){return{contentType:'video/mp4; codecs="'+a+'"',robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}})}]},keySystemDomainToKeySystemFormat:()=>function(E){switch(E){case f.FAIRPLAY:return _.FAIRPLAY;case f.PLAYREADY:return _.PLAYREADY;case f.WIDEVINE:return _.WIDEVINE;case f.CLEARKEY:return _.CLEARKEY}},keySystemFormatToKeySystemDomain:()=>function(E){switch(E){case _.FAIRPLAY:return f.FAIRPLAY;case _.PLAYREADY:return f.PLAYREADY;case _.WIDEVINE:return f.WIDEVINE;case _.CLEARKEY:return f.CLEARKEY}},keySystemIdToKeySystemDomain:()=>function(E){if(E===g.WIDEVINE)return f.WIDEVINE},requestMediaKeySystemAccess:()=>T}),(o=f=f||{}).CLEARKEY="org.w3.clearkey",o.FAIRPLAY="com.apple.fps",o.PLAYREADY="com.microsoft.playready",o.WIDEVINE="com.widevine.alpha",(l=_=_||{}).CLEARKEY="org.w3.clearkey",l.FAIRPLAY="com.apple.streamingkeydelivery",l.PLAYREADY="com.microsoft.playready",l.WIDEVINE="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",(g=g||{}).WIDEVINE="edef8ba979d64acea3c827dcd51d21ed";var T=typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":(c,l,o)=>{o.r(l),o.d(l,{getMediaSource:()=>function(){return self.MediaSource||self.WebKitMediaSource}})},"./src/utils/mp4-tools.ts":(c,l,o)=>{o.r(l),o.d(l,{RemuxerTrackIdConfig:()=>t,appendUint8Array:()=>function(L,B){var A=new Uint8Array(L.length+B.length);return A.set(L),A.set(B,L.length),A},bin2str:()=>r,computeRawDurationFromSamples:()=>C,discardEPB:()=>y,findBox:()=>m,getDuration:()=>function(L,B){for(var A=0,I=0,U=0,P=m(L,["moof","traf"]),F=0;F<P.length;F++){var M=P[F],w=m(M,["tfhd"])[0],R=B[a(w,4)];if(R){var O=R.default,j=a(w,0)|O?.flags,z=O?.duration;8&j&&(z=a(w,2&j?12:8));for(var G=R.timescale||9e4,K=m(M,["trun"]),$=0;$<K.length;$++)!(A=C(K[$]))&&z&&(A=z*a(K[$],4)),R.type===f.ElementaryStreamTypes.VIDEO?I+=A/G:R.type===f.ElementaryStreamTypes.AUDIO&&(U+=A/G)}}if(I!==0||U!==0)return I||U;for(var V=0,q=m(L,["sidx"]),J=0;J<q.length;J++){var re=x(q[J]);re!=null&&re.references&&(V+=re.references.reduce(function(Z,W){return Z+W.info.duration||0},0))}return V},getStartDTS:()=>function(L,B){return m(B,["moof","traf"]).reduce(function(A,F){var U=m(F,["tfdt"])[0],P=U[0],F=m(F,["tfhd"]).reduce(function(M,w){if(w=a(w,4),w=L[w],w){var R=a(U,4),R=(R=P===1?(R*=Math.pow(2,32))+a(U,8):R)/(w.timescale||9e4);if(isFinite(R)&&(M===null||R<M))return R}return M},null);return F!==null&&isFinite(F)&&(A===null||F<A)?F:A},null)||0},mp4Box:()=>S,mp4pssh:()=>function(L,B,A){if(L.byteLength!==16)throw new RangeError("Invalid system id");var I,U,P;if(B){I=1,U=new Uint8Array(16*B.length);for(var F=0;F<B.length;F++){var M=B[F];if(M.byteLength!==16)throw new RangeError("Invalid key");U.set(M,16*F)}}else I=0,U=new Uint8Array;0<I?(P=new Uint8Array(4),0<B.length&&new DataView(P.buffer).setUint32(0,B.length,!1)):P=new Uint8Array;var w=new Uint8Array(4);return A&&0<A.byteLength&&new DataView(w.buffer).setUint32(0,A.byteLength,!1),S([112,115,115,104],new Uint8Array([I,0,0,0]),L,P,U,w,A||new Uint8Array)},offsetStartDTS:()=>function(L,B,A){m(B,["moof","traf"]).forEach(function(I){m(I,["tfhd"]).forEach(function(F){var P,F=a(F,4),F=L[F];F&&(P=F.timescale||9e4,m(I,["tfdt"]).forEach(function(M){var w=M[0],R=a(M,4);w===0?(R-=A*P,p(M,4,R=Math.max(R,0))):(R=(R=(R*=Math.pow(2,32))+a(M,8))-A*P,R=Math.max(R,0),w=Math.floor(R/(h+1)),R=Math.floor(R%(h+1)),p(M,4,w),p(M,8,R))}))})})},parseEmsg:()=>function(L){var B=L[0],A="",I="",U=0,P=0,F=0,M=0,w=0,R=0;if(B===0){for(;r(L.subarray(R,R+1))!=="\0";)A+=r(L.subarray(R,R+1)),R+=1;for(A+=r(L.subarray(R,R+1)),R+=1;r(L.subarray(R,R+1))!=="\0";)I+=r(L.subarray(R,R+1)),R+=1;I+=r(L.subarray(R,R+1)),R+=1,U=a(L,12),P=a(L,16),M=a(L,20),w=a(L,24),R=28}else if(B===1){U=a(L,R+=4);var B=a(L,R+=4),O=a(L,R+=4);for(R+=4,F=Math.pow(2,32)*B+O,Number.isSafeInteger(F)||(F=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),M=a(L,R),w=a(L,R+=4),R+=4;r(L.subarray(R,R+1))!=="\0";)A+=r(L.subarray(R,R+1)),R+=1;for(A+=r(L.subarray(R,R+1)),R+=1;r(L.subarray(R,R+1))!=="\0";)I+=r(L.subarray(R,R+1)),R+=1;I+=r(L.subarray(R,R+1)),R+=1}return{schemeIdUri:A,value:I,timeScale:U,presentationTime:F,presentationTimeDelta:P,eventDuration:M,id:w,payload:L.subarray(R,L.byteLength)}},parseInitSegment:()=>function(L){for(var B=[],A=m(L,["moov","trak"]),I=0;I<A.length;I++){var U,P,F,M=A[I],w=m(M,["tkhd"])[0];w&&(P=w[0],w=a(w,P===0?12:20),U=m(M,["mdia","mdhd"])[0])&&(U=a(U,(P=U[0])===0?12:20),P=m(M,["mdia","hdlr"])[0])&&(P=r(P.subarray(8,12)),P={soun:f.ElementaryStreamTypes.AUDIO,vide:f.ElementaryStreamTypes.VIDEO}[P])&&(M=m(M,["mdia","minf","stbl","stsd"])[0],F=void 0,M&&(F=r(M.subarray(12,16))),B[w]={timescale:U,type:P},B[P]={timescale:U,id:w,codec:F})}return m(L,["moov","mvex","trex"]).forEach(function(R){var O=a(R,4),O=B[O];O&&(O.default={duration:a(R,12),flags:a(R,20)})}),B},parsePssh:()=>function(L){if(!(L instanceof ArrayBuffer)||L.byteLength<32)return null;var B={version:0,systemId:"",kids:null,data:null},A=new DataView(L),I=A.getUint32(0);if(L.byteLength!==I&&44<I||A.getUint32(4)!==1886614376||(B.version=A.getUint32(8)>>>24,1<B.version))return null;B.systemId=E.default.hexDump(new Uint8Array(L,12,16));var U=A.getUint32(28);if(B.version===0){if(I-32<U)return null;B.data=new Uint8Array(L,32,U)}else if(B.version===1){B.kids=[];for(var P=0;P<U;P++)B.kids.push(new Uint8Array(L,32+16*P,16))}return B},parseSEIMessageFromNALu:()=>v,parseSamples:()=>function(L,B){var A=[],I=B.samples,U=B.timescale,P=B.id,F=!1;return m(I,["moof"]).map(function(M){var w=M.byteOffset-8;m(M,["traf"]).map(function(R){var O=m(R,["tfdt"]).map(function(j){var z=j[0],G=a(j,4);return(G=z===1?(G*=Math.pow(2,32))+a(j,8):G)/U})[0];return O!==void 0&&(L=O),m(R,["tfhd"]).map(function(j){var z=a(j,4),G=16777215&a(j,0),K=0,$=0,V=8;z===P&&((1&G)!=0&&(V+=8),(2&G)!=0&&(V+=4),(8&G)!=0&&(K=a(j,V),V+=4),(16&G)!=0&&($=a(j,V),V+=4),(32&G)!=0&&(V+=4),B.type==="video"&&(z=B.codec,F=!!z&&((z=(j=z.indexOf("."))<0?z:z.substring(0,j))==="hvc1"||z==="hev1"||z==="dvh1"||z==="dvhe")),m(R,["trun"]).map(function(q){var J=q[0],re=16777215&a(q,0),Z=0,W=(256&re)!=0,X=0,se=(512&re)!=0,ie=0,ne=(1024&re)!=0,me=(2048&re)!=0,ce=0,le=a(q,4),ge=8;(1&re)!=0&&(Z=a(q,ge),ge+=4),(4&re)!=0&&(ge+=4);for(var ye=Z+w,Ee=0;Ee<le;Ee++){if(W?(X=a(q,ge),ge+=4):X=K,se?(ie=a(q,ge),ge+=4):ie=$,ne&&(ge+=4),me&&(ce=(J===0?a:d)(q,ge),ge+=4),B.type===f.ElementaryStreamTypes.VIDEO)for(var xe=0;xe<ie;){var ke=a(I,ye);!(function(Le,De){return Le?(Le=De>>1&63)==39||Le==40:(31&De)==6})(F,I[ye+=4])||v(I.subarray(ye,ye+ke),F?2:1,L+ce/U,A),ye+=ke,xe+=ke+4}L+=X/U}}))})})}),A},parseSegmentIndex:()=>x,parseSinf:()=>b,patchEncyptionData:()=>function(L,B){var A;return L&&B&&(A=B.keyId)&&B.isCommonEncryption&&m(L,["moov","trak"]).forEach(function(U){var U=m(U,["mdia","minf","stbl","stsd"])[0].subarray(8),P=m(U,["enca"]),F=0<P.length;(P=F?P:m(U,["encv"])).forEach(function(M){m(F?M.subarray(28):M.subarray(78),["sinf"]).forEach(function(O){var R,O=b(O);O&&!(R=O.subarray(8,24)).some(function(j){return j!==0})&&(T.logger.log("[eme] Patching keyId in 'enc"+(F?"a":"v")+">sinf>>tenc' box: "+E.default.hexDump(R)+" -> "+E.default.hexDump(A)),O.set(A,8))})})}),L},readSint32:()=>d,readUint16:()=>n,readUint32:()=>a,segmentValidRange:()=>function(L){var B={valid:null,remainder:null},A=m(L,["moof"]);return A&&(A.length<2?B.remainder=L:(A=A[A.length-1],B.valid=(0,_.sliceUint8)(L,0,A.byteOffset-8),B.remainder=(0,_.sliceUint8)(L,A.byteOffset-8))),B},writeUint32:()=>p});var f=o("./src/loader/fragment.ts"),_=o("./src/utils/typed-array.ts"),g=o("./src/demux/id3.ts"),T=o("./src/utils/logger.ts"),E=o("./src/utils/hex.ts"),h=Math.pow(2,32)-1,k=[].push,t={video:1,audio:2,id3:3,text:4};function r(L){return String.fromCharCode.apply(null,L)}function n(L,B){return L=L[B]<<8|L[B+1],L<0?65536+L:L}function a(L,B){return L=d(L,B),L<0?4294967296+L:L}function d(L,B){return L[B]<<24|L[B+1]<<16|L[B+2]<<8|L[B+3]}function p(L,B,A){L[B]=A>>24,L[B+1]=A>>16&255,L[B+2]=A>>8&255,L[B+3]=255&A}function m(L,B){var A=[];if(B.length)for(var I=L.byteLength,U=0;U<I;){var P,F=a(L,U),F=1<F?U+F:I;r(L.subarray(U+4,U+8))===B[0]&&(B.length===1?A.push(L.subarray(U+8,F)):(P=m(L.subarray(U+8,F),B.slice(1))).length&&k.apply(A,P)),U=F}return A}function x(L){var B=[],A=L[0],I=8,U=a(L,I),P=L.length+0,F=n(L,I=(I+=4)+(A===0?8:16)+2);I+=2;for(var M=0;M<F;M++){var w=I,R=a(L,w),O=(w+=4,2147483647&R);if((2147483648&R)>>>31==1)return console.warn("SIDX has hierarchical references (not supported)"),null;R=a(L,w),w+=4,B.push({referenceSize:O,subsegmentDuration:R,info:{duration:R/U,start:P,end:P+O-1}}),P+=O,I=w+=4}return{earliestPresentationTime:0,timescale:U,version:A,referencesCount:F,references:B}}function b(L){var B=m(L,["schm"])[0];return B&&(B=r(B.subarray(4,8)),B==="cbcs"||B==="cenc")?m(L,["schi","tenc"])[0]:(T.logger.error("[eme] missing 'schm' box"),null)}function C(L){var B=a(L,0),A=8;1&B&&(A+=4),4&B&&(A+=4);for(var I=0,U=a(L,4),P=0;P<U;P++)256&B&&(I+=a(L,A),A+=4),512&B&&(A+=4),1024&B&&(A+=4),2048&B&&(A+=4);return I}function v(L,B,A,I){var U=y(L),P=0;P+=B;for(var F=0,M=0,w=!1,R=0;P<U.length;){for(F=0;!(P>=U.length)&&(F+=R=U[P++],R===255););for(M=0;!(P>=U.length)&&(M+=R=U[P++],R===255););var O=U.length-P;if(!w&&F===4&&P<U.length){if(w=!0,U[P++]===181){var j=n(U,P);if(P+=2,j===49&&(j=a(U,P),P+=4,j===1195456820&&(j=U[P++],j===3))){var z=U[P++],G=64&z,K=G?2+3*(31&z):0,$=new Uint8Array(K);if(G){$[0]=z;for(var V=1;V<K;V++)$[V]=U[P++]}I.push({type:j,payloadType:F,pts:A,bytes:$})}}}else if(F===5&&M<O){if(w=!0,16<M){for(var q=[],J=0;J<16;J++){var re=U[P++].toString(16);q.push(re.length==1?"0"+re:re),J!==3&&J!==5&&J!==7&&J!==9||q.push("-")}for(var Z=M-16,W=new Uint8Array(Z),X=0;X<Z;X++)W[X]=U[P++];I.push({payloadType:F,pts:A,uuid:q.join(""),userData:(0,g.utf8ArrayToStr)(W),userDataBytes:W})}}else if(M<O)P+=M;else if(O<M)break}}function y(L){for(var B=L.byteLength,A=[],I=1;I<B-2;)L[I]===0&&L[I+1]===0&&L[I+2]===3?(A.push(I+2),I+=2):I++;if(A.length===0)return L;for(var U=B-A.length,P=new Uint8Array(U),F=0,I=0;I<U;F++,I++)F===A[0]&&(F++,A.shift()),P[I]=L[F];return P}function S(L){for(var B=arguments.length,A=new Array(1<B?B-1:0),I=1;I<B;I++)A[I-1]=arguments[I];for(var U=A.length,P=8,F=U;F--;)P+=A[F].byteLength;var M=new Uint8Array(P);for(M[0]=P>>24&255,M[1]=P>>16&255,M[2]=P>>8&255,M[3]=255&P,M.set(L,4),F=0,P=8;F<U;F++)M.set(A[F],P),P+=A[F].byteLength;return M}},"./src/utils/numeric-encoding-utils.ts":(c,l,o)=>{function f(g){return g.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function _(g){return btoa(String.fromCharCode.apply(String,g))}o.r(l),o.d(l,{base64Decode:()=>function(g){return Uint8Array.from(atob(g),function(T){return T.charCodeAt(0)})},base64DecodeToStr:()=>function(g){return atob(g)},base64Encode:()=>_,base64ToBase64Url:()=>f,base64UrlEncode:()=>function(g){return f(_(g))},strToBase64Encode:()=>function(g){return btoa(g)}})},"./src/utils/output-filter.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>f}),(o=_.prototype).dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},o.newCue=function(g,T,E){(this.startTime===null||this.startTime>g)&&(this.startTime=g),this.endTime=T,this.screen=E,this.timelineController.createCaptionsTrack(this.trackName)},o.reset=function(){this.cueRanges=[],this.startTime=null};var f=_;function _(g,T){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=g,this.trackName=T}},"./src/utils/texttrack-utils.ts":(c,l,o)=>{o.r(l),o.d(l,{addCueToTrack:()=>function(g,T){var E=g.mode;if(E==="disabled"&&(g.mode="hidden"),g.cues&&!g.cues.getCueById(T.id))try{if(g.addCue(T),!g.cues.getCueById(T.id))throw new Error("addCue is failed for: "+T)}catch(k){f.logger.debug("[texttrack-utils]: "+k);var h=new self.TextTrackCue(T.startTime,T.endTime,T.text);h.id=T.id,g.addCue(h)}E==="disabled"&&(g.mode=E)},clearCurrentCues:()=>function(g){var T=g.mode;if(T==="disabled"&&(g.mode="hidden"),g.cues)for(var E=g.cues.length;E--;)g.removeCue(g.cues[E]);T==="disabled"&&(g.mode=T)},getCuesInRange:()=>_,removeCuesInRange:()=>function(g,T,E,h){var k=g.mode;if(k==="disabled"&&(g.mode="hidden"),g.cues&&0<g.cues.length)for(var t=_(g.cues,T,E),r=0;r<t.length;r++)h&&!h(t[r])||g.removeCue(t[r]);k==="disabled"&&(g.mode=k)},sendAddTrackEvent:()=>function(g,T){var E;try{E=new Event("addtrack")}catch{(E=document.createEvent("Event")).initEvent("addtrack",!1,!1)}E.track=g,T.dispatchEvent(E)}});var f=o("./src/utils/logger.ts");function _(g,T,E){var h=[],k=(function(a,d){if(d<a[0].startTime)return 0;var p=a.length-1;if(d>a[p].endTime)return-1;for(var m=0,x=p;m<=x;){var b=Math.floor((x+m)/2);if(d<a[b].startTime)x=b-1;else{if(!(d>a[b].startTime&&m<p))return b;m=b+1}}return a[m].startTime-d<d-a[x].startTime?m:x})(g,T);if(-1<k)for(var t=k,r=g.length;t<r;t++){var n=g[t];if(n.startTime>=T&&n.endTime<=E)h.push(n);else if(n.startTime>E)return h}return h}},"./src/utils/time-ranges.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>f});const f={toString:function(_){for(var g="",T=_.length,E=0;E<T;E++)g+="["+_.start(E).toFixed(3)+"-"+_.end(E).toFixed(3)+"]";return g}}},"./src/utils/timescale-conversion.ts":(c,l,o)=>{function f(_,g,T,E){return _=_*g*(T=T===void 0?1:T),(E=E===void 0?!1:E)?Math.round(_):_}o.r(l),o.d(l,{toMpegTsClockFromTimescale:()=>function(_,g){return f(_,9e4,1/(g=g===void 0?1:g))},toMsFromMpegTsClock:()=>function(_,g){return f(_,1e3,1/9e4,g=g===void 0?!1:g)},toTimescaleFromBase:()=>f,toTimescaleFromScale:()=>function(_,g,T,E){return f(_,g,1/(T=T===void 0?1:T),E=E===void 0?!1:E)}})},"./src/utils/typed-array.ts":(c,l,o)=>{o.r(l),o.d(l,{sliceUint8:()=>function(f,_,g){return Uint8Array.prototype.slice?f.slice(_,g):new Uint8Array(Array.prototype.slice.call(f,_,g))}})},"./src/utils/vttcue.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>f});const f=typeof self<"u"&&self.VTTCue?self.VTTCue:(h=["","lr","rl"],k=["start","middle","end","left","right"],E.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},E);function _(t,r){return typeof r=="string"&&!!Array.isArray(t)&&(r=r.toLowerCase(),!!~t.indexOf(r))&&r}function g(t){return _(k,t)}function T(t){for(var r=arguments.length,n=new Array(1<r?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];for(var d=1;d<arguments.length;d++){var p,m=arguments[d];for(p in m)t[p]=m[p]}return t}function E(t,r,n){var a=this,d={enumerable:!0},p=(a.hasBeenReset=!1,""),m=!1,x=t,b=r,C=n,v=null,y="",S=!0,L="auto",B="start",A=50,I="middle",U=50,P="middle";Object.defineProperty(a,"id",T({},d,{get:function(){return p},set:function(F){p=""+F}})),Object.defineProperty(a,"pauseOnExit",T({},d,{get:function(){return m},set:function(F){m=!!F}})),Object.defineProperty(a,"startTime",T({},d,{get:function(){return x},set:function(F){if(typeof F!="number")throw new TypeError("Start time must be set to a number.");x=F,this.hasBeenReset=!0}})),Object.defineProperty(a,"endTime",T({},d,{get:function(){return b},set:function(F){if(typeof F!="number")throw new TypeError("End time must be set to a number.");b=F,this.hasBeenReset=!0}})),Object.defineProperty(a,"text",T({},d,{get:function(){return C},set:function(F){C=""+F,this.hasBeenReset=!0}})),Object.defineProperty(a,"region",T({},d,{get:function(){return v},set:function(F){v=F,this.hasBeenReset=!0}})),Object.defineProperty(a,"vertical",T({},d,{get:function(){return y},set:function(F){if(F=_(h,F),F===!1)throw new SyntaxError("An invalid or illegal string was specified.");y=F,this.hasBeenReset=!0}})),Object.defineProperty(a,"snapToLines",T({},d,{get:function(){return S},set:function(F){S=!!F,this.hasBeenReset=!0}})),Object.defineProperty(a,"line",T({},d,{get:function(){return L},set:function(F){if(typeof F!="number"&&F!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");L=F,this.hasBeenReset=!0}})),Object.defineProperty(a,"lineAlign",T({},d,{get:function(){return B},set:function(F){if(F=g(F),!F)throw new SyntaxError("An invalid or illegal string was specified.");B=F,this.hasBeenReset=!0}})),Object.defineProperty(a,"position",T({},d,{get:function(){return A},set:function(F){if(F<0||100<F)throw new Error("Position must be between 0 and 100.");A=F,this.hasBeenReset=!0}})),Object.defineProperty(a,"positionAlign",T({},d,{get:function(){return I},set:function(F){if(F=g(F),!F)throw new SyntaxError("An invalid or illegal string was specified.");I=F,this.hasBeenReset=!0}})),Object.defineProperty(a,"size",T({},d,{get:function(){return U},set:function(F){if(F<0||100<F)throw new Error("Size must be between 0 and 100.");U=F,this.hasBeenReset=!0}})),Object.defineProperty(a,"align",T({},d,{get:function(){return P},set:function(F){if(F=g(F),!F)throw new SyntaxError("An invalid or illegal string was specified.");P=F,this.hasBeenReset=!0}})),a.displayState=void 0}var h,k},"./src/utils/vttparser.ts":(c,l,o)=>{o.r(l),o.d(l,{VTTParser:()=>a,fixLineBreaks:()=>n,parseTimeStamp:()=>T});var f=o("./src/utils/vttcue.ts"),_=(g.prototype.decode=function(p,m){if(!p)return"";if(typeof p!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(p))},g);function g(){}function T(p){function m(x,b,C,v){return 3600*(0|x)+60*(0|b)+(0|C)+parseFloat(v||0)}return p=p.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/),p?59<parseFloat(p[2])?m(p[2],p[3],0,p[4]):m(p[1],p[2],p[3],p[4]):null}(l=h.prototype).set=function(p,m){this.get(p)||m===""||(this.values[p]=m)},l.get=function(p,m,x){return x?this.has(p)?this.values[p]:m[x]:this.has(p)?this.values[p]:m},l.has=function(p){return p in this.values},l.alt=function(p,m,x){for(var b=0;b<x.length;++b)if(m===x[b]){this.set(p,m);break}},l.integer=function(p,m){/^-?\d+$/.test(m)&&this.set(p,parseInt(m,10))},l.percent=function(p,m){return/^([\d]{1,3})(\.[\d]*)?%$/.test(m)&&(m=parseFloat(m),0<=m&&m<=100)?(this.set(p,m),!0):!1};var E=h;function h(){this.values=Object.create(null)}function k(p,m,x,b){var C,v,y=b?p.split(b):[p];for(C in y)typeof y[C]=="string"&&(v=y[C].split(x)).length===2&&m(v[0],v[1])}var t=new f.default(0,0,""),r=t.align==="middle"?"middle":"center";function n(p){return p.replace(/<br(?: \/)?>/gi,`
`)}(o=d.prototype).parse=function(p){var m=this;function x(){for(var S=0,L=n(L=m.buffer);S<L.length&&L[S]!=="\r"&&L[S]!==`
`;)++S;var B=L.slice(0,S);return L[S]==="\r"&&++S,L[S]===`
`&&++S,m.buffer=L.slice(S),B}p&&(m.buffer+=m.decoder.decode(p,{stream:!0}));try{var b="";if(m.state==="INITIAL"){if(!/\r\n|\n/.test(m.buffer))return this;var C=(b=x()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!C||!C[0])throw new Error("Malformed WebVTT signature.");m.state="HEADER"}for(var v=!1;m.buffer;){if(!/\r\n|\n/.test(m.buffer))return this;switch(v?v=!1:b=x(),m.state){case"HEADER":/:/.test(b)?k(b,function(S,L){},/:/):b||(m.state="ID");continue;case"NOTE":b||(m.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(b)){m.state="NOTE";break}if(!b)continue;if(m.cue=new f.default(0,0,""),m.state="CUE",b.indexOf("-->")===-1){m.cue.id=b;continue}case"CUE":if(!m.cue){m.state="BADCUE";continue}try{(function(S,L,B){var A,I,U=S;function P(){var M=T(S);if(M===null)throw new Error("Malformed timestamp: "+U);return S=S.replace(/^[^\sa-zA-Z-]+/,""),M}function F(){S=S.replace(/^\s+/,"")}if(F(),L.startTime=P(),F(),S.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+U);S=S.slice(3),F(),L.endTime=P(),F(),A=S,L=L,I=new E,k(A,function(M,w){var R;switch(M){case"region":for(var O=B.length-1;0<=O;O--)if(B[O].id===w){I.set(M,B[O].region);break}break;case"vertical":I.alt(M,w,["rl","lr"]);break;case"line":R=w.split(","),I.integer(M,R[0]),I.percent(M,R[0])&&I.set("snapToLines",!1),I.alt(M,R[0],["auto"]),R.length===2&&I.alt("lineAlign",R[1],["start",r,"end"]);break;case"position":R=w.split(","),I.percent(M,R[0]),R.length===2&&I.alt("positionAlign",R[1],["start",r,"end","line-left","line-right","auto"]);break;case"size":I.percent(M,w);break;case"align":I.alt(M,w,["start",r,"end","left","right"])}},/:/,/\s/),L.region=I.get("region",null),L.vertical=I.get("vertical",""),(A=I.get("line","auto"))==="auto"&&t.line===-1&&(A=-1),L.line=A,L.lineAlign=I.get("lineAlign","start"),L.snapToLines=I.get("snapToLines",!0),L.size=I.get("size",100),L.align=I.get("align",r),(A=I.get("position","auto"))==="auto"&&t.position===50&&(A=L.align==="start"||L.align==="left"?0:L.align==="end"||L.align==="right"?100:50),L.position=A})(b,m.cue,m.regionList)}catch{m.cue=null,m.state="BADCUE";continue}m.state="CUETEXT";continue;case"CUETEXT":var y=b.indexOf("-->")!==-1;if(!b||y&&(v=!0)){m.oncue&&m.cue&&m.oncue(m.cue),m.cue=null,m.state="ID";continue}if(m.cue===null)continue;m.cue.text&&(m.cue.text+=`
`),m.cue.text+=b;continue;case"BADCUE":b||(m.state="ID")}}}catch{m.state==="CUETEXT"&&m.cue&&m.oncue&&m.oncue(m.cue),m.cue=null,m.state=m.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},o.flush=function(){var p=this;try{if(!p.cue&&p.state!=="HEADER"||(p.buffer+=`

`,p.parse()),p.state==="INITIAL"||p.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(m){p.onparsingerror&&p.onparsingerror(m)}return p.onflush&&p.onflush(),this};var a=d;function d(){this.state="INITIAL",this.buffer="",this.decoder=new _,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}},"./src/utils/webvtt-parser.ts":(c,l,o)=>{o.r(l),o.d(l,{generateCueId:()=>r,parseWebVTT:()=>function(S,a,d,p,m,x,b,C){var v,y=new _.VTTParser,S=(0,g.utf8ArrayToStr)(new Uint8Array(S)).trim().replace(h,`
`).split(`
`),L=[],B=(0,T.toMpegTsClockFromTimescale)(a,d),A="00:00.000",I=0,U=0,P=!0;y.oncue=function(F){var M=p[m],R=p.ccOffset,w=(I-B)/9e4,M=(M!=null&&M.new&&(U!==void 0?R=p.ccOffset=M.start:(function(O,j){var z,G=O[m],K=O[G.prevCC];if(!K||!K.new&&G.new)return O.ccOffset=O.presentationOffset=G.start,G.new=!1;for(;(z=K)!=null&&z.new;)O.ccOffset+=G.start-K.start,G.new=!1,K=O[(G=K).prevCC];O.presentationOffset=j})(p,w)),w&&(R=w-p.presentationOffset),F.endTime-F.startTime),w=(0,E.normalizePts)(9e4*(F.startTime+R-U),9e4*x)/9e4,R=(F.startTime=Math.max(w,0),F.endTime=Math.max(w+M,0),F.text.trim());F.text=decodeURIComponent(encodeURIComponent(R)),F.id||(F.id=r(F.startTime,F.endTime,R)),0<F.endTime&&L.push(F)},y.onparsingerror=function(F){v=F},y.onflush=function(){v?C(v):b(L)},S.forEach(function(F){if(P){if(k(F,"X-TIMESTAMP-MAP=")){P=!1,F.slice(16).split(",").forEach(function(M){k(M,"LOCAL:")?A=M.slice(6):k(M,"MPEGTS:")&&(I=parseInt(M.slice(7)))});try{U=(function(M){var w=parseInt(M.slice(-3)),R=parseInt(M.slice(-6,-4)),O=parseInt(M.slice(-9,-7)),j=9<M.length?parseInt(M.substring(0,M.indexOf(":"))):0;if((0,f.isFiniteNumber)(w)&&(0,f.isFiniteNumber)(R)&&(0,f.isFiniteNumber)(O)&&(0,f.isFiniteNumber)(j))return w+1e3*R+6e4*O+36e5*j;throw Error("Malformed X-TIMESTAMP-MAP: Local:"+M)})(A)/1e3}catch(M){v=M}return}F===""&&(P=!1)}y.parse(F+`
`)}),y.flush()}});var f=o("./src/polyfills/number.ts"),_=o("./src/utils/vttparser.ts"),g=o("./src/demux/id3.ts"),T=o("./src/utils/timescale-conversion.ts"),E=o("./src/remux/mp4-remuxer.ts"),h=/\r\n|\n\r|\n|\r/g,k=function(n,a,d){return n.slice(d=d===void 0?0:d,d+a.length)===a},t=function(n){for(var a=5381,d=n.length;d;)a=33*a^n.charCodeAt(--d);return(a>>>0).toString()};function r(n,a,d){return t(n.toString())+t(a.toString())+t(d)}},"./src/utils/xhr-loader.ts":(c,l,o)=>{o.r(l),o.d(l,{default:()=>T});var f=o("./src/utils/logger.ts"),_=o("./src/loader/load-stats.ts"),g=/^age:\s*[\d.]+\s*$/m;(l=E.prototype).destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},l.abortInternal=function(){var h=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),h&&(h.onreadystatechange=null,h.onprogress=null,h.readyState!==4)&&(this.stats.aborted=!0,h.abort())},l.abort=function(){var h;this.abortInternal(),(h=this.callbacks)!=null&&h.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},l.load=function(h,k,t){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=h,this.config=k,this.callbacks=t,this.retryDelay=k.retryDelay,this.loadInternal()},l.loadInternal=function(){var h=this.config,k=this.context;if(h){var t=this.loader=new self.XMLHttpRequest,r=this.stats,r=(r.loading.first=0,r.loaded=0,this.xhrSetup);try{if(r)try{r(t,k.url)}catch{t.open("GET",k.url,!0),r(t,k.url)}t.readyState||t.open("GET",k.url,!0);var n=this.context.headers;if(n)for(var a in n)t.setRequestHeader(a,n[a])}catch(d){return void this.callbacks.onError({code:t.status,text:d.message},k,t)}k.rangeEnd&&t.setRequestHeader("Range","bytes="+k.rangeStart+"-"+(k.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=k.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),h.timeout),t.send()}},l.readystatechange=function(){var h,k,t,r,n=this.context,a=this.loader,d=this.stats;n&&a&&(k=a.readyState,h=this.config,!d.aborted)&&2<=k&&(self.clearTimeout(this.requestTimeout),d.loading.first===0&&(d.loading.first=Math.max(self.performance.now(),d.loading.start)),k===4?(a.onreadystatechange=null,a.onprogress=null,k=a.status,r=a.responseType==="arraybuffer",200<=k&&k<300&&(r&&a.response||a.responseText!==null)?(d.loading.end=Math.max(self.performance.now(),d.loading.first),r=r?(t=a.response).byteLength:(t=a.responseText).length,d.loaded=d.total=r,this.callbacks&&((r=this.callbacks.onProgress)&&r(d,n,t,a),this.callbacks)&&(r={url:a.responseURL,data:t},this.callbacks.onSuccess(r,d,n,a))):d.retry>=h.maxRetry||400<=k&&k<499?(f.logger.error(k+" while loading "+n.url),this.callbacks.onError({code:k,text:a.statusText},n,a)):(f.logger.warn(k+" while loading "+n.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,h.maxRetryDelay),d.retry++)):(self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),h.timeout)))},l.loadtimeout=function(){f.logger.warn("timeout while loading "+this.context.url);var h=this.callbacks;h&&(this.abortInternal(),h.onTimeout(this.stats,this.context,this.loader))},l.loadprogress=function(h){var k=this.stats;k.loaded=h.loaded,h.lengthComputable&&(k.total=h.total)},l.getCacheAge=function(){var h,k=null;return k=this.loader&&g.test(this.loader.getAllResponseHeaders())?(h=this.loader.getResponseHeader("age"))?parseFloat(h):null:k};const T=E;function E(h){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=h?h.xhrSetup:null,this.stats=new _.LoadStats,this.retryDelay=0}},"./node_modules/eventemitter3/index.js":c=>{var l=Object.prototype.hasOwnProperty,o="~";function f(){}function _(h,k,t){this.fn=h,this.context=k,this.once=t||!1}function g(h,k,t,r,n){if(typeof t!="function")throw new TypeError("The listener must be a function");return t=new _(t,r||h,n),r=o?o+k:k,h._events[r]?h._events[r].fn?h._events[r]=[h._events[r],t]:h._events[r].push(t):(h._events[r]=t,h._eventsCount++),h}function T(h,k){--h._eventsCount==0?h._events=new f:delete h._events[k]}function E(){this._events=new f,this._eventsCount=0}Object.create&&(f.prototype=Object.create(null),new f().__proto__||(o=!1)),E.prototype.eventNames=function(){var h,k,t=[];if(this._eventsCount===0)return t;for(k in h=this._events)l.call(h,k)&&t.push(o?k.slice(1):k);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(h)):t},E.prototype.listeners=function(k){var k=o?o+k:k,t=this._events[k];if(!t)return[];if(t.fn)return[t.fn];for(var r=0,n=t.length,a=new Array(n);r<n;r++)a[r]=t[r].fn;return a},E.prototype.listenerCount=function(h){return h=o?o+h:h,h=this._events[h],h?h.fn?1:h.length:0},E.prototype.emit=function(h,k,t,r,n,a){var d=o?o+h:h;if(!this._events[d])return!1;var p,m=this._events[d],x=arguments.length;if(m.fn){switch(m.once&&this.removeListener(h,m.fn,void 0,!0),x){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,k),!0;case 3:return m.fn.call(m.context,k,t),!0;case 4:return m.fn.call(m.context,k,t,r),!0;case 5:return m.fn.call(m.context,k,t,r,n),!0;case 6:return m.fn.call(m.context,k,t,r,n,a),!0}for(v=1,p=new Array(x-1);v<x;v++)p[v-1]=arguments[v];m.fn.apply(m.context,p)}else for(var b,C=m.length,v=0;v<C;v++)switch(m[v].once&&this.removeListener(h,m[v].fn,void 0,!0),x){case 1:m[v].fn.call(m[v].context);break;case 2:m[v].fn.call(m[v].context,k);break;case 3:m[v].fn.call(m[v].context,k,t);break;case 4:m[v].fn.call(m[v].context,k,t,r);break;default:if(!p)for(b=1,p=new Array(x-1);b<x;b++)p[b-1]=arguments[b];m[v].fn.apply(m[v].context,p)}return!0},E.prototype.on=function(h,k,t){return g(this,h,k,t,!1)},E.prototype.once=function(h,k,t){return g(this,h,k,t,!0)},E.prototype.removeListener=function(h,k,t,r){if(h=o?o+h:h,this._events[h])if(k){var n=this._events[h];if(n.fn)n.fn!==k||r&&!n.once||t&&n.context!==t||T(this,h);else{for(var a=0,d=[],p=n.length;a<p;a++)(n[a].fn!==k||r&&!n[a].once||t&&n[a].context!==t)&&d.push(n[a]);d.length?this._events[h]=d.length===1?d[0]:d:T(this,h)}}else T(this,h);return this},E.prototype.removeAllListeners=function(h){return h?(h=o?o+h:h,this._events[h]&&T(this,h)):(this._events=new f,this._eventsCount=0),this},E.prototype.off=E.prototype.removeListener,E.prototype.addListener=E.prototype.on,E.prefixed=o,c.exports=E.EventEmitter=E},"./node_modules/url-toolkit/src/url-toolkit.js":function(c){var l=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,o=/^(?=([^\/?#]*))\1([^]*)$/,f=/(?:\/|^)\.(?=\/)/g,_=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,g={buildAbsoluteURL:function(r,E,h){if(h=h||{},r=r.trim(),!(E=E.trim())){if(!h.alwaysNormalize)return r;var k=g.parseURL(r);if(k)return k.path=g.normalizePath(k.path),g.buildURLFromParts(k);throw new Error("Error trying to parse base URL.")}if(k=g.parseURL(E),!k)throw new Error("Error trying to parse relative URL.");if(k.scheme)return h.alwaysNormalize?(k.path=g.normalizePath(k.path),g.buildURLFromParts(k)):E;if(E=g.parseURL(r),!E)throw new Error("Error trying to parse base URL.");!E.netLoc&&E.path&&E.path[0]!=="/"&&(r=o.exec(E.path),E.netLoc=r[1],E.path=r[2]),E.netLoc&&!E.path&&(E.path="/");var t,r={scheme:E.scheme,netLoc:k.netLoc,path:null,params:k.params,query:k.query,fragment:k.fragment};return k.netLoc||(r.netLoc=E.netLoc,k.path[0]==="/")||(k.path?(t=(t=E.path).substring(0,t.lastIndexOf("/")+1)+k.path,r.path=g.normalizePath(t)):(r.path=E.path,k.params||(r.params=E.params,k.query)||(r.query=E.query))),r.path===null&&(r.path=h.alwaysNormalize?g.normalizePath(k.path):k.path),g.buildURLFromParts(r)},parseURL:function(T){return T=l.exec(T),T?{scheme:T[1]||"",netLoc:T[2]||"",path:T[3]||"",params:T[4]||"",query:T[5]||"",fragment:T[6]||""}:null},normalizePath:function(T){for(T=T.split("").reverse().join("").replace(f,"");T.length!==(T=T.replace(_,"")).length;);return T.split("").reverse().join("")},buildURLFromParts:function(T){return T.scheme+T.netLoc+T.path+T.params+T.query+T.fragment}};c.exports=g}},u={},i.m=s,i.n=c=>{var l=c&&c.__esModule?()=>c.default:()=>c;return i.d(l,{a:l}),l},i.d=(c,l)=>{for(var o in l)i.o(l,o)&&!i.o(c,o)&&Object.defineProperty(c,o,{enumerable:!0,get:l[o]})},i.o=(c,l)=>Object.prototype.hasOwnProperty.call(c,l),i.r=c=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(c,"__esModule",{value:!0})},i("./src/hls.ts").default;function i(c){var l=u[c];return l!==void 0||(l=u[c]={exports:{}},s[c].call(l.exports,l,l.exports,i)),l.exports}var s,u})())}))&&Ri.__esModule&&Object.prototype.hasOwnProperty.call(Ri,"default")?Ri.default:Ri;class nn extends Ae{constructor(e){super(),(this.player=e)._opt,this.canVideoPlay=!1,this.$videoElement=null,this.canvasRenderInterval=null,this.bandwidthEstimateInterval=null,this.fpsInterval=null,this.hlsFps=0,this.hlsPrevFrams=0,this.isInitInfo=!1,this.eventsDestroy=[],ua()?(this.$videoElement=this.player.video.$videoElement,this.canVideoPlay=!0):Ce.isSupported()?(this.$videoElement=this.player.video.$videoElement,this.hls=new Ce({}),this._initHls(),this._bindEvents()):this.player.debug.error("HlsDecoder","init hls error ,not support "),this.player.debug.log("HlsDecoder","init")}destroy(){return new Promise((e,i)=>{this.hls&&(this.hls.destroy(),this.hls=null),this.eventsDestroy.length&&(this.eventsDestroy.forEach(s=>s()),this.eventsDestroy=[]),this.isInitInfo=!1,this._stopCanvasRender(),this._stopBandwidthEstimateInterval(),this._stopFpsInterval(),this.$videoElement=null,this.hlsFps=0,this.player.debug.log("HlsDecoder","destroy"),setTimeout(()=>{e()},0)})}checkHlsBufferedDelay(){var e=this.$videoElement;let i=0;var s=e.buffered,s=s.length?s.end(s.length-1):0;return(i=s-e.currentTime)<0&&(this.player.debug.warn("HlsDecoder","checkHlsBufferedDelay result < 0",i,s,e.currentTime),i=0),i}getFps(){return this.hlsFps}_startCanvasRender(){this._stopCanvasRender(),this.canvasRenderInterval=setInterval(()=>{this.player.video.render({$video:this.$videoElement,ts:0})},40)}_stopCanvasRender(){this.canvasRenderInterval&&(clearInterval(this.canvasRenderInterval),this.canvasRenderInterval=null)}_startBandwidthEstimateInterval(){this._stopBandwidthEstimateInterval(),this.bandwidthEstimateInterval=setInterval(()=>{let e=0;this.hls.bandwidthEstimate&&(e=this.hls.bandwidthEstimate),this.player.emit(N.kBps,(e/1024/8/10).toFixed(2))},1e3)}_stopBandwidthEstimateInterval(){this.bandwidthEstimateInterval&&(clearInterval(this.bandwidthEstimateInterval),this.bandwidthEstimateInterval=null)}_startFpsInterval(){this._stopCanvasRender(),this.fpsInterval=setInterval(()=>{var e=this.$videoElement.getVideoPlaybackQuality();this.hlsFps=e.totalVideoFrames-this.hlsPrevFrams,this.hlsPrevFrams=e.totalVideoFrames},1e3)}_stopFpsInterval(){this.fpsInterval&&(clearInterval(this.fpsInterval),this.fpsInterval=null)}_initHls(){this.player._opt.useCanvasRender&&(this.$videoElement=document.createElement("video"),this.$videoElement.muted=!0,Mr()&&(this.$videoElement.style.position="absolute"),this.initVideoEvents()),this.hls.attachMedia(this.$videoElement)}_bindEvents(){const e=this.player,i=this.player.events.proxy;this.hls;var s=i(this.$videoElement,Xi,u=>{this.hls&&(u=parseInt(u.timeStamp,10),e.handleRender(),e.updateStats({ts:u,dts:u,fps:!0}),e.emit(N.videoTimeUpdate,u))});this.eventsDestroy.push(s),this._startBandwidthEstimateInterval(),this._startFpsInterval(),this.hls.on(Ce.Events.ERROR,(u,c)=>{if(c.fatal)switch(c.type){case Ce.ErrorTypes.NETWORK_ERROR:this.player.debug.warn("HlsDecoder","fatal network error encountered, try to recover"),this.hls.startLoad();break;case Ce.ErrorTypes.MEDIA_ERROR:this.player.debug.warn("HlsDecoder","fatal media error encountered, try to recover"),this.hls.recoverMediaError()}}),this.hls.on(Ce.Events.MEDIA_ATTACHING,()=>{}),this.hls.on(Ce.Events.MEDIA_ATTACHED,()=>{}),this.hls.on(Ce.Events.MEDIA_DETACHING,()=>{}),this.hls.on(Ce.Events.MEDIA_DETACHED,()=>{}),this.hls.on(Ce.Events.BUFFER_RESET,()=>{}),this.hls.on(Ce.Events.BUFFER_CODECS,()=>{}),this.hls.on(Ce.Events.BUFFER_CREATED,()=>{}),this.hls.on(Ce.Events.BUFFER_APPENDING,(u,c)=>{this.player.debug.log("HlsDecoder","BUFFER_APPENDING",c)}),this.hls.on(Ce.Events.BUFFER_APPENDED,()=>{}),this.hls.on(Ce.Events.BUFFER_EOS,()=>{}),this.hls.on(Ce.Events.BUFFER_FLUSHING,()=>{}),this.hls.on(Ce.Events.BUFFER_FLUSHED,()=>{}),this.hls.on(Ce.Events.MANIFEST_LOADING,()=>{this.player.debug.log("HlsDecoder","MANIFEST_LOADING 开始加载playlist m3u8资源")}),this.hls.on(Ce.Events.MANIFEST_LOADED,(u,c)=>{this.player.debug.log("HlsDecoder","MANIFEST_LOADED playlist m3u8文件加载完成",c)}),this.hls.on(Ce.Events.MANIFEST_PARSED,()=>{this.player.debug.log("HlsDecoder","MANIFEST_PARSED playlist m3u8解析完成"),e._times.demuxStart||(e._times.demuxStart=be())}),this.hls.on(Ce.Events.LEVEL_LOADING,()=>{}),this.hls.on(Ce.Events.LEVEL_LOADED,(u,c)=>{}),this.hls.on(Ce.Events.FRAG_LOADING,()=>{}),this.hls.on(Ce.Events.FRAG_LOADED,(u,c)=>{e._times.decodeStart||(e._times.decodeStart=be())}),this.hls.on(Ce.Events.BUFFER_APPENDING,()=>{e._times.videoStart||(e._times.videoStart=be(),e.handlePlayToRenderTimes())}),this.hls.on(Ce.Events.FRAG_DECRYPTED,()=>{}),this.hls.on(Ce.Events.KEY_LOADING,()=>{}),this.hls.on(Ce.Events.KEY_LOADING,()=>{}),this.hls.on(Ce.Events.FPS_DROP,u=>{}),this.hls.on(Ce.Events.FPS_DROP_LEVEL_CAPPING,u=>{}),this.hls.on(Ce.Events.FRAG_PARSING_INIT_SEGMENT,(u,c)=>{this.player.debug.log("HlsDecoder","FRAG_PARSING_INIT_SEGMENT",c);const l=!!(c&&c.tracks&&c.tracks.audio),o=!!(c&&c.tracks&&c.tracks.video);if(l&&c.tracks.audio){var f=c.tracks.audio;const g=f.metadata&&f.metadata.channelCount?f.metadata.channelCount:0,T=f.codec;this.player.audio&&this.player.audio.updateAudioInfo({encType:T,channels:g,sampleRate:44100})}var _;o&&c.tracks.video&&(c=(f=c.tracks.video).codec,_=f.metadata&&f.metadata.width?f.metadata.width:0,f=f.metadata&&f.metadata.height?f.metadata.height:0,this.player.video)&&this.player.video.updateVideoInfo({encTypeCode:c.indexOf("avc")!==-1?7:12,width:_,height:f})})}initVideoPlay(e){this.player._opt.useCanvasRender&&(this.$videoElement=document.createElement("video"),this.initVideoEvents()),this.$videoElement.muted=!0,this.$videoElement.src=e}initRenderSize(){this.isInitInfo||(this.player.video.updateVideoInfo({width:this.$videoElement.videoWidth,height:this.$videoElement.videoHeight}),this.player.video.initCanvasViewSize(),this.isInitInfo=!0)}initVideoEvents(){var u=this.player.events.proxy,e=u(this.$videoElement,Ns,()=>{this.player.debug.log("HlsDecoder","video canplay"),this.$videoElement.play().then(()=>{this.player.debug.log("HlsDecoder","video play"),this._startCanvasRender(),this.initRenderSize()}).catch(c=>{this.player.debug.warn("HlsDecoder","video play error ",c)})}),i=u(this.$videoElement,js,()=>{this.player.debug.log("HlsDecoder","video waiting")}),s=u(this.$videoElement,Xi,c=>{c=parseInt(c.timeStamp,10),this.player.handleRender(),this.player.updateStats({ts:c}),this.player.emit(N.videoTimeUpdate,c),this.$videoElement.paused&&(this.player.debug.warn("HlsDecoder","video is paused and next try to replay"),this.$videoElement.play().then(()=>{this.player.debug.log("HlsDecoder","video is paused and replay success")}).catch(l=>{this.player.debug.warn("HlsDecoder","video is paused and replay error ",l)}))}),u=u(this.$videoElement,zs,()=>{this.player.debug.log("HlsDecoder","video playback Rate change",this.$videoElement&&this.$videoElement.playbackRate)});this.eventsDestroy.push(e,i,s,u)}loadSource(e){return new Promise((i,s)=>{this.canVideoPlay?(this.initVideoPlay(e),i()):this.hls.on(Ce.Events.MEDIA_ATTACHED,()=>{this.hls.loadSource(e),i()})})}_handleUpdatePlaybackRate(){if(this.$videoElement){var e=this.$videoElement,u=(this.player._opt.videoBuffer+this.player._opt.videoBufferDelay)/1e3,i=e.buffered,i=(i.length&&i.start(0),i.length?i.end(i.length-1):0);let c=e.currentTime;var s=i-c,u=Math.max(5,3+u),u=(u<s?(this.player.debug.warn("HlsDecoder",`handleUpdatePlaybackRate and delay buffer is more than ${u} is ${s} and new time is ${i} `),e.currentTime=i,c=e.currentTime):s<0&&this.player.debug.warn("HlsDecoder",`handleUpdatePlaybackRate and delay buffer is less than 0 is ${s} and new time is `+i),this._getPlaybackRate(i-c));e.playbackRate!==u&&(e.playbackRate=u)}}_getPlaybackRate(e){var i=this.$videoElement,s=this.player._opt.videoBuffer,u=s+this.player._opt.videoBufferDelay;return e*=1e3,i.playbackRate===1?u<e?1.2:1:e<=s?1:i.playbackRate}getDecodePlaybackRate(){let e=0;var i=this.$videoElement;return e=i?i.playbackRate:e}}const Bi="fetch",on="arraybuffer",Ui="real_time_speed",ln=Object.prototype.toString;function hn(D){if(ln.call(D)==="[object Object]")return(D=Object.getPrototypeOf(D))===null||D===Object.prototype}function dn(D){if(D&&D[0]!==null&&D[0]!==void 0&&(D[0]!==0||D[1]!==null&&D[1]!==void 0)){let e="bytes="+D[0]+"-";return D[1]&&(e+=D[1]),e}}function un(D){return encodeURIComponent(D).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function cn(D,e){if(D){if(e){let s;var i=Object.keys(e).map(u=>{if((s=e[u])!=null)return Array.isArray(s)?u+="[]":s=[s],s.map(c=>{var l=c;return ln.call(l)==="[object Date]"?c=c.toISOString():c!==null&&typeof c=="object"&&(c=JSON.stringify(c)),un(u)+"="+un(c)}).join("&")}).filter(Boolean).join("&");if(i){const u=D.indexOf("#");u!==-1&&(D=D.slice(0,u)),D+=(D.indexOf("?")===-1?"?":"&")+i}}return D}}function As(D,e,i,s,u,c,l,o,f,_,g){return u=u!=null?parseFloat(u):null,s=parseInt(s||"0",10),{data:D,done:e,option:{range:f,vid:_,index:o,contentLength:s=Number.isNaN(s)?0:s,age:u,startTime:c,firstByteTime:l,endTime:Date.now(),priOptions:g},response:i}}function bs(D,e){return Math.round(8*D*1e3/e/1024)}class Dt extends Error{retryCount=0;isTimeout=!1;loaderType=Bi;startTime=0;endTime=0;options={};constructor(e,i,s,u){super(u),this.url=e,this.request=i,this.response=s}}class vs extends Ae{_abortController=null;_timeoutTimer=null;_reader=null;_response=null;_aborted=!1;_index=-1;_range=null;_receivedLength=0;_running=!1;_logger=null;_vid="";_onProcessMinLen=0;_onCancel=null;_priOptions=null;TAG_NAME="FetchLoader";constructor(e){super(),this.player=e}load(e){let{url:i,vid:s,timeout:u,responseType:c,onProgress:l,index:o,onTimeout:f,onCancel:_,range:g,transformResponse:T,request:E,params:h,method:k,headers:t,body:r,mode:n,credentials:a,cache:d,redirect:p,referrer:m,referrerPolicy:x,onProcessMinLen:b,priOptions:C}=e;this._aborted=!1,this._onProcessMinLen=b,this._onCancel=_,this._abortController=typeof AbortController<"u"&&new AbortController,this._running=!0,this._index=o,this._range=g||[0,0],this._vid=s||i,this._priOptions=C||{};const v={method:k,headers:t,body:r,mode:n,credentials:a,cache:d,redirect:p,referrer:m,referrerPolicy:x,signal:this._abortController?.signal};let y=!1;clearTimeout(this._timeoutTimer),i=cn(i,h),e=dn(g),e&&(t=E?E.headers:v.headers=v.headers||(Headers?new Headers:{}),Headers&&t instanceof Headers?t.append("Range",e):t.Range=e),u&&(this._timeoutTimer=setTimeout(()=>{var L;y=!0,this.cancel(),f&&((L=new Dt(i,v,null,"timeout")).isTimeout=!0,f(L,{index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions}))},u));const S=Date.now();return(Ue(o)||Ue(g))&&this.player.debug.log(this.TAG_NAME,"[fetch load start], index,",o,",range,",g),new Promise((L,B)=>{fetch(E||i,E?void 0:v).then(async A=>{if(clearTimeout(this._timeoutTimer),this._response=A,!this._aborted&&this._running){if(!(A=T&&T(A,i)||A).ok)throw new Dt(i,v,A,"bad network response");var I=Date.now();let U;if(c==="text")U=await A.text(),this._running=!1;else if(c==="json")U=await A.json(),this._running=!1;else{if(l)return this.resolve=L,this.reject=B,void this._loadChunk(A,l,S,I);{U=await A.arrayBuffer(),U=new Uint8Array(U),this._running=!1;const P=Date.now()-S,F=bs(U.byteLength,P);this.emit(Ui,{speed:F,len:U.byteLength,time:P,vid:this._vid,index:this._index,range:this._range,priOptions:this._priOptions})}}(Ue(o)||Ue(g))&&this.player.debug.log(this.TAG_NAME,"[fetch load end], index,",o,",range,",g),L(As(U,!0,A,A.headers.get("Content-Length"),A.headers.get("age"),S,I,o,g,this._vid,this._priOptions))}}).catch(A=>{clearTimeout(this._timeoutTimer),this._running=!1,this._aborted&&!y||((A=A instanceof Dt?A:new Dt(i,v,null,A?.message)).startTime=S,A.endTime=Date.now(),A.isTimeout=y,A.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},B(A))})})}async cancel(){if(!this._aborted){if(this._aborted=!0,this._running=!1,this._response){try{this._reader&&await this._reader.cancel()}catch{}this._response=this._reader=null}if(this._abortController){try{this._abortController.abort()}catch{}this._abortController=null}this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions})}}_loadChunk(e,i,s,u){if(e.body&&e.body.getReader){0<this._onProcessMinLen&&(this._cache=new Uint8Array(2097152),this._writeIdx=0);const c=this._reader=e.body.getReader();let l,o,f;const _=async()=>{o=Date.now();try{l=await c.read(),f=Date.now()}catch(h){return f=Date.now(),void(this._aborted||(this._running=!1,h.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this.reject(h)))}var g=0<this._range?.length?this._range[0]:0,T=g+this._receivedLength;if(this._aborted)this._running=!1,i(void 0,!1,{range:[T,T],vid:this._vid,index:this._index,startTime:o,endTime:f,st:s,firstByteTime:u,priOptions:this._priOptions},e);else{var E=l.value?l.value.byteLength:0;let h;if(this._receivedLength+=E,this.player.debug.log(this.TAG_NAME,"【fetchLoader,onProgress call】,task,",this._range,", start,",T,", end,",g+this._receivedLength,", done,",l.done),0<this._onProcessMinLen){if(this._writeIdx+E>=this._onProcessMinLen||l.done)(h=new Uint8Array(this._writeIdx+E)).set(this._cache.slice(0,this._writeIdx),0),0<E&&h.set(l.value,this._writeIdx),this._writeIdx=0,this.player.debug.log(this.TAG_NAME,"【fetchLoader,onProgress enough】,done,",l.done,",len,",h.byteLength,", writeIdx,",this._writeIdx);else if(0<E&&this._writeIdx+E<2097152)this._cache.set(l.value,this._writeIdx),this._writeIdx+=E,this.player.debug.log(this.TAG_NAME,"【fetchLoader,onProgress cache】,len,",E,", writeIdx,",this._writeIdx);else if(0<E){const k=new Uint8Array(this._writeIdx+E+2048);this.player.debug.log(this.TAG_NAME,"【fetchLoader,onProgress extra start】,size,",this._writeIdx+E+2048,", datalen,",E,", writeIdx,",this._writeIdx),k.set(this._cache.slice(0,this._writeIdx),0),0<E&&k.set(l.value,this._writeIdx),this._writeIdx+=E,delete this._cache,this._cache=k,this.player.debug.log(this.TAG_NAME,"【fetchLoader,onProgress extra end】,len,",E,", writeIdx,",this._writeIdx)}}else h=l.value;if((h&&0<h.byteLength||l.done)&&i(h,l.done,{range:[this._range[0]+this._receivedLength-(h?h.byteLength:0),this._range[0]+this._receivedLength],vid:this._vid,index:this._index,startTime:o,endTime:f,st:s,firstByteTime:u,priOptions:this._priOptions},e),l.done){const k=Date.now()-s,t=bs(this._receivedLength,k);this.emit(Ui,{speed:t,len:this._receivedLength,time:k,vid:this._vid,index:this._index,range:this._range,priOptions:this._priOptions}),this._running=!1,this.player.debug.log(this.TAG_NAME,"[fetchLoader onProgress end],task,",this._range,",done,",l.done),this.resolve(As(l,!0,e,e.headers.get("Content-Length"),e.headers.get("age"),s,u,this._index,this._range,this._vid,this._priOptions))}else _()}};_()}else{this._running=!1;const c=new Dt(e.url,"",e,"onProgress of bad response.body.getReader");c.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this.reject(c)}}get receiveLen(){return this._receivedLength}get running(){return this._running}set running(e){this._running=e}static isSupported(){return!(typeof fetch>"u")}}class Po{TAG_NAME="Task";constructor(e,i,s){this.promise=(function(){let u,c;const l=new Promise((o,f)=>{u=o,c=f});return l.used=!1,l.resolve=function(){return l.used=!0,u(...arguments)},l.reject=function(){return l.used=!0,c(...arguments)},l})(),this.alive=!!i.onProgress,this._loaderType=e,this.player=s,this._loader=new(e===Bi&&window.fetch?vs:Bo)(s),this._config=i,this._retryCount=0,this._retryTimer=null,this._canceled=!1,this._retryCheckFunc=i.retryCheckFunc}exec(){const{retry:e,retryDelay:i,onRetryError:s,transformError:u,...c}=this._config,l=async()=>{try{const o=await this._loader.load(c);this.promise.resolve(o)}catch(o){if(this._loader.running=!1,this.player.debug.log(this.TAG_NAME,"[task request catch err]",o),!this._canceled){o.loaderType=this._loaderType,o.retryCount=this._retryCount;let f=o,_=(u&&(f=u(f)||f),s&&0<this._retryCount&&s(f,this._retryCount,{index:c.index,vid:c.vid,range:c.range,priOptions:c.priOptions}),this._retryCount++,!0);(_=this._retryCheckFunc?this._retryCheckFunc(o):_)&&this._retryCount<=e?(clearTimeout(this._retryTimer),this.player.debug.log(this.TAG_NAME,"[task request setTimeout],retry",this._retryCount,",retry range,",c.range),this._retryTimer=setTimeout(l,i)):this.promise.reject(f)}}};return l(),this.promise}async cancel(){return clearTimeout(this._retryTimer),this._canceled=!0,this._loader.running=!1,this._loader.cancel()}get running(){return this._loader&&this._loader.running}get loader(){return this._loader}}class Bo extends Ae{_xhr=null;_aborted=!1;_timeoutTimer=null;_range=null;_receivedLength=0;_url=null;_onProgress=null;_index=-1;_headers=null;_currentChunkSizeKB=384;_timeout=null;_xhr=null;_withCredentials=null;_startTime=-1;_loadCompleteResolve=null;_loadCompleteReject=null;_runing=!1;_logger=!1;_vid="";_responseType;_credentials;_method;_transformResponse;_firstRtt;_onCancel=null;_priOptions=null;TAG_NAME="XhrLoader";constructor(e){super(),this.player=e}load(e){clearTimeout(this._timeoutTimer),this._range=e.range,this._onProgress=e.onProgress,this._index=e.index,this._headers=e.headers,this._withCredentials=e.credentials==="include"||e.credentials==="same-origin",this._body=e.body||null,e.method&&(this._method=e.method),this._timeout=e.timeout||null,this._runing=!0,this._vid=e.vid||e.url,this._responseType=e.responseType,this._firstRtt=-1,this._onTimeout=e.onTimeout,this._onCancel=e.onCancel,this._request=e.request,this._priOptions=e.priOptions||{},this.player.debug.log(this.TAG_NAME,"【xhrLoader task】, range",this._range),this._url=cn(e.url,e.params);const i=Date.now();return new Promise((s,u)=>{this._loadCompleteResolve=s,this._loadCompleteReject=u,this._startLoad()}).catch(s=>{if(clearTimeout(this._timeoutTimer),this._runing=!1,!this._aborted)throw(s=s instanceof Dt?s:new Dt(this._url,this._request)).startTime=i,s.endTime=Date.now(),s.options={index:this._index,vid:this._vid,priOptions:this._priOptions},s})}_startLoad(){let e=null;if(this._responseType===on&&this._range&&1<this._range.length)if(this._onProgress){this._firstRtt=-1;var i=1024*this._currentChunkSizeKB,s=this._range[0]+this._receivedLength;let u=this._range[1];i<this._range[1]-s&&(u=s+i),e=[s,u],this.player.debug.log(this.TAG_NAME,"[xhr_loader->],tast :",this._range,", SubRange, ",e)}else e=this._range,this.player.debug.log(this.TAG_NAME,"[xhr_loader->],tast :",this._range,", allRange, ",e);this._internalOpen(e)}_internalOpen(e){try{this._startTime=Date.now();const i=this._xhr=new XMLHttpRequest,s=(i.open(this._method||"GET",this._url,!0),i.responseType=this._responseType,this._timeout&&(i.timeout=this._timeout),i.withCredentials=this._withCredentials,i.onload=this._onLoad.bind(this),i.onreadystatechange=this._onReadyStatechange.bind(this),i.onerror=c=>{this._running=!1,c=new Dt(this._url,this._request,c?.currentTarget?.response,"xhr.onerror.status:"+c?.currentTarget?.status+",statusText,"+c?.currentTarget?.statusText),c.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(c)},i.ontimeout=c=>{this.cancel();var l=new Dt(this._url,this._request,{status:408},"timeout");this._onTimeout&&(l.isTimeout=!0,this._onTimeout(l,{index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions})),l.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(l)},this._headers||{}),u=dn(e);u&&(s.Range=u),s&&Object.keys(s).forEach(c=>{i.setRequestHeader(c,s[c])}),this.player.debug.log(this.TAG_NAME,"[xhr.send->] tast,",this._range,",load sub range, ",e),i.send(this._body)}catch(i){i.options={index:this._index,range:e,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(i)}}_onReadyStatechange(e){e.target.readyState===2&&this._firstRtt<0&&(this._firstRtt=Date.now())}_onLoad(e){const i=e.target.status;if(i<200||299<i){const f=new Dt(this._url,null,{...e.target.response,status:i},"bad response,status:"+i);return f.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(f)}let s,u=null,c=!1;var l=0<this._range?.length?this._range[0]:0;if(this._responseType===on){const f=new Uint8Array(e.target.response);if(s=l+this._receivedLength,f&&0<f.byteLength){this._receivedLength+=f.byteLength;const _=Date.now()-this._startTime,g=bs(this._receivedLength,_);this.emit(Ui,{speed:g,len:this._receivedLength,time:_,vid:this._vid,index:this._index,range:[s,l+this._receivedLength],priOptions:this._priOptions})}u=f,c=!(1<this._range?.length&&this._range[1]&&this._receivedLength<this._range[1]-this._range[0]),this.player.debug.log(this.TAG_NAME,"[xhr load done->], tast :",this._range,", start",s,"end ",l+this._receivedLength,",dataLen,",f?f.byteLength:0,",receivedLength",this._receivedLength,",index,",this._index,", done,",c)}else c=!0,u=e.target.response;let o={ok:200<=i&&i<300,status:i,statusText:this._xhr.statusText,url:this._xhr.responseURL,headers:this._getHeaders(this._xhr),body:this._xhr.response};this._transformResponse&&(o=this._transformResponse(o,this._url)||o),this._onProgress&&this._onProgress(u,c,{index:this._index,vid:this._vid,range:[s,l+this._receivedLength],startTime:this._startTime,endTime:Date.now(),priOptions:this._priOptions},o),c?(this._runing=!1,this._loadCompleteResolve&&this._loadCompleteResolve(As(this._onProgress?null:u,c,o,o.headers["content-length"],o.headers.age,this._startTime,this._firstRtt,this._index,this._range,this._vid,this._priOptions))):this._startLoad()}cancel(){if(!this._aborted)return this._aborted=!0,this._runing=!1,super.removeAllListeners(),this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions}),this._xhr?this._xhr.abort():void 0}static isSupported(){return typeof XMLHttpRequest<"u"}get receiveLen(){return this._receivedLength}get running(){return this._running}set running(e){this._running=e}_getHeaders(e){const i=e.getAllResponseHeaders().trim().split(`\r
`),s={};for(const u of i){const c=u.split(": ");s[c[0].toLowerCase()]=c.slice(1).join(": ")}return s}}class di extends Ae{type=Bi;_queue=[];_alive=[];_currentTask=null;_config;constructor(e,i){super(),this.player=i,this._config=(i=e,{loaderType:Bi,retry:0,retryDelay:0,timeout:0,request:null,onTimeout:void 0,onProgress:void 0,onRetryError:void 0,transformRequest:void 0,transformResponse:void 0,transformError:void 0,responseType:"text",range:void 0,url:"",params:void 0,method:"GET",headers:{},body:void 0,mode:void 0,credentials:void 0,cache:void 0,redirect:void 0,referrer:void 0,referrerPolicy:void 0,integrity:void 0,onProcessMinLen:0,...i}),this._config.loaderType!=="xhr"&&vs.isSupported()||(this.type="xhr")}destroy(){this._queue=[],this._alive=[],this._currentTask=null}isFetch(){return this.type===Bi}static isFetchSupport(){return vs.isSupported()}load(e){let i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};return typeof e!="string"&&e?i=e:i.url=e||i.url||this._config.url,(i=Object.assign({},this._config,i)).params&&(i.params=Object.assign({},i.params)),i.headers&&hn(i.headers)&&(i.headers=Object.assign({},i.headers)),i.body&&hn(i.body)&&(i.body=Object.assign({},i.body)),i.transformRequest&&(i=i.transformRequest(i)||i),e=new Po(this.type,i,this.player),e.loader.on(Ui,s=>{this.emit(Ui,s)}),this._queue.push(e),this._queue.length!==1||this._currentTask&&this._currentTask.running||this._processTask(),e.promise}async cancel(){var e=this._queue.map(i=>i.cancel()).concat(this._alive.map(i=>i.cancel()));this._currentTask&&e.push(this._currentTask.cancel()),this._queue=[],this._alive=[],await Promise.all(e),await(function(i){let s=0;return new Promise(u=>setTimeout(u,s))})()}_processTask(){var e;this._currentTask=this._queue.shift(),this._currentTask&&(this._currentTask.alive&&this._alive.push(this._currentTask),e=this._currentTask.exec().catch(i=>{}))&&typeof e.finally=="function"&&e.finally(()=>{this._currentTask?.alive&&0<this._alive?.length&&(this._alive=this._alive.filter(i=>i&&i!==this._currentTask)),this._processTask()})}}const pn="network",fn="network_timeout",_s="other";class tt extends Error{constructor(e,i,s,u,c){super(c||s?.message),this.errorType=e===fn?pn:e,this.originError=s,this.ext=u,this.errorMessage=this.message}static create(e,i,s,u,c){return e instanceof tt?e:(e instanceof Error&&(s=e,e=""),e=e||_s,new tt(e,i,s,u,c))}static network(e){return new tt(e?.isTimeout?fn:pn,null,e instanceof Error?e:null,{url:e?.url,response:e?.response,httpCode:e?.response?.status})}}const Uo=/^#(EXT[^:]*)(?::(.*))?$/,mn=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g,Mo=/^(?:[a-zA-Z0-9+\-.]+:)?\/\//,Fo=/^((?:[a-zA-Z0-9+\-.]+:)?\/\/[^/?#]*)?([^?#]*\/)?/;function gn(D){if(D=D.match(Uo),D&&D[1])return[D[1].replace("EXT-X-",""),D[2]]}function Sr(D){var e={};let i=mn.exec(D);for(;i;)e[i[1]]=i[2]||i[3],i=mn.exec(D);return e}function Mi(D,e){return e&&D&&!Mo.test(D)&&(e=Fo.exec(e))?D[0]==="/"?e[1]+D:e[1]+e[2]+D:D}const Oo={audio:[/^mp4a/,/^vorbis$/,/^opus$/,/^flac$/,/^[ae]c-3$/],video:[/^avc/,/^hev/,/^hvc/,/^vp0?[89]/,/^av1$/],text:[/^vtt$/,/^wvtt/,/^stpp/]};function ws(D,e){var i=Oo[D];if(i&&e&&e.length){for(let s=0;s<i.length;s++)for(let u=0;u<e.length;u++)if(i[s].test(e[u]))return e[u]}}class No{version=0;streams=[];isMaster=!0}class Ss{id=0;url="";default=!1;autoSelect=!1;forced=!1;group="";name="";lang="";segments=[];endSN=0}class jo extends Ss{mediaType="AUDIO";channels=0}class zo extends Ss{mediaType="SUBTITLE"}class Go{id=0;bitrate=0;width=0;height=0;name="";url="";audioCodec="";videoCodec="";textCodec="";audioGroup="";audioStreams=[];subtitleStreams=[];closedCaptionsStream=[]}class Ho{version=0;url="";type="";startCC=0;endCC=0;startSN=0;endSN=0;totalDuration=0;targetDuration=0;live=!0;segments=[]}class Es{sn=0;cc=0;url="";title="";start=0;duration=0;key=null;byteRange=null;isInitSegment=!1;initSegment=null;isLast=!1;hasAudio=!1;hasVideo=!1;get end(){return this.start+this.duration}setTrackExist(e,i){this.hasVideo=e,this.hasAudio=i}setByteRange(e,i){this.byteRange=[0],e=e.split("@"),e.length===1&&i&&i.byteRange?(this.byteRange[0]=i.byteRange[1]||0,this.byteRange[0]&&(this.byteRange[0]+=1)):this.byteRange[0]=parseInt(e[1]),this.byteRange[1]=this.byteRange[0]+parseInt(e[0])-1}}class Er{method="";url="";iv=null;keyFormat="";keyFormatVersions="";constructor(e){e instanceof Er&&(this.method=e.method,this.url=e.url,this.keyFormat=e.keyFormat,this.keyFormatVersions=e.keyFormatVersions,e.iv)&&(this.iv=new Uint8Array(e.iv))}clone(e){var i=new Er(this);return e!=null&&i.setIVFromSN(e),i}setIVFromSN(e){if(!this.iv&&this.method==="AES-128"&&typeof e=="number"&&this.url){this.iv=new Uint8Array(16);for(let i=12;i<16;i++)this.iv[i]=e>>8*(15-i)&255}}}class Fi{static parse(){var e,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"",s=1<arguments.length?arguments[1]:void 0;if(i.includes("#EXTM3U"))return e=i.split(/[\r\n]/).map(u=>u.trim()).filter(Boolean),(Fi.isMediaPlaylist(i)?function(u,c){var l=new Ho;l.url=c;let o,f=new Es,_=null,g=null,T=0,E=0,h=0,k=0,t=!1;for(;(o=u[k++])&&!t;)if(o[0]!=="#")f.sn=E,f.cc=h,f.url=Mi(o,c),g&&(f.key=g.clone(E)),_&&(f.initSegment=_),l.segments.push(f),f=new Es,E++;else{const a=gn(o);if(a){const[d,p]=a;switch(d){case"VERSION":l.version=parseInt(p);break;case"PLAYLIST-TYPE":l.type=p?.toUpperCase();break;case"TARGETDURATION":l.targetDuration=parseFloat(p);break;case"ENDLIST":{const m=l.segments[l.segments.length-1];m&&(m.isLast=!0),l.live=!1,t=!0}break;case"MEDIA-SEQUENCE":E=l.startSN=parseInt(p);break;case"DISCONTINUITY-SEQUENCE":h=l.startCC=parseInt(p);break;case"DISCONTINUITY":h++;break;case"BYTERANGE":f.setByteRange(p,l.segments[l.segments.length-1]);break;case"EXTINF":{const[m,x]=p.split(",");f.start=T,f.duration=parseFloat(m),T+=f.duration,f.title=x}break;case"KEY":{const m=Sr(p);if(m.METHOD==="NONE"){g=null;break}if(m.METHOD!=="AES-128")throw new Error(`encrypt ${m.METHOD}/${m.KEYFORMAT} is not supported`);if((g=new Er).method=m.METHOD,g.url=/^blob:/.test(m.URI)?m.URI:Mi(m.URI,c),g.keyFormat=m.KEYFORMAT||"identity",g.keyFormatVersions=m.KEYFORMATVERSIONS,m.IV){var r=(1&(r=m.IV.slice(2)).length?"0":"")+r;g.iv=new Uint8Array(r.length/2);for(let x=0,b=r.length/2;x<b;x++)g.iv[x]=parseInt(r.slice(2*x,2*x+2),16)}}break;case"MAP":{const m=Sr(p);f.url=Mi(m.URI,c),m.BYTERANGE&&f.setByteRange(m.BYTERANGE),f.isInitSegment=!0,f.sn=0,g&&(f.key=g.clone(0)),_=f,f=new Es}}}}const n=l.segments[l.segments.length-1];return n&&(l.endSN=n.sn),l.totalDuration=T,l.endCC=h,l}:function(u,c){var l=new No;let o,f=0;const _=[],g=[];for(;o=u[f++];){var T=gn(o);if(T){var[T,E]=T;if(T==="VERSION")l.version=parseInt(E);else if(T==="MEDIA"&&E){const k=Sr(E);let t;switch(k.TYPE){case"AUDIO":t=new jo;break;case"SUBTITLES":t=new zo;break;default:t=new Ss}t.url=Mi(k.URI,c),t.default=k.DEFAULT==="YES",t.autoSelect=k.AUTOSELECT==="YES",t.group=k["GROUP-ID"],t.name=k.NAME,t.lang=k.LANGUAGE,k.CHANNELS&&(t.channels=Number(k.CHANNELS.split("/")[0]),Number.isNaN(t.channels))&&(t.channels=0),k.TYPE==="AUDIO"&&k.URI&&_.push(t),k.TYPE==="SUBTITLES"&&g.push(t)}else if(T==="STREAM-INF"&&E){const k=new Go,t=Sr(E);if(k.bitrate=parseInt(t["AVERAGE-BANDWIDTH"]||t.BANDWIDTH),k.name=t.NAME,k.url=Mi(u[f++],c),t.RESOLUTION){const[r,n]=t.RESOLUTION.split("x");k.width=parseInt(r),k.height=parseInt(n)}if(t.CODECS){const r=t.CODECS.split(/[ ,]+/).filter(Boolean);k.videoCodec=ws("video",r),k.audioCodec=ws("audio",r),k.textCodec=ws("text",r)}k.audioGroup=t.AUDIO,k.subtitleGroup=t.SUBTITLES,l.streams.push(k)}}}return l.streams.forEach((h,k)=>{h.id=k}),_.length&&(_.forEach((h,k)=>{h.id=k}),l.streams.forEach(h=>{h.audioGroup&&(h.audioStreams=_.filter(k=>k.group===h.audioGroup))})),g.length&&(g.forEach((h,k)=>{h.id=k}),l.streams.forEach(h=>{h.subtitleGroup&&(h.subtitleStreams=g.filter(k=>k.group===h.subtitleGroup))})),l})(e,s);throw new Error("Invalid m3u8 file")}static isMediaPlaylist(e){return e.includes("#EXTINF:")||e.includes("#EXT-X-TARGETDURATION:")}}class Vo{TAG_NAME="HlsManifestLoader";constructor(i){this.hls=i,this.player=i.player,this._timer=null;var{retryCount:i,retryDelay:s,loadTimeout:u,fetchOptions:c}=this.hls.config;this._loader=new di({...c,responseType:"text",retry:i,retryDelay:s,timeout:u,onRetryError:this._onLoaderRetry},this.player),this._audioLoader=new di({...c,responseType:"text",retry:i,retryDelay:s,timeout:u,onRetryError:this._onLoaderRetry},this.player),this._subtitleLoader=new di({...c,responseType:"text",retry:i,retryDelay:s,timeout:u,onRetryError:this._onLoaderRetry},this.player)}async destroy(){await this.stopPoll(),this._audioLoader&&(this._audioLoader.destroy(),this._audioLoader=null),this._subtitleLoader&&(this._subtitleLoader.destroy(),this._subtitleLoader=null),this._loader&&(this._loader.destroy(),this._loader=null)}async load(e,i,s){this.player.debug.log(this.TAG_NAME,"load()",e,i,s);var u=[this._loader.load(e)];let c,l,o,f,_,g;i&&u.push(this._audioLoader.load(i)),s&&u.push(this._subtitleLoader.load(s));try{const[T,E,h]=await Promise.all(u);if(!T)return[];c=T.data,o=(i?(l=E?.data,h):E)?.data}catch(T){throw tt.network(T)}try{if((f=Fi.parse(c,e))?.live===!1&&f.segments&&!f.segments.length)throw new Error("empty segments list");l&&(_=Fi.parse(l,i)),o&&(g=Fi.parse(o,s))}catch(T){throw new tt("manifest","hls",T)}return f&&(f.isMaster?this.hls.emit("hls-manifest-loaded",{playlist:f}):this.hls.emit("hls-level-loaded",{playlist:f})),[f,_,g]}poll(e,i,s,u,c,l){clearTimeout(this._timer),l=l||3e3;let o=this.hls.config.pollRetryCount;const f=async()=>{clearTimeout(this._timer);try{const _=await this.load(e,i,s);if(!_[0])return;o=this.hls.config.pollRetryCount,u(_[0],_[1],_[2])}catch(_){--o<=0&&c(_)}this._timer=setTimeout(f,l)};this._timer=setTimeout(f,l)}stopPoll(){return clearTimeout(this._timer),this.cancel()}cancel(){return Promise.all([this._loader.cancel(),this._audioLoader.cancel()])}_onLoaderRetry=(e,i)=>{this.hls.emit($s,{error:tt.network(e),retryTime:i})}}class Wo{_chunkSpeeds=[];_speeds=[];addRecord(e,i){e&&i&&(this._speeds.push(8e3*e/i),this._speeds=this._speeds.slice(-3))}addChunkRecord(e,i){e&&i&&(this._chunkSpeeds.push(8e3*e/i),this._chunkSpeeds=this._chunkSpeeds.slice(-100))}getAvgSpeed(){return this._chunkSpeeds.length||this._speeds.length?this._speeds.length?this._speeds.reduce((e,i)=>e+i)/this._speeds.length:this._chunkSpeeds.reduce((e,i)=>e+i)/this._chunkSpeeds.length:0}getLatestSpeed(){return this._chunkSpeeds.length||this._speeds.length?this._speeds.length?this._speeds[this._speeds.length-1]:this._chunkSpeeds[this._chunkSpeeds.length-1]:0}reset(){this._chunkSpeeds=[],this._speeds=[]}}class $o{constructor(i){this.hls=i,this.player=i.player,this._bandwidthService=new Wo;var{retryCount:i,retryDelay:s,loadTimeout:u,fetchOptions:c}=this.hls.config;this._segmentLoader=new di({...c,responseType:"arraybuffer",retry:i,retryDelay:s,timeout:u,onRetryError:this._onLoaderRetry},this.player),this._audioSegmentLoader=new di({...c,responseType:"arraybuffer",retry:i,retryDelay:s,timeout:u,onRetryError:this._onLoaderRetry},this.player),this._keyLoader=new di({...c,responseType:"arraybuffer",retry:i,retryDelay:s,timeout:u,onRetryError:this._onLoaderRetry},this.player)}destroy(){this.reset(),this._keyLoader&&(this._keyLoader.destroy(),this._keyLoader=null),this._audioSegmentLoader&&(this._audioSegmentLoader.destroy(),this._audioSegmentLoader=null),this._segmentLoader&&(this._segmentLoader.destroy(),this._segmentLoader=null)}speedInfo(){return{speed:this._bandwidthService.getLatestSpeed(),avgSpeed:this._bandwidthService.getAvgSpeed()}}load(e,i,s){var u=3<arguments.length&&arguments[3]!==void 0?arguments[3]:s,c=[];return e&&(c[0]=this.loadVideoSegment(e,s)),i&&(c[1]=this.loadAudioSegment(i,u)),Promise.all(c)}loadVideoSegment(e,i){return this._loadSegment(this._segmentLoader,e,i)}loadAudioSegment(e,i){return this._loadSegment(this._audioSegmentLoader,e,i)}async _loadSegment(e,i,T){let u,c,l,o,f;var _=[];if(this.hls.emit(er,{url:i.url}),_[0]=e.load(i.url),T&&i.initSegment){const E=i.initSegment.url,h=((u=this._mapCache[E])||(this.hls.emit(er,{url:E}),_[1]=e.load(E).then(k=>{k&&(30<Object.keys(this._mapCache)&&(this._mapCache={}),u=this._mapCache[E]=k.data,this._emitOnLoaded(k,E))})),i.initSegment.key?.url);h&&(f=i.initSegment.key.iv,(o=this._keyCache[h])||(this.hls.emit(er,{url:h}),_[2]=this._keyLoader.load(h).then(k=>{k&&(o=this._keyCache[h]=k.data,this._emitOnLoaded(k,h))})))}const g=i.key?.url;!g||(l=i.key.iv,c=this._keyCache[g])||(this.hls.emit(er,{url:g}),_[3]=this._keyLoader.load(g).then(E=>{E&&(c=this._keyCache[g]=E.data,this._emitOnLoaded(E,g))}));var[T]=await Promise.all(_);if(T)return e=T.data,this._emitOnLoaded(T,i.url),{data:e,map:u,key:c,mapKey:o,keyIv:l,mapKeyIv:f}}reset(){this.error=null,this._mapCache={},this._keyCache={},this._bandwidthService.reset()}async cancel(){await Promise.all([this._keyLoader.cancel(),this._segmentLoader.cancel(),this._audioSegmentLoader.cancel()])}_emitOnLoaded=(s,i)=>{var{data:s,response:u,option:c}=s,{firstByteTime:c,startTime:l,endTime:f,contentLength:o}=c||{},f=f-l;this._bandwidthService.addRecord(o||s.byteLength,f),this.hls.emit("speed",{time:f,byteLength:o,url:i}),this.hls.emit("load-complete",{url:i,elapsed:f||0}),this.hls.emit("ttfb",{url:i,responseUrl:u.url,elapsed:c-l}),this.hls.emit("load-response-headers",{headers:u.headers})};_onLoaderRetry=(e,i)=>{this.hls.emit($s,{error:tt.network(e),retryTime:i})}}class yn{live=void 0;id=0;bitrate=0;width=0;height=0;name="";url="";audioCodec="";videoCodec="";textCodec="";startCC=0;endCC=0;startSN=0;endSN=-1;totalDuration=0;targetDuration=0;snDiff=null;segments=[];audioStreams=[];subtitleStreams=[];closedCaptions=[];currentAudioStream=null;currentSubtitleStream=null;TAG_NAME="HlsStream";get lastSegment(){return this.segments.length?this.segments[this.segments.length-1]:null}get segmentDuration(){return this.targetDuration||this.segments[0]?.duration||0}get liveEdge(){return this.endTime}get endTime(){return this.lastSegment?.end||0}get currentSubtitleEndSn(){return this.currentSubtitleStream?.endSN||0}constructor(e,i,s){this.update(e,i,s)}clearOldSegment(e,i){return this._clearSegments(e,i)}getAudioSegment(e){if(e&&this.currentAudioStream){const i=e.sn-this.snDiff;return this.currentAudioStream.segments.find(s=>s.sn===i)}}update(e,i){this.url=e.url,Array.isArray(e.segments)?(this.live!==null&&this.live!==void 0||(this.live=e.live),this._updateSegments(e,this),this.startCC=e.startCC,this.endCC=e.endCC,this.startSN=e.startSN,this.endSN=e.endSN||-1,this.totalDuration=e.totalDuration,this.targetDuration=e.targetDuration,this.live=e.live,i&&this.currentAudioStream&&Array.isArray(i.segments)&&(this._updateSegments(i,this.currentAudioStream),this.snDiff===null||this.snDiff===void 0)&&e.segments.length&&i.segments.length&&(this.snDiff=e.segments[0].sn-i.segments[0].sn)):(this.id=e.id,this.bitrate=e.bitrate,this.width=e.width,this.height=e.height,this.name=e.name,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.textCodec=e.textCodec,this.audioStreams=e.audioStreams,this.subtitleStreams=e.subtitleStreams,!this.currentAudioStream&&this.audioStreams.length&&(this.currentAudioStream=this.audioStreams.find(s=>s.default)||this.audioStreams[0]),!this.currentSubtitleStream&&this.subtitleStreams.length&&(this.currentSubtitleStream=this.subtitleStreams.find(s=>s.default)||this.subtitleStreams[0]))}updateSubtitle(e){var i;if(e&&this.currentSubtitleStream&&Array.isArray(e.segments))return e=this._updateSegments(e,this.currentSubtitleStream),100<(i=this.currentSubtitleStream.segments).length&&(this.currentSubtitleStream.segments=i.slice(100)),e?e.map(s=>({sn:s.sn,url:s.url,duration:s.duration,start:s.start,end:s.end,lang:this.currentSubtitleStream.lang})):void 0}switchSubtitle(e){var i=this.subtitleStreams.find(u=>u.lang===e),s=this.currentSubtitleStream;i&&(this.currentSubtitleStream=i,s.segments=[])}_clearSegments(e,i){let s=0;var u=this.segments;for(let c=0,l=u.length;c<l;c++)if(u[c].end>=e){s=c;break}return(s=s>i?i:s)&&(this.segments=this.segments.slice(s),this.currentAudioStream)&&(this.currentAudioStream.segments=this.currentAudioStream.segments.slice(s)),i-s}_updateSegments(e,i){var s=i.segments;if(this.live){const c=s[s.length-1],l=c?.sn||-1;if(l<e.endSN&&e.segments.length){var u=e.segments.findIndex(o=>o.sn===l),u=u<0?e.segments:e.segments.slice(u+1);if(s.length&&u.length){let o=c.end;u.forEach(_=>{_.start=o,o=_.end});const f=c?.cc||-1;f>u[0].cc&&u.forEach(_=>_.cc+=f)}return i.endSN=e.endSN,i.segments=s.concat(u),u}}else i.segments=e.segments}}class Ko{streams=[];currentStream=null;dvrWindow=0;_segmentPointer=-1;TAG_NAME="HlsPlaylist";constructor(e){this.hls=e,this.player=e.player}destroy(){this.reset()}get lastSegment(){return this.currentStream?.lastSegment}get currentSegment(){return this.currentSegments?.[this._segmentPointer]}get nextSegment(){return this.currentSegments?.[this._segmentPointer+1]}get currentSegments(){return this.currentStream?.segments}get currentSubtitleEndSn(){return this.currentStream?.currentSubtitleEndSn}get liveEdge(){return this.currentStream?.liveEdge}get totalDuration(){return this.currentStream?.totalDuration||0}get seekRange(){var e=this.currentSegments;if(e&&e.length)return[e[0].start,e[e.length-1].end]}get isEmpty(){return!this.currentSegments?.length}get isLive(){return this.currentStream?.live}get hasSubtitle(){return!!this.currentStream?.currentSubtitleStream}getAudioSegment(e){return this.currentStream?.getAudioSegment(e)}moveSegmentPointer(e){e==null&&(e=this._segmentPointer+1),this._segmentPointer=ft(e,-1,this.currentSegments?.length),this.player.debug.log(this.TAG_NAME,"moveSegmentPointer()",e,this._segmentPointer)}reset(){this.streams=[],this.currentStream=null,this.dvrWindow=0,this._segmentPointer=-1}getSegmentByIndex(e){return this.currentSegments?.[e]}setNextSegmentByIndex(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0;this._segmentPointer=e-1,this.player.debug.log(this.TAG_NAME,"setNextSegmentByIndex()",e,this._segmentPointer)}findSegmentIndexByTime(e){var i=this.currentSegments;if(i){for(let u,c=0,l=i.length;c<l;c++)if(e>=(u=i[c]).start&&e<u.end)return c;var s=i[i.length-1];if(Math.abs(e-s.end)<.2)return i.length-1}}upsertPlaylist(e,i,s){var u;e?(e.isMaster?(this.streams.length=e.streams.length,e.streams.filter(c=>c.url).forEach((c,l)=>{this.streams[l]?this.streams[l].update(c):this.streams[l]=new yn(c)}),this.currentStream=this.streams[0]):Array.isArray(e.segments)&&((u=this.currentStream)?(u.update(e,i,s),(u=u.updateSubtitle(s))&&this.hls.emit("subtitle-segments",{list:u})):(this.reset(),this.currentStream=this.streams[0]=new yn(e,i,s))),this.currentStream&&this.hls.isLive&&!this.dvrWindow&&(this.dvrWindow=this.currentSegments.reduce((c,l)=>c+l.duration,0))):this.player.debug.warn(this.TAG_NAME,"upsertPlaylist() playlist is null")}switchSubtitle(e){this.currentStream?.switchSubtitle(e)}clearOldSegment(){var e,i,s=0<arguments.length&&arguments[0]!==void 0?arguments[0]:50,u=this.currentStream;this.dvrWindow&&u&&((e=u.endTime-this.dvrWindow)<=0?this.player.debug.log(this.TAG_NAME,`clearOldSegment() stream.endTime:${u.endTime}, this.dvrWindow:${this.dvrWindow}  startTime <= 0`):(i=u.segments).length<=s?this.player.debug.log(this.TAG_NAME,`clearOldSegment() segments.length:${i.length} <= maxPlaylistSize:`+s):(i=this._segmentPointer,this._segmentPointer=u.clearOldSegment(e,i),this.player.debug.log(this.TAG_NAME,"clearOldSegment() update _segmentPointer:",i,this._segmentPointer),this.player.debug.log(this.TAG_NAME,"currentSegments",this.currentSegments)))}checkSegmentTrackChange(e,i){var s=this.findSegmentIndexByTime(e),u=this.getSegmentByIndex(s);if(u&&(u.hasAudio||u.hasVideo))return i!==2&&u.hasAudio&&u.hasVideo?u:.3<u.end-e||!(i=this.getSegmentByIndex(s+1))||!i.hasAudio&&!i.hasVideo||i.hasAudio===u.hasAudio&&i.hasVideo===u.hasVideo?void 0:i}}function Oi(){for(var D=arguments.length,e=new Array(D),i=0;i<D;i++)e[i]=arguments[i];if((e=e.filter(Boolean)).length<2)return e[0];const s=new Uint8Array(e.reduce((c,l)=>c+l.byteLength,0));let u=0;return e.forEach(c=>{s.set(c,u),u+=c.byteLength}),s}class qo{constructor(){var e=window.crypto||window.msCrypto;this.subtle=e&&(e.subtle||e.webkitSubtle),this.externalDecryptor=null}decrypt(e,i){var s;if(e||i)return s=[],e&&(s[0]=this._decryptSegment(e)),i&&(s[1]=this._decryptSegment(i)),Promise.all(s)}async _decryptSegment(e){let i=e.data;return e.key&&(i=await this._decryptData(e.data,e.key,e.keyIv)),e.map?Oi(e.map,i):i}async _decryptData(e,i,s){if(this.externalDecryptor)return this.externalDecryptor.decrypt(e,i,s);if(this.subtle)return i=await this.subtle.importKey("raw",i,{name:"AES-CBC"},!1,["encrypt","decrypt"]),new Uint8Array(await this.subtle.decrypt({name:"AES-CBC",iv:s},i,e));throw new Error("crypto is not defined")}}class jt extends Qt{_pmtId=-1;_remainingPacketData=null;_videoPesData=[];_audioPesData=[];_gopId=0;_videoPid=-1;_audioPid=-1;_codecType=7;_audioCodecType=Je;_vps=null;_sps=null;_pps=null;TAG_NAME="TsLoader";constructor(e){super(e),this.player=e,this.videoTrack=jt.initVideoTrack(),this.audioTrack=jt.initAudioTrack(),this._baseDts=-1,this._baseDtsInited=!1,this._basefps=25,this._baseFpsInterval=null,this._allSampleList=[],this._tempSampleTsList=[],this._hasAudio=!1,this._hasVideo=!1,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=!1,this._videoTimestampBreak=!1,this._lastAudioExceptionGapDot=0,this._lastAudioExceptionOverlapDot=0,this._lastAudioExceptionLargeGapDot=0,this._isSendAACSeqHeader=!1,this.player.debug.log(this.TAG_NAME,"init")}destroy(){super.destroy(),this._stopDecodeLoopInterval(),this.videoTrack=null,this.audioTrack=null,this._baseDts=-1,this._baseDtsInited=!1,this._basefps=50,this._hasCalcFps=!1,this._allSampleList=[],this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=!1,this._videoTimestampBreak=!1,this._lastAudioExceptionGapDot=0,this._lastAudioExceptionOverlapDot=0,this._lastAudioExceptionLargeGapDot=0,this._isSendAACSeqHeader=!1,this.player.debug.log(this.TAG_NAME,"destroy")}static initVideoTrack(){return{samples:[]}}static initAudioTrack(){return{samples:[]}}static probe(e){return!!e.length&&e[0]===71&&e[188]===71&&e[376]===71}static _parsePES(e){var i=e[8];if(!(i==null||e.length<i+9)&&(e[0]<<16|e[1]<<8|e[2])==1){var s=(e[4]<<8)+e[5];if(!(s&&s>e.length-6)){let u,c;return s=e[7],192&s&&(u=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,64&s?(c=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2,54e5<u-c&&(u=c)):c=u),{data:e.subarray(9+i),pts:u,dts:c,originalPts:u,originalDts:c}}}}_demux(e){let i=1<arguments.length&&arguments[1]!==void 0&&arguments[1],s=!(2<arguments.length&&arguments[2]!==void 0)||arguments[2],u=(i&&(this._pmtId=-1,this.videoTrack=jt.initVideoTrack(),this.audioTrack=jt.initAudioTrack()),!s||i?(this._remainingPacketData=null,this._videoPesData=[],this._audioPesData=[]):(this.videoTrack.samples=[],this.audioTrack.samples=[],this._remainingPacketData&&(e=Oi(this._remainingPacketData,e),this._remainingPacketData=null)),e.length);var c=u%188;c&&(this._remainingPacketData=e.subarray(u-c),u-=c);for(let l=0;l<u;l+=188){if(e[l]!==71)throw new Error("TS packet did not start with 0x47");const o=!!(64&e[l+1]),f=((31&e[l+1])<<8)+e[l+2];let _;if(1<(48&e[l+3])>>4){if((_=l+5+e[l+4])===l+188)continue}else _=l+4;switch(f){case 0:o&&(_+=e[_]+1),this._pmtId=(31&e[_+10])<<8|e[_+11];break;case this._pmtId:{o&&(_+=e[_]+1);const g=_+3+((15&e[_+1])<<8|e[_+2])-4;for(_+=12+((15&e[_+10])<<8|e[_+11]);_<g;){const T=(31&e[_+1])<<8|e[_+2];switch(e[_]){case 15:this._audioPid=T,this._audioCodecType=Je;break;case 27:this._videoPid=T,this._codecType=7;break;case 36:this._videoPid=T,this._codecType=12;break;default:console.warn(`Unsupported stream. type: ${e[_]}, pid: `+T)}_+=5+((15&e[_+3])<<8|e[_+4])}}break;case this._videoPid:o&&this._videoPesData.length&&this._parseVideoData(),this._videoPesData.push(e.subarray(_,l+188));break;case this._audioPid:o&&this._audioPesData.length&&this._parseAudioData(),this._audioPesData.push(e.subarray(_,l+188));break;case 17:case 8191:break;default:console.warn("Unknown pid: "+f)}}this._parseVideoData(),this._parseAudioData(),this.audioTrack.formatTimescale=this.videoTrack.formatTimescale=this.videoTrack.timescale=9e4,this.audioTrack.timescale=this.audioTrack.sampleRate||0}demuxAndFix(e,i,s,u){this.player._times.demuxStart||(this.player._times.demuxStart=be()),this._demux(e,i,s,u),this._fix(u,i,s)}_parseVideoData(){var e,i;this._videoPesData.length?(e=jt._parsePES(Oi(...this._videoPesData)))?(this.player.updateStats({vbps:e.data.byteLength}),(i=(function(s){var u=s.length;let c=2,l=0;for(;s[c]!==null&&s[c]!==void 0&&s[c]!==1;)c++;if(c++,(l=c+2)>=u)return[];for(var o=[];l<u;)switch(s[l]){case 0:if(s[l-1]!==0)l+=2;else if(s[l-2]!==0)l++;else{for(c!==l-2&&o.push(s.subarray(c,l-2));s[++l]!==1&&l<u;);c=l+1,l=c+2}break;case 1:s[l-1]!==0||s[l-2]!==0?l+=3:(c!==l-2&&o.push(s.subarray(c,l-2)),c=l+1,l=c+2);break;default:l+=3}return c<u&&o.push(s.subarray(c)),o})(e.data))?this._createVideoSample(i,e.pts,e.dts):this.player.debug.warn(this.TAG_NAME,"Cannot parse avc units",e),this._videoPesData=[]):console.warn("Cannot parse video pes",this._videoPesData):console.log("_parseVideoData","no video pes data")}_createVideoSample(e,i,s){if(e.length){const u=this._codecType===12,c={isIFrame:!1,type:2,isHevc:u,vps:null,sps:null,pps:null,sei:null,pts:i,dts:s,payload:null};e.forEach(o=>{const f=u?o[0]>>>1&63:31&o[0];switch(f){case 5:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:!u&&f!==5||u&&f===5||(c.isIFrame=!0,this._gopId++);break;case 6:case 39:case 40:if(!u&&f!==6||u&&f===6)break;return void(c.sei=(function(_,g){var T=_.length;let E=g?2:1,h=0,k=0,t="";for(;_[E]===255;)h+=255,E++;for(h+=_[E++];_[E]===255;)k+=255,E++;if(k+=_[E++],h===5&&T>E+16)for(let r=0;r<16;r++)t+=_[E].toString(16),E++;return{payload:_.subarray(E),type:h,size:k,uuid:t}})((function(_){var g=_.byteLength,T=[];let E=1;for(;E<g-2;)_[E]===0&&_[E+1]===0&&_[E+2]===3?(T.push(E+2),E+=2):E++;if(!T.length)return _;var h=g-T.length,k=new Uint8Array(h);let t=0;for(E=0;E<h;t++,E++)t===T[0]&&(t++,T.shift()),k[E]=_[t];return k})(o),u));case 32:!u||c.vps||(c.vps=o);break;case 7:case 33:!u&&f!==7||u&&f===7||c.sps||(c.sps=o);break;case 8:case 34:!u&&f!==8||u&&f===8||c.pps||(c.pps=o)}if(u&&Fa(f)||!u&&Qr(f)){const _=Jr(o);if(c.payload){this.player.debug.log(this.TAG_NAME,"append nal unit to payload");const g=new Uint8Array(c.payload.byteLength+_.byteLength);g.set(c.payload,0),g.set(_,c.payload.byteLength),c.payload=g}else c.payload=_}});let l=null;u?c.sps&&c.vps&&c.pps&&(l=Ua({vps:c.vps,sps:c.sps,pps:c.pps})):c.sps&&c.pps&&(l=Ia({sps:c.sps,pps:c.pps})),l&&(this.player.debug.log(this.TAG_NAME,"_createVideoSample","seqHeader"),this._doDecodeByHls(l,2,c.pts,!0,0)),c.isIFrame&&this.calcIframeIntervalTimestamp(c.dts/90),this.videoTrack.samples=this.videoTrack.samples.concat(c)}}_parseAudioData(){if(this._audioPesData.length){const i=jt._parsePES(Oi(...this._audioPesData));if(i){if(this.player._opt.hasAudio){if(this.player.updateStats({abps:i.data.byteLength}),this._audioCodecType===Je){var e=(function(s,u){var c=s.length;let l=0;for(;l+2<c&&(s[l]!==255||(246&s[l+1])!=240);)l++;if(!(l>=c)){var o=l,f=[],_=(60&s[l+2])>>>2,g=Ys[_];if(!g)throw new Error("Invalid sampling index: "+_);var T=1+((192&s[l+2])>>>6),E=(1&s[l+2])<<2|(192&s[l+3])>>>6;let k,t,r=0;for(var h=Js(g);l+7<c;)if(s[l]===255&&(246&s[l+1])==240){if(t=(3&s[l+3])<<11|s[l+4]<<3|(224&s[l+5])>>5,c-l<t)break;k=2*(1&~s[l+1]),f.push({pts:u+r*h,data:s.subarray(l+7+k,l+t)}),r++,l+=t}else l++;return{skip:o,remaining:l>=c?void 0:s.subarray(l),frames:f,samplingFrequencyIndex:_,sampleRate:g,objectType:T,channelCount:E,originCodec:"mp4a.40."+T}}})(i.data,i.originalPts);if(e){if(this.audioTrack.codec=e.codec,this.audioTrack.sampleRate=e.sampleRate,this.audioTrack.channelCount=e.channelCount,!this._isSendAACSeqHeader){const s=Ks({profile:e.objectType,sampleRate:e.samplingFrequencyIndex,channel:e.channelCount});this._isSendAACSeqHeader=!0,this.player.debug.log(this.TAG_NAME,"aac seq header",`profile: ${e.objectType}, sampleRate:${e.sampleRate},sampleRateIndex: ${e.samplingFrequencyIndex}, channel: `+e.channelCount),this._doDecodeByHls(s,1,0,!1,0)}if(this._isSendAACSeqHeader){const s=[];e.frames.forEach(o=>{var c=o.pts,l=new Uint8Array(o.data.length+2),o=(l.set([175,1],0),l.set(o.data,2),{type:1,pts:c,dts:c,payload:l});s.push(o)}),this.audioTrack.samples=this.audioTrack.samples.concat(s)}else this.player.debug.warn(this.TAG_NAME,"aac seq header not send")}else this.player.debug.warn(this.TAG_NAME,"aac parseADTS error")}this._audioPesData=[]}}else console.warn("Cannot parse audio pes",this._audioPesData)}}_fix(){let e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,i=1<arguments.length&&arguments[1]!==void 0&&arguments[1],s=!(2<arguments.length&&arguments[2]!==void 0)||arguments[2];e=Math.round(9e4*e);var u=this.videoTrack,c=this.audioTrack,l=u.samples,o=c.samples;if(l.length||o.length){var f=l[0],_=o[0];let g=0;if(l.length&&o.length&&(g=f.dts-_.pts),this._baseDtsInited||this._calculateBaseDts(),i&&(this._calculateBaseDts(),this._baseDts-=e),!s){this._videoNextDts=0<g?e+g:e,this._audioNextPts=0<g?e:e-g;const E=f?f.dts-this._baseDts-this._videoNextDts:0,h=_?_.pts-this._baseDts-this._audioNextPts:0;9e4<Math.abs(E||h)&&(this._calculateBaseDts(this.audioTrack,this.videoTrack),this._baseDts-=e)}this._resetBaseDtsWhenStreamBreaked(),this._fixAudio(c),this._fixVideo(u);let T=u.samples.concat(c.samples);T=T.map(E=>(E.dts=E.dts/90,E.pts=E.pts/90,E.cts=E.pts-E.dts,E)).sort((E,h)=>E.dts-h.dts),this._allSampleList=this._allSampleList.concat(T),_e(this._hasCalcFps)&&(this._hasCalcFps=!0,this._calcDecodeFps(T))}}_calculateBaseDts(){var e=this.audioTrack,i=this.videoTrack,s=e.samples,u=i.samples;if(!s.length&&!u.length)return!1;let c=1/0,l=1/0;return s.length&&(e.baseDts=c=s[0].pts),u.length&&(i.baseDts=l=u[0].dts),this._baseDts=Math.min(c,l),e=l-c,Number.isFinite(e)&&45e3<Math.abs(e)&&this.player.debug.warn(this.TAG_NAME,`large av first frame gap,
                video pts: ${l},
                audio pts: ${c},
                base dts: ${this._baseDts},
                detect is: `+e),this._baseDtsInited=!0}_resetBaseDtsWhenStreamBreaked(){this._baseDtsInited&&this._videoTimestampBreak&&this._audioTimestampBreak&&this._calculateBaseDts(this.audioTrack,this.videoTrack)&&(this._baseDts-=Math.min(this._audioNextPts,this._videoNextDts),this._audioLastSample=null,this._videoLastSample=null,this._videoTimestampBreak=!1,this._audioTimestampBreak=!1)}_fixAudio(e){var i=e.samples;i.length&&(i.forEach(s=>{s.pts-=this._baseDts,s.dts=s.pts}),this._doFixAudioInternal(e,i,9e4))}_fixVideo(e){var i=e.samples;if(i.length){if(i.forEach(T=>{T.dts-=this._baseDts,T.pts-=this._baseDts}),this._videoNextDts===void 0){const T=i[0];this._videoNextDts=T.dts}const l=i.length;let o=0;const f=i[0],_=i[1],g=this._videoNextDts-f.dts;45e3<Math.abs(g)&&(f.dts+=g,f.pts+=g,this.player.debug.warn(this.TAG_NAME,`large video gap between chunk,
             next dts is ${this._videoNextDts},
             first dts is ${f.dts},
             next dts is ${_.dts},
             duration is `+g),_)&&9e4<Math.abs(_.dts-f.dts)&&(this._videoTimestampBreak=!0,i.forEach((T,E)=>{E!==0&&(T.dts+=g,T.pts+=g)}));var s=e.samples[0],u=e.samples[l-1],c=l===1?9e3:Math.floor((u.dts-s.dts)/(l-1));for(let T=0;T<l;T++){const E=i[T].dts,h=i[T+1];if(9e4<(o=T<l-1?h.dts-E:i[T-1]?Math.min(E-i[T-1].dts,c):c)||o<0){this._videoTimestampBreak=!0,o=this._audioTimestampBreak?c:Math.max(o,2700);const k=this._audioNextPts||0;h&&h.dts>k&&(o=c),this.player.debug.warn(this.TAG_NAME,`large video gap between frames,
                time is ${E/e.timescale},
                dts is ${E},
                origin dts is ${i[T].originalDts},
                next dts is ${this._videoNextDts},
                sample Duration is ${o} ,
                ref Sample DurationInt is `+c)}i[T].duration=o,this._videoNextDts+=o}}}_doFixAudioInternal(e,i,s){e.sampleDuration||(e.sampleDuration=Js(e.timescale,s));var u,c,l=e.sampleDuration;if(this._audioNextPts===void 0){const T=i[0];this._audioNextPts=T.pts}for(let T=0;T<i.length;T++){var o=this._audioNextPts,f=i[T],_=f.pts-o;if(!this._audioTimestampBreak&&3*l<=_&&_<=9e4&&!Mr()){u=e.codec,c=e.channelCount,(u==="mp4a.40.2"?c===1?new Uint8Array([0,200,0,128,35,128]):c===2?new Uint8Array([33,0,73,144,2,25,0,35,128]):c===3?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]):c===4?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]):c===5?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]):c===6&&new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]):c===1?new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]):(c===2||c===3)&&new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]))||i[0].data.subarray();var g=Math.floor(_/l);45e4<Math.abs(f.pts-this._lastAudioExceptionGapDot)&&(this._lastAudioExceptionGapDot=f.pts),this.player.debug.warn(this.TAG_NAME,`audio gap detected,
                pts is ${i.pts},
                originPts is ${i.originalPts},
                count is ${g},
                nextPts is ${o},
                ref sample duration is `+l);for(let E=0;E<g;E++)this._audioNextPts+=l,T++;T--}else _<=-3*l&&-9e4<=_?(45e4<Math.abs(f.pts-this._lastAudioExceptionOverlapDot)&&(this._lastAudioExceptionOverlapDot=f.pts,this.player.debug.warn(this.TAG_NAME,`audio overlap detected,
                    pts is ${f.pts},
                    originPts is ${f.originalPts},
                    nextPts is ${o},
                    ref sample duration is `+l)),i.splice(T,1),T--):(9e4<=Math.abs(_)&&(this._audioTimestampBreak=!0,45e4<Math.abs(f.pts-this._lastAudioExceptionLargeGapDot))&&(this._lastAudioExceptionLargeGapDot=f.pts,this.player.debug.warn(this.TAG_NAME,`large audio gap detected,
                        time is ${f.pts/1e3}
                        pts is ${f.pts},
                        originPts is ${f.originalPts},
                        nextPts is ${o},
                        sample duration is ${_}
                        ref sample duration is `+l)),f.dts=f.pts=o,this._audioNextPts+=l)}}_calcDecodeFps(e){e=fa(e.map(i=>({ts:i.dts||i.pts,type:i.type})),2),e&&(this._basefps=e,this._startDecodeLoopInterval(),this.player.debug.log(this.TAG_NAME,`_calcDecodeFps()  video fps is ${e}, update base fps is `+this._basefps))}_startDecodeLoopInterval(){this.player.debug.log(this.TAG_NAME,"_startDecodeLoopInterval()"),this._stopDecodeLoopInterval(),this._loop();var e=Math.ceil(1e3/this._basefps);this._baseFpsInterval=setInterval(()=>{var i=new Date().getTime(),i=(this.preLoopTimestamp||(this.preLoopTimestamp=i),i-this.preLoopTimestamp);i>2*this._basefps&&this.player.debug.warn(this.TAG_NAME,`hls loop demux diff time is ${i} and more than `+2*this._basefps),this._loop(),this.preLoopTimestamp=new Date().getTime()},e)}_loop(){let e=null;if(this._allSampleList.length)if((e=this._allSampleList.shift()).type===2){this._doDecodeVideo(e);let i=this._allSampleList[0];for(;i&&i.type===1;)e=this._allSampleList.shift(),this._doDecodeAudio(e),i=this._allSampleList[0]}else e.type===1&&(this._doDecodeAudio(e),this._allSampleList.length)&&this._allSampleList[0].type===2&&(e=this._allSampleList.shift(),this._doDecodeVideo(e))}_doDecodeAudio(e){this._doDecodeByHls(e.payload,1,e.dts,!1,0)}_doDecodeVideo(e){var i=new Uint8Array(e.payload),i=(e.isHevc?Ma:Yr)(i,e.isIFrame),s=(this.player.updateStats({dts:e.dts}),e.pts-e.dts);this._doDecodeByHls(i,2,e.dts,e.isIFrame,s)}_stopDecodeLoopInterval(){this._baseFpsInterval&&(clearInterval(this._baseFpsInterval),this._baseFpsInterval=null)}getBuferredDuration(){let e=0;return this._allSampleList&&this._allSampleList.forEach(i=>{i.duration&&i.type===2&&(e+=i.duration)}),e/90}getSampleListLength(){return this._allSampleList.length}getSampleAudioListLength(){return this._allSampleList.filter(e=>e.type===1).length}getSampleVideoListLength(){return this._allSampleList.filter(e=>e.type===2).length}}class Yo{_initSegmentId="";TAG_NAME="HlsTransmuxer";constructor(e,i,s){this.hls=e,this.player=this.hls.player,this._demuxer=new(i?Za:jt)(this.hls.player),this._isMP4=i,s&&console.log("hls needRemux")}destroy(){this._demuxer&&(this._demuxer.destroy(),this._demuxer=null)}transmux(e,i,s,u,c,l){this.player.debug.log(this.TAG_NAME,`transmux videoChunk:${e&&e.byteLength}, audioChunk:${i&&i.byteLength}, discontinuity:${s}, contiguous:${u}, startTime:${c}, needInit:`+l),l=this._demuxer;try{this._isMP4?l.demux(e,i):l.demuxAndFix(Oi(e,i),s,u,c)}catch(o){throw new tt("demux","hls",o)}}}class Jo{_decryptor=new qo;_transmuxer=null;_mse=null;_softVideo=null;_sourceCreated=!1;_needInitSegment=!0;_directAppend=!1;TAG_NAME="HlsBufferService";constructor(e){this.hls=e,this.player=e.player}async destroy(){this._softVideo=null,this._transmuxer&&(this._transmuxer.destroy(),this._transmuxer=null)}get baseDts(){return this._transmuxer?._demuxer?._baseDts}get nbSb(){return 0}async updateDuration(e){this.player.debug.log(this.TAG_NAME,"updateDuration()",e)}getBuferredDuration(){return this._transmuxer?._demuxer?.getBuferredDuration()}getBufferedSegments(){return this._transmuxer?._demuxer?.getSampleListLength()}getBufferedAudioSegments(){return this._transmuxer?._demuxer?.getSampleAudioListLength()}getBufferedVideoSegments(){return this._transmuxer?._demuxer?.getSampleVideoListLength()}createSource(e,i,s,u){this._sourceCreated||(e=e||i)&&(jt.probe(e)?this._transmuxer||(this._transmuxer=new Yo(this.hls,!1,!this._softVideo)):console.error("createSource error: chunk is not ts"))}async appendBuffer(e,i,s,u,c,l,o){if(s?.length||u?.length)return this._needInitSegment,this._transmuxer.transmux(s,u,c,l,o,this._needInitSegment||c),!0}async clearAllBuffer(){this.player.debug.log(this.TAG_NAME,"clearAllBuffer")}decryptBuffer(e,i){return this._decryptor.decrypt(e,i)}async reset(){this._transmuxer=null,this._needInitSegment=!0,this._directAppend=!1}async endOfStream(){this._softVideo&&this._softVideo.endOfStream()}async setLiveSeekableRange(e,i){}seamlessSwitch(){this._needInitSegment=!0}}class Qo{_seiSet=new Set;constructor(e){(this.emitter=e).on("sei",i=>{i&&this._seiSet.add(i)})}throw(e){if(e!=null&&this._seiSet.size){const i=e-.2,s=e+.2,u=[];this._seiSet.forEach(c=>{c.time>=i&&c.time<=s&&u.push(c)}),u.forEach(c=>{this._seiSet.delete(c),this.emitter.emit("sei-in-time",c)})}}reset(){this._seiSet.clear()}}class An{encodeType="";audioCodec="";videoCodec="";domain="";fps=0;bitrate=0;width=0;height=0;samplerate=0;channelCount=0;gop=0;_bitsAccumulateSize=0;_bitsAccumulateDuration=0;constructor(e){this._timescale=e}getStats(){return{encodeType:this.encodeType,audioCodec:this.audioCodec,videoCodec:this.videoCodec,domain:this.domain,fps:this.fps,bitrate:this.bitrate,width:this.width,height:this.height,samplerate:this.samplerate,channelCount:this.channelCount,gop:this.gop}}setEncodeType(e){this.encodeType=e}setFpsFromScriptData(e){e=e.data,e=e?.onMetaData?.framerate,e&&0<e&&e<100&&(this.fps=e)}setVideoMeta(e){this.width=e.width,this.height=e.height,this.videoCodec=e.codec,this.encodeType=e.codecType,e.fpsNum&&e.fpsDen&&0<(e=e.fpsNum/e.fpsDen)&&e<100&&(this.fps=e)}setAudioMeta(e){this.audioCodec=e.codec,this.samplerate=e.sampleRate,this.channelCount=e.channelCount}setDomain(e){this.domain=e.split("/").slice(2,3)[0]}updateBitrate(e){var i;(!this.fps||100<=this.fps)&&e.length&&(i=e.reduce((s,u)=>s+u.duration,0)/e.length,this.fps=Math.round(this._timescale/i)),e.forEach(s=>{s.gopId===1&&this.gop++,this._bitsAccumulateDuration+=s.duration/(this._timescale/1e3),this._bitsAccumulateSize+=s.units.reduce((u,c)=>u+c.length,0),1e3<=this._bitsAccumulateDuration&&(this.bitrate=8*this._bitsAccumulateSize,this._bitsAccumulateDuration=0,this._bitsAccumulateSize=0)})}}class Xo{_core=null;_samples=[];constructor(e){var i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1e3;this._core=e,this._timescale=i,this._stats=new An(i),this._bindEvents()}getStats(){var{currentTime:e=0,decodeFps:i=0}=this._core?.media||{};return{...this._stats.getStats(),downloadSpeed:this._core?.speedInfo?.().speed||0,avgSpeed:this._core?.speedInfo?.().avgSpeed||0,currentTime:e,bufferEnd:this._core?.bufferInfo()?.remaining||0,decodeFps:i}}_bindEvents(){this._core.on("demuxed-track",e=>this._stats.updateBitrate(e.samples)),this._core.on("flv-script-data",e=>{this._stats.setFpsFromScriptData(e)}),this._core.on("metadata-parsed",e=>{e.type==="video"?this._stats.setVideoMeta(e.track):this._stats.setAudioMeta(e.track)}),this._core.on("ttfb",e=>{this._stats.setDomain(e.responseUrl)})}reset(){this._samples=[],this._stats=new An(this._timescale)}}class Zo extends Ae{config=null;_manifestLoader=null;_segmentLoader=null;_playlist=null;_bufferService=null;_seiService=null;_stats=null;_prevSegSn=null;_prevSegCc=null;_tickTimer=null;_tickInterval=500;_segmentProcessing=!1;_reloadOnPlay=!1;_switchUrlOpts=null;_disconnectTimer=null;TAG_NAME="Hls256";constructor(e){var i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};super(),this.player=e,this.canVideoPlay=!1,this.$videoElement=null,this.config={isLive:!0,maxPlaylistSize:50,retryCount:3,retryDelay:1e3,pollRetryCount:2,loadTimeout:1e4,preloadTime:30,softDecode:!1,bufferBehind:10,maxJumpDistance:3,startTime:0,targetLatency:10,maxLatency:20,allowedStreamTrackChange:!0,...i},this._manifestLoader=new Vo(this),this._segmentLoader=new $o(this),this._playlist=new Ko(this),this._bufferService=new Jo(this),this._seiService=new Qo(this),this._stats=new Xo(this,9e4),this.player.debug.log(this.TAG_NAME,"init")}async destroy(){this.player.debug.log(this.TAG_NAME,"destroy()"),this._playlist.reset(),this._segmentLoader.reset(),this._seiService.reset(),await Promise.all([this._clear(),this._bufferService.destroy()]),this._manifestLoader&&(await this._manifestLoader.destroy(),this._manifestLoader=null),this._segmentLoader&&(this._segmentLoader.destroy(),this._segmentLoader=null),this._playlist&&(this._playlist.destroy(),this._playlist=null),this.player.debug.log(this.TAG_NAME,"destroy end")}_startTick(){this._stopTick(),this._tickTimer=setTimeout(()=>{this._tick()},this._tickInterval)}_stopTick(){this._tickTimer&&clearTimeout(this._tickTimer),this._tickTimer=null}_tick(){this._startTick(),this._loadSegment()}get isLive(){return this._playlist.isLive}get streams(){return this._playlist.streams}get currentStream(){return this._playlist.currentStream}get hasSubtitle(){return this._playlist.hasSubtitle}get baseDts(){return this._bufferService?.baseDts}speedInfo(){return this._segmentLoader.speedInfo()}getStats(){return this._stats.getStats()}async loadSource(e){return this.player.debug.log(this.TAG_NAME,"loadSource() "+e),await this._reset(),await this._loadData(e),this._startTick(),!0}async _loadData(e){this.player.debug.log(this.TAG_NAME,"_loadData() "+e);try{e=e&&e.trim()}catch{}if(!e)throw this._emitError(new tt(_s,_s,null,null,"m3u8 url is missing"));const i=await this._loadM3U8(e),s=this._playlist.currentStream;if(this._urlSwitching){s.bitrate===0&&this._switchUrlOpts?.bitrate&&(s.bitrate=this._switchUrlOpts?.bitrate);const u=this._getSeamlessSwitchPoint(),c=(this.config.startTime=u,this._playlist.findSegmentIndexByTime(u)),l=this._playlist.getSegmentByIndex(c+1);if(l){const o=l.start;this.player.debug.warn(this.TAG_NAME,"clear buffer from "+o)}}i&&(this.isLive?(this.player.debug.log(this.TAG_NAME,"is live"),this._bufferService.setLiveSeekableRange(0,4294967295),this.config.targetLatency<this._playlist.totalDuration&&(this.config.targetLatency=this._playlist.totalDuration,this.config.maxLatency=1.5*this.config.targetLatency),i.isMaster||this._pollM3U8(e)):(this.player.debug.log(this.TAG_NAME,`is vod and totalDuration is ${s.totalDuration} s`),await this._bufferService.updateDuration(s.totalDuration))),await this._loadSegment()}async _loadM3U8(e){let i;this.player.debug.log(this.TAG_NAME,"load m3u8: "+e);try{[i]=await this._manifestLoader.load(e)}catch(s){throw this._emitError(tt.create(s))}if(i)return this._playlist.upsertPlaylist(i),i.isMaster?(this._playlist.currentStream.subtitleStreams?.length&&this.emit("subtitle-playlist",{list:this._playlist.currentStream.subtitleStreams}),await this._refreshM3U8()):this.player.debug.warn(this.TAG_NAME,"_loadM3U8() is not master playlist"),this.emit("stream-parsed"),i;this.player.debug.warn(this.TAG_NAME,"_loadM3U8() playlist is empty")}_refreshM3U8(){this.player.debug.log(this.TAG_NAME,"_refreshM3U8()");var e=this._playlist.currentStream;if(!e||!e.url)throw this._emitError(tt.create(null,null,new Error("m3u8 url is not defined")));const i=e.url,s=e.currentAudioStream?.url,u=e.currentSubtitleStream?.url;return this._manifestLoader.load(i,s,u).then(l=>{var[l,o,f]=l;l?(this._playlist.upsertPlaylist(l,o,f),this.isLive&&this._pollM3U8(i,s,u)):this.player.debug.warn(this.TAG_NAME,"_refreshM3U8() mediaPlaylist is empty")}).catch(c=>{throw this._emitError(tt.create(c))})}_pollM3U8(e,i,s){let u=this._playlist.isEmpty;this._manifestLoader.poll(e,i,s,(c,l,o)=>{this._playlist.upsertPlaylist(c,l,o),this._playlist.clearOldSegment(),c&&u&&!this._playlist.isEmpty&&this._loadSegment(),u=u&&this._playlist.isEmpty},c=>{this._emitError(tt.create(c))},1e3*(this._playlist.lastSegment?.duration||0))}_loadSegment=async()=>{var e,i;if(this.player.debug.log(this.TAG_NAME,"_loadSegment()","_segmentProcessing",this._segmentProcessing),!this._segmentProcessing)return e=this._playlist.currentSegment,i=this._playlist.nextSegment,this.player.debug.log(this.TAG_NAME,"_loadSegment()","curSeg",e,"nextSeg",i),i?this._loadSegmentDirect():void this.player.debug.log(this.TAG_NAME,"nextSeg is null and return");this.player.debug.warn("_loadSegment()","_segmentProcessing is ture and return")};async _loadSegmentDirect(){this.player.debug.log(this.TAG_NAME,"_loadSegmentDirect()");var e=this._playlist.nextSegment;if(e){let i=!1,s=null;try{this._segmentProcessing=!0,i=await this._reqAndBufferSegment(e,this._playlist.getAudioSegment(e))}catch(u){s=u}finally{this._segmentProcessing=!1}return s?this._emitError(tt.create(s)):(i?(this._urlSwitching&&(this._urlSwitching=!1,this.emit("switch-url-success",{url:this.config.url})),this._playlist.moveSegmentPointer(),this.player.debug.log(this.TAG_NAME,"_loadSegmentDirect()","seg.isLast",e.isLast),e.isLast?(this.player.debug.log(this.TAG_NAME,"_loadSegmentDirect()","seg.isLast"),this._end()):(this.player.debug.log(this.TAG_NAME,"_loadSegmentDirect()","and next _loadSegment()"),this._loadSegment())):this.player.debug.log(this.TAG_NAME,"_loadSegmentDirect() not appended"),i)}this.player.debug.log(this.TAG_NAME,"_loadSegmentDirect() !seg")}async _reqAndBufferSegment(e,i){this.player.debug.log(this.TAG_NAME,"video seg",e&&e.url,"audio seg",i&&i.url);var s=(e||i).cc,u=this._prevSegCc!==s;let c=[];try{c=await this._segmentLoader.load(e,i,u)}catch(g){throw g.fatal=!1,this._segmentLoader.error=g}if(c[0]){var l,o,f,_=await this._bufferService.decryptBuffer(...c);if(_)return l=(e||i).sn,o=(e||i).start,f=this._playlist.currentStream,this._bufferService.createSource(_[0],_[1],f?.videoCodec,f?.audioCodec),await this._bufferService.appendBuffer(e,i,_[0],_[1],u,this._prevSegSn===l-1,o),this._prevSegCc=s,this._prevSegSn=l,!0;this.player.debug.log(this.TAG_NAME,"decryptBuffer return null")}}async _clear(){this.player.debug.log(this.TAG_NAME,"_clear()"),clearTimeout(this._disconnectTimer),this._stopTick(),await Promise.all([this._segmentLoader.cancel(),this._manifestLoader.stopPoll()]),this._segmentProcessing=!1}async _reset(){var e=0<arguments.length&&arguments[0]!==void 0&&arguments[0];return this.player.debug.log(this.TAG_NAME,"_reset()"),this._reloadOnPlay=!1,this._prevSegSn=null,this._prevSegCc=null,this._switchUrlOpts=null,this._playlist.reset(),this._segmentLoader.reset(),this._seiService.reset(),this._stats.reset(),await this._clear(),this._bufferService.reset(e)}_end(){this.player.debug.log(this.TAG_NAME,"_end()"),this._clear()}_emitError(e){var i=1<arguments.length&&arguments[1]!==void 0&&arguments[1];return e.originError?.fatal===!1?console.warn(e):(console.table(e),console.error(e),console.error(this.media?.error),this._stopTick(),this._urlSwitching&&(this._urlSwitching=!1,this.emit("switch-url-failed",e)),i&&this._end(),this._seiService.reset(),this.emit("error",e)),e}_getSeamlessSwitchPoint(){var e,i=this.media;let s=i.currentTime;return i.paused||(i=this._playlist.findSegmentIndexByTime(i.currentTime),i=this._playlist.getSegmentByIndex(i),e=this._stats?.getStats().downloadSpeed,s+=e&&i?i.duration*this._playlist.currentStream.bitrate/e+1:5),s}getDemuxBuferredDuration(){return this._bufferService.getBuferredDuration()||0}getDemuxBufferedListLength(){return this._bufferService.getBufferedSegments()||0}getDemuxAudioBufferedListLength(){return this._bufferService.getBufferedAudioSegments()||0}getDemuxVideoBufferedListLength(){return this._bufferService.getBufferedVideoSegments()||0}}class bn extends Ae{TAG_NAME="Hls256Decoder";constructor(e){super(),this.player=e,this.canVideoPlay=!1,this.$videoElement=this.player.video.$videoElement,this.hls=null,this.eventsDestroy=[],this.bandwidthEstimateInterval=null,ua()?this.canVideoPlay=!0:(this.hls=new Zo(e),this._bindEvents())}async destroy(){return this._stopBandwidthEstimateInterval(),this.hls&&(await this.hls.destroy(),this.hls=null),this.eventsDestroy.length&&(this.eventsDestroy.forEach(e=>e()),this.eventsDestroy=[]),this.$videoElement=null,this.player.debug.log(this.TAG_NAME,"destroy"),!0}_bindEvents(){this.hls.on("error",e=>{this.player.emitError(H.hlsError,e)}),this._startBandwidthEstimateInterval()}_startBandwidthEstimateInterval(){this._stopBandwidthEstimateInterval(),this.bandwidthEstimateInterval=setInterval(()=>{var e=this.hls.speedInfo();this.player.emit(N.kBps,(e.avgSpeed/1024).toFixed(2))},1e3)}_stopBandwidthEstimateInterval(){this.bandwidthEstimateInterval&&(clearInterval(this.bandwidthEstimateInterval),this.bandwidthEstimateInterval=null)}initVideoPlay(e){this.$videoElement.muted=!0,this.$videoElement.src=e}async loadSource(e){return this.player.debug.log(this.TAG_NAME,"loadSource() "+e),this.url=e,this.canVideoPlay?this.initVideoPlay(e):await this.hls.loadSource(e),!0}checkHlsBufferedDelay(){let e=0;return e=this.hls?this.hls.getDemuxBuferredDuration():e}getDemuxBufferedListLength(){let e=0;return e=this.hls?this.hls.getDemuxBufferedListLength():e}getDemuxAudioBufferedListLength(){let e=0;return e=this.hls?this.hls.getDemuxAudioBufferedListLength():e}getDemuxVideoBufferedListLength(){let e=0;return e=this.hls?this.hls.getDemuxVideoBufferedListLength():e}}class vn extends Ae{constructor(e){super(),this.player=e,this.rtcPeerConnection=null,this.videoStream=null,this._initRtcPeerConnection(),this.player.debug.log("WebrtcDecoder","init")}destroy(){this.rtcPeerConnection&&(this.rtcPeerConnection.close(),this.rtcPeerConnection=null),this.videoStream=null,this.player.video.$videoElement.srcObject=null,this.player.debug.log("WebrtcDecoder","destroy")}_initRtcPeerConnection(){const e=new RTCPeerConnection,i=this.player;e.addTransceiver("video",{direction:"recvonly"}),e.addTransceiver("audio",{direction:"recvonly"}),e.onsignalingstatechange=s=>{this.player.debug.log("WebrtcDecoder","onsignalingstatechange",s)},e.oniceconnectionstatechange=s=>{this.player.debug.log("WebrtcDecoder","oniceconnectionstatechange",e.iceConnectionState)},e.onicecandidate=s=>{this.player.debug.log("WebrtcDecoder","onicecandidate",s)},e.ontrack=s=>{var u=i.video.$videoElement;s.track.kind==="video"&&(s=s.streams[0],u.srcObject=s,this.videoStream=s)},e.onconnectionstatechange=s=>{switch(i.debug.log("WebrtcDecoder","sdp connect status "+e.connectionState),e.connectionState){case"connected":break;case"disconnected":i.emit(N.webrtcDisconnect);break;case"failed":i.emit(N.webrtcFailed);break;case"closed":i.emit(N.webrtcClosed)}},this.rtcPeerConnection=e}loadSource(e){return new Promise((i,s)=>{const u=this.rtcPeerConnection;u.createOffer().then(c=>{u.setLocalDescription(c),this.player.debug.log("WebrtcDecoder","getWebRtcRemoteSdp loadSource"),c=c.sdp,fetch(e,{method:"POST",mode:"cors",cache:"no-cache",credentials:"include",redirect:"follow",referrerPolicy:"no-referrer",headers:{"Content-Type":"application/sdp"},body:c}).then(l=>{l.text().then(o=>{this.player.debug.log("WebrtcDecoder","getWebRtcRemoteSdp response"),u.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:o})),i()}).catch(o=>{this.player.debug.error("WebrtcDecoder","loadSource response.text() error",o),s(o)})}).catch(l=>{this.player.debug.error("WebrtcDecoder","loadSource getWebRtcRemoteSdp response error",l),s(l)})}).catch(c=>{this.player.debug.error("WebrtcDecoder","loadSource rtcPeerConnection.createOffer() error",c),s(c)})})}}class _n extends Ae{constructor(e){super(),this.tagName="WebrtcForZLMDecoder",this.player=e,this.rtcPeerConnection=null,this.videoStream=null,this._initRtcPeerConnection(),this.player.debug.log(this.tagName,"init")}destroy(){this.rtcPeerConnection&&(this.rtcPeerConnection.close(),this.rtcPeerConnection=null),this.videoStream&&(this.videoStream.getTracks().forEach(e=>e.stop()),this.videoStream=null),this.videoStream=null,this.player.video.$videoElement.srcObject=null,this.player.debug.log(this.tagName,"destroy")}_initRtcPeerConnection(){const e=new RTCPeerConnection,i=this.player;e.addTransceiver("video",{direction:"recvonly"}),e.addTransceiver("audio",{direction:"recvonly"}),e.onsignalingstatechange=s=>{console.log("onsignalingstatechange",s)},e.oniceconnectionstatechange=s=>{console.log("oniceconnectionstatechange",e.iceConnectionState)},e.onicecandidate=s=>{console.log("onicecandidate",s)},e.ontrack=s=>{var u=i.video.$videoElement;console.log("ontrack",s),s.track.kind==="video"&&(s=s.streams[0],u.srcObject=s,this.videoStream=s)},this.rtcPeerConnection=e}loadSource(e){return new Promise((i,s)=>{const u=this.rtcPeerConnection;u.createOffer().then(c=>{u.setLocalDescription(c),this.player.debug.log(this.tagName,"getWebRtcRemoteSdp loadSource"),c=c.sdp,Ot({url:e,type:"POST",data:c,contentType:"text/plain;charset=utf-8",processData:!1,dataType:"json"}).then(l=>{if(this.player.debug.log(this.tagName,"getWebRtcRemoteSdp response"),l=l.data,l.code!==0)return s(l.msg);u.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:l.sdp})),i()}).catch(l=>{this.player.debug.error(this.tagName,"loadSource getWebRtcRemoteSdp response error",l),s(l)})}).catch(c=>{this.player.debug.error(this.tagName,"loadSource rtcPeerConnection.createOffer() error",c),s(c)})})}}class el extends Ae{constructor(e,i){super(),this.player=e,this.player.$container.classList.add("jessibuca-container-playback"),this._showPrecision=null,this._startTime=null,this._playStartTime=null,this._playingTimestamp=null,this._fps=parseInt(i.fps,10)||e._opt.playbackFps,this._isUseFpsRender=!!We(i.isUseFpsRender),this._rate=1,this._audioTimestamp=0,this._videoTimestamp=0,this._currentLocalTimestamp=0,this._localOneFrameTimestamp=i.localOneFrameTimestamp||40,this._localCalculateTimeInterval=null,this._isUseLocalCalculateTime=!!We(i.isUseLocalCalculateTime),this._isPlaybackPauseClearCache=!_e(i.isPlaybackPauseClearCache),this._isCacheBeforeDecodeForFpsRender=!!We(i.isCacheBeforeDecodeForFpsRender),this._startfpsTime=null,this._startFpsTimestamp=null,this._checkStatsInterval=null,this._playbackTs=0,this._renderFps=0,this._isUseLocalCalculateTime?this._startLocalCalculateTime():this._listen(),this.playbackList=[],this._totalDuration=0,this.initPlaybackList(i.playList),this.player.on(N.playbackPause,s=>{s?this.pause():this.resume()}),e.debug.log("Playback","init",{fps:this._fps,isUseFpsRender:this._isUseFpsRender,localOneFrameTimestamp:this._localOneFrameTimestamp,isUseLocalCalculateTime:this._isUseLocalCalculateTime,uiUsePlaybackPause:i.uiUsePlaybackPause,showControl:i.showControl})}destroy(){this._startTime=null,this._showPrecision=null,this._playStartTime=null,this._playingTimestamp=null,this._totalDuration=0,this._audioTimestamp=0,this._videoTimestamp=0,this._fps=null,this._isUseFpsRender=!1,this._rate=1,this.playbackList=[],this._localCalculateTimeInterval=null,this._currentLocalTimestamp=0,this._startfpsTime=null,this._startFpsTimestamp=null,this._renderFps=0,this._playbackTs=0,this._stopLocalCalculateTime(),this.clearStatsInterval(),this.player.$container&&this.player.$container.classList.remove("jessibuca-container-playback"),this.off(),this.player.debug.log("Playback","destroy")}_listen(){this.player.on(N.stats,e=>{e=e.ts,this._playStartTime||(this._playStartTime=e),e-=this._playStartTime,this.setPlayingTimestamp(e)})}pause(){this.clearStatsInterval()}resume(){this.startCheckStatsInterval()}updateStats(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},e=(this._startFpsTimestamp||(this._startFpsTimestamp=be()),Ue(e.ts)&&(this.player.updateStats({fps:!0,ts:e.ts}),this._playbackTs=e.ts,this._startfpsTime||(this._startfpsTime=e.ts),this._renderFps+=1),be()),i=e-this._startFpsTimestamp;if(!(i<1e3)){let s=null;this._startfpsTime&&(s=this._playbackTs-this._startfpsTime),this.player.emit(N.playbackStats,{fps:this._renderFps,rate:this.rate,start:this._startfpsTime,end:this._playbackTs,timestamp:i,dataTimestamp:s,audioBufferSize:this.player.audio?this.player.audio.bufferSize:0,videoBufferSize:this.player.video?this.player.video.bufferSize:0,ts:this._playbackTs}),this._renderFps=0,this._startfpsTime=this._playbackTs,this._startFpsTimestamp=e}}updateLocalOneFrameTimestamp(e){this._localOneFrameTimestamp=e}_startLocalCalculateTime(){this._stopLocalCalculateTime(),this._localCalculateTimeInterval=setInterval(()=>{var e=this._currentLocalTimestamp,e=(this._playStartTime||(this._playStartTime=e),e-this._playStartTime);this.setPlayingTimestamp(e)},1e3)}startCheckStatsInterval(){this.clearStatsInterval(),this._checkStatsInterval=setInterval(()=>{this.updateStats()},1e3)}_stopLocalCalculateTime(){this._localCalculateTimeInterval&&(clearInterval(this._localCalculateTimeInterval),this._localCalculateTimeInterval=null)}clearStatsInterval(){this._checkStatsInterval&&(clearInterval(this._checkStatsInterval),this._checkStatsInterval=null)}increaseLocalTimestamp(){this._isUseLocalCalculateTime&&(this._currentLocalTimestamp+=this._localOneFrameTimestamp)}initPlaybackList(e){this.playbackList=e||[];let i=0;this.playbackList.forEach((s,u)=>{Nr(s.start)===10&&(s.startTimestamp=1e3*s.start,s.startTime=Fr(s.startTimestamp)),Nr(s.end)===10&&(s.endTimestamp=1e3*s.end,s.endTime=Fr(s.endTimestamp)),s.duration=s.end-s.start,i+=s.duration}),this._totalDuration=i,this.player.debug.log("Playback",this.playbackList),0<this.playbackList.length&&this.setStartTime(this.playbackList[0].startTimestamp),this.setShowPrecision(Yi)}get startTime(){return this._startTime||0}setStartTime(e){this._startTime=e,this._playStartTime=null}setRate(e){this._rate=e,this.player.emit(N.playbackRateChange,e)}get fps(){return this._fps}get rate(){return this._rate}get isUseFpsRender(){return this._isUseFpsRender}get isUseLocalCalculateTime(){return this._isUseLocalCalculateTime}get showPrecision(){return this._showPrecision}get is60Min(){return this.showPrecision===Yi}get is30Min(){return this.showPrecision===Ds}get is10Min(){return this.showPrecision===Rs}get is5Min(){return this.showPrecision===Ji}get is1Min(){return this.showPrecision===Ji}get isPlaybackPauseClearCache(){return this._isPlaybackPauseClearCache}get isCacheBeforeDecodeForFpsRender(){return this._isCacheBeforeDecodeForFpsRender}setShowPrecision(e){this._showPrecision&&this._showPrecision===e||(this._showPrecision=e,this.player.emit(N.playbackPrecision,this._showPrecision,this.playbackList))}setPlayingTimestamp(i){var i=this.startTime+i,s=(this._playingTimestamp=i,this.player.emit(N.playbackTime,i),new Date(i));this.player.emit(N.playbackTimestamp,{ts:i,hour:s.getHours(),min:s.getMinutes(),second:s.getSeconds()})}get playingTimestamp(){return this._playingTimestamp}narrowPrecision(){var e=yi.indexOf(this.showPrecision)-1;0<=e&&(e=yi[e],this.setShowPrecision(e))}expandPrecision(){var e=yi.indexOf(this.showPrecision)+1;e<=yi.length-1&&(e=yi[e],this.setShowPrecision(e))}seek(e){if(console.log(e),e.hasRecord==="true"){let i=e.time;e.type==="min"&&(i=60*e.time),this.player.emit(N.playbackSeek,(function(s){let u={};return u=-1<s?{hour:Math.floor(s/60/60)%60,min:Math.floor(s/60)%60,second:s%60}:u})(i))}}}class wn extends Ae{constructor(e){super(),this.player=e,this.bindEvents=[],this.isDragging=!1,this.currentZoom=1,this.prevVideoElementStyleTransform=null,this.prevVideoElementStyleScale=null,this.tempPosition={x:0,y:0},this.videoPosition={left:0,top:0};var{proxy:i}=this.player.events;this.player.on(N.zooming,s=>{if(s){this.player.$container.classList.add("jessibuca-zoom-control"),this._bindEvents();const l=this.player.video.$videoElement.style.transform;var c=this.player.video.$videoElement.style.left,u=this.player.video.$videoElement.style.top,c=parseFloat(c),u=parseFloat(u),c=(c&&(this.videoPosition.left=c),u&&(this.videoPosition.top=u),(this.prevVideoElementStyleTransform=l).match(/scale\([0-9., ]*\)/g));c&&c[0]&&(u=c[0].replace("scale(","").replace(")",""),this.prevVideoElementStyleScale=u.split(","))}else this.player.$container.classList.remove("jessibuca-zoom-control"),this._unbindEvents(),this._resetVideoPosition(),this.player.$container.style.cursor="auto",this.player.video.$videoElement.style.transform=this.prevVideoElementStyleTransform,this.prevVideoElementStyleTransform=null,this.prevVideoElementStyleScale=null}),i(window,"mouseup",s=>{this.handleMouseUp(s)}),e.debug.log("zoom","init")}destroy(){this.bindEvents=[],this.isDragging=!1,this.currentZoom=1,this.prevVideoElementStyleTransform=null,this.prevVideoElementStyleScale=null,this.tempPosition={x:0,y:0},this.videoPosition={left:0,top:0},this.off(),this.player.debug.log("zoom","destroy")}_bindEvents(){var e=this.player.events.proxy,i=e(this.player.$container,"mousemove",s=>{this.handleMouseMove(s)}),i=(this.bindEvents.push(i),e(this.player.$container,"mousedown",s=>{this.handleMouseDown(s)}));this.bindEvents.push(i)}_unbindEvents(){this.bindEvents.forEach(e=>{e&&e()})}handleMouseMove(e){var i,s,u;e.stopPropagation(),this.isDragging&&this.player.zooming&&({posX:e,posY:i}=da(e),s=this.tempPosition.x-e,u=this.tempPosition.y-i,this.videoPosition.left=this.videoPosition.left-s,this.videoPosition.top=this.videoPosition.top-u,this.tempPosition.x=e,this.tempPosition.y=i,this.updateVideoPosition())}handleMouseDown(e){e.stopPropagation();const i=Mt(e);if(this.player.zooming&&(i.matches("video")||i.matches("canvas"))){const{posX:s,posY:u}=da(e);this.player.$container.style.cursor="grabbing",this.tempPosition.x=s,this.tempPosition.y=u,this.isDragging=!0,this.player.debug.log("zoom","handleMouseDown is dragging true")}}handleMouseUp(e){e.stopPropagation(),this.isDragging&&this.player.zooming&&(this.tempPosition={x:0,y:0},this.isDragging=!1,this.player.$container.style.cursor="grab",this.player.debug.log("zoom","handleMouseUp is dragging false"))}updateVideoPosition(){var e=this.player.video.$videoElement;e.style.left=this.videoPosition.left+"px",e.style.top=this.videoPosition.top+"px"}_resetVideoPosition(){this.player.resize(),this.tempPosition={x:0,y:0},this.videoPosition={left:0,top:0},this.currentZoom=1}narrowPrecision(){this.currentZoom<=1||(--this.currentZoom,this.updateVideoElementScale())}expandPrecision(){5<=this.currentZoom||(this.currentZoom+=1,this.updateVideoElementScale())}updateVideoElementScale(){const e=this.player.video.$videoElement;let i=e.style.transform,s=1,u=1;if(this.prevVideoElementStyleScale){const f=this.prevVideoElementStyleScale[0],_=(f!==void 0&&(s=f,u=f),this.prevVideoElementStyleScale[1]);_!==void 0&&(u=_)}u=Ut(u);var c=.5*(s=Ut(s))*(this.currentZoom-1)+s,l=.5*u*(this.currentZoom-1)+u,o=i.indexOf("scale(")===-1?i+` scale(${c},${l})`:i.replace(/scale\([0-9., ]*\)/,`scale(${c},${l})`);this.player.debug.log("zoom",`updateVideoElementScale end is ${c}, ${l} style is `+o),e.style.transform=o}}class tl extends Ae{constructor(e){super(),this.player=e,this.faceDetector=null,this.objectDetector=null,this.initFaceDetector(),this.initObjectDetector(),this.player.debug.log("AiLoader","init")}initFaceDetector(){if(this.player._opt.useFaceDetector&&window.JessibucaProFaceDetector){const e=new JessibucaProFaceDetector({detectWidth:this.player._opt.aiFaceDetectWidth});e.load().then(()=>{this.player.debug.log("AiLoader","init face detector success"),this.faceDetector=e})}}initObjectDetector(){if(this.player._opt.useObjectDetector&&window.JessibucaProObjectDetector){const e=new JessibucaProObjectDetector({detectWidth:this.player._opt.aiObjectDetectWidth});e.load().then(()=>{this.player.debug.log("AiLoader","init object detector success"),this.objectDetector=e,this.objectDetector.on("jessibuca-pro-object-detector-info",i=>{i&&0<i.length&&this.player.emit(N.aiObjectDetectorInfo,i)})})}}destroy(){this.faceDetector&&(this.faceDetector.destroy(),this.faceDetector=null),this.objectDetector&&(this.objectDetector.destroy(),this.objectDetector=null),this.off()}}class il extends Ae{constructor(e){super(),this.player=e,this.LOG_NAME="Contextmenu",this.menuList=[],this.$contextmenus=e.control.$contextmenus,dt()?this.player.debug.warn(this.LOG_NAME,"not support mobile"):this.init(),e.debug.log(this.LOG_NAME,"init")}destroy(){this.menuList=[],this.player.debug.log(this.LOG_NAME,"destroy")}get isShow(){return this.player.$container.classList.contains("jessibuca-contextmenus-show")}show(){this.player.$container.classList.add("jessibuca-contextmenus-show")}hide(){this.player.$container.classList.remove("jessibuca-contextmenus-show")}init(){var{proxy:e}=this.player.events;0<this.player._opt.contextmenuBtns.length&&this.player._opt.contextmenuBtns.forEach(i=>{this.addMenuItem(i)}),e(this.player.$container,"contextmenu",u=>{u.preventDefault(),this.show();var s=u.clientX,u=u.clientY,{height:c,width:l,left:o,top:f}=this.player.$container.getBoundingClientRect(),{height:_,width:g}=this.$contextmenus.getBoundingClientRect();let T=s-o,E=u-f;o+l<s+g&&(T=l-g),f+c<u+_&&(E=c-_),ue(this.$contextmenus,{left:T+"px",top:E+"px"})}),e(this.player.$container,"click",i=>{sn(i,this.$contextmenus)||this.hide()}),this.player.on(N.blur,()=>{this.hide()})}_validateMenuItem(e){let i=!0;return e.content||(this.player.debug.warn(this.LOG_NAME,"content is required"),i=!1),i}addMenuItem(){let e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};var i,s,u,c,l=li(Un);e=Object.assign({},l,e),this._validateMenuItem(e)&&({events:{proxy:l},debug:i}=this.player,u=`
            <div class="jessibuca-contextmenu jessibuca-contextmenu-${s=sr()}">
                ${e.content}
            </div>
        `,(c=Array.from(this.$contextmenus.children)[e.index])?c.insertAdjacentHTML("beforebegin",u):rn(this.$contextmenus,u),c=this.$contextmenus.querySelector(".jessibuca-contextmenu-"+s),e.click&&l(c,"click",o=>{o.preventDefault(),e.click.call(this.player,this,o),this.hide()}),this.menuList.push({uuid:s,$menuItem:c}))}}class rl extends Ae{_opt={};constructor(u){let i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};super(),this.$container=u;var s,u=zr();if(this._opt=Object.assign({},u,i),this.debug=new tr(this),this._opt.forceNoOffscreen=!0,dt()&&(this._opt.controlAutoHide=!1),this._opt.forceNoOffscreen||(typeof OffscreenCanvas>"u"?(this._opt.forceNoOffscreen=!0,this._opt.useOffscreen=!1):this._opt.useOffscreen=!0),this._opt.isMpeg4&&(this._opt.useWCS=!1,this._opt.useMSE=!1,this._opt.isNakedFlow=!1,this._opt.useSIMD=!1,this._opt.isFmp4=!1),(this.isOldHls()||this._opt.isWebrtc)&&(this._opt.useWCS=!1,this._opt.useMSE=!1,this._opt.isNakedFlow=!1),this._opt.isNakedFlow,!this.isOldHls()&&!this._opt.isWebrtc){if(this._opt.useWCS){const o="VideoEncoder"in window,f=ra();this._opt.useWCS=o,this._opt.useWCS&&this._opt.isH265&&(this._opt.useWCS=f),this._opt.useWCS||this.debug.warn("Player",`
                    useWCS is true,
                    and supportWCS is ${o}, supportHevcWCS is ${f} , _opt.isH265 is ${this._opt.isH265}
                     so set useWCS false`),this._opt.useWCS&&(this._opt.useOffscreen?this._opt.wcsUseVideoRender=!1:this._opt.wcsUseVideoRender&&(this._opt.wcsUseVideoRender=vi()&&_i(),this._opt.wcsUseVideoRender||this.debug.warn("Player","wcsUseVideoRender is true, but not support so set wcsUseVideoRender false")))}if(this._opt.useMSE){const o=(function(){let _=!1;return _="MediaSource"in window&&window.MediaSource.isTypeSupported(Cs)?!0:_})(),f=ia();this._opt.useMSE=o,this._opt.useMSE&&this._opt.isH265&&(this._opt.useMSE=f),this._opt.useMSE||this.debug.warn("Player",`
                    useMSE is true,
                    and supportMSE is ${o}, supportHevcMSE is ${f} , _opt.isH265 is ${this._opt.isH265}
                     so set useMSE false`)}}this._opt.useMSE?(this._opt.useWCS&&this.debug.warn("Player","useMSE is true and useWCS is true then useWCS set true->false"),this._opt.forceNoOffscreen||this.debug.warn("Player","useMSE is true and forceNoOffscreen is false then forceNoOffscreen set false->true"),this._opt.useWCS=!1,this._opt.forceNoOffscreen=!0):this._opt.useWCS,!this._opt.useSIMD&&this._opt.decoder.indexOf("-simd")===-1||(this._opt.useSIMD=WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]))&&_e(/iphone/i.test(navigator.userAgent)),this._opt.useSIMD)||this.debug.warn("Player","useSIMD is true, but not support so set useSIMD false"),this._opt.useSIMD?this._opt.decoder.indexOf("-simd")===-1&&(this._opt.decoder=this._opt.decoder.replace("decoder-pro","decoder-pro-simd")):this._opt.decoder.indexOf("-simd")!==-1&&(this._opt.decoder=this._opt.decoder.replace("decoder-pro-simd","decoder-pro")),this._opt.decoder.indexOf("-simd")!==-1?this._opt.decoderAudio=this._opt.decoder.replace("decoder-pro-simd","decoder-pro-audio"):this._opt.decoderAudio=this._opt.decoder.replace("decoder-pro","decoder-pro-audio"),_e(this._opt.hasAudio)&&(this._opt.operateBtns.audio=!1),_e(this._opt.hasVideo)&&(this._opt.operateBtns.fullscreen=!1,this._opt.operateBtns.screenshot=!1,this._opt.operateBtns.record=!1,this._opt.operateBtns.ptz=!1,this._opt.operateBtns.quality=!1,this._opt.operateBtns.zoom=!1),this._opt.qualityConfig&&this._opt.qualityConfig.length===0&&this._opt.operateBtns.quality&&(this._opt.operateBtns.quality=!1,this.debug.warn("Player","_opt.qualityConfig is empty, so set operateBtns.quality false")),We(this._opt.useWebGPU)&&(this._opt.useWebGPU=(function(){let o=!1;return o="gpu"in navigator?!0:o})(),_e(this._opt.useWebGPU))&&this.debug.warn("Player","useWebGPU is true, but not support so set useWebGPU false"),this._opt.hasControl=this._hasControl(),this._loading=!1,this._playing=!1,this._playbackPause=!1,this._hasLoaded=!1,this._zooming=!1,this._destroyed=!1,this._checkHeartTimeout=null,this._checkLoadingTimeout=null,this._checkStatsInterval=null,this._checkVisibleHiddenTimeout=null,this._startBpsTime=null,this._isPlayingBeforePageHidden=!1,this._stats={buf:0,netBuf:0,fps:0,maxFps:0,dfps:0,abps:0,vbps:0,ts:0,mseTs:0,pTs:0,dts:0},this._allStatsData={},this._faceDetectActive=!1,this._objectDetectActive=!1,this._times={playInitStart:"",playStart:"",streamStart:"",streamResponse:"",demuxStart:"",decodeStart:"",videoStart:"",playTimestamp:"",streamTimestamp:"",streamResponseTimestamp:"",demuxTimestamp:"",decodeTimestamp:"",videoTimestamp:"",allTimestamp:""},this._videoTimestamp=0,this._audioTimestamp=0,this._videoIframeIntervalTs=0,this._streamQuality=this._opt.defaultStreamQuality||"",this._visibility=!0,this._lastestVisibilityChangeTimestamp=null,this._tempWorkerStats=null,this._historyFpsList=[],this._isPlayback()&&(this._opt.useMSE=!1,this._opt.useWCS=!1),_e(this._opt.useMSE)&&_e(this._opt.useWCS)&&_e(this._opt.isWebrtc)&&!this.isOldHls()&&(this._opt.useWasm=!0),(this.isOldHls()||this._opt.isWebrtc)&&(this._opt.hasVideo=!0,this._opt.hasAudio=!0),this._opt.hasVideo||(this._opt.useMSE=!1,this._opt.useWCS=!1),this._opt.useWasm&&(this._opt.useOffscreen?this._opt.wasmUseVideoRender=!1:this._opt.wasmUseVideoRender&&(this._opt.wasmUseVideoRender=ea()&&vi()&&_i(),this._opt.wasmUseVideoRender||this.debug.warn("Player","use wasm video render, but not support so set wasmUseVideoRender false")),this._opt.useSIMD?this.debug.log("Player","use simd wasm"):this.debug.log("Player","use wasm")),this._opt.useWasm&&(this._opt.useFaceDetector&&window.JessibucaProFaceDetector||this._opt.useObjectDetector&&window.JessibucaProObjectDetector)?(this.ai=new tl(this),this._opt.useFaceDetector&&window.JessibucaProFaceDetector||(this._opt.operateBtns.aiFace=!1),this._opt.useObjectDetector&&window.JessibucaProObjectDetector||(this._opt.operateBtns.aiObject=!1)):(this._opt.operateBtns.aiObject=!1,this._opt.operateBtns.aiFace=!1),!this._opt.useFaceDetector||this._opt.useWasm&&window.JessibucaProFaceDetector||this.debug.warn("Player",`use face detector, useWasm is ${this._opt.useWasm} and window.JessibucaProFaceDetector is `+!!window.JessibucaProFaceDetector),!this._opt.useObjectDetector||this._opt.useWasm&&window.JessibucaProObjectDetector||this.debug.warn("Player",`use object detector, useWasm is ${this._opt.useWasm} and window.JessibucaProObjectDetector is `+!!window.JessibucaProObjectDetector),this._opt.useVideoRender&&(this._opt.useWasm&&!this._opt.useOffscreen?(this._opt.wasmUseVideoRender=ea()&&vi()&&_i(),this._opt.wasmUseVideoRender||this.debug.warn("Player","use wasm video render, but not support so set wasmUseVideoRender false")):this._opt.useWCS&&!this._opt.useOffscreen&&(this._opt.wcsUseVideoRender=vi()&&_i(),this._opt.wcsUseVideoRender||this.debug.warn("Player","use wcs video render, but not support so set wcsUseVideoRender false"))),this._opt.useCanvasRender&&(this._opt.useMSE&&(this._opt.mseUseCanvasRender=!0),this._opt.useWasm&&(this._opt.wasmUseVideoRender=!1),this._opt.useWCS&&(this._opt.wcsUseVideoRender=!1),this.isOldHls())&&!Mr()&&(this._opt.hlsUseCanvasRender=!0),this._opt.useVideoRender=!1,this._opt.useCanvasRender=!1,this._opt.useWasm?this._opt.wasmUseVideoRender?this._opt.useVideoRender=!0:this._opt.useCanvasRender=!0:this._opt.useWCS?this._opt.wcsUseVideoRender?this._opt.useVideoRender=!0:this._opt.useCanvasRender=!0:this._opt.useMSE?this._opt.mseUseCanvasRender?this._opt.useCanvasRender=!0:this._opt.useVideoRender=!0:this.isOldHls()?this._opt.hlsUseCanvasRender?this._opt.useCanvasRender=!0:this._opt.useVideoRender=!0:this._opt.isWebrtc&&(this._opt.useVideoRender=!0),s=this,Object.defineProperty(s,"rect",{get:()=>{var o=s.$container.getBoundingClientRect();return o.width=Math.max(o.width,s.$container.clientWidth),o.height=Math.max(o.height,s.$container.clientHeight),o}}),["bottom","height","left","right","top","width"].forEach(o=>{Object.defineProperty(s,o,{get:()=>s.rect[o]})}),this.events=new dr(this),this._opt.hasVideo&&(this.video=new fr(this),this.recorder=new es(this)),this.isOldHls()?(this.hlsDecoder=new nn(this),this.loaded=!0):this._opt.isWebrtc?(this._opt.isWebrtcForZLM?this.webrtc=new _n(this):this.webrtc=new vn(this),this.loaded=!0):(this.isUseHls265()&&(this.hlsDecoder=new bn(this)),lr(this._opt)?this.loaded=!0:this.decoderWorker=new Na(this)),this._opt.hasAudio&&(this.audio=new mr(this)),this.stream=null,this.demux=null,this._lastVolume=null,this._isInZoom=!1,this._playingStartTimestamp=null,this._opt.useWCS&&(this.webcodecsDecoder=new en(this),this._opt.hasAudio||(this.loaded=!0)),this._opt.useMSE&&(this.mseDecoder=new an(this),this._opt.hasAudio||(this.loaded=!0)),this.control=new Ro(this),0<this._opt.contextmenuBtns.length&&(this.contextmenu=new il(this)),this._isPlayback()&&(this.playback=new el(this,this._opt.playbackConfig)),this._opt.operateBtns.zoom&&(this.zoom=new wn(this)),/(iphone|ipad|ipod|ios|android)/i.test(window.navigator.userAgent.toLowerCase())&&_e(this._opt.supportLockScreenPlayAudio&&oi())&&(this.keepScreenOn=new Io(this));var c=this;try{const o=f=>{Mt(f)===c.$container&&(c.emit(ae.fullscreen,c.fullscreen),!c.fullscreen||c._opt.useMSE)&&c.resize()};at.on("change",o),c.events.destroys.push(()=>{at.off("change",o)})}catch{}if(c.on(N.decoderWorkerInit,()=>{c.debug.log("player","listen decoderWorkerInit and set loaded true"),c.loaded=!0}),c.on(N.play,()=>{c.loading=!1}),c.on(N.fullscreen,o=>{if(o)try{at.request(c.$container).then(()=>{}).catch(f=>{c.debug.error("player","fullscreen request error",f),dt()&&c._opt.useWebFullScreen&&(c.webFullscreen=!0)})}catch{dt()&&c._opt.useWebFullScreen&&(c.webFullscreen=!0)}else try{at.exit().then(()=>{c.webFullscreen&&(c.webFullscreen=!1)}).catch(f=>{c.debug.error("player","fullscreen exit error",f),c.webFullscreen&&(c.webFullscreen=!1)})}catch{c.webFullscreen&&(c.webFullscreen=!1)}}),dt()&&c.on(N.webFullscreen,o=>{o?c.$container.classList.add("jessibuca-fullscreen-web"):c.$container.classList.remove("jessibuca-fullscreen-web"),c.emit(ae.fullscreen,c.fullscreen)}),c.on(N.resize,()=>{c.video&&c.video.resize()}),c._opt.debug){const o=[N.timeUpdate];Object.keys(N).forEach(f=>{c.on(N[f],_=>{o.includes(f)||c.debug.log("player events",N[f],_)})}),Object.keys(H).forEach(f=>{c.on(H[f],_=>{c.debug.warn("player event error",H[f],_)})})}{var l=this;const{_opt:o,debug:f,events:{proxy:_}}=l;if(o.supportDblclickFullscreen&&_(l.$container,"dblclick",g=>{g=Mt(g).nodeName.toLowerCase(),g!=="canvas"&&g!=="video"||(l.fullscreen=!l.fullscreen)}),_(document,"visibilitychange",()=>{l.visibility=document.visibilityState==="visible",f.log("visibilitychange",document.visibilityState),o.hiddenAutoPause&&(f.log("visibilitychange","hiddenAutoPause is true ",document.visibilityState,l._isPlayingBeforePageHidden),document.visibilityState==="visible"?l._isPlayingBeforePageHidden&&l.play():(l._isPlayingBeforePageHidden=l.playing,l.playing&&l.pause()))}),_(document,["click","contextmenu"],g=>{sn(g,l.$container)?(l.isInput=g.target.tagName==="INPUT",l.isFocus=!0,l.emit(N.focus)):(l.isInput=!1,l.isFocus=!1,l.emit(N.blur))}),o.autoResize){const g=ta(()=>{l.resize()},500);_(window,["resize","orientationchange"],()=>{g()}),screen&&screen.orientation&&screen.orientation.onchange&&_(screen.orientation,"change",()=>{g()})}}this.singleWatermark=new ka(this),this._opt.watermarkConfig&&this.updateWatermark(this._opt.watermarkConfig),this._opt.useWCS&&this.debug.log("Player","use WCS"),this._opt.useMSE&&this.debug.log("Player","use MSE"),this._opt.useOffscreen&&this.debug.log("Player","use offscreen"),this._opt.isHls&&(this._opt.supportHls265?this.debug.log("Player","use hls 265"):this.debug.log("Player","use hls")),this._opt.isWebrtc&&this.debug.log("Player","use webrtc"),this._opt.isFmp4&&this.debug.log("Player","use fmp4"),this._opt.isMpeg4&&this.debug.log("Player","use mpeg4"),this._isPlayback()&&this.debug.log("Player","use playback"),this._opt.hasVideo&&(this.width===0&&this.debug.warn("Player","container width is 0, please check the container width"),this.height===0)&&this.debug.warn("Player","container height is 0, please check the container height"),this.debug.log("Player options",JSON.stringify(this._opt))}async destroy(){this._destroyed=!0,this.emit("destroy"),this.off(),this.events&&(this.events.destroy(),this.events=null),this.clearCheckHeartTimeout(),this.clearCheckLoadingTimeout(),this.clearStatsInterval(),this.clearVisibilityHiddenTimeout(),this.decoderWorker&&(await this.decoderWorker.destroy(),this.decoderWorker=null),await this._destroy()}async _destroy(){this._loading=!1,this._playing=!1,this._playbackPause=!1,this._hasLoaded=!1,this._lastVolume=null,this._zooming=!1,this._faceDetectActive=!1,this._objectDetectActive=!1,this._times={playInitStart:"",playStart:"",streamStart:"",streamResponse:"",demuxStart:"",decodeStart:"",videoStart:"",playTimestamp:"",streamTimestamp:"",streamResponseTimestamp:"",demuxTimestamp:"",decodeTimestamp:"",videoTimestamp:"",allTimestamp:""},this.singleWatermark&&(this.singleWatermark.destroy(),this.singleWatermark=null),this.stream&&(this.stream.destroy(),this.stream=null),this.hlsDecoder&&(await this.hlsDecoder.destroy(),this.hlsDecoder=null),this.mseDecoder&&(this.mseDecoder.destroy(),this.mseDecoder=null),this.video&&(this.video.destroy(),this.video=null),this.audio&&(this.audio.destroy(),this.audio=null),this.recorder&&(this.recorder.destroy(),this.recorder=null),this.control&&(this.control.destroy(),this.control=null),this.webcodecsDecoder&&(this.webcodecsDecoder.destroy(),this.webcodecsDecoder=null),this.demux&&(this.demux.destroy(),this.demux=null),this.playback&&(this.playback.destroy(),this.playback=null),this.zoom&&(this.zoom.destroy(),this.zoom=null),this.ai&&(this.ai.destroy(),this.ai=null),this.keepScreenOn&&(this.releaseWakeLock(),this.keepScreenOn.destroy(),this.keepScreenOn=null),this.resetStats(),this._audioTimestamp=0,this._videoTimestamp=0,this._streamQuality="",this._visibility=!0,this._isInZoom=!1,this._playingStartTimestamp=null,this._lastestVisibilityChangeTimestamp=null,this._videoIframeIntervalTs=null,this._tempWorkerStats=null,this.debug.log("play","destroy end"),this._opt=zr(),this.$container=null}set fullscreen(e){dt()&&this._opt.useWebFullScreen?(this.emit(N.webFullscreen,e),setTimeout(()=>{this.updateOption({rotate:e?270:0}),this.resize()},10)):this.emit(N.fullscreen,e)}get fullscreen(){return at.isFullscreen||this.webFullscreen}set webFullscreen(e){this.emit(N.webFullscreen,e)}get webFullscreen(){return this.$container.classList.contains("jessibuca-fullscreen-web")}set loaded(e){this._hasLoaded=e}get loaded(){return this._hasLoaded||this.isOldHls()||this._opt.isWebrtc||this._opt.useMSE&&!this._opt.hasAudio||this._opt.useWCS&&!this._opt.hasAudio}set playing(e){e&&(this.loading=!1),this.playing!==e&&(this._playing=e,this.emit(N.playing,e),this.emit(N.volumechange,this.volume),e?this.emit(N.play):this.emit(N.pause))}get playing(){return this._playing}get volume(){return this.audio&&this.audio.volume||0}set volume(e){e!==this.volume&&(this.audio?(this.audio.setVolume(e),this._lastVolume=this.volume):this.debug.warn("Player","set volume error, audio is null"))}get lastVolume(){return this._lastVolume}set loading(e){this.loading!==e&&(this._loading=e,this.emit(N.loading,this._loading))}get loading(){return this._loading}set zooming(e){this.zooming!==e&&(this.zoom||(this.zoom=new wn(this)),this._zooming=e,this.emit(N.zooming,this.zooming))}get zooming(){return this._zooming}set recording(e){e?this.playing&&!this.recording&&(this.recorder&&this.recorder.startRecord(),this._opt.useWasm)&&this.decoderWorker.updateWorkConfig({key:"isRecording",value:!0}):this.recording&&(this._opt.useWasm&&this.decoderWorker.updateWorkConfig({key:"isRecording",value:!1}),this.recorder)&&this.recorder.stopRecordAndSave().then(()=>{}).catch(i=>{})}get recording(){return!!this.recorder&&this.recorder.isRecording}set audioTimestamp(e){e!==null&&(this._audioTimestamp=e)}get audioTimestamp(){return this._audioTimestamp}set videoTimestamp(e){e!==null&&(this._videoTimestamp=e,this._opt.useWCS||this._opt.useMSE||this.audioTimestamp&&this.videoTimestamp&&this.audio&&this.audio.emit(N.videoSyncAudio,{audioTimestamp:this.audioTimestamp,videoTimestamp:this.videoTimestamp,diff:this.audioTimestamp-this.videoTimestamp}))}set streamQuality(e){this.streamQuality!==e&&(this._streamQuality=e,this.emit(N.streamQualityChange,e))}get streamQuality(){return this._streamQuality}get videoTimestamp(){return this._videoTimestamp}get isDebug(){return We(this._opt.debug)}get scaleType(){var i=this._opt,e=i.isResize,i=i.isFullResize;let s=0;return _e(i)&&_e(e)?s=0:_e(i)&&We(e)?s=1:We(i)&&We(e)&&(s=2),s}set visibility(e){this._visibility!==e&&(this._visibility=e,this.emit(N.visibilityChange,e),this._lastestVisibilityChangeTimestamp=be(),e?this.clearVisibilityHiddenTimeout():this.startVisibilityHiddenTimeout())}get visibility(){return this._visibility}set playbackPause(e){this._playbackPause!==e&&(this._playbackPause=e,this.emit(N.playbackPause,e),this.emit(N.playbackPauseOrResume,e))}get playbackPause(){return this._playbackPause}set videoIframeIntervalTs(e){this._videoIframeIntervalTs=e}get videoIframeIntervalTs(){return this._videoIframeIntervalTs}set faceDetectActive(e){this._faceDetectActive!==e&&(this._faceDetectActive=e,this.emit(N.faceDetectActive,e))}get faceDetectActive(){return this._faceDetectActive}set objectDetectActive(e){this._objectDetectActive!==e&&(this._objectDetectActive=e,this.emit(N.objectDetectActive,e))}get objectDetectActive(){return this._objectDetectActive}get isUseWorkerDemuxAndDecode(){return this.stream&&this.stream.getStreamType()===ve}isDestroyed(){return this._destroyed}updateOption(e){this._opt=Object.assign({},this._opt,e)}init(){return new Promise((e,i)=>{this.video||this._opt.hasVideo&&(this.video=new fr(this)),this.audio||this._opt.hasAudio&&(this.audio=new mr(this)),this.stream||(this.stream=new qr(this)),this.isOldHls()?(this.hlsDecoder||(this.hlsDecoder=new nn(this),this.loaded=!0),e()):this._opt.isWebrtc?(this.webrtc||(this._opt.isWebrtcForZLM?this.webrtc=new _n(this):this.webrtc=new vn(this),this.loaded=!0),e()):(this.demux||this._opt.hasVideo&&!this.isUseWorkerDemuxAndDecode&&(this.demux=new ms(this)),this._opt.useWCS&&!this.webcodecsDecoder&&(this.webcodecsDecoder=new en(this)),this._opt.useMSE&&!this.mseDecoder&&(this.mseDecoder=new an(this)),this.isUseHls265()&&!this.hlsDecoder&&(this.hlsDecoder=new bn(this)),this.decoderWorker?this.loaded?e():this.once(N.decoderWorkerInit,()=>{this.loaded=!0,e()}):lr(this._opt)?e():(this.decoderWorker=new Na(this),this.once(N.decoderWorkerInit,()=>{this.loaded=!0,e()})))})}play(e,i){return new Promise((s,u)=>{if(!e&&!this._opt.url)return u("url is empty");this.loading=!0,this.playing=!1,this._times.playInitStart=be(),e=e||this._opt.url,this._opt.url=e,this.clearCheckHeartTimeout(),this.init().then(()=>{this._times.playStart=be(),this._opt.isNotMute&&this.mute(!1),this.webcodecsDecoder&&this.webcodecsDecoder.once(H.webcodecsH265NotSupport,()=>{this.emitError(H.webcodecsH265NotSupport)}),this.mseDecoder&&(this.mseDecoder.once(H.mediaSourceH265NotSupport,()=>{this.emitError(H.mediaSourceH265NotSupport)}),this.mseDecoder.once(H.mediaSourceFull,()=>{this.emitError(H.mediaSourceFull)}),this.mseDecoder.once(H.mediaSourceAppendBufferError,()=>{this.emitError(H.mediaSourceAppendBufferError)}),this.mseDecoder.once(H.mediaSourceBufferListLarge,()=>{this.emitError(H.mediaSourceBufferListLarge)}),this.mseDecoder.once(H.mediaSourceAppendBufferEndTimeout,()=>{this.emitError(H.mediaSourceAppendBufferEndTimeout)}),this.mseDecoder.once(H.mediaSourceDecoderConfigurationError,()=>{this.emitError(H.mediaSourceDecoderConfigurationError)}),this.mseDecoder.once(H.mediaSourceTsIsMaxDiff,()=>{this.emitError(H.mediaSourceTsIsMaxDiff)})),this.enableWakeLock(),this.checkLoadingTimeout(),this.stream?(this.stream.once(H.fetchError,c=>{this.emitError(H.fetchError,c)}),this.stream.once(H.websocketError,c=>{this.emitError(H.websocketError,c)}),this.stream.once(N.streamEnd,()=>{this.emit(N.streamEnd)}),this.stream.once(H.hlsError,c=>{this.emitError(H.hlsError,c)}),this.stream.once(H.webrtcError,c=>{this.emitError(H.webrtcError,c)}),this.stream.once(N.streamSuccess,()=>{s(),this._times.streamResponse=be(),this.video&&this.video.play(),this.checkStatsInterval(),this.isPlayback()&&this.playback&&this.playback.startCheckStatsInterval()}),this.stream.fetchStream(e,i)):this.debug.warn("player","play() this.stream is null")}).catch(c=>{u(c)})})}close(){return new Promise((e,i)=>{this._close().then(()=>{this.video&&this.video.clearView(),e()}).catch(s=>{i(s)})})}resumeAudioAfterPause(){this.lastVolume&&(this.volume=this.lastVolume)}_close(){return new Promise((e,i)=>{const s=()=>{this.stream&&(this.stream.destroy(),this.stream=null),this.demux&&(this.demux.destroy(),this.demux=null),this.webcodecsDecoder&&(this.webcodecsDecoder.destroy(),this.webcodecsDecoder=null),this.mseDecoder&&(this.mseDecoder.destroy(),this.mseDecoder=null),this.hlsDecoder&&(this.hlsDecoder.destroy(),this.hlsDecoder=null),this.webrtc&&(this.webrtc.destroy(),this.webrtc=null),this.audio&&(this.audio.destroy(),this.audio=null),this.clearCheckHeartTimeout(),this.clearCheckLoadingTimeout(),this.clearStatsInterval(),this.isPlayback()&&this.playback&&this.playback.clearStatsInterval(),this.loading=!1,this.recording=!1,this.zooming=!1,this.playing=!1,this.video&&(this.video.resetInit(),this.video.pause(!0)),this.releaseWakeLock(),this.resetStats(),this._audioTimestamp=0,this._videoTimestamp=0,this._times={playInitStart:"",playStart:"",streamStart:"",streamResponse:"",demuxStart:"",decodeStart:"",videoStart:"",playTimestamp:"",streamTimestamp:"",streamResponseTimestamp:"",demuxTimestamp:"",decodeTimestamp:"",videoTimestamp:"",allTimestamp:""}};this.decoderWorker?this.decoderWorker.destroy().then(()=>{this.decoderWorker=null,s(),setTimeout(()=>{e()},0)}).catch(u=>{this.debug&&this.debug.error("player","close() decoderWorker.destroy() error",u),i()}):(s(),setTimeout(()=>{e()},0))})}pause(){let e=0<arguments.length&&arguments[0]!==void 0&&arguments[0];return new Promise((i,s)=>{e?this.close().then(()=>{i()}).catch(u=>{s(u)}):this._close().then(()=>{i()}).catch(u=>{s(u)})})}isAudioMute(){let e=!0;return e=this.audio?this.audio.isMute:e}isAudioNotMute(){return!this.isAudioMute()}mute(e){this.audio&&this.audio.mute(e)}resize(){this.video&&this.video.resize()}startRecord(e,i){this.recording||(this.recorder.setFileName(e,i),this.recording=!0)}stopRecordAndSave(e,i){return new Promise((s,u)=>{this.recorder||u("recorder is null"),this.recording?(this._opt.useWasm&&this.decoderWorker.updateWorkConfig({key:"isRecording",value:!0}),this.recorder.stopRecordAndSave(e,i).then(c=>{s(c)}).catch(c=>{u(c)})):u("recorder is not recording")})}_hasControl(){let e=!1,i=!1;return Object.keys(this._opt.operateBtns).forEach(s=>{this._opt.operateBtns[s]&&(""+s).indexOf("Fn")===-1&&(i=!0)}),(this._opt.showBandwidth||i)&&(e=!0),e=this._isPlayback()&&this._opt.playbackConfig.showControl?!0:e}_isPlayback(){return this._opt.playType===pe}useWasmDecode(){return _e(this._opt.useMSE)&&_e(this._opt.useWCS)}canVideoTrackWritter(){var e=this._opt;return!this.isOldHls()&&_e(e.isWebrtc)&&_e(e.useMSE)&&(e.useWCS&&_e(e.useOffscreen)&&e.wcsUseVideoRender||this.useWasmDecode())}checkHeart(){this.clearCheckHeartTimeout(),this.checkHeartTimeout()}checkHeartTimeout(){this._checkHeartTimeout=setTimeout(()=>{_e(this.playbackPause)&&this.playing?this.isDestroyed()?this.debug&&this.debug.warn("player","checkHeartTimeout but player is destroyed"):this._stats.fps!==0?this.debug&&this.debug.warn("player","checkHeartTimeout but fps is "+this._stats.fps):_e(this.visibility)&&this._stats.vbps!==0?this.debug&&this.debug.warn("player","checkHeartTimeout but page is not visibility and vbps is "+this._stats.vbps):(this.debug.warn("player",`checkHeartTimeout and
                pause and emit delayTimeout event and
                current vbps is ${this._stats.vbps} and
                current fps is ${this._stats.fps} and
                current visibility is ${this.visibility} and`),this.emit(N.timeout,N.delayTimeout),this.emit(N.delayTimeout)):this.debug.warn("player",`playbackPause is ${this.playbackPause}, playing is `+this.playing)},1e3*this._opt.heartTimeout)}checkHeartTimeout$2(){var e;_e(this.playbackPause)&&this.playing?this.isDestroyed()?this.debug&&this.debug.warn("player","checkHeartTimeout$2 but player is destroyed"):_e(this.isHistoryFpsListAllZero())?this.debug&&this.debug.warn("player","checkHeartTimeout$2 but fps is not all zero"):this._stats.fps!==0?this.debug&&this.debug.warn("player","checkHeartTimeout$2 but fps is "+this._stats.fps):_e(this.visibility)&&this._stats.vbps!==0?this.debug&&this.debug.warn("player","checkHeartTimeout$2 but page is not visibility and vbps is "+this._stats.vbps):(e=this._historyFpsList.join(","),this.debug.warn("player",`checkHeartTimeout$2 and
                pause and emit delayTimeout event and
                current vbps is ${this._stats.vbps} and
                current fps is ${this._stats.fps} and
                history FpsList is ${e} and
                current visibility is ${this.visibility} and`),this.emit(N.timeout,N.delayTimeout),this.emit(N.delayTimeout)):this.debug.log("player",`checkHeartTimeout$2 playbackPause is ${this.playbackPause}, playing is `+this.playing)}checkStatsInterval(){this._checkStatsInterval=setInterval(()=>{this.updateStats()},1e3)}clearCheckHeartTimeout(){this._checkHeartTimeout&&(clearTimeout(this._checkHeartTimeout),this._checkHeartTimeout=null)}checkLoadingTimeout(){this._checkLoadingTimeout=setTimeout(()=>{this.playing?this.debug.warn("player",`checkLoadingTimeout but loading is ${this.loading} and playing is `+this.playing):this.isDestroyed()?this.debug&&this.debug.warn("player","checkLoadingTimeout but player is destroyed"):(this.debug.warn("player","checkLoadingTimeout and pause and emit loadingTimeout event"),this.emit(N.timeout,N.loadingTimeout),this.emit(N.loadingTimeout))},1e3*this._opt.loadingTimeout)}clearCheckLoadingTimeout(){this._checkLoadingTimeout&&(this.debug.log("player","clearCheckLoadingTimeout"),clearTimeout(this._checkLoadingTimeout),this._checkLoadingTimeout=null)}clearStatsInterval(){this._checkStatsInterval&&(clearInterval(this._checkStatsInterval),this._checkStatsInterval=null)}handleRender(){this.isDestroyed()?this.debug&&this.debug.warn("player","handleRender but player is destroyed"):(this.loading&&(this.clearCheckLoadingTimeout(),this.emit(N.start),this.loading=!1),this.playing||(this.playing=!0))}updateStats(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};this._startBpsTime||(this._startBpsTime=be()),Ue(e.ts)&&(this._stats.ts=e.ts,this._playingStartTimestamp===null)&&0<e.ts&&(this._playingStartTimestamp=e.ts),Ue(e.dts)&&(this._stats.dts=e.dts),Ue(e.mseTs)&&(this._stats.mseTs=e.mseTs),Ue(e.buf)&&(this._stats.buf=e.buf),Ue(e.netBuf)&&(this._stats.netBuf=e.netBuf),e.fps&&(this._stats.fps+=1),e.dfps&&(this._stats.dfps+=1),e.abps&&(this._stats.abps+=e.abps),e.vbps&&(this._stats.vbps+=e.vbps),e.workerStats&&(this._tempWorkerStats=e.workerStats);const i=be();if(!(i-this._startBpsTime<1e3)){this._playingStartTimestamp!==null&&0<this._stats.fps&&(this._stats.pTs+=1);let u=0,c=0,l=0,o=(this._opt.useMSE&&this.mseDecoder&&(u=this.mseDecoder.checkSourceBufferDelay(),u=parseInt(1e3*u,10),c=this.mseDecoder.getDecodeDiffTimes(),l=this.mseDecoder.getDecodePlaybackRate()),this._opt.useWCS&&this.webcodecsDecoder&&(c=this.webcodecsDecoder.getDecodeDiffTimes()),this.isOldHls()&&this.hlsDecoder&&(u=this.hlsDecoder.checkHlsBufferedDelay(),u=parseInt(1e3*u,10),l=this.hlsDecoder.getDecodePlaybackRate()),0),f=0,_=0,g=(this.isUseHls265()&&this.hlsDecoder&&(u=(u=this.hlsDecoder.checkHlsBufferedDelay()).toFixed(2),o=this.hlsDecoder.getDemuxBufferedListLength(),_=this.hlsDecoder.getDemuxVideoBufferedListLength(),f=this.hlsDecoder.getDemuxAudioBufferedListLength()),0),T=0,E=0,h=!1,k=!1,t=0,r=(this.demux&&(h=this.demux.isDropping()),this._opt.useWasm?this._tempWorkerStats&&(T=this._tempWorkerStats.demuxBufferDelay,E=this._tempWorkerStats.audioDemuxBufferDelay,g=this._tempWorkerStats.flvBufferByteLength,this._stats.netBuf=this._tempWorkerStats.netBuf,h=this._tempWorkerStats.isDropping,t=this._tempWorkerStats.pushLatestDelay,k=this._tempWorkerStats.isStreamTsMoreThanLocal):this.demux&&(g=this.demux.getInputByteLength(),t=this.demux.getPushLatestDelay(),k=this.demux.getIsStreamTsMoreThanLocal(),this.demux.bufferList)&&(T=this.demux.bufferList.length),0),n=0,a=(this.audio&&this.audio.bufferList&&(r=this.audio.bufferList.length,n=r*this.audio.oneBufferDuration),0),d=0;if(this.isPlayback()&&this.video){this._opt.playbackConfig.isUseFpsRender&&(a=this.video.bufferList&&this.video.bufferList.length||0),e=this.video.getStreamFps();const m=0<e?1e3/e:0;d=parseInt(m*a+m*T,10)}var e=this._stats.dts-this._stats.ts,s=e+this._stats.netBuf;this.isOldHls()&&(this._stats.fps=this.hlsDecoder.getFps()),this._stats.fps>this._stats.maxFps&&(this._stats.maxFps=this._stats.fps),this._allStatsData=Object.assign(this._stats,{audioBuffer:r,audioBufferDelayTs:n,audioTs:this.audioTimestamp,playbackVideoBuffer:a,playbackVideoWaitingBuffer:0,playbackAudioWaitingBuffer:0,playbackCacheDataDuration:d,demuxBuffer:T,pushLatestDelay:t,audioDemuxBuffer:E,flvBuffer:g,mseDelay:u,mseDecodeDiffTimes:c,mseDecodePlaybackRate:l,wcsDecodeDiffTimes:c,hlsDelay:u,hlsDemuxLength:o,hlsDemuxAudioLength:f,hlsDemuxVideoLength:_,hlsDecodePlaybackRate:l,delayTs:e,totalDelayTs:s,isDropping:h,isStreamTsMoreThanLocal:k}),this.emit(N.stats,this._allStatsData),1048576<this._allStatsData.flvBuffer&&this.emit(H.flvDemuxBufferSizeTooLarge,this._allStatsData.flvBuffer),this._opt.hasVideo&&this.emit(N.performance,(function(m){let x=0;return 24<=m?x=2:15<=m&&(x=1),x})(this._stats.fps)),this.updateHistoryFpsList(this._stats.fps),this._stats.fps=0,this._stats.dfps=0,this._stats.abps=0,this._stats.vbps=0,this._startBpsTime=i}}resetStats(){this._startBpsTime=null,this._playingStartTimestamp=null,this._historyFpsList=[],this._stats={buf:0,netBuf:0,fps:0,maxFps:0,dfps:0,abps:0,vbps:0,ts:0,mseTs:0,pTs:0,dts:0},this._allStatsData={}}enableWakeLock(){this._opt.keepScreenOn&&this.keepScreenOn&&this.keepScreenOn.enable()}releaseWakeLock(){this._opt.keepScreenOn&&this.keepScreenOn&&this.keepScreenOn.disable()}clearBufferDelay(){this._opt.useWasm?this.decoderWorker&&this.decoderWorker.clearWorkBuffer(!0):this.demux&&this.demux.clearBuffer(!0)}doDestroy(){this.emit(N.beforeDestroy)}handlePlayToRenderTimes(){var e=this.getPlayToRenderTimes();this.emit(N.playToRenderTimes,e)}getPlayToRenderTimes(){var e=this._times;return e.playTimestamp=e.playStart-e.playInitStart,e.streamTimestamp=e.streamStart-e.playStart,e.streamResponseTimestamp=e.streamResponse-e.streamStart,e.demuxTimestamp=0<e.demuxStart-e.streamResponse?e.demuxStart-e.streamResponse:0,e.decodeTimestamp=e.decodeStart-e.demuxStart,e.videoTimestamp=e.videoStart-e.decodeStart,e.allTimestamp=e.videoStart-e.playInitStart,e}getOption(){return this._opt}isPlayer(){return this._opt.playType===Ie}isPlayback(){return this._opt.playType===pe}isDemuxSetCodecInit(){let e=!0,i=this._opt;return i.useWCS&&!i.useOffscreen?e=this.webcodecsDecoder.hasInit:i.useMSE&&(e=this.mseDecoder.hasInit),e}isDemuxDecodeFirstIIframeInit(){let e=!0,i=this._opt;return i.useWCS&&!i.useOffscreen?e=!!this.webcodecsDecoder&&this.webcodecsDecoder.isDecodeFirstIIframe:i.useMSE&&(e=!!this.mseDecoder&&this.mseDecoder.isDecodeFirstIIframe),e}isAudioPlaybackRateSpeed(){let e=!1;return e=this.audio?this.audio.isPlaybackRateSpeed():e}getPlayingTimestamp(){return this._stats.pTs}getRecordingType(){let e=null;return e=this.recorder?this.recorder.getType():e}getRecordingByteLength(){let e=0;return e=this.recording?this.recorder.getToTalByteLength():e}getRecordingDuration(){let e=0;return e=this.recording?this.recorder.getTotalDuration():e}getDecodeType(){let e="";var i=this.getOption();return i.useMSE&&(e+="mse "),i.useWCS&&(e+="wcs "),i.useWasm&&(e+="wasm ",i.useSIMD)&&(e+="simd "),i.useOffscreen&&(e+="offscreen "),e}getDemuxType(){return this.getOption().demuxType}getRenderType(){let e="";return e=this.video?this.video.getType():e}getCanvasRenderType(){let e="";return e=this.video?this.video.getCanvasType():e}getAudioEngineType(){let e="";return e=this.audio?this.audio.getEngineType():e}getStreamType(){let e="";return e=this.stream?this.stream.getStreamType():e}getAllStatsData(){return this._allStatsData}togglePerformancePanel(e){this.updateOption({showPerformance:e}),this.emit(N.togglePerformancePanel,e)}setScaleMode(e){var i={isFullResize:!1,isResize:!1};switch(e=Number(e)){case 0:i.isFullResize=!1,i.isResize=!1;break;case 1:i.isFullResize=!1,i.isResize=!0;break;case 2:i.isFullResize=!0,i.isResize=!0}this.updateOption(i),this.resize(),this.emit(N.viewResizeChange,e)}startVisibilityHiddenTimeout(){this.clearVisibilityHiddenTimeout(),0<this._opt.pageVisibilityHiddenTimeout&&(this.visibilityHiddenTimeout=setTimeout(()=>{this.emit(N.visibilityHiddenTimeout)},1e3*this._opt.pageVisibilityHiddenTimeout))}clearVisibilityHiddenTimeout(){this._checkVisibleHiddenTimeout&&(clearTimeout(this._checkVisibleHiddenTimeout),this._checkVisibleHiddenTimeout=null)}faceDetect(e){this.faceDetectActive=e}objectDetect(e){this.objectDetectActive=e}downloadNakedFlowFile(){this.demux&&this.demux.downloadNakedFlowFile&&this.demux.downloadNakedFlowFile()}downloadFmp4File(){this.demux&&this.demux.downloadFmp4File&&this.demux.downloadFmp4File()}hasCacheOnGopBuffer(){var e=this.videoIframeIntervalTs,i=this._allStatsData.demuxBuffer,s=this._allStatsData.maxFps;return e&&i&&s?e<1e3/s*i:!1}addContentToCanvas(){this.video&&this.video.addContentToCanvas(0<arguments.length&&arguments[0]!==void 0?arguments[0]:[])}sendWebsocketMessage(e){var i=this.getStreamType();i===He||i===ve+" "+He?this.stream.sendMessage(e):this.debug.warn("player","sendWebsocketMessage: stream type is not websocket, current stream type is "+this.getStreamType())}checkIsInRender(){var e=this._stats;return 0<e.vbps&&0<e.fps}setControlHtml(e){this.control&&this.control.$controlHtml&&(this.control.$controlHtml.innerHTML=e)}clearControlHtml(){this.control&&this.control.$controlHtml&&(this.control.$controlHtml.innerHTML="")}updateWatermark(e){this.singleWatermark&&this.singleWatermark.update(e)}removeWatermark(){this.singleWatermark&&this.singleWatermark.remove()}getVideoInfo(){let e=null;return e=this.video?this.video.getVideoInfo():e}getAudioInfo(){let e=null;return e=this.audio?this.audio.getAudioInfo():e}getVideoPlaybackQuality(){let e=null;return e=this.video?this.video.getPlaybackQuality():e}emitError(e){var i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"";this.emit(N.error,e,i),this.emit(e,i)}updateHistoryFpsList(e){this._historyFpsList.length>this._opt.heartTimeout&&this._historyFpsList.shift(),this._historyFpsList.push(e),this.isHistoryFpsListAllZero()&&this.checkHeartTimeout$2()}isHistoryFpsListAllZero(){let e=!0;if(e=this._historyFpsList.length<this._opt.heartTimeout?!1:e){for(let i=0;i<this._historyFpsList.length;i++)if(0<this._historyFpsList[i]){e=!1;break}}return e}isUseHls265(){return We(this._opt.isHls)&&We(this._opt.supportHls265)}isOldHls(){return We(this._opt.isHls)&&_e(this._opt.supportHls265)}}class sl{constructor(i){var{fromSampleRate:i,toSampleRate:s,channels:u,inputBufferSize:c}=i;if(!i||!s||!u)throw new Error("Invalid settings specified for the resampler.");this.resampler=null,this.fromSampleRate=i,this.toSampleRate=s,this.channels=u||0,this.inputBufferSize=c,this.initialize()}initialize(){this.fromSampleRate==this.toSampleRate?(this.resampler=e=>e,this.ratioWeight=1):(this.fromSampleRate<this.toSampleRate?(this.linearInterpolation(),this.lastWeight=1):(this.multiTap(),this.tailExists=!1,this.lastWeight=0),this.initializeBuffers(),this.ratioWeight=this.fromSampleRate/this.toSampleRate)}bufferSlice(e){try{return this.outputBuffer.subarray(0,e)}catch{try{return this.outputBuffer.length=e,this.outputBuffer}catch{return this.outputBuffer.slice(0,e)}}}initializeBuffers(){this.outputBufferSize=Math.ceil(this.inputBufferSize*this.toSampleRate/this.fromSampleRate/this.channels*1.0000004768371582)+this.channels+this.channels;try{this.outputBuffer=new Float32Array(this.outputBufferSize),this.lastOutput=new Float32Array(this.channels)}catch{this.outputBuffer=[],this.lastOutput=[]}}linearInterpolation(){this.resampler=e=>{let i,s,u,c,l,o,f,_,g,T=e.length,E=this.channels;if(T%E!=0)throw new Error("Buffer was of incorrect sample length.");if(T<=0)return[];for(i=this.outputBufferSize,s=this.ratioWeight,u=this.lastWeight,c=0,l=0,o=0,f=0,_=this.outputBuffer;u<1;u+=s)for(l=u%1,c=1-l,this.lastWeight=u%1,g=0;g<this.channels;++g)_[f++]=this.lastOutput[g]*c+e[g]*l;for(--u,T-=E,o=Math.floor(u)*E;f<i&&o<T;){for(l=u%1,c=1-l,g=0;g<this.channels;++g)_[f++]=e[o+(0<g?g:0)]*c+e[o+(E+g)]*l;u+=s,o=Math.floor(u)*E}for(g=0;g<E;++g)this.lastOutput[g]=e[o++];return this.bufferSlice(f)}}multiTap(){this.resampler=e=>{let i,s,u,c,l,o,f,_,g,T,E,h=e.length,k=this.channels;if(h%k!=0)throw new Error("Buffer was of incorrect sample length.");if(h<=0)return[];for(i=this.outputBufferSize,s=[],u=this.ratioWeight,c=0,o=0,_=!this.tailExists,this.tailExists=!1,g=this.outputBuffer,T=0,E=0,l=0;l<k;++l)s[l]=0;do{if(_)for(c=u,l=0;l<k;++l)s[l]=0;else{for(c=this.lastWeight,l=0;l<k;++l)s[l]=this.lastOutput[l];_=!0}for(;0<c&&o<h;){if(f=1+o-E,!(c>=f)){for(l=0;l<k;++l)s[l]+=e[o+(0<l?l:0)]*c;E+=c,c=0;break}for(l=0;l<k;++l)s[l]+=e[o++]*f;E=o,c-=f}if(c!==0){for(this.lastWeight=c,l=0;l<k;++l)this.lastOutput[l]=s[l];this.tailExists=!0;break}for(l=0;l<k;++l)g[T++]=s[l]/u}while(o<h&&T<i);return this.bufferSlice(T)}}resample(e){return this.fromSampleRate==this.toSampleRate?this.ratioWeight=1:(this.fromSampleRate<this.toSampleRate?this.lastWeight=1:(this.tailExists=!1,this.lastWeight=0),this.initializeBuffers(),this.ratioWeight=this.fromSampleRate/this.toSampleRate),this.resampler(e)}}const Sn=[255,511,1023,2047,4095,8191,16383,32767];function En(D,e,i){for(let s=0;s<i;s++)if(D<=e[s])return s;return i}class al extends Ae{constructor(s){var i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},s=(super(),s&&(this.player=s),this.tag="talk",li(Pn));this._opt=Object.assign({},s,i),this._opt.sampleRate=parseInt(this._opt.sampleRate,10),this._opt.sampleBitsWidth=parseInt(this._opt.sampleBitsWidth,10),this.audioContext=null,this.gainNode=null,this.recorder=null,this.workletRecorder=null,this.biquadFilter=null,this.userMediaStream=null,this.bufferSize=512,this._opt.audioBufferLength=this.calcAudioBufferLength(),this.audioBufferList=[],this.socket=null,this.socketStatus=de,this.mediaStreamSource=null,this.heartInterval=null,this.checkGetUserMediaTimeout=null,this.wsUrl=null,this.startTimestamp=0,this.sequenceId=0,this.tempTimestamp=null,this.tempRtpBufferList=[],this.events=new dr(this),this._initTalk(),this.player||(this.debug=new tr(this)),this.log(this.tag,"init",this._opt)}destroy(){this.userMediaStream&&(this.userMediaStream.getTracks&&this.userMediaStream.getTracks().forEach(e=>{e.stop()}),this.userMediaStream=null),this.mediaStreamSource&&(this.mediaStreamSource.disconnect(),this.mediaStreamSource=null),this.recorder&&(this.recorder.disconnect(),this.recorder.onaudioprocess=null),this.biquadFilter&&(this.biquadFilter.disconnect(),this.biquadFilter=null),this.gainNode&&(this.gainNode.disconnect(),this.gainNode=null),this.workletRecorder&&(this.workletRecorder.disconnect(),this.workletRecorder=null),this.socket&&(this.socketStatus===fe&&this._sendClose(),this.socket.close(),this.socket=null),this._stopHeartInterval(),this._stopCheckGetUserMediaTimeout(),this.audioContext=null,this.gainNode=null,this.recorder=null,this.audioBufferList=[],this.sequenceId=0,this.wsUrl=null,this.tempTimestamp=null,this.tempRtpBufferList=[],this.startTimestamp=0,this.log("talk","destroy")}addRtpToBuffer(e){var i=e.length+this.tempRtpBufferList.length,i=new Uint8Array(i);i.set(this.tempRtpBufferList,0),i.set(e,this.tempRtpBufferList.length),this.tempRtpBufferList=i}downloadRtpFile(){var e=new Blob([this.tempRtpBufferList]);try{var i=document.createElement("a");i.href=window.URL.createObjectURL(e),i.download=Date.now()+".rtp",i.click()}catch(s){console.error("downloadRtpFile",s)}}calcAudioBufferLength(){var e=this._opt.sampleRate;return 8*e*.02/8}get socketStatusOpen(){return this.socketStatus===fe}log(){for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];this._log("log",...i)}warn(){for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];this._log("warn",...i)}error(){for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];this._log("error",...i)}_log(e){for(var i=arguments.length,s=new Array(1<i?i-1:0),u=1;u<i;u++)s[u-1]=arguments[u];(this.player?this.player.debug:this.debug||console)[e](...s)}_getSequenceId(){return++this.sequenceId}_createWebSocket(){return new Promise((e,i)=>{var s=this.events.proxy;this.socket=new WebSocket(this.wsUrl),this.socket.binaryType="arraybuffer",this.emit(N.talkStreamStart),s(this.socket,"open",()=>{this.socketStatus=fe,this.log(this.tag,"websocket open -> do talk"),this.emit(N.talkStreamOpen),e(),this._doTalk()}),s(this.socket,"message",u=>{this.log(this.tag,"websocket message",u.data)}),s(this.socket,"close",u=>{this.socketStatus="close",this.log(this.tag,"websocket close"),this.emit(N.talkStreamClose),i(u)}),s(this.socket,"error",u=>{this.socketStatus="error",this.error(this.tag,"websocket error",u),this.emit(N.talkStreamError,u),i(u)})})}_sendClose(){}_initTalk(){this._initMethods(),this._opt.engine===Ws?this._initWorklet():this._opt.engine==="script"&&this._initScriptProcessor(),this.log(this.tag,"audioContext samplerate",this.audioContext.sampleRate)}_initMethods(){this.audioContext=new(window.AudioContext||window.webkitAudioContext)({sampleRate:48e3}),this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=1,this.biquadFilter=this.audioContext.createBiquadFilter(),this.biquadFilter.type="lowpass",this.biquadFilter.frequency.value=3e3,this.resampler=new sl({fromSampleRate:this.audioContext.sampleRate,toSampleRate:this._opt.sampleRate,channels:this._opt.numberChannels,inputBufferSize:this.bufferSize})}_initScriptProcessor(){var e=this.audioContext.createScriptProcessor||this.audioContext.createJavaScriptNode;this.recorder=e.apply(this.audioContext,[this.bufferSize,this._opt.numberChannels,this._opt.numberChannels]),this.recorder.onaudioprocess=i=>this._onaudioprocess(i)}_initWorklet(){this.audioContext.audioWorklet.addModule(ca(function(){class e extends AudioWorkletProcessor{constructor(s){super(),this._cursor=0,this._bufferSize=s.processorOptions.bufferSize,this._buffer=new Float32Array(this._bufferSize)}process(s,u,c){if(s.length&&s[0].length)for(let l=0;l<s[0][0].length;l++)this._cursor+=1,this._cursor===this._bufferSize&&(this._cursor=0,this.port.postMessage({eventType:"data",buffer:this._buffer})),this._buffer[this._cursor]=s[0][0][l];return!0}}registerProcessor("talk-processor",e)})).then(()=>{var e=new AudioWorkletNode(this.audioContext,"talk-processor",{processorOptions:{bufferSize:this.bufferSize}});e.connect(this.gainNode),e.port.onmessage=i=>{i.data.eventType==="data"&&this._encodeAudioData(i.data.buffer)},this.workletRecorder=e})}_onaudioprocess(e){e=e.inputBuffer.getChannelData(0),this._encodeAudioData(new Float32Array(e))}_encodeAudioData(e){if(e[0]===0&&e[1]===0)this.log(this.tag,"empty audio data");else{const s=this.resampler.resample(e);let u=s;if(this._opt.sampleBitsWidth===16?u=(function(c){let l=c.length,o=new Int16Array(l);for(;l--;){var f=Math.max(-1,Math.min(1,c[l]));o[l]=f<0?32768*f:32767*f}return o})(s):this._opt.sampleBitsWidth===8&&(u=(function(c){let l=c.length,o=new Int8Array(l);for(;l--;){var f=Math.max(-1,Math.min(1,c[l]));o[l]=parseInt(255/(65535/(32768+(f<0?32768*f:32767*f))),10)}return o})(s)),u.buffer!==null){let c=null;this._opt.encType===Qi?c=(function(o){const f=[];return Array.prototype.slice.call(o).forEach((_,g)=>{f[g]=(function(T){let E,h,k;return 0<=T?E=213:(E=85,(T=-T-1)<0&&(T=32767)),8<=(h=En(T,Sn,8))?127^E:(k=h<<4,(k|=h<2?T>>4&15:T>>h+3&15)^E)})(_)}),f})(u):this._opt.encType===Ir&&(c=(function(o){const f=[];return Array.prototype.slice.call(o).forEach((_,g)=>{f[g]=(function(T){let E=0;E=T<0?(T=132-T,127):(T+=132,255);var h=En(T,Sn,8);return 8<=h?127^E:(h<<4|T>>h+3&15)^E})(_)}),f})(u));const l=Uint8Array.from(c);for(let o=0;o<l.length;o++){var i=this.audioBufferList.length;this.audioBufferList[+i]=l[o],this.audioBufferList.length===this._opt.audioBufferLength&&(this._sendTalkMsg(new Uint8Array(this.audioBufferList)),this.audioBufferList=[])}}}}_parseAudioMsg(e){let i=null;return this._opt.packetType!=="rtp"||this._opt.encType!==Qi&&this._opt.encType!==Ir?this._opt.packetType==="opus"?i=this.opusPacket(e):this._opt.packetType==="empty"&&(i=e):i=this.rtpPacket(e),i}rtpPacket(e){var i=[];let s=0,u,c;var l=this._opt.rtpSsrc,o=e.length,o=(this._opt.encType===Qi?s=8:this._opt.encType===Ir&&(s=0),this.startTimestamp||(this.startTimestamp=be()),c=be()-this.startTimestamp,u=this._getSequenceId(),o+12),f=(i[0]=255&o>>8,i[1]=255&o>>0,i[2]=128,i[3]=128+s,i[4]=u/256,i[5]=u%256,i[6]=c/65536/256,i[7]=c/65536%256,i[8]=c%65536/256,i[9]=c%65536%256,i[10]=l/65536/256,i[11]=l/65536%256,i[12]=l%65536/256,i[13]=l%65536%256,i.concat([...e])),_=new Uint8Array(f.length);for(let g=0;g<f.length;g++)_[g]=f[g];return _}opusPacket(e){return e}_sendTalkMsg(e){this.tempTimestamp===null&&(this.tempTimestamp=be());var i=be(),s=i-this.tempTimestamp,u=this._parseAudioMsg(e);this.log(this.tag,`'send talk msg and diff is ${s} and byteLength is ${u.byteLength} and length is ${u.length}, and g711 length is `+e.length),this._opt.packetType==="rtp"&&this.addRtpToBuffer(u),u&&(this.socketStatusOpen?this.socket.send(u.buffer):this.emit(H.tallWebsocketClosedByError)),this.tempTimestamp=i}_doTalk(){this._getUserMedia()}_getUserMedia(){this.log(this.tag,"getUserMedia"),window.navigator.mediaDevices===void 0&&(window.navigator.mediaDevices={}),window.navigator.mediaDevices.getUserMedia===void 0&&(this.log(this.tag,"window.navigator.mediaDevices.getUserMedia is undefined and init function"),window.navigator.mediaDevices.getUserMedia=function(e){var i=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return i?new Promise(function(s,u){i.call(navigator,e,s,u)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}),this._opt.checkGetUserMediaTimeout&&this._startCheckGetUserMediaTimeout(),window.navigator.mediaDevices.getUserMedia({audio:{latency:!0,noiseSuppression:!0,autoGainControl:!0,echoCancellation:!0,sampleRate:48e3,channelCount:1},video:!1}).then(e=>{this.log(this.tag,"getUserMedia success"),this.userMediaStream=e,this.mediaStreamSource=this.audioContext.createMediaStreamSource(e),this.mediaStreamSource.connect(this.biquadFilter),this.recorder?(this.biquadFilter.connect(this.recorder),this.recorder.connect(this.gainNode)):this.workletRecorder&&(this.biquadFilter.connect(this.workletRecorder),this.workletRecorder.connect(this.gainNode)),this.gainNode.connect(this.audioContext.destination),this.emit(N.talkGetUserMediaSuccess),e.oninactive===null&&(e.oninactive=i=>{this._handleStreamInactive(i)})}).catch(e=>{this.error(this.tag,"getUserMedia error",e.toString()),this.emit(N.talkGetUserMediaFail,e.toString())}).finally(()=>{this.log(this.tag,"getUserMedia finally"),this._stopCheckGetUserMediaTimeout()})}_getUserMedia2(){this.log(this.tag,"getUserMedia"),navigator.mediaDevices?navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{this.log(this.tag,"getUserMedia2 success")}):navigator.getUserMedia({audio:!0},this.log(this.tag,"getUserMedia2 success"),this.log(this.tag,"getUserMedia2 fail"))}async _getUserMedia3(){this.log(this.tag,"getUserMedia3");try{var e=await navigator.mediaDevices.getUserMedia({audio:{latency:!0,noiseSuppression:!0,autoGainControl:!0,echoCancellation:!0,sampleRate:48e3,channelCount:1},video:!1});console.log("getUserMedia() got stream:",e),this.log(this.tag,"getUserMedia3 success")}catch{this.log(this.tag,"getUserMedia3 fail")}}_handleStreamInactive(e){this.userMediaStream&&(this.error(this.tag,"stream oninactive"),this.emit(N.talkStreamInactive))}_startCheckGetUserMediaTimeout(){this._stopCheckGetUserMediaTimeout(),this.checkGetUserMediaTimeout=setTimeout(()=>{this.log(this.tag,"check getUserMedia timeout"),this.emit(N.talkGetUserMediaTimeout)},this._opt.getUserMediaTimeout)}_stopCheckGetUserMediaTimeout(){this.checkGetUserMediaTimeout&&(this.log(this.tag,"stop checkGetUserMediaTimeout"),clearTimeout(this.checkGetUserMediaTimeout),this.checkGetUserMediaTimeout=null)}_startHeartInterval(){this.heartInterval=setInterval(()=>{this.log(this.tag,"heart interval");var e=[35,36,0,0,0,0,0,0],e=new Uint8Array(e);this.socket.send(e.buffer)},15e3)}_stopHeartInterval(){this.heartInterval&&(this.log(this.tag,"stop heart interval"),clearInterval(this.heartInterval),this.heartInterval=null)}startTalk(e){return new Promise((i,s)=>(function(){let u=!1;var c=window.navigator;return u=c?(u=!(!c.mediaDevices||!c.mediaDevices.getUserMedia))||!!(c.getUserMedia||c.webkitGetUserMedia||c.mozGetUserMedia||c.msGetUserMedia):u})()?(this.wsUrl=e,this._opt.testMicrophone?(this._doTalk(),i()):(this._createWebSocket().catch(u=>{s(u)}),this.once(N.talkGetUserMediaFail,()=>{s("getUserMedia fail")}),void this.once(N.talkGetUserMediaSuccess,()=>{i()}))):s("not support getUserMedia"))}setVolume(e){e=parseFloat(e).toFixed(2),isNaN(e)||(e=ft(e,0,1),this.gainNode.gain.value=e)}getOption(){return this._opt}get volume(){return this.gainNode?parseFloat(100*this.gainNode.gain.value).toFixed(0):null}}class nl{constructor(e){this.player=e,this.globalSetting=null,e=sr(),this.defaultSettings={watermark_id:"JessibucaPro_"+e,watermark_prefix:"JessibucaPro_mask_"+e,watermark_txt:"JessibucaPro 测试水印",watermark_x:0,watermark_y:0,watermark_rows:0,watermark_cols:0,watermark_x_space:0,watermark_y_space:0,watermark_font:"微软雅黑",watermark_color:"black",watermark_fontsize:"18px",watermark_alpha:.15,watermark_width:150,watermark_height:100,watermark_angle:15,watermark_parent_width:0,watermark_parent_height:0,watermark_parent_node:null},this.player.debug.log("Watermark","int")}destroy(){this._removeMark(),this.globalSetting=null,this.defaultSettings={watermark_id:"",watermark_prefix:"",watermark_txt:"JessibucaPro 测试水印",watermark_x:0,watermark_y:0,watermark_rows:0,watermark_cols:0,watermark_x_space:0,watermark_y_space:0,watermark_font:"微软雅黑",watermark_color:"black",watermark_fontsize:"18px",watermark_alpha:.15,watermark_width:150,watermark_height:100,watermark_angle:15,watermark_parent_width:0,watermark_parent_height:0,watermark_parent_node:null},this.player.debug.log("Watermark","destroy")}remove(){this._removeMark()}load(e){this.globalSetting=e,this._loadMark(e)}resize(){this.globalSetting&&this._loadMark(this.globalSetting)}_loadMark(){var e=this.defaultSettings;if(arguments.length===1&&typeof arguments[0]=="object"){var i,s=arguments[0]||{};for(i in s)s[i]&&e[i]&&s[i]===e[i]||!s[i]&&s[i]!==0||(e[i]=s[i])}var c=document.getElementById(e.watermark_id),u=(c&&c.parentNode&&c.parentNode.removeChild(c),typeof e.watermark_parent_node=="string"?document.getElementById(e.watermark_parent_node):e.watermark_parent_node),c=u||document.body,f=c.getBoundingClientRect(),l=Math.max(c.scrollWidth,c.clientWidth,f.width),o=Math.max(c.scrollHeight,c.clientHeight,f.height),f=arguments[0]||{},f=((f.watermark_parent_width||f.watermark_parent_height)&&c&&(e.watermark_x=e.watermark_x+0,e.watermark_y=e.watermark_y+0),document.getElementById(e.watermark_id)),_=null;f?f.shadowRoot&&(_=f.shadowRoot):((f=document.createElement("div")).id=e.watermark_id,f.setAttribute("style","pointer-events: none !important; display: block !important"),_=typeof f.attachShadow=="function"?f.attachShadow({mode:"open"}):f,(T=c.children)[E=Math.floor(Math.random()*(T.length-1))]?c.insertBefore(f,T[E]):c.appendChild(f)),e.watermark_cols=parseInt((l-e.watermark_x)/(e.watermark_width+e.watermark_x_space));var g,T=parseInt((l-e.watermark_x-e.watermark_width*e.watermark_cols)/e.watermark_cols);e.watermark_x_space=T&&e.watermark_x_space,e.watermark_rows=parseInt((o-e.watermark_y)/(e.watermark_height+e.watermark_y_space));var E=parseInt((o-e.watermark_y-e.watermark_height*e.watermark_rows)/e.watermark_rows);e.watermark_y_space=E&&e.watermark_y_space;for(var h=u?(g=e.watermark_x+e.watermark_width*e.watermark_cols+e.watermark_x_space*(e.watermark_cols-1),e.watermark_y+e.watermark_height*e.watermark_rows+e.watermark_y_space*(e.watermark_rows-1)):(g=0+e.watermark_x+e.watermark_width*e.watermark_cols+e.watermark_x_space*(e.watermark_cols-1),0+e.watermark_y+e.watermark_height*e.watermark_rows+e.watermark_y_space*(e.watermark_rows-1)),k=0;k<e.watermark_rows;k++)for(var t=u?0+e.watermark_y+(o-h)/2+(e.watermark_y_space+e.watermark_height)*k:e.watermark_y+(o-h)/2+(e.watermark_y_space+e.watermark_height)*k,r=0;r<e.watermark_cols;r++){var n=u?0+e.watermark_x+(l-g)/2+(e.watermark_width+e.watermark_x_space)*r:e.watermark_x+(l-g)/2+(e.watermark_width+e.watermark_x_space)*r,a=document.createElement("div"),d=document.createTextNode(e.watermark_txt);a.appendChild(d),a.id=e.watermark_prefix+k+r,a.style.webkitTransform="rotate(-"+e.watermark_angle+"deg)",a.style.MozTransform="rotate(-"+e.watermark_angle+"deg)",a.style.msTransform="rotate(-"+e.watermark_angle+"deg)",a.style.OTransform="rotate(-"+e.watermark_angle+"deg)",a.style.transform="rotate(-"+e.watermark_angle+"deg)",a.style.visibility="",a.style.position="absolute",a.style.left=n+"px",a.style.top=t+"px",a.style.overflow="hidden",a.style.zIndex="9999999",a.style.opacity=e.watermark_alpha,a.style.fontSize=e.watermark_fontsize,a.style.fontFamily=e.watermark_font,a.style.color=e.watermark_color,a.style.textAlign="center",a.style.width=e.watermark_width+"px",a.style.height=e.watermark_height+"px",a.style.display="block",a.style["-ms-user-select"]="none",_.appendChild(a)}}_removeMark(){var e,i=this.defaultSettings,i=document.getElementById(i.watermark_id);i&&(e=i.parentNode)&&e.removeChild(i)}}class Ni extends Ae{_opt={};constructor(){let e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};super(),Object.keys(e).forEach(l=>{if(e[l]===void 0)throw new Error(`JbPro option "${l}" can not be undefined`)});var i,s,u=ga(),u=Object.assign({},u,e);u.url="",u.isMulti&&(u.debugUuid="xxxx".replace(/[xy]/g,function(l){var o=16*Math.random()|0;return(l=="x"?o:3&o|8).toString(16)})),this.debug=new tr(this);let c=e.container;if(!(c=typeof e.container=="string"?document.querySelector(e.container):c))throw this.debug.error("JbPro","JbPro need container option and now container is",e.container),new Error("JbPro need container option");if(c.nodeName==="CANVAS"||c.nodeName==="VIDEO")throw this.debug.error("JbPro",`JbPro container type can not be ${c.nodeName} type`),new Error(`JbPro container type can not be ${c.nodeName} type`);if(u.videoBuffer>=u.heartTimeout)throw this.debug.error("JbPro",`JbPro videoBuffer ${u.videoBuffer}s must be less than heartTimeout ${u.heartTimeout}s`),new Error(`JbPro videoBuffer ${u.videoBuffer}s must be less than heartTimeout ${u.heartTimeout}s`);if(this._checkHasCreated(c))throw this.debug.error("JbPro","JbPro container has been created and can not be created again",c),new Error("JbPro container has been created and can not be created again",c);if(c.classList.add("jessibuca-container"),i=c,s=sr(),i&&(i.dataset?i.dataset.jbprov=s:i.setAttribute("data-jbprov",s)),_e(u.isLive)){const l=document.createElement("video");l.muted=!0,l.setAttribute("controlsList","nodownload"),l.disablePictureInPicture="disablePictureInPicture",l.style.position="absolute",l.style.top=0,l.style.left=0,l.style.height="100%",l.style.width="100%",c.appendChild(l),this.$videoElement=l,this.$container=c,this._opt=u}else delete u.container,Ue(u.videoBuffer)&&(u.videoBuffer=1e3*Number(u.videoBuffer)),Ue(u.videoBufferDelay)&&(u.videoBufferDelay=1e3*Number(u.videoBufferDelay)),Ue(u.networkDelay)&&(u.networkDelay=1e3*Number(u.networkDelay)),Ue(u.timeout)&&(wi(u.loadingTimeout)&&(u.loadingTimeout=u.timeout),wi(u.heartTimeout))&&(u.heartTimeout=u.timeout),this._opt=u,this._destroyed=!1,this.$container=c,this._loadingTimeoutReplayTimes=0,this._heartTimeoutReplayTimes=0,this.events=new dr(this),this.watermark=new nl(this),this._initPlayer(c,u),this._initWatermark(),this.debug.log("JbPro",'init success and version is "6-25-2023"'),console.log('JbPro version is "6-25-2023"')}destroy(){return new Promise((e,i)=>{this.debug.log("JbPro","destroy()"),this._destroyed=!0,this.off(),this.$videoElement&&(this.$videoElement.pause(),this.$videoElement.currentTime=0,this.$videoElement.srcObject&&(this.$videoElement.srcObject=null,this.$videoElement.removeAttribute("srcObject")),this.$videoElement.src&&(this.$videoElement.src="",this.$videoElement.removeAttribute("src")),this.$container.removeChild(this.$videoElement),this.$videoElement=null),this.player?this.player.destroy().then(()=>{this.player=null,this._destroy(),setTimeout(()=>{e()},0)}).catch(()=>{i()}):(this._destroy(),setTimeout(()=>{e()},0))})}_destroy(){var e;this.events&&(this.events.destroy(),this.events=null),this.talk&&(this.talk.destroy(),this.talk=null),this.watermark&&(this.watermark.destroy(),this.watermark=null),this.$container&&(this.$container.classList.remove("jessibuca-container"),e=this.$container,e&&(e.dataset?delete e.dataset.jbprov:e.removeAttribute("data-jbprov")),this.$container=null),this.debug&&this.debug.log("JbPro","destroy end"),this._resetOpt(),this._loadingTimeoutReplayTimes=0,this._heartTimeoutReplayTimes=0}_resetOpt(){this._opt=ga()}_initPlayer(e,i){this.player=new rl(e,i),this.debug.log("JbPro","_initPlayer",this.player.getOption()),this._bindEvents()}_initTalk(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};this.talk&&(this.talk.destroy(),this.talk=null),this.player&&(e.debug=this.player._opt.debug),this.talk=new al(this.player,e),this.debug.log("JbPro","_initTalk",this.talk.getOption()),this._bindTalkEvents()}_resetPlayer(){let e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};return new Promise((i,s)=>{const u=()=>{this._opt.url="",this._opt.playOptions={},this._opt=Object.assign(this._opt,e),this._initPlayer(this.$container,this._opt)};this.player?this.player.destroy().then(()=>{this.player=null,u(),i()}):(u(),i())})}_bindEvents(){Object.keys(ae).forEach(e=>{this.player.on(ae[e],i=>{this.emit(e,i)})}),this.player.once(N.beforeDestroy,()=>{this.emit(N.close),this.destroy().then(()=>{}).catch(e=>{})}),this.player.on(N.resize,()=>{this.watermark&&this.watermark.resize(),this.player.singleWatermark&&this.player.singleWatermark.resize()}),this.player.on(N.fullscreen,()=>{this.watermark&&this.watermark.resize(),this.player.singleWatermark&&this.player.singleWatermark.resize()}),this.player.on(N.videoInfo,()=>{this.player.singleWatermark&&this.player.singleWatermark.resize()})}_bindTalkEvents(){Object.keys(oe).forEach(e=>{this.player.on(oe[e],i=>{this.emit(e,i)})})}_initWatermark(){var e;jr(this._opt.fullscreenWatermarkConfig)&&((e=na(this.$container,this._opt.fullscreenWatermarkConfig)).watermark_txt?this.watermark.load(e):this.debug.warn("JbPro","fullscreenWatermarkConfig text is empty"))}_checkHasCreated(e){return!!e&&(e=e,!!(e&&(e.dataset?e.dataset.jbprov:e.getAttribute("data-jbprov"))))}isDestroyed(){return this._destroyed}getOption(){return this.player?this.player.getOption():{}}setDebug(e){this.debug.log("JbPro","setDebug() "+e),this.player?this.player.updateOption({debug:!!e}):this.debug.warn("JbPro","player is not init")}getIsDebug(){let e=!1;return e=this.player?this.player._opt.debug:e}mute(){this.debug.log("JbPro","mute()"),this.player&&this.player.mute(!0)}cancelMute(){this.debug.log("JbPro","cancelMute()"),this.player&&this.player.mute(!1)}setVolume(e){this.debug.log("JbPro","setVolume() "+e),this.player&&(this.player.volume=e)}getVolume(){let e=null;return this.player&&(e=this.player.volume,e=parseFloat(e).toFixed(2)),e}audioResume(){this.debug.log("JbPro","audioResume()"),this.player&&this.player.audio?this.player.audio.audioEnabled(!0):this.debug.warn("JbPro","audioResume error")}setTimeout(e){this.debug.log("JbPro","setTimeout() "+e),e=Number(e),isNaN(e)?this.debug.warn("JbPro",`setTimeout error: ${e} is not a number`):this.player&&this.player.updateOption({timeout:e,loadingTimeout:e,heartTimeout:e})}setScaleMode(e){this.debug.log("JbPro","setScaleMode() "+e),this.player?this.player.setScaleMode(e):this.debug.warn("JbPro","setScaleMode() player is null")}pause(){let e=0<arguments.length&&arguments[0]!==void 0&&arguments[0];return new Promise((i,s)=>{if(this.debug.log("JbPro","pause() "+e),this.isDestroyed())return s("JbPro is destroyed");this.player?this.player.pause(e).then(u=>{i(u)}).catch(u=>{s(u)}):s("player is null")})}close(){return new Promise((e,i)=>{this.debug.log("JbPro","close()"),this._opt.url="",this._loadingTimeoutReplayTimes=0,this._heartTimeoutReplayTimes=0,this.player?this.player.close().then(()=>{e()}).catch(s=>{i(s)}):i("player is null")})}clearView(){this.debug.log("JbPro","clearView()"),this.player&&this.player.video?this.getRenderType()===Tt?this.player.video.clearView():this.debug.warn("JbPro","clearView","render type is video, not support clearView, please use canvas render type"):this.debug.warn("JbPro","clearView","player is null")}play(){let e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"",i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};return new Promise((s,u)=>{if(this.debug.log("JbPro","play() "+e),e||this._opt.url)if(e=e&&(""+e).trim(),_e(this._opt.isLive))this.$videoElement.controls="controls",this.$videoElement.muted=!1,this.$videoElement.src=e,this.$videoElement.play(),s(this.$videoElement);else{if(this._opt.isCrypto){var c,l=i.cryptoKey||this._opt.playOptions.cryptoKey,o=i.cryptoIV||this._opt.playOptions.cryptoIV;if(!l||!o)return c=e||this._opt.url,void this._cryptoPlay(c).then(_=>{var{cryptoIV:_,cryptoKey:g}=_;this._opt.playOptions.cryptoKey=g,this._opt.playOptions.cryptoIV=_,i.cryptoIV=_,i.cryptoKey=g,this._playBefore(e,i).then(()=>{s()}).catch(T=>{u(T)})}).catch(f=>{u(f)});this._opt.playOptions.cryptoKey=l,this._opt.playOptions.cryptoIV=o,i.cryptoIV=o,i.cryptoKey=l}this._playBefore(e,i).then(()=>{s()}).catch(f=>{u(f)})}else this.emit(N.error,H.playError),u("url is null and this._opt.url is null")})}_playBefore(e,i){return new Promise((s,u)=>{this.player?e?this._opt.url?e===this._opt.url?this.player.playing?(this.debug.log("JbPro","_playBefore","playing and resolve()"),s()):(this.debug.log("JbPro","_playBefore","pause ->  play"),this.player.play(this._opt.url,this._opt.playOptions).then(()=>{s(),this.player.resumeAudioAfterPause()}).catch(c=>{this.debug.error("JbPro","_playBefore this.player.play error",c),this.emit(N.crashLog,this.getCrashLog("this.player.play 1",c)),this.player.pause().then(()=>{u(c)})})):this.player.pause().then(()=>{this._play(e,i).then(()=>{s()}).catch(c=>{this.debug.error("JbPro","_play error",c),this.emit(N.crashLog,this.getCrashLog("this.player.play 2",c)),u(c)})}).catch(c=>{this.debug.error("JbPro","this.player.pause error",c),u(c)}):this._play(e,i).then(()=>{s()}).catch(c=>{this.debug.error("JbPro","_play error",c),this.emit(N.crashLog,this.getCrashLog("this.player.play 3",c)),u(c)}):this.player.play(this._opt.url,this._opt.playOptions).then(()=>{s(),this.player.resumeAudioAfterPause()}).catch(c=>{this.debug.error("JbPro","this.player.play error",c),this.emit(N.crashLog,this.getCrashLog("this.player.play 4",c)),this.player.pause().then(()=>{u(c)})}):e?this._play(e,i).then(()=>{s()}).catch(c=>{this.debug.error("JbPro","_play error",c),this.emit(N.crashLog,this.getCrashLog("this.player.play 5",c)),u(c)}):this._play(this._opt.url,this._opt.playOptions).then(()=>{s()}).catch(c=>{this.debug.error("JbPro","_play error",c),this.emit(N.crashLog,this.getCrashLog("this.player.play 6",c)),u(c)})})}_cryptoPlay(e){return new Promise((i,s)=>{var u,c=(function(){var f=(e||document.location.toString()).split("//"),_=f[1].indexOf("/");let g=f[1].substring(_);return g=g.indexOf("?")!=-1?g.split("?")[0]:g})();let l=this._opt.cryptoKeyUrl,o="";l?o=l:(l=(function(_){var g=/(msie|trident)/i.test(navigator.userAgent),T=document.createElement("a");let E=_;return g&&(T.setAttribute("href",E),E=T.href),T.setAttribute("href",E),{origin:T.origin,href:T.href,protocol:T.protocol?T.protocol.replace(/:$/,""):"",host:T.host,search:T.search?T.search.replace(/^\?/,""):"",hash:T.hash?T.hash.replace(/^#/,""):"",hostname:T.hostname,port:T.port,pathname:T.pathname.charAt(0)==="/"?T.pathname:"/"+T.pathname}})(e).origin+"/crypto/",o=l+"?stream="+c),u=o,new Promise((f,_)=>{Ot.get(u).then(g=>{f(g)}).catch(g=>{_(g)})}).then(f=>{if(f){const _=f.split("."),g=ma(_[0]),T=ma(_[1]);T&&g?i({cryptoIV:T,cryptoKey:g}):s("get cryptoIV or cryptoKey error")}else s(`cryptoKeyUrl: getM7SCryptoStreamKey ${o} res is null`)}).catch(f=>{s(f)})})}playback(e){let i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};return new Promise((s,u)=>{if(this.debug.log("JbPro","playback() "+e),_e(this._opt.isLive))return u("this._opt.isLive is false, can not playback");var c=zr(),c=Object.assign({},c.playbackConfig,this._opt.playbackConfig,i);c.isUseFpsRender||c.isCacheBeforeDecodeForFpsRender&&(c.isCacheBeforeDecodeForFpsRender=!1,this.debug.warn("JbPro","playbackConfig.isUseFpsRender is false, isCacheBeforeDecodeForFpsRender can not be ture, isCacheBeforeDecodeForFpsRender is set to false")),c.rateConfig.length===0&&c.showRateBtn&&(c.showRateBtn=!1,this.debug.warn("JbPro","playbackConfig.rateConfig.length is 0, showRateBtn can not be ture, showRateBtn is set to false")),this._resetPlayer({videoBuffer:0,playbackConfig:c,playType:pe,openWebglAlignment:!0,useMSE:!1,useWCS:!1,useSIMD:!0}).then(()=>{this.play(e).then(()=>{s()}).catch(l=>{u(l)})}).catch(l=>{u(l)})})}playbackPause(){let e=0<arguments.length&&arguments[0]!==void 0&&arguments[0];return this.debug.log("JbPro","playbackPause() "+e),this._opt.playType===Ie?Promise.reject("playType is player, can not call playbackPause method"):new Promise((i,s)=>{if(!this.player)return s("player is null");We(e)?this.pause().then(()=>{i()}).catch(u=>{s(u)}):(this.player.playbackPause=!0,i())})}playbackResume(){return this.debug.log("JbPro","playbackResume()"),this._opt.playType===Ie?Promise.reject("playType is player, can not call playbackResume method"):new Promise((e,i)=>{if(!this.player)return i();this.player.playbackPause=!1,e()})}forward(e){return this.debug.log("JbPro","forward() "+e),_e(this._opt.isLive)||this._opt.playType===Ie?Promise.reject("forward() method only just for playback type"):he(Number(e))?new Promise((i,s)=>{this.player?(e=ft(Number(e),.1,32),this.player.decoderWorker&&this.player.decoderWorker.updateWorkConfig({key:"playbackRate",value:e}),this.player.playback.setRate(e),this.player.video&&this.player.video.setRate(e),this.player.audio&&this.player.audio.setRate(e),i()):s("player is null")}):Promise.reject(`forward() params "rate": ${e} must be number type`)}playbackForward(e){return this.forward(e)}normal(){return this.forward(1)}playbackNormal(){return this.normal()}updatePlaybackForwardMaxRateDecodeIFrame(e){this.debug.log("JbPro","updatePlaybackForwardMaxRateDecodeIFrame() "+e),e=Number(e),e=ft(e=parseInt(e,10),1,8),this._opt.playbackForwardMaxRateDecodeIFrame=e,this.player?(this.player.updateOption({playbackForwardMaxRateDecodeIFrame:e}),this.player.decoderWorker&&this.player.decoderWorker.updateWorkConfig({key:"playbackForwardMaxRateDecodeIFrame",value:e})):this.debug.warn("JbPro","updatePlaybackForwardMaxRateDecodeIFrame() player is null")}setPlaybackStartTime(e){this.debug.log("JbPro","setPlaybackStartTime() "+e);var i=Nr(e);this.player?this.player.isPlayback()?i<10&&e!==0?this.debug.warn("JbPro",`timestamp: ${e} is not valid`):this.player.playing&&(i===10&&(e*=1e3),this.player.playback.setStartTime(e),this.playbackClearCacheBuffer()):this.debug.warn("JbPro","playType is not playback"):this.debug.warn("JbPro","player is null")}playbackClearCacheBuffer(){this.debug.log("JbPro","playbackClearCacheBuffer()"),this.player?this.player.isPlayback()?(this.player.video&&this.player.video.clear(),this.player.audio&&this.player.audio.clear(),this.player.decoderWorker.clearWorkBuffer(!0)):this.debug.warn("JbPro","playType is not playback"):this.debug.warn("JbPro","player is null")}getPlaybackCurrentRate(){return this.player&&this.player.isPlayback()?this.player.playback.rate:1}updatePlaybackLocalOneFrameTimestamp(e){this.debug.log("JbPro","updatePlaybackLocalOneFrameTimestamp() "+e),this.player?this.player.isPlayback()?this.player.playback.updateLocalOneFrameTimestamp(e):this.debug.warn("JbPro","playType is not playback"):this.debug.warn("JbPro","player is null")}setStreamQuality(e){this.debug.log("JbPro","setStreamQuality() "+e),this.player?this.player._opt.operateBtns.quality?(this.player._opt.qualityConfig||[]).includes(e)?this.player.streamQuality=e:this.debug.warn("JbPro",`quality: ${e} is not in qualityList`):this.debug.warn("JbPro","player._opt.operateBtns.quality is false"):this.debug.warn("JbPro","player is null")}_play(){let e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"",i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};return new Promise((s,u)=>{if(!this.player)return u("player is null");let c=!1;this._opt.url&&this._opt.url!==e&&(c=!0),this._opt.url=e,this._opt.playOptions=i;var l=e.indexOf("http")===0,o=e.indexOf("webrtc")===0,f=e.indexOf("wt")===0,_=!o&&e.indexOf(".m3u8")!==-1,g=!o&&e.indexOf(".flv")!==-1,T=!o&&e.indexOf(".fmp4")!==-1||!o&&e.indexOf(".mp4")!==-1,E=!o&&e.indexOf(".mpeg4")!==-1,h=!o&&e.indexOf(".h264")!==-1||!o&&e.indexOf(".h265")!==-1;if(g&&!this._opt.isFlv&&(this._opt.isFlv=!0,this._opt.isFmp4=!1,this._opt.isMpeg4=!1,this._opt.isNakedFlow=!1),T&&!this._opt.isFmp4&&(this._opt.isFmp4=!0,this._opt.isFlv=!1,this._opt.isMpeg4=!1,this._opt.isNakedFlow=!1),E&&!this._opt.isMpeg4&&(this._opt.isMpeg4=!0,this._opt.isFlv=!1,this._opt.isFmp4=!1,this._opt.isNakedFlow=!1),h&&!this._opt.isNakedFlow&&(this._opt.isNakedFlow=!0,this._opt.isFlv=!1,this._opt.isFmp4=!1,this._opt.isMpeg4=!1),T=l?_?3:2:f?5:o?4:1,h=this._opt.isNakedFlow?St:this._opt.isFmp4?Ht:this._opt.isMpeg4?Et:l&&!_||g||this._opt.isFlv?wt:_?"hls":o?"webrtc":f?Pt:"m7s",!T||!h)return u(`play protocol is ${T}, demuxType is `+h);const k=()=>{this.player.once(H.webglAlignmentError,t=>{this.emit(N.crashLog,this.getCrashLog(H.webglAlignmentError,t)),this.pause().then(()=>{if(this.player&&this.player._opt.webglAlignmentErrorReplay){this.debug.log("JbPro","webglAlignmentError");const r=this._opt.url;this._resetPlayer({openWebglAlignment:!0}).then(()=>{this.play(r).then(()=>{this.debug.log("JbPro","webglAlignmentError and play success")}).catch(n=>{this.debug.error("JbPro","webglAlignmentError and play error",n)})}).catch(n=>{this.debug.error("JbPro","webglAlignmentError and _resetPlayer error",n)})}else this.emit(N.playFailedAndPaused,H.webglAlignmentError),this.debug.log("JbPro","webglAlignmentError and webglAlignmentErrorReplay is false")}).catch(r=>{this.debug.error("JbPro","webglAlignmentError and pause error",r)})}),this.player.once(H.webglContextLostError,t=>{this.emit(N.crashLog,this.getCrashLog(H.webglContextLostError,t)),this.pause().then(()=>{if(this.player&&this.player._opt.webglContextLostErrorReplay){this.debug.log("JbPro","webglContextLostError");const n=this._opt.url,a={};var r;this.player._opt.replayUseLastFrameShow&&(r=this.screenshot("","png",.92,"base64"),a.loadingBackground=r),this._resetPlayer(a).then(()=>{this.play(n).then(()=>{this.debug.log("JbPro","webglContextLostError and play success")}).catch(d=>{this.debug.error("JbPro","webglContextLostError and play error",d)})}).catch(d=>{this.debug.error("JbPro","webglContextLostError and _resetPlayer error",d)})}else this.emit(N.playFailedAndPaused,H.webglContextLostError),this.debug.log("JbPro","webglContextLostError and webglContextLostErrorReplay is false")}).catch(r=>{this.debug.error("JbPro","webglAlignmentError and pause error",r)})}),this.player.once(H.mediaSourceH265NotSupport,t=>{this.emit(N.crashLog,this.getCrashLog(H.mediaSourceH265NotSupport,t)),this.pause().then(()=>{if(this.player&&this.player._opt.autoWasm){this.debug.log("JbPro","mediaSourceH265NotSupport auto wasm [mse-> wasm] reset player and play");const r=this._opt.url;this._resetPlayer({useMSE:!1,useWCS:!1}).then(()=>{this.play(r).then(()=>{this.debug.log("JbPro","mediaSourceH265NotSupport auto wasm [mse-> wasm] reset player and play success")}).catch(n=>{this.debug.error("JbPro","mediaSourceH265NotSupport auto wasm [mse-> wasm] reset player and play error",n)})}).catch(n=>{this.debug.error("JbPro","mediaSourceH265NotSupport auto wasm [mse-> wasm] _resetPlayer error",n)})}else this.emit(N.playFailedAndPaused,H.mediaSourceH265NotSupport),this.debug.log("JbPro","mediaSourceH265NotSupport and autoWasm is false")}).catch(r=>{this.debug.error("JbPro","mediaSourceH265NotSupport and pause error",r)})}),this.player.once(H.mediaSourceFull,t=>{this.emit(N.crashLog,this.getCrashLog(H.mediaSourceFull,t)),this.pause().then(()=>{if(this.player&&this.player._opt.mseDecodeErrorReplay){this.debug.log("JbPro","mediaSourceFull and auto wasm [mse-> wasm] reset player and play");const n=this._opt.url;let a={};var r;this.player._opt.autoWasm&&(a={useMSE:!1,useWCS:!1}),this.player._opt.replayUseLastFrameShow&&(r=this.screenshot("","png",.92,"base64"),a.loadingBackground=r),this._resetPlayer(a).then(()=>{this.play(n).then(()=>{this.debug.log("JbPro","mediaSourceFull and reset player and play success")}).catch(d=>{this.debug.error("JbPro","mediaSourceFull and reset player and play error",d)})}).catch(d=>{this.debug.error("JbPro","mediaSourceFull and _resetPlayer error",d)})}else this.emit(N.playFailedAndPaused,H.mediaSourceFull),this.debug.log("JbPro","mediaSourceFull and autoWasm is false")}).catch(r=>{this.debug.error("JbPro","mediaSourceFull and pause error",r)})}),this.player.once(H.mediaSourceAppendBufferError,t=>{this.emit(N.crashLog,this.getCrashLog(H.mediaSourceAppendBufferError,t)),this.pause().then(()=>{if(this.player&&this.player._opt.mseDecodeErrorReplay){this.debug.log("JbPro","mediaSourceAppendBufferError and auto wasm [mse-> wasm] reset player and play");const n=this._opt.url;let a={};var r;this.player._opt.autoWasm&&(a={useMSE:!1,useWCS:!1}),this.player._opt.replayUseLastFrameShow&&(r=this.screenshot("","png",.92,"base64"),a.loadingBackground=r),this._resetPlayer(a).then(()=>{this.play(n).then(()=>{this.debug.log("JbPro","mediaSourceAppendBufferError and reset player and play success")}).catch(d=>{this.debug.error("JbPro","mediaSourceAppendBufferError and reset player and play error",d)})}).catch(d=>{this.debug.error("JbPro","mediaSourceAppendBufferError and _resetPlayer error",d)})}else this.emit(N.playFailedAndPaused,H.mediaSourceAppendBufferError),this.debug.log("JbPro","mediaSourceAppendBufferError and autoWasm is false")}).catch(r=>{this.debug.error("JbPro","mediaSourceAppendBufferError and pause error",r)})}),this.player.once(H.mediaSourceBufferListLarge,t=>{this.emit(N.crashLog,this.getCrashLog(H.mediaSourceBufferListLarge,t)),this.pause().then(()=>{if(this.player&&this.player._opt.mseDecodeErrorReplay){this.debug.log("JbPro","media source buffer list large and auto wasm [mse-> wasm] reset player and play");const n=this._opt.url;let a={};var r;this.player._opt.autoWasm&&(a={useMSE:!1,useWCS:!1}),this.player._opt.replayUseLastFrameShow&&(r=this.screenshot("","png",.92,"base64"),a.loadingBackground=r),this._resetPlayer(a).then(()=>{this.play(n).then(()=>{this.debug.log("JbPro","media source buffer list large and reset player and play success")}).catch(d=>{this.debug.error("JbPro","media source buffer list large and reset player and play error",d)})}).catch(d=>{this.debug.error("JbPro","media source buffer list large and _resetPlayer error",d)})}else this.emit(N.playFailedAndPaused,H.mediaSourceBufferListLarge),this.debug.log("JbPro","media source buffer list large and autoWasm is false")}).catch(r=>{this.debug.error("JbPro","media source buffer list large and pause error",r)})}),this.player.once(H.mediaSourceAppendBufferEndTimeout,t=>{this.emit(N.crashLog,this.getCrashLog(H.mediaSourceAppendBufferEndTimeout,t)),this.pause().then(()=>{if(this.player&&this.player._opt.mseDecodeErrorReplay){this.debug.log("JbPro","media source append buffer end timeout and auto wasm [mse-> wasm] reset player and play");const n=this._opt.url;let a={};var r;this.player._opt.autoWasm&&(a={useMSE:!1,useWCS:!1}),this.player._opt.replayUseLastFrameShow&&(r=this.screenshot("","png",.92,"base64"),a.loadingBackground=r),this._resetPlayer(a).then(()=>{this.play(n).then(()=>{this.debug.log("JbPro","media source append buffer end timeout and reset player and play success")}).catch(d=>{this.debug.error("JbPro","media source append buffer end timeout and reset player and play error",d)})}).catch(d=>{this.debug.error("JbPro","media source append buffer end timeout and _resetPlayer error",d)})}else this.emit(N.playFailedAndPaused,H.mediaSourceAppendBufferEndTimeout),this.debug.log("JbPro","media source append buffer end timeout and autoWasm is false")}).catch(r=>{this.debug.error("JbPro","media source append buffer end timeout and pause error",r)})}),this.player.once(H.mseSourceBufferError,t=>{this.emit(N.crashLog,this.getCrashLog(H.mseSourceBufferError,t)),this.pause().then(()=>{if(this.player&&this.player._opt.mseDecodeErrorReplay){this.debug.log("JbPro","mseSourceBufferError auto wasm [mse-> wasm] reset player and play");const n=this._opt.url;let a={};var r;this.player._opt.autoWasm&&(a={useMSE:!1,useWCS:!1}),this.player._opt.replayUseLastFrameShow&&(r=this.screenshot("","png",.92,"base64"),a.loadingBackground=r),this._resetPlayer(a).then(()=>{this.play(n).then(()=>{this.debug.log("JbPro","mseSourceBufferError auto wasm [mse-> wasm] reset player and play success")}).catch(d=>{this.debug.error("JbPro","mseSourceBufferError auto wasm [mse-> wasm] reset player and play error",d)})}).catch(d=>{this.debug.error("JbPro","mseSourceBufferError auto wasm [mse-> wasm] _resetPlayer and play error",d)})}else this.emit(N.playFailedAndPaused,H.mseSourceBufferError),this.debug.log("JbPro","mseSourceBufferError and autoWasm is false")}).catch(r=>{this.debug.error("JbPro","mseSourceBufferError and pause error:",r)})}),this.player.once(H.mseAddSourceBufferError,t=>{this.emit(N.crashLog,this.getCrashLog(H.mseAddSourceBufferError,t)),this.pause().then(()=>{if(this.player&&this.player._opt.autoWasm){this.debug.log("JbPro","mseAddSourceBufferError auto wasm [mse-> wasm] reset player and play");const r=this._opt.url;this._resetPlayer({useMSE:!1,useWCS:!1}).then(()=>{this.play(r).then(()=>{this.debug.log("JbPro","mseAddSourceBufferError auto wasm [mse-> wasm] reset player and play success")}).catch(n=>{this.debug.error("JbPro","mseAddSourceBufferError auto wasm [mse-> wasm] reset player and play error",n)})}).catch(n=>{this.debug.error("JbPro","mseAddSourceBufferError auto wasm [mse-> wasm] _resetPlayer and play error",n)})}else this.emit(N.playFailedAndPaused,H.mseAddSourceBufferError),this.debug.log("JbPro","mseAddSourceBufferError and autoWasm is false")}).catch(r=>{this.debug.error("JbPro","mseAddSourceBufferError and pause error",r)})}),this.player.once(H.mediaSourceDecoderConfigurationError,t=>{this.emit(N.crashLog,this.getCrashLog(H.mediaSourceDecoderConfigurationError,t)),this.pause().then(()=>{if(this.player&&this.player._opt.autoWasm){this.debug.log("JbPro","mediaSourceDecoderConfigurationError auto wasm [mse-> wasm] reset player and play");const r=this._opt.url;this._resetPlayer({useMSE:!1,useWCS:!1}).then(()=>{this.play(r).then(()=>{this.debug.log("JbPro","mediaSourceDecoderConfigurationError auto wasm [mse-> wasm] reset player and play success")}).catch(n=>{this.debug.error("JbPro","mediaSourceDecoderConfigurationError auto wasm [mse-> wasm] reset player and play error",n)})}).catch(n=>{this.debug.error("JbPro","mediaSourceDecoderConfigurationError auto wasm [mse-> wasm] _resetPlayer and play error",n)})}else this.debug.log("JbPro","mediaSourceDecoderConfigurationError and autoWasm is false")}).catch(r=>{this.debug.error("JbPro","mediaSourceDecoderConfigurationError and pause error",r)})}),this.player.once(H.mediaSourceTsIsMaxDiff,t=>{this.emit(N.crashLog,this.getCrashLog(H.mediaSourceTsIsMaxDiff,t)),this.pause().then(()=>{if(this.player&&this.player._opt.mediaSourceTsIsMaxDiffReplay){this.debug.log("JbPro","mediaSourceTsIsMaxDiff reset player and play");const r=this._opt.url,n={};n.loadingBackground=this.screenshot("","png",.92,"base64"),this._resetPlayer(n).then(()=>{this.play(r).then(()=>{}).catch(a=>{this.debug.error("JbPro","mediaSourceTsIsMaxDiff replay error",a)})}).catch(a=>{this.debug.error("JbPro","mediaSourceTsIsMaxDiff _resetPlayer error",a)})}else this.emit(N.playFailedAndPaused,H.mediaSourceTsIsMaxDiff),this.debug.log("JbPro","mediaSourceTsIsMaxDiff and replay is false")}).catch(r=>{this.debug.error("JbPro","mediaSourceTsIsMaxDiff and pause error",r)})}),this.player.once(H.mseWidthOrHeightChange,t=>{this.emit(N.crashLog,this.getCrashLog(H.mseWidthOrHeightChange,t)),this.debug.log("JbPro","mseWidthOrHeightChange and reset player and play");const r=this._opt.url,n=this.screenshot("","png",.92,"base64");this._resetPlayer({loadingBackground:n}).then(()=>{this.play(r).then(()=>{this.debug.log("JbPro","mseWidthOrHeightChange and reset player and play success")}).catch(a=>{this.debug.error("JbPro","mseWidthOrHeightChange and reset player and play error",a)})}).catch(a=>{this.debug.error("JbPro","mseWidthOrHeightChange and _resetPlayer error",a)})}),this.player.once(H.mediaSourceUseCanvasRenderPlayFailed,t=>{this.emit(N.crashLog,this.getCrashLog(H.mediaSourceUseCanvasRenderPlayFailed,t)),this.debug.log("JbPro","mediaSourceUseCanvasRenderPlayFailed and reset player"),this.pause().then(()=>{this._resetPlayer().then(()=>{this.debug.log("JbPro","mediaSourceUseCanvasRenderPlayFailed and reset player success")}).catch(r=>{this.debug.error("JbPro","mediaSourceUseCanvasRenderPlayFailed and reset player error",r)})}).catch(r=>{this.debug.error("JbPro","mediaSourceUseCanvasRenderPlayFailed and pause",r)})}),this.player.once(H.webcodecsH265NotSupport,t=>{this.emit(N.crashLog,this.getCrashLog(H.webcodecsH265NotSupport,t)),this.pause().then(()=>{if(this.player&&this.player._opt.autoWasm){this.debug.log("JbPro","webcodecsH265NotSupport auto wasm [wcs-> wasm] reset player and play");const r=this._opt.url;this._resetPlayer({useMSE:!1,useWCS:!1}).then(()=>{this.play(r).then(()=>{this.debug.log("JbPro","webcodecsH265NotSupport auto wasm [wcs-> wasm] reset player and play success")}).catch(n=>{this.debug.error("JbPro","webcodecsH265NotSupport auto wasm [wcs-> wasm] reset player and play error",n)})}).catch(n=>{this.debug.error("JbPro","webcodecsH265NotSupport auto wasm [wcs-> wasm] _resetPlayer and play error",n)})}else this.emit(N.playFailedAndPaused,H.webcodecsH265NotSupport),this.debug.log("JbPro","webcodecsH265NotSupport and autoWasm is false")}).catch(r=>{this.debug.error("JbPro","webcodecsH265NotSupport and pause error",r)})}),this.player.once(H.webcodecsUnsupportedConfigurationError,t=>{this.emit(N.crashLog,this.getCrashLog(H.webcodecsUnsupportedConfigurationError,t)),this.pause().then(()=>{if(this.player&&this.player._opt.autoWasm){this.debug.log("Jessibuca","webcodecsUnsupportedConfigurationError auto wasm [wcs-> wasm] reset player and play");const r=this._opt.url;this._resetPlayer({useMSE:!1,useWCS:!1}).then(()=>{this.play(r).then(()=>{this.debug.log("Jessibuca","webcodecsUnsupportedConfigurationError auto wasm [wcs-> wasm] reset player and play success")}).catch(n=>{this.debug.error("Jessibuca","webcodecsUnsupportedConfigurationError auto wasm [wcs-> wasm] reset player and play error",n)})}).catch(n=>{this.debug.error("Jessibuca","webcodecsUnsupportedConfigurationError auto wasm [wcs-> wasm] _resetPlayer and play error",n)})}else this.emit(N.playFailedAndPaused,H.webcodecsUnsupportedConfigurationError),this.debug.log("Jessibuca","webcodecsUnsupportedConfigurationError and autoWasm is false")}).catch(r=>{this.debug.error("Jessibuca","webcodecsUnsupportedConfigurationError and pause error",r)})}),this.player.once(H.webcodecsDecodeError,t=>{this.emit(N.crashLog,this.getCrashLog(H.webcodecsDecodeError,t)),this.pause().then(()=>{if(this.player&&this.player._opt.wcsDecodeErrorReplay){this.debug.log("JbPro","webcodecs decode error reset player and play");const n=this._opt.url;let a={};var r;this.player._opt.autoWasm&&(a={useMSE:!1,useWCS:!1}),this.player._opt.replayUseLastFrameShow&&(r=this.screenshot("","png",.92,"base64"),a.loadingBackground=r),this._resetPlayer(a).then(()=>{this.play(n).then(()=>{this.debug.log("JbPro","webcodecs decode error  reset player and play success")}).catch(d=>{this.debug.error("JbPro","webcodecs decode error reset player and play error",d)})}).catch(()=>{this.debug.error("JbPro","webcodecs decode error _resetPlayer error")})}else this.emit(N.playFailedAndPaused,H.webcodecsDecodeError),this.debug.log("JbPro","webcodecs decode error and autoWasm is false")}).catch(r=>{this.debug.error("JbPro","webcodecs decode error and pause error",r)})}),this.player.once(H.wcsWidthOrHeightChange,t=>{this.emit(N.crashLog,this.getCrashLog(H.wcsWidthOrHeightChange,t)),this.debug.log("JbPro","wcsWidthOrHeightChange and reset player and play");const r=this._opt.url,n=this.screenshot("","png",.92,"base64");this._resetPlayer({loadingBackground:n}).then(()=>{this.play(r).then(()=>{this.debug.log("JbPro","wcsWidthOrHeightChange and reset player and play success")}).catch(a=>{this.debug.error("JbPro","wcsWidthOrHeightChange and reset player and play error",a)})}).catch(a=>{this.debug.error("JbPro","wcsWidthOrHeightChange and _resetPlayer error",a)})}),this.player.once(H.wasmDecodeError,t=>{this.emit(N.crashLog,this.getCrashLog(H.wasmDecodeError,t)),this.pause().then(()=>{if(this.player&&this.player._opt.wasmDecodeErrorReplay){this.debug.log("JbPro","wasm decode error and reset player and play");const n=this._opt.url,a={};var r;this.player._opt.replayUseLastFrameShow&&(r=this.screenshot("","png",.92,"base64"),a.loadingBackground=r),this._resetPlayer(a).then(()=>{this.play(n).then(()=>{this.debug.log("JbPro","wasm decode error and reset player and play success")}).catch(d=>{this.debug.error("JbPro","wasm decode error and reset player and play error",d)})}).catch(()=>{this.debug.error("JbPro","wasm decode error and _resetPlayer error")})}else this.emit(N.playFailedAndPaused,H.wasmDecodeError),this.debug.log("JbPro","wasm decode error and wasmDecodeErrorReplay is false")}).catch(r=>{this.debug.error("JbPro","wasm decode error and pause error",r)})}),this.player.once(H.wasmDecodeVideoNoResponseError,t=>{this.emit(N.crashLog,this.getCrashLog(H.wasmDecodeVideoNoResponseError,t)),this.pause().then(()=>{this.debug.log("JbPro","wasm decode video no response error and reset player and play");const r=this._opt.url,n={};if(this.player&&this.player._opt.replayUseLastFrameShow){const a=this.screenshot("","png",.92,"base64");n.loadingBackground=a}this._resetPlayer(n).then(()=>{this.play(r).then(()=>{this.debug.log("JbPro","wasm decode video no response error and reset player and play success")}).catch(a=>{this.debug.error("JbPro","wasm decode video no response error and reset player and play error",a)})}).catch(a=>{this.debug.error("JbPro","wasm decode video no response error and _resetPlayer error",a)})}).catch(r=>{this.debug.error("JbPro","wasm decode video no response error and pause error",r)})}),this.player.once(H.wasmWidthOrHeightChange,t=>{this.emit(N.crashLog,this.getCrashLog(H.wasmWidthOrHeightChange,t)),this.debug.log("JbPro","wasmWidthOrHeightChange and reset player and play");const r=this._opt.url,n=this.screenshot("","png",.92,"base64");this._resetPlayer({loadingBackground:n}).then(()=>{this.play(r).then(()=>{this.debug.log("JbPro","wasmWidthOrHeightChange and reset player and play success")}).catch(a=>{this.debug.error("JbPro","wasmWidthOrHeightChange and reset player and play error",a)})}).catch(a=>{this.debug.error("JbPro","wasmWidthOrHeightChange and _resetPlayer error",a)})}),this.player.once(H.wasmUseVideoRenderError,t=>{this.emit(N.crashLog,this.getCrashLog(H.wasmUseVideoRenderError,t)),this.debug.log("JbPro","wasmUseVideoRenderError and reset player and play");const r=this._opt.url;this._resetPlayer({useVideoRender:!1}).then(()=>{this.play(r).then(()=>{this.debug.log("JbPro","wasmUseVideoRenderError and reset player and play success")}).catch(n=>{this.debug.error("JbPro","wasmUseVideoRenderError and reset player and play error",n)})}).catch(n=>{this.debug.error("JbPro","wasmUseVideoRenderError and _resetPlayer error",n)})}),this.player.once(H.simdH264DecodeVideoWidthIsTooLarge,t=>{this.emit(N.crashLog,this.getCrashLog(H.simdH264DecodeVideoWidthIsTooLarge,t)),this.pause().then(()=>{this.debug.log("JbPro","simdH264DecodeVideoWidthIsTooLarge and reset player and play");const r=this._opt.url;this._resetPlayer({useSIMD:!1}).then(()=>{this.play(r).then(()=>{this.debug.log("JbPro","simdH264DecodeVideoWidthIsTooLarge and reset player and play success")}).catch(n=>{this.debug.error("JbPro","simdH264DecodeVideoWidthIsTooLarge and reset player and play error",n)})}).catch(n=>{this.debug.error("JbPro","simdH264DecodeVideoWidthIsTooLarge and _resetPlayer error",n)})}).catch(r=>{this.debug.error("JbPro","simdH264DecodeVideoWidthIsTooLarge and pause error",r)})}),this.player.once(N.networkDelayTimeout,t=>{if(this.player._opt.networkDelayTimeoutReplay){this.emit(N.crashLog,this.getCrashLog(N.networkDelayTimeout,t)),this.debug.log("JbPro","network delay time out and reset player and play");const r=this._opt.url,n={};if(this.player&&this.player._opt.replayUseLastFrameShow){const a=this.screenshot("","png",.92,"base64");n.loadingBackground=a}this._resetPlayer(n).then(()=>{this.play(r).then(()=>{this.debug.log("JbPro","wasm decode error and reset player and play success")}).catch(a=>{this.debug.error("JbPro","wasm decode error and reset player and play error",a)})}).catch(()=>{this.debug.error("JbPro","wasm decode error and _resetPlayer error")})}}),this.player.once(H.fetchError,t=>{this.emit(N.crashLog,this.getCrashLog(H.fetchError,t)),this.debug.log("JbPro","fetch error and reset player"),this.pause().then(()=>{this._resetPlayer().then(()=>{this.emit(N.playFailedAndPaused,H.fetchError)}).catch(()=>{this.emit(N.playFailedAndPaused,H.fetchError)})}).catch(r=>{this.debug.error("JbPro","fetch error and pause",r)})}),this.player.once(N.streamEnd,t=>{this.emit(N.crashLog,this.getCrashLog(N.streamEnd,t)),this.debug.log("JbPro","streamEnd reset player"),this.pause().then(()=>{this._resetPlayer().then(()=>{this.emit(N.playFailedAndPaused,N.streamEnd)}).catch(()=>{this.emit(N.playFailedAndPaused,N.streamEnd)})}).catch(r=>{this.debug.error("JbPro","streamEnd pause",r)})}),this.player.once(H.websocketError,t=>{this.emit(N.crashLog,this.getCrashLog(H.websocketError,t)),this.debug.log("JbPro","websocketError and reset player"),this.pause().then(()=>{this._resetPlayer().then(()=>{this.emit(N.playFailedAndPaused,H.websocketError)}).catch(()=>{this.emit(N.playFailedAndPaused,H.websocketError)})}).catch(r=>{this.debug.error("JbPro","websocketError and pause",r)})}),this.player.once(H.webrtcError,t=>{this.emit(N.crashLog,this.getCrashLog(H.webrtcError,t)),this.debug.log("JbPro","webrtcError and reset player"),this.pause().then(()=>{this._resetPlayer().then(()=>{this.emit(N.playFailedAndPaused,H.webrtcError)}).catch(()=>{this.emit(N.playFailedAndPaused,H.webrtcError)})}).catch(r=>{this.debug.error("JbPro","webrtcError and pause",r)})}),this.player.once(H.hlsError,t=>{this.emit(N.crashLog,this.getCrashLog(H.hlsError,t)),this.debug.log("JbPro","hlsError and reset player"),this.pause().then(()=>{this._resetPlayer().then(()=>{this.emit(N.playFailedAndPaused,H.hlsError)}).catch(()=>{this.emit(N.playFailedAndPaused,H.hlsError)})}).catch(r=>{this.debug.error("JbPro","hlsError and pause",r)})}),this.player.on(N.delayTimeout,t=>{this.emit(N.crashLog,this.getCrashLog(N.delayTimeout,t)),this.isDestroyed()?this.debug.log("JbPro","delay timeout but player is destroyed"):this.pause().then(()=>{if(this.player&&this.player._opt.heartTimeoutReplay&&(this._heartTimeoutReplayTimes<this.player._opt.heartTimeoutReplayTimes||this.player._opt.heartTimeoutReplayTimes===-1))if(this.debug.log("JbPro",`delay timeout replay time is ${this._heartTimeoutReplayTimes} and heartTimeoutReplayTimes is `+this.player._opt.heartTimeoutReplayTimes),this.isDestroyed())this.debug&&this.debug.warn("JbPro","delay timeout replay but player is destroyed");else{this._heartTimeoutReplayTimes+=1;const r=this._opt.url,n={};(this.player._opt.heartTimeoutReplayUseLastFrameShow||this.player._opt.replayUseLastFrameShow)&&(n.loadingBackground=this.screenshot("","png",.92,"base64")),this._resetPlayer(n).then(()=>{this.play(r).then(()=>{}).catch(a=>{this.debug.error("JbPro","delay timeout replay error",a)})}).catch(a=>{this.debug.error("JbPro","delay timeout _resetPlayer error",a)})}else this.emit(N.playFailedAndPaused,N.delayTimeout),this.player&&this.player.emit(N.delayTimeoutRetryEnd),this.debug.warn("JbPro",`delayTimeoutRetryEnd and
                            opt.heartTimeout is ${this.player&&this.player._opt.heartTimeout} and
                            opt.heartTimeoutReplay is ${this.player&&this.player._opt.heartTimeoutReplay} and
                            opt.heartTimeoutReplayTimes is ${this.player&&this.player._opt.heartTimeoutReplayTimes},and
                            local._heartTimeoutReplayTimes is `+this._heartTimeoutReplayTimes)}).catch(r=>{this.debug.error("JbPro","delay timeout and pause error",r)})}),this.player.on(N.loadingTimeout,t=>{this.emit(N.crashLog,this.getCrashLog(N.loadingTimeout,t)),this.isDestroyed()?this.debug.log("JbPro","loading timeout but player is destroyed"):this.pause().then(()=>{if(this.player&&this.player._opt.loadingTimeoutReplay&&(this._loadingTimeoutReplayTimes<this.player._opt.loadingTimeoutReplayTimes||this.player._opt.loadingTimeoutReplayTimes===-1))if(this.debug.log("JbPro",`loading timeout and
                             replay time is ${this._loadingTimeoutReplayTimes} and
                             loadingTimeoutReplayTimes is `+this.player._opt.loadingTimeoutReplayTimes),this.isDestroyed())this.debug&&this.debug.warn("JbPro","delay timeout replay but player is destroyed");else{this._loadingTimeoutReplayTimes+=1;const r=this._opt.url;this._resetPlayer().then(()=>{this.play(r).then(()=>{}).catch(n=>{this.debug.error("JbPro","loading timeout replay error",n)})}).catch(n=>{this.debug.error("JbPro","loading timeout _resetPlayer error",n)})}else this.emit(N.playFailedAndPaused,N.loadingTimeout),this.player&&this.player.emit(N.loadingTimeoutRetryEnd),this.debug.log("JbPro",`loadingTimeoutRetryEnd and
                            opt.loadingTimeout is ${this.player&&this.player._opt.loadingTimeout} and
                            opt.loadingTimeoutReplay is ${this.player&&this.player._opt.loadingTimeoutReplay} and
                            local._loadingTimeoutReplayTimes time is ${this._loadingTimeoutReplayTimes} and
                            opt.loadingTimeoutReplayTimes is `+(this.player&&this.player._opt.loadingTimeoutReplayTimes))}).catch(r=>{this.debug.error("JbPro","loading timeout and pause error",r)})}),this._hasLoaded()?this.player.play(e,i).then(()=>{s()}).catch(t=>{this.debug.error("JbPro","_hasLoaded() and play error",t),this.emit(N.crashLog,this.getCrashLog("_hasLoaded() and play error",t)),this.player.pause().then(()=>{u(t)}).catch(r=>{this.debug.error("JbPro","_hasLoaded() and play error and next pause error",r)})}):this.player.once(N.decoderWorkerInit,()=>{this.player.play(e,i).then(()=>{s()}).catch(t=>{this.debug.error("JbPro","decoderWorkerInit and play error",t),this.emit(N.crashLog,this.getCrashLog("decoderWorkerInit and play error",t)),this.player&&this.player.pause().then(()=>{u(t)}).catch(r=>{this.debug.error("JbPro","decoderWorkerInit and play error and next pause error",r)})})})};_&&_e(this._opt.supportHls265)||o||c||E?(this.debug.log("JbPro","need reset player"),this._resetPlayer({protocol:T,demuxType:h,isHls:_,isWebrtc:o,url:e}).then(()=>{k()}).catch(t=>{u("reset player error")})):(this.player.updateOption({protocol:T,demuxType:h,isHls:_,isFlv:this._opt.isFlv,isFmp4:this._opt.isFmp4,isMpeg4:this._opt.isMpeg4,isNakedFlow:this._opt.isNakedFlow,cryptoKey:i.cryptoKey||"",cryptoIV:i.cryptoIV||""}),i.cryptoKey&&i.cryptoIV&&(this.player.decoderWorker&&this.player.decoderWorker.updateWorkConfig({key:"cryptoKey",value:i.cryptoKey}),this.player.decoderWorker)&&this.player.decoderWorker.updateWorkConfig({key:"cryptoIV",value:i.cryptoIV}),k())})}resize(){this.debug.log("JbPro","resize()"),this.player&&this.player.resize()}setBufferTime(e){this.debug.log("JbPro","setBufferTime() "+e),e=Number(e),this.player?(10<e&&this.debug.warn("JbPro",`setBufferTime() buffer time is ${e} second, is too large, video will show blank screen until cache ${e} second buffer data`),this.player.updateOption({videoBuffer:1e3*e}),this.player.decoderWorker&&this.player.decoderWorker.updateWorkConfig({key:"videoBuffer",value:1e3*e})):this.debug.warn("JbPro","setBufferTime() player is not ready")}setBufferDelayTime(e){this.debug.log("JbPro","setBufferDelayTime() "+e),e=Number(e),this.player?(e<.2&&this.debug.warn("JbPro",`setBufferDelayTime() buffer time delay is ${e} second, is too small`),e=ft(e,.2,100),this.player.updateOption({videoBufferDelay:1e3*e}),this.player.decoderWorker&&this.player.decoderWorker.updateWorkConfig({key:"videoBufferDelay",value:1e3*e})):this.debug.warn("JbPro","setBufferDelayTime() player is not ready")}setRotate(e){this.debug.log("JbPro","setRotate() "+e),e=parseInt(e,10),this.player?this._opt.rotate!==e&&[0,90,180,270].indexOf(e)!==-1?(this.player.updateOption({rotate:e}),this.resize()):this.debug.warn("JbPro",`setRotate() rotate is ${e} and this._opt.rotate is `+this._opt.rotate):this.debug.warn("JbPro","setRotate() player is not ready")}setMirrorRotate(e){this.debug.log("JbPro","setMirrorRotate() "+e),this.player?this._opt.mirrorRotate!==e&&["none","level","vertical"].indexOf(e)!==-1?(this.player.updateOption({mirrorRotate:e}),this.resize()):this.debug.warn("JbPro",`setMirrorRotate() mirrorRotate is ${e} and this._opt.mirrorRotate is `+this._opt.mirrorRotate):this.debug.warn("JbPro","setMirrorRotate() player is not ready")}hasLoaded(){return!0}_hasLoaded(){return this.player&&this.player.loaded||!1}setKeepScreenOn(){this.debug.log("JbPro","setKeepScreenOn()"),this.player?this.player.updateOption({keepScreenOn:!0}):this.debug.warn("JbPro","setKeepScreenOn() player is not ready")}setFullscreen(e){this.debug.log("JbPro","setFullscreen() "+e),e=!!e,this.player?this.player.fullscreen!==e&&(this.player.fullscreen=e):this.debug.warn("JbPro","setFullscreen() player is not ready")}screenshot(e,i,s,u){return this.debug.log("JbPro",`screenshot() ${e} ${i} ${s} `+u),this.player&&this.player.video?this.player.video.screenshot(e,i,s,u):(this.debug.warn("JbPro","screenshot() player is not ready"),null)}screenshotWatermark(e){return new Promise((i,s)=>{this.debug.log("JbPro","screenshotWatermark()",e),this.player&&this.player.video?this.player.video.screenshotWatermark(e).then(u=>{i(u)}).catch(u=>{s(u)}):(this.debug.warn("JbPro","screenshotWatermark() player is not ready"),s("player is not ready"))})}startRecord(e,i){return new Promise((s,u)=>{if(this.debug.log("JbPro",`startRecord() ${e} `+i),!this.player)return this.debug.warn("JbPro","startRecord() player is not ready"),u("player is not ready");this.player.playing?(this.player.startRecord(e,i),s()):(this.debug.warn("JbPro","startRecord() player is not playing"),u("not playing"))})}stopRecordAndSave(e,i){return new Promise((s,u)=>{this.debug.log("JbPro",`stopRecordAndSave() ${e} `+i),this.player&&this.player.recording?this.player.stopRecordAndSave(e,i).then(c=>{s(c)}).catch(c=>{u(c)}):u("not recording")})}isPlaying(){let e=!1;return this.player&&(this._opt.playType===Ie?e=this.player.playing:this._opt.playType===pe&&(e=_e(this.player.playbackPause)&&this.player.playing)),e}isLoading(){return!!this.player&&this.player.loading}isPause(){let e=!1;return this._opt.playType===Ie?e=!this.isPlaying()&&!this.isLoading():this._opt.playType===pe&&this.player&&(e=this.player.playbackPause),e}isPaused(){return this.isPause()}isPlaybackPause(){let e=!1;return e=this._opt.playType===pe&&this.player?this.player.playbackPause:e}isMute(){let e=!0;return e=this.player?this.player.isAudioMute():e}isRecording(){return this.player&&this.player.recorder&&this.player.recorder.recording||!1}clearBufferDelay(){this.debug.log("JbPro","clearBufferDelay()"),this.player?this.player.clearBufferDelay():this.debug.warn("JbPro","clearBufferDelay() player is not init")}setNetworkDelayTime(e){this.debug.log("JbPro","setNetworkDelayTime() "+e),e=Number(e),this.player?(e<1&&this.debug.warn("JbPro",`setNetworkDelayTime() network delay is ${e} second, is too small`),e=ft(e,1,100),this.player.updateOption({networkDelay:1e3*e}),this.player.decoderWorker&&this.player.decoderWorker.updateWorkConfig({key:"networkDelay",value:1e3*e})):this.debug.warn("JbPro","setNetworkDelayTime() player is not init")}getDecodeType(){let e="";return e=this.player?this.player.getDecodeType():e}getRenderType(){let e="";return e=this.player?this.player.getRenderType():e}getAudioEngineType(){let e="";return e=this.player?this.player.getAudioEngineType():e}getPlayingTimestamp(){let e=0;return e=this.player?this.player.getPlayingTimestamp():e}getStatus(){let e="destroy";return e=this.player?this.player.loading?"loading":this.player.playing?"playing":"paused":e}getPlayType(){return this.player?this.player._opt.playType:Ie}togglePerformancePanel(e){this.debug.log("JbPro","togglePerformancePanel() "+e);var i=this.player._opt.showPerformance;let s=!i;(s=sa(e)?e:s)!==i?this.player?this.player.togglePerformancePanel(s):this.debug.warn("JbPro","togglePerformancePanel() failed, this.player is not init"):this.debug.warn("JbPro",`togglePerformancePanel() failed, showPerformance is prev: ${i} === now: `+s)}openZoom(){this.debug.log("JbPro","openZoom()"),this.player?this.player.zooming=!0:this.debug.warn("JbPro","openZoom() failed, this.player is not init")}closeZoom(){this.debug.log("JbPro","closeZoom()"),this.player?this.player.zooming=!1:this.debug.warn("JbPro","closeZoom() failed, this.player is not init")}isZoomOpen(){let e=!1;return e=this.player?this.player.zooming:e}expandZoom(){this.debug.log("JbPro","expandZoom()"),this.player&&this.player.zoom&&this.player.zooming?this.player.zoom.expandPrecision():this.debug.warn("JbPro","expandZoom() failed, zoom is not open or not init")}narrowZoom(){this.debug.log("JbPro","narrowZoom()"),this.player&&this.player.zoom&&this.player.zooming?this.player.zoom.narrowPrecision():this.debug.warn("JbPro","narrowZoom failed, zoom is not open or not init")}getCurrentZoomIndex(){let e=1;return e=this.player&&this.player.zoom?this.player.zoom.currentZoom:e}startTalk(e){let i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};return new Promise((s,u)=>{this.debug.log("JbPro","startTalk()",e,i),this._initTalk(i),this.talk.startTalk(e).then(()=>{s(),this.talk.once(N.talkStreamClose,()=>{this.debug.warn("JbPro","talk stream close"),this.stopTalk().catch(c=>{})}),this.talk.once(N.talkStreamError,c=>{this.debug.warn("JbPro","talk stream error",c),this.stopTalk().catch(l=>{})}),this.talk.once(N.talkStreamInactive,()=>{this.debug.warn("JbPro","talk stream inactive"),this.stopTalk().catch(c=>{})})}).catch(c=>{u(c)})})}stopTalk(){return new Promise((e,i)=>{if(this.debug.log("JbPro","stopTalk()"),!this.talk)return i("stopTalk() talk is not init");this.talk.destroy(),e()})}getTalkVolume(){return new Promise((e,i)=>{if(!this.talk)return i("getTalkVolume() talk is not init");e(this.talk.volume)})}setTalkVolume(e){return new Promise((i,s)=>{if(this.debug.log("JbPro","setTalkVolume()",e),!this.talk)return s("setTalkVolume() talk is not init");this.talk.setVolume(e/100),i()})}setNakedFlowFps(e){return new Promise((i,s)=>{var u;return this.debug.log("JbPro","setNakedFlowFps()",e),this.player?wi(e)?s("setNakedFlowFps() fps is empty"):(u=ft(u=Number(e),1,100),void this.player.updateOption({nakedFlowFps:u})):s("setNakedFlowFps() player is not init")})}getCrashLog(e){var i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"";if(this.player){var u=this.player.getAllStatsData(),s=this.player,u={url:this._opt.url,playType:s.isPlayback()?"playback":"live",demuxType:s.getDemuxType(),decoderType:s.getDecodeType(),renderType:s.getRenderType(),videoInfo:{encType:"",width:"",height:""},audioInfo:{encType:"",sampleRate:"",channels:""},audioEngine:s.getAudioEngineType(),allTimes:u.pTs,timestamp:be(),type:e,error:(function(c){const l=Object.prototype.toString;return(function(o){switch(l.call(o)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return 1;default:try{return o instanceof Error}catch{}}})(c)?c.message:c==null?"":typeof c=="object"?JSON.stringify(c,null,2):String(c)})(i)||e};if(s.video){const c=s.video.videoInfo||{};u.videoInfo={encType:c.encType||"",width:c.width||"",height:c.height||""}}if(s.audio){const c=s.audio.audioInfo||{};u.audioInfo={encType:c.encType||"",sampleRate:c.sampleRate||"",channels:c.channels||""}}return u}}updateDebugLevel(e){this.debug.log("JbPro","updateDebugLevel()",e),this.player?e!==kt&&e!==Bt?this.debug.warn("JbPro","updateDebugLevel() level is not valid, level: "+e):e===this.player._opt.debugLevel?this.debug.warn("JbPro","updateDebugLevel() level is same, level: "+e):(this.player.updateOption({debugLevel:e}),this.player.decoderWorker&&this.player.decoderWorker.updateWorkConfig({key:"debugLevel",value:e})):this.debug.warn("JbPro","updateDebugLevel() player is not init")}updateWatermark(e){this.debug.log("JbPro","updateWatermark()",e),this.player?this.player.updateWatermark(e):this.debug.warn("JbPro","updateWatermark() player is not init")}removeWatermark(){this.debug.log("JbPro","removeWatermark()"),this.player?this.player.removeWatermark():this.debug.warn("JbPro","removeWatermark() player is not init")}updateFullscreenWatermark(e){var i;this.debug.log("JbPro","updateFullscreenWatermark()",e),jr(e)?(this._opt.fullscreenWatermarkConfig=e,(i=na(this.$container,e)).watermark_txt?this.watermark.load(i):this.debug.warn("JbPro","fullscreenWatermarkConfig text is empty")):this.debug.warn("JbPro","updateFullscreenWatermark() config is not valid, config: "+e)}removeFullscreenWatermark(){this.debug.log("JbPro","removeFullscreenWatermark()"),this.watermark?this.watermark.remove():this.debug.warn("JbPro","removeFullscreenWatermark() watermark is not init")}faceDetectOpen(){this.debug.log("JbPro","faceDetectOpen()"),this.player?this.player.faceDetect(!0):this.debug.warn("JbPro","faceDetectOpen() player is not init")}faceDetectClose(){this.debug.log("JbPro","faceDetectClose()"),this.player?this.player.faceDetect(!1):this.debug.warn("JbPro","faceDetectClose() player is not init")}objectDetectOpen(){this.debug.log("JbPro","objectDetectOpen()"),this.player?this.player.objectDetect(!0):this.debug.warn("JbPro","objectDetectOpen() player is not init")}objectDetectClose(){this.debug.log("JbPro","objectDetectClose()"),this.player?this.player.objectDetect(!1):this.debug.warn("JbPro","objectDetectClose() player is not init")}sendWebsocketMessage(e){this.debug.log("JbPro","sendWebsocketMessage()",e),this.player?this.player.sendWebsocketMessage(e):this.debug.warn("JbPro","sendWebsocketMessage() player is not init")}addContentToCanvas(e){this.debug.log("JbPro","addContentToCanvas()",e),this.player?this.player.addContentToCanvas(e):this.debug.warn("JbPro","addContentToCanvas() player is not init")}clearContentToCanvas(){this.debug.log("JbPro","clearContentToCanvas()"),this.player?this.player.addContentToCanvas([]):this.debug.warn("JbPro","clearContentToCanvas() player is not init")}setControlHtml(e){this.debug.log("JbPro","setControlHtml()",e),this.player?this.player.setControlHtml(e):this.debug.warn("JbPro","setControlHtml() player is not init")}clearControlHtml(){this.debug.log("JbPro","clearControlHtml()"),this.player?this.player.clearControlHtml():this.debug.warn("JbPro","clearControlHtml() player is not init")}getVideoInfo(){let e=null;return e=this.player?this.player.getVideoInfo():e}getAudioInfo(){let e=null;return e=this.player?this.player.getAudioInfo():e}downloadTempNakedFlowFile(){return new Promise((e,i)=>{this.player?(this.player.downloadNakedFlowFile(),e()):i("player is not init")})}downloadTempFmp4File(){return new Promise((e,i)=>{this.player?(this.player.downloadFmp4File(),e()):i("player is not init")})}downloadTempRtpFile(){return new Promise((e,i)=>{this.talk?(this.talk.downloadRtpFile(),e()):i("talk is not init")})}}Ni.ERROR=H,Ni.EVENTS=ae,window.JessibucaPro=Ni,window.WebPlayerPro=Ni;class ji extends Ae{_opt={};constructor(){let e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};super(),Object.keys(e).forEach(u=>{if(e[u]===void 0)throw new Error(`Jessibuca-pro-multi option "${u}" can not be undefined`)});var i=li(Mn);this._opt=Object.assign({},i,e),this.LOG_TAG="jessibucaProMulti";let s=e.container;if(!(s=typeof e.container=="string"?document.querySelector(e.container):s))throw new Error("Jessibuca-pro-multi need container option");if(s.nodeName==="CANVAS"||s.nodeName==="VIDEO")throw new Error(`Jessibuca-pro-multi container type can not be ${s.nodeName} type`);s.classList.add("jessibuca-multi-container"),this.maxWindowSize=this._opt.maxSplit*this._opt.maxSplit,this.currentWindowIndex=-1,this.specialLayoutType=null,this.windowList=[],this.$container=s,this.debug=new tr(this),this.events=new dr(this),this._initWindows(),this._initEvents(),this._handleWindowSelect(0),this._listenFullscreenChange()}destroy(){return new Promise((e,i)=>{if(this.debug.log(this.LOG_TAG,"destroy()"),this.off(),this.events&&(this.events.destroy(),this.events=null),this.specialLayoutType=null,this.windowList){const s=[];this.windowList.forEach(u=>{u.$playerContainerEvents.forEach(c=>{c()}),u.player&&s.push(u.player.destroy())}),Promise.all(s).then(()=>{this.windowList.forEach(u=>{u.player=null}),this.windowList=[],e()}).catch(u=>{i(u)})}else e();this.debug&&this.debug.log(this.LOG_TAG,"destroy")})}_createPlayer(e){const i=this._findWindowItemIndex(e),s=this._opt,u=(s.supportDblclickContainerFullscreen&&(s.supportDblclickFullscreen=!1),new Ni({...s,isMulti:!0,container:e.$player}));return Object.keys(ae).forEach(c=>{u.on(ae[c],l=>{this.emit(c,i,l)})}),u.on(N.close,()=>{this.emit(N.close,i),e.player=null}),u}_initWindows(){const e=this._getContainerRect(),i=e.width,s=e.height;let u="";var c,l,o,f,_=this._opt.split,g=i%_,T=s%_,E=(i-g-2*_)/_,h=(s-T-2*_)/_,k=(i-g)/_,t=(s-T)/_;for(let a=0;a<this.maxWindowSize;a++)c=E+(a%_==_-1?g:0),l=h+(a+_>=Math.pow(_,2)?T:0),o=k+(a%_==_-1?g:0),f=t+(a+_>=Math.pow(_,2)?T:0),u+=`
             <div class="jessibuca-multi-player" wid="${a}" style='float: left;position:relative;overflow: hidden; background-color:${this._opt.style.background};width: ${o+"px"};height: ${f+"px"}'>
                <div class="jessibuca-multi-player-draw-window" wid="${a}" style='position:absolute; z-index: 1; width:${c+"px"}; height:${l+"px"};border: 1px solid ${this._opt.style.border}'></div>
                <div class="jessibuca-multi-player-video-window" wid="${a}" style='position:absolute;left: 1px;top:1px; z-index: 2; width:${c+"px"}; height:${l+"px"};'></div>
             </div>
            `;var r=`<div class="jessibuca-multi-player-container" style="overflow: hidden;width:100%; height:100%; position: relative;">${u}</div>`,n=(this.$container.innerHTML=r,this.$container.querySelectorAll(".jessibuca-multi-player"));for(let a=0;a<this.maxWindowSize;a++){const d=n[a],p=d.querySelector(".jessibuca-multi-player-draw-window"),m=d.querySelector(".jessibuca-multi-player-video-window");this.windowList[a]={uuid:sr(),isContainerFullscreen:!1,$playerContainer:d,$playerBorder:p,$player:m,$playerContainerEvents:[],player:null}}for(let a=this._getCurrentMaxSplit();a<this.maxWindowSize;a++){const d=this.windowList[a];d.$player.style.display="none",d.$playerBorder.style.display="none",d.$playerContainer.style.width="0",d.$playerContainer.style.height="0"}}_initEvents(){const e=this.events.proxy;this.windowList.forEach((i,s)=>{var f=i.$playerContainer,u=e(f,"click",()=>{this.emit(ri.selected,s),this.getSelectedWindowIndex()===s&&this.windowList[s].isContainerFullscreen||this._opt.split!==1&&this._handleWindowSelect(s)}),c=e(f,"dblclick",()=>{this.emit(ri.dblSelected,s),this._opt.supportDblclickContainerFullscreen&&this._opt.split!==1&&this._handleWindowContainerFullscreen(s)}),l=e(f,"mouseup",()=>{this.emit(ri.mouseUp,s)}),o=e(f,"mouseover",()=>{this.emit(ri.mouseOver,s)}),f=e(f,"mouseout",()=>{this.emit(ri.mouseOut,s)});i.$playerContainerEvents=[u,l,o,f,c]})}_getContainerRect(){var e=this.$container.getBoundingClientRect();return{width:Math.max(e.width,this.$container.clientWidth),height:Math.max(e.height,this.$container.clientHeight)}}_updateWindows(){const e=this._getContainerRect(),i=e.width,s=e.height,u=this._opt.split,c=i%u,l=s%u,o=(i-c-2*u)/u,f=(s-l-2*u)/u,_=(i-c)/u,g=(s-l)/u;let T=this._getCurrentMaxSplit();for(let E=0;E<T;E++){const h=this.windowList[E],k=(h.isContainerFullscreen=!1,h.$playerContainer),t=(k.style.position="relative",k.style.left="auto",k.style.top="auto",k.style.zIndex="auto",h.$playerBorder),r=h.$player,n=o+(E%u==u-1?c:0),a=f+(E+u>=Math.pow(u,2)?l:0),d=_+(E%u==u-1?c:0),p=g+(E+u>=Math.pow(u,2)?l:0);k.style.width=d+"px",k.style.height=p+"px",k.style.display="block",r.style.width=n+"px",r.style.height=a+"px",r.style.display="block",t.style.width=n+"px",t.style.height=a+"px",t.style.display="block",h.player&&h.player.resize()}if(this.specialLayoutType){const E=this.windowList[0],h=E.$playerContainer,k=E.$player,t=E.$playerBorder,r=h.style.width.replace("px",""),n=h.style.height.replace("px",""),a=k.style.width.replace("px",""),d=k.style.height.replace("px","");let p,m,x,b;this.specialLayoutType===si?(p=2*r,m=2*n,x=2*a+2,b=2*d+2):this.specialLayoutType===ai&&(p=3*r,m=3*n,x=3*a+4,b=3*d+4),h.style.width=p+"px",h.style.height=m+"px",k.style.width=x+"px",k.style.height=b+"px",t.style.width=x+"px",t.style.height=b+"px",E.player&&E.player.resize(),T=this._getSpecialMaxSplit()}for(let E=T;E<this.maxWindowSize;E++){const h=this.windowList[E];h.player&&(h.player.destroy(),h.player=null),h.$playerContainer.style.display="none",h.$playerContainer.style.width="0",h.$playerContainer.style.height="0",h.$player.style.display="none",h.$playerBorder.style.display="none"}this._opt.split===1&&(this.windowList[0].$playerBorder.style.display="none")}_handleWindowSelect(e){const i=this.windowList[e];i?(this.currentWindowIndex=e,1<this.windowList.length&&(this.windowList.forEach(s=>{i.$playerBorder.style.display="block",s.$playerBorder.style.border="1px solid "+this._opt.style.border}),i.$playerBorder.style.border="1px solid "+this._opt.style.borderSelect)):this.debug.warn(this.LOG_TAG,`_handleWindowSelect() ${e} is not exist`),this._opt.split===1&&(i.$playerBorder.style.display="none")}_handleWindowContainerFullscreen(e){var i=this.windowList[e];if(i){if(i.isContainerFullscreen)i.$playerContainer.style.position="relative",i.$playerContainer.style.left="auto",i.$playerContainer.style.top="auto",i.$playerContainer.style.zIndex="auto",i.$playerContainer.style.width=i.prevInfo.playerContainerWidth,i.$playerContainer.style.height=i.prevInfo.playerContainerHeight,i.$player.style.width=i.prevInfo.playerWidth,i.$player.style.height=i.prevInfo.playerHeight,this.getSelectedWindowIndex()===e&&(i.$playerBorder.style.display="block");else{const s=this._getContainerRect(),u=s.width,c=s.height;i.prevInfo={playerContainerWidth:i.$playerContainer.style.width,playerContainerHeight:i.$playerContainer.style.height,playerWidth:i.$player.style.width,playerHeight:i.$player.style.height},i.$playerContainer.style.position="absolute",i.$playerContainer.style.top="0",i.$playerContainer.style.left="0",i.$playerContainer.style.zIndex="10",i.$playerContainer.style.width=u+"px",i.$playerContainer.style.height=c+"px",i.$player.style.width=u+"px",i.$player.style.height=c+"px",i.$playerBorder.style.display="none"}i.isContainerFullscreen=!i.isContainerFullscreen,i.player&&i.player.resize()}else this.debug.warn(this.LOG_TAG,`handleWindowContainerFullscreen() ${e} is not exist`)}_handleFullscreenResize(){let e=this._getContainerRect(),i=0;const s=setInterval(()=>{var u=this._getContainerRect();u.width===e.width&&u.height===e.height&&4<i?(this.resize(),clearInterval(s)):(e=u,i++)},300)}_listenFullscreenChange(){try{const e=i=>{Mt(i)===this.$container&&(this.emit(ae.fullscreen,at.isFullscreen),at.isFullscreen?this._handleFullscreenResize():this.resize())};at.on("change",e),this.events.destroys.push(()=>{at.off("change",e)})}catch{}}play(e,i,s){return new Promise((u,c)=>{he(i)&&(s=i,i={});const l=()=>{var _=this._createPlayer(f);(f.player=_).play(e,i).then(()=>{u()}).catch(g=>{c(g)})};var o=he(s)?s:this.currentWindowIndex;const f=this.windowList[o];f?f.player?f.player.destroy().then(()=>{f.player=null,l()}).catch(()=>{}):l():c(`play() windowIndex ${o} is not exist`)})}getOption(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];return i&&i.player?i.player.getOption():(this.debug.warn(this.LOG_TAG,`getOption() windowIndex ${e} is not exist`),{})}setDebug(e,i){i=he(i)?i:this.currentWindowIndex;var s=this.windowList[i];s&&s.player?s.player.setDebug(e):this.debug.warn(this.LOG_TAG,`setDebug() windowIndex ${i} is not exist`)}mute(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];i&&i.player?i.player.mute():this.debug.warn(this.LOG_TAG,`mute() windowIndex ${e} is not exist`)}cancelMute(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];i&&i.player?i.player.cancelMute():this.debug.warn(this.LOG_TAG,`cancelMute() windowIndex ${e} is not exist`)}setVolume(e,i){i=he(i)?i:this.currentWindowIndex;var s=this.windowList[i];s&&s.player?s.player.setVolume(e):this.debug.warn(this.LOG_TAG,`setVolume() windowIndex ${i} is not exist`)}audioResume(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];i&&i.player?i.player.audioResume():this.debug.warn(this.LOG_TAG,`audioResume() windowIndex ${e} is not exist`)}setTimeout(e,i){i=he(i)?i:this.currentWindowIndex;var s=this.windowList[i];s&&s.player?s.player.setTimeout(e):this.debug.warn(this.LOG_TAG,`setTimeout() windowIndex ${i} is not exist`)}setScaleMode(e,i){i=he(i)?i:this.currentWindowIndex;var s=this.windowList[i];s&&s.player?s.player.setScaleMode(e):this.debug.warn(this.LOG_TAG,`setScaleMode() windowIndex ${i} is not exist`)}pause(){let e=0<arguments.length&&arguments[0]!==void 0&&arguments[0],i=1<arguments.length?arguments[1]:void 0;return new Promise((s,u)=>{i=he(i)?i:this.currentWindowIndex;var c=this.windowList[i];c&&c.player?c.player.pause(e).then(()=>{s()}).catch(l=>{u(l)}):u(`pause() windowIndex ${i} is not exist`)})}close(e){return new Promise((i,s)=>{e=he(e)?e:this.currentWindowIndex;var u=this.windowList[e];u&&u.player?u.player.close().then(()=>{i()}).catch(c=>{s(c)}):s(`close() windowIndex ${e} is not exist`)})}clearView(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];i&&i.player?i.player.clearView():this.debug.warn(this.LOG_TAG,`clearView() windowIndex ${e} is not exist`)}setStreamQuality(e,i){i=he(i)?i:this.currentWindowIndex;var s=this.windowList[i];s&&s.player?s.player.setStreamQuality(e):this.debug.warn(this.LOG_TAG,`setStreamQuality() windowIndex ${i} is not exist`)}resize(){this._updateWindows()}setBufferTime(e,i){i=he(i)?i:this.currentWindowIndex;var s=this.windowList[i];s&&s.player?s.player.setBufferTime(e):this.debug.warn(this.LOG_TAG,`setBufferTime() windowIndex ${i} is not exist`)}setBufferDelayTime(e,i){i=he(i)?i:this.currentWindowIndex;var s=this.windowList[i];s&&s.player?s.player.setBufferDelayTime(e):this.debug.warn(this.LOG_TAG,`setBufferDelayTime() windowIndex ${i} is not exist`)}setRotate(e,i){i=he(i)?i:this.currentWindowIndex;var s=this.windowList[i];s&&s.player?s.player.setRotate(e):this.debug.warn(this.LOG_TAG,`setRotate() windowIndex ${i} is not exist`)}setMirrorRotate(e,i){i=he(i)?i:this.currentWindowIndex;var s=this.windowList[i];s&&s.player?s.player.setMirrorRotate(e):this.debug.warn(this.LOG_TAG,`setMirrorRotate() windowIndex ${i} is not exist`)}hasLoaded(e){return e=he(e)?e:this.currentWindowIndex,e=this.windowList[e],!(!e||!e.player)&&e.player.hasLoaded()}setKeepScreenOn(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];i&&i.player?i.player.setKeepScreenOn():this.debug.warn(this.LOG_TAG,`setKeepScreenOn() windowIndex ${e} is not exist`)}setFullscreen(e,i){i=he(i)?i:this.currentWindowIndex;var s=this.windowList[i];s&&s.player?s.player.setFullscreen(e):this.debug.warn(this.LOG_TAG,`setFullscreen() windowIndex ${i} is not exist`)}screenshot(e,i){return i=he(i)?i:this.currentWindowIndex,i=this.windowList[i],i&&i.player?i.player.screenshot(e.filename,e.format,e.quality,e.type):null}screenshotWatermark(e,i){return i=he(i)?i:this.currentWindowIndex,i=this.windowList[i],i&&i.player?i.player.screenshotWatermark(e):null}startRecord(e,i,s){return new Promise((u,c)=>{s=he(s)?s:this.currentWindowIndex;var l=this.windowList[s];l&&l.player?l.player.startRecord(e,i).then(()=>{u()}).catch(o=>{c(o)}):(this.debug.warn(this.LOG_TAG,`startRecord() windowIndex ${s} is not exist`),c(`windowIndex ${s} is not exist`))})}stopRecordAndSave(e,i,s){return new Promise((u,c)=>{s=he(s)?s:this.currentWindowIndex;var l=this.windowList[s];l&&l.player?l.player.stopRecordAndSave(e,i).then(o=>{u(o)}).catch(o=>{c(o)}):(this.debug.warn(this.LOG_TAG,`stopRecordAndSave() windowIndex ${s} is not exist`),c(`windowIndex ${s} is not exist`))})}isPlaying(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];return i&&i.player?i.player.isPlaying():(this.debug.warn(this.LOG_TAG,`isPlaying() windowIndex ${e} is not exist`),!1)}isLoading(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];return i&&i.player?i.player.isLoading():(this.debug.warn(this.LOG_TAG,`isLoading() windowIndex ${e} is not exist`),!1)}isPaused(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];return i&&i.player?i.player.isPaused():(this.debug.warn(this.LOG_TAG,`windowIndex ${e} is not exist`),!1)}isMute(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];return i&&i.player?i.player.isMute():(this.debug.warn(this.LOG_TAG,`isMute() windowIndex ${e} is not exist`),!1)}isRecording(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];return i&&i.player?i.player.isRecording():(this.debug.warn(this.LOG_TAG,`isRecording() windowIndex ${e} is not exist`),!1)}clearBufferDelay(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];i&&i.player?i.player.clearBufferDelay():this.debug.warn(this.LOG_TAG,`clearBufferDelay() windowIndex ${e} is not exist`)}setNetworkDelayTime(e,i){i=he(i)?i:this.currentWindowIndex;var s=this.windowList[i];s&&s.player?s.player.setNetworkDelayTime(e):this.debug.warn(this.LOG_TAG,`setNetworkDelayTime() windowIndex ${i} is not exist`)}getDecodeType(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];return i&&i.player?i.player.getDecodeType():(this.debug.warn(this.LOG_TAG,`getDecodeType() windowIndex ${e} is not exist`),null)}getRenderType(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];return i&&i.player?i.player.getRenderType():(this.debug.warn(this.LOG_TAG,`windowIndex ${e} is not exist`),null)}getAudioEngineType(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];return i&&i.player?i.player.getAudioEngineType():(this.debug.warn(this.LOG_TAG,`windowIndex ${e} is not exist`),null)}getPlayingTimestamp(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];return i&&i.player?i.player.getPlayingTimestamp():(this.debug.warn(this.LOG_TAG,`windowIndex ${e} is not exist`),null)}getStatus(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];return i&&i.player?i.player.getStatus():(this.debug.warn(this.LOG_TAG,`getStatus() windowIndex ${e} is not exist`),null)}getPlayType(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];return i&&i.player?i.player.getPlayType():(this.debug.warn(this.LOG_TAG,`getPlayType() windowIndex ${e} is not exist`),null)}togglePerformancePanel(e,i){i=he(i)?i:this.currentWindowIndex;var s=this.windowList[i];s&&s.player?s.player.togglePerformancePanel(e):this.debug.warn(this.LOG_TAG,`togglePerformancePanel() windowIndex ${i} is not exist`)}openZoom(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];i&&i.player?i.player.openZoom():this.debug.warn(this.LOG_TAG,`openZoom() windowIndex ${e} is not exist`)}closeZoom(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];i&&i.player?i.player.closeZoom():this.debug.warn(this.LOG_TAG,`closeZoom() windowIndex ${e} is not exist`)}isZoomOpen(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];return i&&i.player?i.player.isZoomOpen():(this.debug.warn(this.LOG_TAG,`isZoomOpen() windowIndex ${e} is not exist`),!1)}expandZoom(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];i&&i.player?i.player.expandZoom():this.debug.warn(this.LOG_TAG,`expandZoom() windowIndex ${e} is not exist`)}narrowZoom(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];i&&i.player?i.player.narrowZoom():this.debug.warn(this.LOG_TAG,`narrowZoom() windowIndex ${e} is not exist`)}getCurrentZoomIndex(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];return i&&i.player?i.player.getCurrentZoomIndex():(this.debug.warn(this.LOG_TAG,`getCurrentZoomIndex() windowIndex ${e} is not exist`),0)}setNakedFlowFps(e,i){i=he(i)?i:this.currentWindowIndex;var s=this.windowList[i];s&&s.player?s.player.setNakedFlowFps(e):this.debug.warn(this.LOG_TAG,`setNakedFlowFps() windowIndex ${i} is not exist`)}updateDebugLevel(e,i){i=he(i)?i:this.currentWindowIndex;var s=this.windowList[i];s&&s.player?s.player.updateDebugLevel(e):this.debug.warn(this.LOG_TAG,`updateDebugLevel() windowIndex ${i} is not exist`)}updateWatermark(e,i){i=he(i)?i:this.currentWindowIndex;var s=this.windowList[i];s&&s.player?s.player.updateWatermark(e):this.debug.warn(this.LOG_TAG,`updateWatermark() windowIndex ${i} is not exist`)}removeWatermark(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];i&&i.player?i.player.removeWatermark():this.debug.warn(this.LOG_TAG,`removeWatermark() windowIndex ${e} is not exist`)}updateFullscreenWatermark(e,i){i=he(i)?i:this.currentWindowIndex;var s=this.windowList[i];s&&s.player?s.player.updateFullscreenWatermark(e):this.debug.warn(this.LOG_TAG,`updateFullscreenWatermark() windowIndex ${i} is not exist`)}removeFullscreenWatermark(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];i&&i.player?i.player.removeFullscreenWatermark():this.debug.warn(this.LOG_TAG,`removeFullscreenWatermark() windowIndex ${e} is not exist`)}faceDetectOpen(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];i&&i.player?i.player.faceDetectOpen():this.debug.warn(this.LOG_TAG,`faceDetectOpen() windowIndex ${e} is not exist`)}faceDetectClose(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];i&&i.player?i.player.faceDetectClose():this.debug.warn(this.LOG_TAG,`faceDetectClose() windowIndex ${e} is not exist`)}objectDetectOpen(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];i&&i.player?i.player.objectDetectOpen():this.debug.warn(this.LOG_TAG,`objectDetectOpen() windowIndex ${e} is not exist`)}objectDetectClose(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];i&&i.player?i.player.objectDetectClose():this.debug.warn(this.LOG_TAG,`objectDetectClose() windowIndex ${e} is not exist`)}sendWebsocketMessage(e,i){i=he(i)?i:this.currentWindowIndex;var s=this.windowList[i];s&&s.player?s.player.sendWebsocketMessage(e):this.debug.warn(this.LOG_TAG,`sendWebsocketMessage() windowIndex ${i} is not exist`)}addContentToCanvas(e,i){i=he(i)?i:this.currentWindowIndex;var s=this.windowList[i];s&&s.player?s.player.addContentToCanvas(e):this.debug.warn(this.LOG_TAG,`addContentToCanvas() windowIndex ${i} is not exist`)}clearContentToCanvas(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];i&&i.player?i.player.clearContentToCanvas():this.debug.warn(this.LOG_TAG,`clearContentToCanvas() windowIndex ${e} is not exist`)}setControlHtml(e,i){i=he(i)?i:this.currentWindowIndex;var s=this.windowList[i];s&&s.player?s.player.setControlHtml(e):this.debug.warn(this.LOG_TAG,`setControlHtml() windowIndex ${i} is not exist`)}clearControlHtml(e){e=he(e)?e:this.currentWindowIndex;var i=this.windowList[e];i&&i.player?i.player.clearControlHtml():this.debug.warn(this.LOG_TAG,`clearControlHtml() windowIndex ${e} is not exist`)}destroySingle(e){return new Promise((i,s)=>{e=he(e)?e:this.currentWindowIndex;const u=this.windowList[e];u?u.player&&u.player.destroy().then(()=>{u.player=null,i()}).catch(c=>{s(c)}):(s("windowIndex is not exist"),this.debug.warn(this.LOG_TAG,`destroySingle() windowIndex ${e} is not exist`))})}setFullscreenMulti(e){return new Promise((i,s)=>{if(this.debug.log(this.LOG_TAG,"setFullscreenMulti",e),e)try{at.request(this.$container).then(()=>{i()}).catch(u=>{this.debug.error(this.LOG_TAG,"fullscreen request inner error",u),s(u)})}catch(u){this.debug.error(this.LOG_TAG,"fullscreen request error",u),s(u)}else try{at.exit().then(()=>{i()}).catch(u=>{this.debug.error(this.LOG_TAG,"fullscreen exit inner error",u),s(u)})}catch(u){this.debug.error(this.LOG_TAG,"fullscreen exit error",u),s(u)}})}selectWindow(e){this.debug.log(this.LOG_TAG,"selectWindow",e),this._handleWindowSelect(e)}arrangeWindow(e){this.debug.log(this.LOG_TAG,"arrangeWindow",e),e?[si,ai].includes(e)?this._arrangeSpecialWindow(e):this._opt.split===e&&this.specialLayoutType===null?this.debug.warn(this.LOG_TAG,`arrangeWindow() split ${e} is not changed`):(this.specialLayoutType=null,this._arrangeWindow(e)):this.debug.warn(this.LOG_TAG,`arrangeWindow() split ${e} is not valid`)}_arrangeWindow(e){(e=Ut(e))<1||!he(e)?this.debug.warn(this.LOG_TAG,`arrangeWindow() split ${e} is not valid`):(e>this._opt.maxSplit&&(e=this._opt.maxSplit),this._opt.split=e,this.currentWindowIndex=0,this._updateWindows(),this._handleWindowSelect(this.currentWindowIndex))}_arrangeSpecialWindow(e){this._opt.maxSplit<=3&&e===ai||this._opt.maxSplit<=2&&e===si?this.debug.warn(this.LOG_TAG,`_arrangeSpecialWindow() type ${e} is not valid because maxSplit is `+this._opt.maxSplit):this.specialLayoutType&&this.specialLayoutType===e?this.debug.warn(this.LOG_TAG,`_arrangeSpecialWindow() type ${e} is not changed`):(this.specialLayoutType=e)===si?this._arrangeWindow(3):e===ai?this._arrangeWindow(4):this.debug.warn(this.LOG_TAG,`_arrangeSpecialWindow() type ${e} is not valid`)}getCurrentSplit(){return this.specialLayoutType||this._opt.split}_getCurrentMaxSplit(){if(this.specialLayoutType){let e=0;return this.specialLayoutType===si?e=9:this.specialLayoutType===ai&&(e=16),e}return this._opt.split*this._opt.split}_getSpecialMaxSplit(){let e=0;return this.specialLayoutType===si?e=6:this.specialLayoutType===ai&&(e=8),e}getSelectedWindowIndex(){return this.currentWindowIndex}_findWindowItemIndex(e){return this.windowList.findIndex(i=>i.uuid===e.uuid)}}ji.MULTI_EVENTS=ri,ji.EVENTS=N,ji.ERROR=H,window.JessibucaProMulti=ji,window.WebPlayerProMulti=ji}),(function(Ae){typeof define=="function"&&define.amd?define(Ae):Ae()})(function(){class Ae{on(Y,Q,N){var ae=this.e||(this.e={});return(ae[Y]||(ae[Y]=[])).push({fn:Q,ctx:N}),this}once(Y,Q,N){const ae=this;function oe(){ae.off(Y,oe);for(var H=arguments.length,de=new Array(H),fe=0;fe<H;fe++)de[fe]=arguments[fe];Q.apply(N,de)}return oe._=Q,this.on(Y,oe,N)}emit(Y){for(var Q=((this.e||(this.e={}))[Y]||[]).slice(),N=arguments.length,ae=new Array(1<N?N-1:0),oe=1;oe<N;oe++)ae[oe-1]=arguments[oe];for(let H=0;H<Q.length;H+=1)Q[H].fn.apply(Q[H].ctx,ae);return this}off(Y,Q){const N=this.e||(this.e={});if(Y){var ae=N[Y],oe=[];if(ae&&Q)for(let H=0,de=ae.length;H<de;H+=1)ae[H].fn!==Q&&ae[H].fn._!==Q&&oe.push(ae[H]);return oe.length?N[Y]=oe:delete N[Y],this}Object.keys(N).forEach(H=>{delete N[H]}),delete this.e}}const Xe="debug",He="warn",ve="talkGetUserMediaSuccess",Ie="talkGetUserMediaFail",It="talkGetUserMediaTimeout",pe="talkStreamClose",Ze="talkStreamError",Gt="talkStreamInactive",wt={talkStreamClose:pe,talkStreamError:Ze,talkStreamInactive:Gt,talkGetUserMediaTimeout:It},Pt="open",St="g711a",Ht="g711u",Et="rtp",st="worklet",Tt={encType:St,packetType:Et,rtpSsrc:"0000000000",numberChannels:1,sampleRate:8e3,sampleBitsWidth:16,debug:!1,debugLevel:He,testMicrophone:!1,audioBufferLength:160,engine:st,checkGetUserMediaTimeout:!1,getUserMediaTimeout:1e4};var vt;function kt(){return new Date().getTime()}function Bt(Se){let Y="";if(typeof Se=="object")try{Y=JSON.stringify(Se),Y=JSON.parse(Y)}catch{Y=Se}else Y=Se;return Y}(function(Se){var Y,Q,N,ae,oe;Y=typeof window<"u"&&window.document!==void 0?window.document:{},Q=Se.exports,N=(function(){for(var H,de=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],fe=0,we=de.length,Te={};fe<we;fe++)if((H=de[fe])&&H[1]in Y){for(fe=0;fe<H.length;fe++)Te[de[0][fe]]=H[fe];return Te}return!1})(),ae={change:N.fullscreenchange,error:N.fullscreenerror},oe={request:function(H,de){return new Promise((function(fe,we){var Te=(function(){this.off("change",Te),fe()}).bind(this),Be=(this.on("change",Te),(H=H||Y.documentElement)[N.requestFullscreen](de));Be instanceof Promise&&Be.then(Te).catch(we)}).bind(this))},exit:function(){return new Promise((function(H,de){var fe,we;this.isFullscreen?(fe=(function(){this.off("change",fe),H()}).bind(this),this.on("change",fe),(we=Y[N.exitFullscreen]())instanceof Promise&&we.then(fe).catch(de)):H()}).bind(this))},toggle:function(H,de){return this.isFullscreen?this.exit():this.request(H,de)},onchange:function(H){this.on("change",H)},onerror:function(H){this.on("error",H)},on:function(H,de){H=ae[H],H&&Y.addEventListener(H,de,!1)},off:function(H,de){H=ae[H],H&&Y.removeEventListener(H,de,!1)},raw:N},N?(Object.defineProperties(oe,{isFullscreen:{get:function(){return!!Y[N.fullscreenElement]}},element:{enumerable:!0,get:function(){return Y[N.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return!!Y[N.fullscreenEnabled]}}}),Q?Se.exports=oe:window.screenfull=oe):Q?Se.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}})(vt={exports:{}}),vt.exports.isEnabled;try{if(typeof WebAssembly=="object"&&typeof WebAssembly.instantiate=="function"){var xt=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));xt instanceof WebAssembly.Module&&new WebAssembly.Instance(xt)instanceof WebAssembly.Instance}}catch{}class Vt{constructor(Q){var{fromSampleRate:Q,toSampleRate:N,channels:ae,inputBufferSize:oe}=Q;if(!Q||!N||!ae)throw new Error("Invalid settings specified for the resampler.");this.resampler=null,this.fromSampleRate=Q,this.toSampleRate=N,this.channels=ae||0,this.inputBufferSize=oe,this.initialize()}initialize(){this.fromSampleRate==this.toSampleRate?(this.resampler=Y=>Y,this.ratioWeight=1):(this.fromSampleRate<this.toSampleRate?(this.linearInterpolation(),this.lastWeight=1):(this.multiTap(),this.tailExists=!1,this.lastWeight=0),this.initializeBuffers(),this.ratioWeight=this.fromSampleRate/this.toSampleRate)}bufferSlice(Y){try{return this.outputBuffer.subarray(0,Y)}catch{try{return this.outputBuffer.length=Y,this.outputBuffer}catch{return this.outputBuffer.slice(0,Y)}}}initializeBuffers(){this.outputBufferSize=Math.ceil(this.inputBufferSize*this.toSampleRate/this.fromSampleRate/this.channels*1.0000004768371582)+this.channels+this.channels;try{this.outputBuffer=new Float32Array(this.outputBufferSize),this.lastOutput=new Float32Array(this.channels)}catch{this.outputBuffer=[],this.lastOutput=[]}}linearInterpolation(){this.resampler=Y=>{let Q,N,ae,oe,H,de,fe,we,Te,Be=Y.length,Oe=this.channels;if(Be%Oe!=0)throw new Error("Buffer was of incorrect sample length.");if(Be<=0)return[];for(Q=this.outputBufferSize,N=this.ratioWeight,ae=this.lastWeight,oe=0,H=0,de=0,fe=0,we=this.outputBuffer;ae<1;ae+=N)for(H=ae%1,oe=1-H,this.lastWeight=ae%1,Te=0;Te<this.channels;++Te)we[fe++]=this.lastOutput[Te]*oe+Y[Te]*H;for(--ae,Be-=Oe,de=Math.floor(ae)*Oe;fe<Q&&de<Be;){for(H=ae%1,oe=1-H,Te=0;Te<this.channels;++Te)we[fe++]=Y[de+(0<Te?Te:0)]*oe+Y[de+(Oe+Te)]*H;ae+=N,de=Math.floor(ae)*Oe}for(Te=0;Te<Oe;++Te)this.lastOutput[Te]=Y[de++];return this.bufferSlice(fe)}}multiTap(){this.resampler=Y=>{let Q,N,ae,oe,H,de,fe,we,Te,Be,Oe,Ye=Y.length,Je=this.channels;if(Ye%Je!=0)throw new Error("Buffer was of incorrect sample length.");if(Ye<=0)return[];for(Q=this.outputBufferSize,N=[],ae=this.ratioWeight,oe=0,de=0,we=!this.tailExists,this.tailExists=!1,Te=this.outputBuffer,Be=0,Oe=0,H=0;H<Je;++H)N[H]=0;do{if(we)for(oe=ae,H=0;H<Je;++H)N[H]=0;else{for(oe=this.lastWeight,H=0;H<Je;++H)N[H]=this.lastOutput[H];we=!0}for(;0<oe&&de<Ye;){if(fe=1+de-Oe,!(oe>=fe)){for(H=0;H<Je;++H)N[H]+=Y[de+(0<H?H:0)]*oe;Oe+=oe,oe=0;break}for(H=0;H<Je;++H)N[H]+=Y[de++]*fe;Oe=de,oe-=fe}if(oe!==0){for(this.lastWeight=oe,H=0;H<Je;++H)this.lastOutput[H]=N[H];this.tailExists=!0;break}for(H=0;H<Je;++H)Te[Be++]=N[H]/ae}while(de<Ye&&Be<Q);return this.bufferSlice(Be)}}resample(Y){return this.fromSampleRate==this.toSampleRate?this.ratioWeight=1:(this.fromSampleRate<this.toSampleRate?this.lastWeight=1:(this.tailExists=!1,this.lastWeight=0),this.initializeBuffers(),this.ratioWeight=this.fromSampleRate/this.toSampleRate),this.resampler(Y)}}const Wt=[255,511,1023,2047,4095,8191,16383,32767];function ci(Se,Y,Q){for(let N=0;N<Q;N++)if(Se<=Y[N])return N;return Q}class ei{constructor(Y){this.log=function(Q){if(Y._opt.debug&&Y._opt.debugLevel==Xe){const H=Y._opt.debugUuid?`[${Y._opt.debugUuid}]`:"";for(var N=arguments.length,ae=new Array(1<N?N-1:0),oe=1;oe<N;oe++)ae[oe-1]=arguments[oe];console.log(`JbPro${H}:[✅✅✅][${Q}]`,...ae)}},this.warn=function(Q){if(Y._opt.debug&&(Y._opt.debugLevel==Xe||Y._opt.debugLevel==He)){const H=Y._opt.debugUuid?`[${Y._opt.debugUuid}]`:"";for(var N=arguments.length,ae=new Array(1<N?N-1:0),oe=1;oe<N;oe++)ae[oe-1]=arguments[oe];console.log(`JbPro${H}:[❗❗❗][${Q}]`,...ae)}},this.error=function(Q){for(var N=Y._opt.debugUuid?`[${Y._opt.debugUuid}]`:"",ae=arguments.length,oe=new Array(1<ae?ae-1:0),H=1;H<ae;H++)oe[H-1]=arguments[H];console.error(`JbPro${N}:[❌❌❌][${Q}]`,...oe)}}}class pi{constructor(Y){this.destroys=[],this.proxy=this.proxy.bind(this),this.master=Y}proxy(Y,Q,N){let ae=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};if(Y){if(Array.isArray(Q))return Q.map(H=>this.proxy(Y,H,N,ae));Y.addEventListener(Q,N,ae);var oe=()=>{typeof Y.removeEventListener=="function"&&Y.removeEventListener(Q,N,ae)};return this.destroys.push(oe),oe}}destroy(){this.master.debug&&this.master.debug.log("Events","destroy"),this.destroys.forEach(Y=>Y()),this.destroys=[]}}class fi extends Ae{constructor(N){var Q=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},N=(super(),N&&(this.player=N),this.tag="talk",Bt(Tt));this._opt=Object.assign({},N,Q),this._opt.sampleRate=parseInt(this._opt.sampleRate,10),this._opt.sampleBitsWidth=parseInt(this._opt.sampleBitsWidth,10),this.audioContext=null,this.gainNode=null,this.recorder=null,this.workletRecorder=null,this.biquadFilter=null,this.userMediaStream=null,this.bufferSize=512,this._opt.audioBufferLength=this.calcAudioBufferLength(),this.audioBufferList=[],this.socket=null,this.socketStatus="notConnect",this.mediaStreamSource=null,this.heartInterval=null,this.checkGetUserMediaTimeout=null,this.wsUrl=null,this.startTimestamp=0,this.sequenceId=0,this.tempTimestamp=null,this.tempRtpBufferList=[],this.events=new pi(this),this._initTalk(),this.player||(this.debug=new ei(this)),this.log(this.tag,"init",this._opt)}destroy(){this.userMediaStream&&(this.userMediaStream.getTracks&&this.userMediaStream.getTracks().forEach(Y=>{Y.stop()}),this.userMediaStream=null),this.mediaStreamSource&&(this.mediaStreamSource.disconnect(),this.mediaStreamSource=null),this.recorder&&(this.recorder.disconnect(),this.recorder.onaudioprocess=null),this.biquadFilter&&(this.biquadFilter.disconnect(),this.biquadFilter=null),this.gainNode&&(this.gainNode.disconnect(),this.gainNode=null),this.workletRecorder&&(this.workletRecorder.disconnect(),this.workletRecorder=null),this.socket&&(this.socketStatus===Pt&&this._sendClose(),this.socket.close(),this.socket=null),this._stopHeartInterval(),this._stopCheckGetUserMediaTimeout(),this.audioContext=null,this.gainNode=null,this.recorder=null,this.audioBufferList=[],this.sequenceId=0,this.wsUrl=null,this.tempTimestamp=null,this.tempRtpBufferList=[],this.startTimestamp=0,this.log("talk","destroy")}addRtpToBuffer(Y){var Q=Y.length+this.tempRtpBufferList.length,Q=new Uint8Array(Q);Q.set(this.tempRtpBufferList,0),Q.set(Y,this.tempRtpBufferList.length),this.tempRtpBufferList=Q}downloadRtpFile(){var Y=new Blob([this.tempRtpBufferList]);try{var Q=document.createElement("a");Q.href=window.URL.createObjectURL(Y),Q.download=Date.now()+".rtp",Q.click()}catch(N){console.error("downloadRtpFile",N)}}calcAudioBufferLength(){var Y=this._opt.sampleRate;return 8*Y*.02/8}get socketStatusOpen(){return this.socketStatus===Pt}log(){for(var Y=arguments.length,Q=new Array(Y),N=0;N<Y;N++)Q[N]=arguments[N];this._log("log",...Q)}warn(){for(var Y=arguments.length,Q=new Array(Y),N=0;N<Y;N++)Q[N]=arguments[N];this._log("warn",...Q)}error(){for(var Y=arguments.length,Q=new Array(Y),N=0;N<Y;N++)Q[N]=arguments[N];this._log("error",...Q)}_log(Y){for(var Q=arguments.length,N=new Array(1<Q?Q-1:0),ae=1;ae<Q;ae++)N[ae-1]=arguments[ae];(this.player?this.player.debug:this.debug||console)[Y](...N)}_getSequenceId(){return++this.sequenceId}_createWebSocket(){return new Promise((Y,Q)=>{var N=this.events.proxy;this.socket=new WebSocket(this.wsUrl),this.socket.binaryType="arraybuffer",this.emit("talkStreamStart"),N(this.socket,"open",()=>{this.socketStatus=Pt,this.log(this.tag,"websocket open -> do talk"),this.emit("talkStreamOpen"),Y(),this._doTalk()}),N(this.socket,"message",ae=>{this.log(this.tag,"websocket message",ae.data)}),N(this.socket,"close",ae=>{this.socketStatus="close",this.log(this.tag,"websocket close"),this.emit(pe),Q(ae)}),N(this.socket,"error",ae=>{this.socketStatus="error",this.error(this.tag,"websocket error",ae),this.emit(Ze,ae),Q(ae)})})}_sendClose(){}_initTalk(){this._initMethods(),this._opt.engine===st?this._initWorklet():this._opt.engine==="script"&&this._initScriptProcessor(),this.log(this.tag,"audioContext samplerate",this.audioContext.sampleRate)}_initMethods(){this.audioContext=new(window.AudioContext||window.webkitAudioContext)({sampleRate:48e3}),this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=1,this.biquadFilter=this.audioContext.createBiquadFilter(),this.biquadFilter.type="lowpass",this.biquadFilter.frequency.value=3e3,this.resampler=new Vt({fromSampleRate:this.audioContext.sampleRate,toSampleRate:this._opt.sampleRate,channels:this._opt.numberChannels,inputBufferSize:this.bufferSize})}_initScriptProcessor(){var Y=this.audioContext.createScriptProcessor||this.audioContext.createJavaScriptNode;this.recorder=Y.apply(this.audioContext,[this.bufferSize,this._opt.numberChannels,this._opt.numberChannels]),this.recorder.onaudioprocess=Q=>this._onaudioprocess(Q)}_initWorklet(){var Y;this.audioContext.audioWorklet.addModule((Y=(function(){class Q extends AudioWorkletProcessor{constructor(ae){super(),this._cursor=0,this._bufferSize=ae.processorOptions.bufferSize,this._buffer=new Float32Array(this._bufferSize)}process(ae,oe,H){if(!ae.length||!ae[0].length)return!0;for(let de=0;de<ae[0][0].length;de++)this._cursor+=1,this._cursor===this._bufferSize&&(this._cursor=0,this.port.postMessage({eventType:"data",buffer:this._buffer})),this._buffer[this._cursor]=ae[0][0][de];return!0}}registerProcessor("talk-processor",Q)}).toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1],Y=new Blob([Y],{type:"application/javascript"}),URL.createObjectURL(Y))).then(()=>{var Q=new AudioWorkletNode(this.audioContext,"talk-processor",{processorOptions:{bufferSize:this.bufferSize}});Q.connect(this.gainNode),Q.port.onmessage=N=>{N.data.eventType==="data"&&this._encodeAudioData(N.data.buffer)},this.workletRecorder=Q})}_onaudioprocess(Y){Y=Y.inputBuffer.getChannelData(0),this._encodeAudioData(new Float32Array(Y))}_encodeAudioData(Y){if(Y[0]===0&&Y[1]===0)this.log(this.tag,"empty audio data");else{const N=this.resampler.resample(Y);let ae=N;if(this._opt.sampleBitsWidth===16?ae=(function(oe){let H=oe.length,de=new Int16Array(H);for(;H--;){var fe=Math.max(-1,Math.min(1,oe[H]));de[H]=fe<0?32768*fe:32767*fe}return de})(N):this._opt.sampleBitsWidth===8&&(ae=(function(oe){let H=oe.length,de=new Int8Array(H);for(;H--;){var fe=Math.max(-1,Math.min(1,oe[H]));de[H]=parseInt(255/(65535/(32768+(fe<0?32768*fe:32767*fe))),10)}return de})(N)),ae.buffer!==null){let oe=null;this._opt.encType===St?oe=(function(de){const fe=[];return Array.prototype.slice.call(de).forEach((we,Te)=>{fe[Te]=(function(Be){let Oe,Ye,Je;return 0<=Be?Oe=213:(Oe=85,(Be=-Be-1)<0&&(Be=32767)),8<=(Ye=ci(Be,Wt,8))?127^Oe:(Je=Ye<<4,(Je|=Ye<2?Be>>4&15:Be>>Ye+3&15)^Oe)})(we)}),fe})(ae):this._opt.encType===Ht&&(oe=(function(de){const fe=[];return Array.prototype.slice.call(de).forEach((we,Te)=>{fe[Te]=(function(Be){let Oe=0;Oe=Be<0?(Be=132-Be,127):(Be+=132,255);var Ye=ci(Be,Wt,8);return 8<=Ye?127^Oe:(Ye<<4|Be>>Ye+3&15)^Oe})(we)}),fe})(ae));const H=Uint8Array.from(oe);for(let de=0;de<H.length;de++){var Q=this.audioBufferList.length;this.audioBufferList[+Q]=H[de],this.audioBufferList.length===this._opt.audioBufferLength&&(this._sendTalkMsg(new Uint8Array(this.audioBufferList)),this.audioBufferList=[])}}}}_parseAudioMsg(Y){let Q=null;return this._opt.packetType!==Et||this._opt.encType!==St&&this._opt.encType!==Ht?this._opt.packetType==="opus"?Q=this.opusPacket(Y):this._opt.packetType==="empty"&&(Q=Y):Q=this.rtpPacket(Y),Q}rtpPacket(Y){var Q=[];let N=0,ae,oe;var H=this._opt.rtpSsrc,de=Y.length,de=(this._opt.encType===St?N=8:this._opt.encType===Ht&&(N=0),this.startTimestamp||(this.startTimestamp=kt()),oe=kt()-this.startTimestamp,ae=this._getSequenceId(),de+12),fe=(Q[0]=255&de>>8,Q[1]=255&de>>0,Q[2]=128,Q[3]=128+N,Q[4]=ae/256,Q[5]=ae%256,Q[6]=oe/65536/256,Q[7]=oe/65536%256,Q[8]=oe%65536/256,Q[9]=oe%65536%256,Q[10]=H/65536/256,Q[11]=H/65536%256,Q[12]=H%65536/256,Q[13]=H%65536%256,Q.concat([...Y])),we=new Uint8Array(fe.length);for(let Te=0;Te<fe.length;Te++)we[Te]=fe[Te];return we}opusPacket(Y){return Y}_sendTalkMsg(Y){this.tempTimestamp===null&&(this.tempTimestamp=kt());var Q=kt(),N=Q-this.tempTimestamp,ae=this._parseAudioMsg(Y);this.log(this.tag,`'send talk msg and diff is ${N} and byteLength is ${ae.byteLength} and length is ${ae.length}, and g711 length is `+Y.length),this._opt.packetType===Et&&this.addRtpToBuffer(ae),ae&&(this.socketStatusOpen?this.socket.send(ae.buffer):this.emit("tallWebsocketClosedByError")),this.tempTimestamp=Q}_doTalk(){this._getUserMedia()}_getUserMedia(){this.log(this.tag,"getUserMedia"),window.navigator.mediaDevices===void 0&&(window.navigator.mediaDevices={}),window.navigator.mediaDevices.getUserMedia===void 0&&(this.log(this.tag,"window.navigator.mediaDevices.getUserMedia is undefined and init function"),window.navigator.mediaDevices.getUserMedia=function(Y){var Q=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return Q?new Promise(function(N,ae){Q.call(navigator,Y,N,ae)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}),this._opt.checkGetUserMediaTimeout&&this._startCheckGetUserMediaTimeout(),window.navigator.mediaDevices.getUserMedia({audio:{latency:!0,noiseSuppression:!0,autoGainControl:!0,echoCancellation:!0,sampleRate:48e3,channelCount:1},video:!1}).then(Y=>{this.log(this.tag,"getUserMedia success"),this.userMediaStream=Y,this.mediaStreamSource=this.audioContext.createMediaStreamSource(Y),this.mediaStreamSource.connect(this.biquadFilter),this.recorder?(this.biquadFilter.connect(this.recorder),this.recorder.connect(this.gainNode)):this.workletRecorder&&(this.biquadFilter.connect(this.workletRecorder),this.workletRecorder.connect(this.gainNode)),this.gainNode.connect(this.audioContext.destination),this.emit(ve),Y.oninactive===null&&(Y.oninactive=Q=>{this._handleStreamInactive(Q)})}).catch(Y=>{this.error(this.tag,"getUserMedia error",Y.toString()),this.emit(Ie,Y.toString())}).finally(()=>{this.log(this.tag,"getUserMedia finally"),this._stopCheckGetUserMediaTimeout()})}_getUserMedia2(){this.log(this.tag,"getUserMedia"),navigator.mediaDevices?navigator.mediaDevices.getUserMedia({audio:!0}).then(Y=>{this.log(this.tag,"getUserMedia2 success")}):navigator.getUserMedia({audio:!0},this.log(this.tag,"getUserMedia2 success"),this.log(this.tag,"getUserMedia2 fail"))}async _getUserMedia3(){this.log(this.tag,"getUserMedia3");try{var Y=await navigator.mediaDevices.getUserMedia({audio:{latency:!0,noiseSuppression:!0,autoGainControl:!0,echoCancellation:!0,sampleRate:48e3,channelCount:1},video:!1});console.log("getUserMedia() got stream:",Y),this.log(this.tag,"getUserMedia3 success")}catch{this.log(this.tag,"getUserMedia3 fail")}}_handleStreamInactive(Y){this.userMediaStream&&(this.error(this.tag,"stream oninactive"),this.emit(Gt))}_startCheckGetUserMediaTimeout(){this._stopCheckGetUserMediaTimeout(),this.checkGetUserMediaTimeout=setTimeout(()=>{this.log(this.tag,"check getUserMedia timeout"),this.emit(It)},this._opt.getUserMediaTimeout)}_stopCheckGetUserMediaTimeout(){this.checkGetUserMediaTimeout&&(this.log(this.tag,"stop checkGetUserMediaTimeout"),clearTimeout(this.checkGetUserMediaTimeout),this.checkGetUserMediaTimeout=null)}_startHeartInterval(){this.heartInterval=setInterval(()=>{this.log(this.tag,"heart interval");var Y=[35,36,0,0,0,0,0,0],Y=new Uint8Array(Y);this.socket.send(Y.buffer)},15e3)}_stopHeartInterval(){this.heartInterval&&(this.log(this.tag,"stop heart interval"),clearInterval(this.heartInterval),this.heartInterval=null)}startTalk(Y){return new Promise((Q,N)=>(function(){let ae=!1;var oe=window.navigator;return ae=oe?(ae=!(!oe.mediaDevices||!oe.mediaDevices.getUserMedia))||!!(oe.getUserMedia||oe.webkitGetUserMedia||oe.mozGetUserMedia||oe.msGetUserMedia):ae})()?(this.wsUrl=Y,this._opt.testMicrophone?(this._doTalk(),Q()):(this._createWebSocket().catch(ae=>{N(ae)}),this.once(Ie,()=>{N("getUserMedia fail")}),void this.once(ve,()=>{Q()}))):N("not support getUserMedia"))}setVolume(Y){var Q;Y=parseFloat(Y).toFixed(2),isNaN(Y)||(Q=Y,Y=Math.max(Math.min(Q,Math.max(0,1)),Math.min(0,1)),this.gainNode.gain.value=Y)}getOption(){return this._opt}get volume(){return this.gainNode?parseFloat(100*this.gainNode.gain.value).toFixed(0):null}}class Me extends Ae{_opt={};constructor(){var Y=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};super(),this.talk=null,this._opt=Y,this.LOG_TAG="JessibucaProTalk",this.debug=new ei(this),this.debug.log(this.LOG_TAG,"init",JSON.stringify(Y))}destroy(){this.debug.log(this.LOG_TAG,"destroy()"),this.off(),this.talk&&(this.talk.destroy(),this.talk=null),this.debug.log(this.LOG_TAG,"destroy")}_initTalk(){var Y=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},Y=(this.talk&&(this.talk.destroy(),this.talk=null),Object.assign({},Bt(this._opt),Y));this.talk=new fi(null,Y),this.debug.log(this.LOG_TAG,"_initTalk",this.talk.getOption()),this._bindTalkEvents()}_bindTalkEvents(){Object.keys(wt).forEach(Y=>{this.talk.on(wt[Y],Q=>{this.emit(Y,Q)})})}startTalk(Y){let Q=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};return new Promise((N,ae)=>{this.debug.log(this.LOG_TAG,"startTalk",Y,JSON.stringify(Q)),this._initTalk(Q),this.talk.startTalk(Y).then(()=>{N(),this.talk.once(pe,()=>{this.debug.warn(this.LOG_TAG,"talkStreamClose"),this.stopTalk().catch(oe=>{})}),this.talk.once(Ze,oe=>{this.debug.error(this.LOG_TAG,"talkStreamError"),this.stopTalk().catch(H=>{})}),this.talk.once(Gt,()=>{this.debug.warn(this.LOG_TAG,"talkStreamInactive"),this.stopTalk().catch(oe=>{})})}).catch(oe=>{ae(oe)})})}stopTalk(){return new Promise((Y,Q)=>{this.debug.log(this.LOG_TAG,"stopTalk()"),this.talk||Q("talk is not init"),this.talk.destroy(),Y()})}getTalkVolume(){return new Promise((Y,Q)=>{this.talk||Q("talk is not init"),Y(this.talk.volume)})}setTalkVolume(Y){return new Promise((Q,N)=>{this.debug.log(this.LOG_TAG,"setTalkVolume",Y),this.talk||N("talk is not init"),this.talk.setVolume(Y/100),Q()})}downloadTempRtpFile(){return new Promise((Y,Q)=>{this.talk?(this.talk.downloadRtpFile(),Y()):Q("talk is not init")})}}Me.EVENTS=wt,window.JessibucaProTalk=Me,window.WebPlayerProTalk=Me}),{install(Ae){Ae.component("VideoPlayer",Cn)}}}));
